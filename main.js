(()=>{var e=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var i={};if(null!=r)for(var n in r)"default"!==n&&Object.prototype.hasOwnProperty.call(r,n)&&e(i,r,n);return t(i,r),i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("utils",["require","exports"],(function(e,t){"use strict";function r(e,t,r,i){let n=e/i;return-r*n*(n-2)+t}function i(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)}function n(e,t,r,n,o){let a=i(e,t,r,n,o);return n<o?a>o?a=o:a<n&&(a=n):a<o?a=o:a>n&&(a=n),a}Object.defineProperty(t,"__esModule",{value:!0}),t.getAngleFromVector=t.radiansToDegrees=t.getNormalizedVec=t.getAngleTowards=t.circleCircleCollision=t.calculateDistance=t.removeIfPresent=t.getRandBetween=t.timeoutPromise=t.normalizeEaseOutClamp=t.normalizeEaseOut=t.normalizeClamp=t.normalize=t.extrapolatePoint=t.truncatePoint3d=t.removeFileExtension=t.pixelToIsoCoords=t.isoToPixelCoords=void 0,t.isoToPixelCoords=(e,t,r)=>[e-t,(e+t)/2-(null!=r?r:0)/2],t.pixelToIsoCoords=(e,t)=>[(2*t+e)/2,(2*t-e)/2],t.removeFileExtension=e=>{let t=e.lastIndexOf(".");return t>-1&&(e=e.slice(0,t)),e},t.truncatePoint3d=e=>[e[0],e[1]],t.extrapolatePoint=e=>[e[0],e[1],0],t.normalize=i,t.normalizeClamp=n,t.normalizeEaseOut=function(e,t,n,o,a){return r(i(e,t,n,0,1),o,a-o,1)},t.normalizeEaseOutClamp=function(e,t,i,o,a){return r(n(e,t,i,0,1),o,a-o,1)},t.timeoutPromise=e=>new Promise(t=>{setTimeout(t,e)}),t.getRandBetween=(e,t)=>Math.floor(Math.random()*(t-e))+e,t.removeIfPresent=(e,t)=>{let r=e.indexOf(t);return r>-1&&(e.splice(r,1),!0)},t.calculateDistance=(e,t)=>{let[r,i,n]=e,[o,a,l]=t;return Math.sqrt(Math.pow(o-r,2)+Math.pow(a-i,2)+Math.pow(l-n,2))},t.circleCircleCollision=(e,r)=>{let[i,n,o]=e,[a,l,s]=r;return t.calculateDistance([i,n,0],[a,l,0])<=o+s},t.getAngleTowards=function(e,t){let[r,i]=e,[n,o]=t,a=o-i,l=n-r,s=Math.sqrt(l*l+a*a),c=0;return c=o>=i&&n>=r?180*Math.asin(a/s)/Math.PI+90:o>=i&&n<r?180*Math.asin(a/-s)/Math.PI-90:o<i&&n>r?180*Math.asin(a/s)/Math.PI+90:180*Math.asin(-a/s)/Math.PI-90,c>=360&&(c=360-c),c<0&&(c=360+c),c},t.getNormalizedVec=(e,t)=>{let r=Math.sqrt(e*e+t*t);return[e/r,t/r]},t.radiansToDegrees=e=>e*(180/Math.PI),t.getAngleFromVector=(e,r)=>{if(0==e)return r>0?90:0==r?0:270;if(0==r)return e>=0?0:180;let i=t.radiansToDegrees(Math.atan(r/e));return e<0&&r<0||e<0?i=180+i:r<0&&(i=270+(90+i)),i}})),define("model/utility",["require","exports","model/generics","utils","model/room"],(function(e,t,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=t.transformOffsetJumpFar=t.transformOffsetJumpMedium=t.transformOffsetJumpShort=t.transformOffsetFlat=t.TransformEase=t.Gauge=t.Timer=void 0;class o{constructor(e){this.timestampStart=r.getNow(),this.timestampPause=0,this.duration=e,this.shouldRemove=!1,this.isPaused=!1,this.awaits=[]}start(e){this.timestampStart=r.getNow(),this.duration=null!=e?e:this.duration}pause(){this.isPaused||(this.isPaused=!0,this.timestampPause=r.getNow())}unpause(){this.isPaused&&(this.isPaused=!1,this.updateStart(r.getNow()-this.timestampPause))}updateStart(e){this.timestampStart+=e}update(){this.isComplete()&&(this.awaits.forEach(e=>e()),this.awaits=[])}isComplete(){return r.getNow()-this.timestampStart>=this.duration}onCompletion(){return new Promise(e=>{this.isComplete()||this.awaits.push(e)})}getPctComplete(){let e=r.getNow();this.isPaused&&(e-=e-this.timestampPause);let t=e-this.timestampStart;return t>this.duration?t=this.duration:t<0&&(t=0),t/this.duration}markForRemoval(){this.shouldRemove=!0}}var a;t.Timer=o,t.Gauge=class{constructor(e,t){this.max=e,this.current=0,this.decayRate=t}fill(e){this.current+=e,this.current>this.max&&(this.current=this.max)}empty(){this.current=0}isFull(){return this.current>=this.max}getPct(){return this.current/this.max}update(){this.current-=this.decayRate*r.getFrameMultiplier(),this.current<0&&(this.current=0)}},function(e){e.LINEAR="linear",e.EASE_OUT="ease_out"}(a=t.TransformEase||(t.TransformEase={})),t.transformOffsetFlat=e=>[0*e,0*e,0*e],t.transformOffsetJumpShort=e=>[0,0,n.TILE_HEIGHT*Math.sin(e*Math.PI)],t.transformOffsetJumpMedium=e=>[0,0,2*n.TILE_HEIGHT*Math.sin(e*Math.PI)],t.transformOffsetJumpFar=e=>[0,0,4*n.TILE_HEIGHT*Math.sin(e*Math.PI)];class l{constructor(e,r,i,n,a){this.startX=e[0],this.startY=e[1],this.startZ=e[2],this.endX=r[0],this.endY=r[1],this.endZ=r[2],this.timer=new o(i),this.ease=n,this.shouldRemove=!1,this.offsetFunc=a||t.transformOffsetFlat,this.timer.start()}start(){return[this.startX,this.startY,this.endZ]}end(){return[this.endX,this.endY,this.endZ]}current(){let[e,t,r]=this.offsetFunc(this.timer.getPctComplete(),this),n=this.timer.getPctComplete(),o=this.ease===a.EASE_OUT?i.normalizeEaseOutClamp:i.normalizeClamp;return[o(n,0,1,this.startX,this.endX)+e,o(n,0,1,this.startY,this.endY)+t,o(n,0,1,this.startZ,this.endZ)+r]}update(){this.timer.update()}createInverse(){return new l([this.endX,this.endY,this.endZ],[this.startX,this.startY,this.startZ],this.timer.duration,this.ease,this.offsetFunc)}markForRemoval(){this.shouldRemove=!0}}t.Transform=l})),define("model/particle",["require","exports","model/utility","model/animation","utils","model/sprite","model/room"],(function(e,t,r,i,n,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.particleUpdate=t.particleGetSize=t.particleGetPos=t.particleCreateFromTemplate=t.createDamageParticle=t.EFFECT_TEMPLATE_SWORD_LEFT=void 0,t.EFFECT_TEMPLATE_SWORD_LEFT={animName:"effect_sword_left"},t.createDamageParticle=(e,t,i,o)=>{let l={anim:void 0,text:e,textParams:{size:16,color:null!=o?o:"white",align:"center",strokeColor:"black"},timer:new r.Timer(1e3),shouldRemove:!1,transform:new r.Transform([t,i,0],[t+n.getRandBetween(-a.TILE_WIDTH/2,a.TILE_WIDTH/2),i-a.TILE_HEIGHT,0],1e3,r.TransformEase.EASE_OUT),x:t,y:i};return l.timer.start(),l},t.particleCreateFromTemplate=(e,t)=>{var n;let a=i.createAnimation(t.animName+(t.flipped?o.SpriteModification.FLIPPED:o.SpriteModification.NORMAL)),[l,s]=a.getSpriteSize(1),c={anim:a,timer:new r.Timer(null!==(n=t.duration)&&void 0!==n?n:a.getDurationMs()),shouldRemove:!1,x:e[0]-l/2,y:e[1]-s/2};return a.start(),c.timer.start(),c},t.particleGetPos=e=>e.transform?n.truncatePoint3d(e.transform.current()):[e.x,e.y],t.particleGetSize=e=>{let t=e.anim;return(null==t?void 0:t.getSpriteSize(0))||[0,0]},t.particleUpdate=e=>{e.timer.isComplete()&&(e.shouldRemove=!0)}})),define("model/player",["require","exports","model/character","model/battle","utils"],(function(e,t,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.playerGetBattlePosition=t.playerSetBattlePosition=t.playerCreate=void 0,t.playerCreate=e=>{let t=r.characterCreateFromTemplate(e);return{leader:t,party:[t],battlePositions:{[i.BattlePosition.FRONT]:[t],[i.BattlePosition.MIDDLE]:[],[i.BattlePosition.BACK]:[]}}},t.playerSetBattlePosition=(e,t,r)=>{if(n.removeIfPresent(e.battlePositions[i.BattlePosition.FRONT],t),n.removeIfPresent(e.battlePositions[i.BattlePosition.MIDDLE],t),n.removeIfPresent(e.battlePositions[i.BattlePosition.BACK],t),!e.party.includes(t))throw console.error(e,t,r),Error("Cannot set battle position for player, the given character is not in the party.");e.battlePositions[r].push(t)},t.playerGetBattlePosition=(e,t)=>{if(e.battlePositions[i.BattlePosition.FRONT].includes(t))return i.BattlePosition.FRONT;if(e.battlePositions[i.BattlePosition.MIDDLE].includes(t))return i.BattlePosition.MIDDLE;if(e.battlePositions[i.BattlePosition.BACK].includes(t))return i.BattlePosition.BACK;throw Error("Cannot get battle position for party member who isn't in the player's party: "+JSON.stringify(t))}})),define("model/store",["require","exports"],(function(e,t){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.AppStateInitial=t.CutsceneSpeaker=t.AppSection=void 0,function(e){e.BattleUI="battleMenu",e.BattleVictory="battleVictory",e.BattleDefeated="battleDefeated",e.Cutscene="cutscene",e.Debug="debug"}(r=t.AppSection||(t.AppSection={})),function(e){e.Left="left",e.Left2="left2",e.Right="right",e.Right2="right2",e.Center="center",e.None="none"}(i=t.CutsceneSpeaker||(t.CutsceneSpeaker={})),t.AppStateInitial={sections:[r.Debug],cutscene:{text:"",speaker:i.None,visible:!0,portraitLeft:"",portraitLeftEmotion:"",portraitLeft2:"",portraitLeft2Emotion:"",portraitRight:"",portraitRightEmotion:"",portraitRight2:"",portraitRight2Emotion:"",portraitCenter:"",portraitCenterEmotion:""},battle:{chButtonsEnabled:!0}}})),define("view/style",["require","exports","preact","picostyle"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keyframes=t.style=t.MEDIA_QUERY_PHONE_WIDTH=t.colors=void 0;let o=(n=r(n)).default(i.h);t.colors={BLACK:"#111",WHITE:"#F8F8F8",GREY:"#999",DARKGREY:"#2E3740",RED:"#BE2633",GREEN:"#44891A",BROWN:"#A46422",ORANGE:"#FAB40B",PURPLE:"#9964F9",BLUE:"#31A2F2",YELLOW:"#F4B41B",DARKBLUE:"#243F72"},t.MEDIA_QUERY_PHONE_WIDTH="@media (max-width: 850px)",t.style=function(e,t){return o(e)(t)},t.keyframes=e=>n.keyframes(e)})),define("model/canvas",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getScreenSize=t.getDrawScale=t.setDrawScale=t.getCtx=t.getCanvas=t.createCanvas=t.CANVAS_ID=t.SCREEN_WIDTH=void 0,t.SCREEN_WIDTH=512,t.CANVAS_ID="canv";let r=null,i=1;t.createCanvas=(e,t)=>{let r=document.createElement("canvas");return r.width=e||1,r.height=t||1,[r,r.getContext("2d"),e,t]},t.getCanvas=()=>{if(r)return r;{let[e,i]=t.createCanvas(t.SCREEN_WIDTH,t.SCREEN_WIDTH);e.id=t.CANVAS_ID,i.imageSmoothingEnabled=!1;let n=document.getElementById("canvas-container");return n&&n.appendChild(e),r=e,e}},t.getCtx=()=>t.getCanvas().getContext("2d"),t.setDrawScale=e=>{i=e;let r=document.getElementById(t.CANVAS_ID);r&&(r.style.width=t.SCREEN_WIDTH*i+"",r.style.height=t.SCREEN_WIDTH*i+"",e>2&&(r.style.position="relative",r.style.left=-parseInt(r.style.width)/4+"px",r.style.top=-parseInt(r.style.height)/4+"px"))},t.getDrawScale=()=>i,t.getScreenSize=()=>t.SCREEN_WIDTH})),define("view/elements/Button",["require","exports","view/style"],(function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonType=void 0,function(e){e[e.PRIMARY=0]="PRIMARY",e[e.SECONDARY=1]="SECONDARY",e[e.CANCEL=2]="CANCEL"}(i=t.ButtonType||(t.ButtonType={}));let n={[i.PRIMARY]:r.colors.GREEN,[i.SECONDARY]:r.colors.GREY,[i.CANCEL]:r.colors.RED},o=r.style("div",e=>({textAlign:"center",borderRadius:"0.25rem",padding:"0.5rem",fontSize:"1rem",background:n[e.type],cursor:"pointer","&:hover":{filter:"brightness(120%)"},"&:active":{filter:"brightness(80%)"},[r.MEDIA_QUERY_PHONE_WIDTH]:{padding:"0.75rem",fontSize:"2rem"}}));t.default=o})),define("view/icons/Cursor",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{style:"transform: rotate(75deg)",stroke:e.color,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.h("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M21.1568 4.15379C21.5068 3.32658 20.6734 2.49321 19.8462 2.84319L3.46966 9.77172C2.60871 10.136 2.67381 11.3772 3.56814 11.6494L8.7707 13.2327C9.72737 13.5239 10.4761 14.2726 10.7672 15.2293L12.3506 20.4318C12.6228 21.3262 13.864 21.3913 14.2283 20.5303L21.1568 4.15379ZM19.0669 1.00125C21.5485 -0.048667 24.0486 2.45145 22.9987 4.93307L16.0702 21.3096C14.9775 23.8924 11.2538 23.6971 10.4373 21.0142L8.85389 15.8116C8.75683 15.4927 8.50727 15.2432 8.18837 15.1461L2.98581 13.5627C0.302836 12.7462 0.107539 9.02252 2.69038 7.92979L19.0669 1.00125Z",fill:e.color}))})),define("view/icons/Close",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{xmlns:"http://www.w3.org/2000/svg",id:"svg2",viewBox:"0 0 84.853 84.853",version:"1.0"},r.h("g",{id:"layer1",transform:"translate(-153.29 -132.79)"},r.h("g",{id:"g2762",transform:"matrix(.70711 -.70711 .70711 .70711 -66.575 189.71)",fill:e.color},r.h("rect",{id:"rect1872",y:"165.22",width:"100",x:"145.71",height:"20"}),r.h("rect",{id:"rect1874",transform:"rotate(90)",height:"20",width:"100",y:"-205.71",x:"125.22"}))))})),define("view/elements/VerticalMenu",["require","exports","preact","preact/hooks","view/style","view/icons/Cursor","view/icons/Close"],(function(e,t,r,n,o,a,l){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.MenuLineHeight=void 0,a=i(a),l=i(l),function(e){e[e.SMALL=0]="SMALL",e[e.MEDIUM=1]="MEDIUM",e[e.LARGE=2]="LARGE"}(s=t.MenuLineHeight||(t.MenuLineHeight={}));let c={backgroundColor:o.colors.BLACK,borderColor:o.colors.WHITE,lineHeight:s.MEDIUM,startingIndex:0},d=e=>{switch(e){case s.SMALL:return{fontSize:"12px",padding:"0.25rem",minHeight:"12px"};case s.MEDIUM:return{fontSize:"16px",padding:"0.5rem",minHeight:"16px"};case s.LARGE:return{fontSize:"24px",padding:"1rem",minHeight:"24px"}}},u=o.style("div",e=>({background:e.backgroundColor,position:"relative",width:e.width||"100%",border:"4px double "+e.borderColor,boxSizing:"border-box",transition:e.open?"transform 0.15s ease-out":"unset",transform:e.open?"scale(1.0)":"scale(0.0)"})),h=o.style("div",e=>({position:"relative","&:not(:last-child)":{borderBottom:"2px solid "+e.borderColor}})),p=o.style("div",e=>Object.assign(Object.assign({textAlign:"center"},d(e.lineHeight)),{color:"white",backgroundColor:e.backgroundColor,cursor:"pointer",filter:e.active?"brightness(80%)":"",transform:e.active?"translateY(2px)":""})),m=o.keyframes({"0%":{transform:"translateX(-5px)"},"20%":{transform:"translateX(0px)"},"100%":{transform:"translateX(-5px)"}}),g=o.style("div",()=>({color:o.colors.WHITE,position:"absolute",top:"0px",left:"-32px",animation:m+" 500ms linear infinite"})),f=()=>r.h(g,null,r.h(a.default,{color:o.colors.BLUE})),_=o.style("div",e=>({textAlign:"center",position:"relative",background:o.colors.DARKBLUE,display:"flex",justifyContent:e.title?"space-around":"center",alignItems:"baseline"})),v=o.style("div",e=>Object.assign(Object.assign({},d(e.lineHeight)),{width:"1rem",cursor:"pointer",background:e.backgroundColor,borderRight:"2px solid "+o.colors.WHITE,marginTop:"0.15rem","&:hover":{filter:"brightness(120%)"},"&:active":{filter:"brightness(80%)"}})),y=o.style("div",e=>Object.assign(Object.assign({},d(e.lineHeight)),{width:"calc(100% - 34px)"})),C=e=>{var t;let i=null!==(t=e.lineHeight)&&void 0!==t?t:s.MEDIUM;return r.h(_,{title:e.title},e.onClick?r.h(v,{backgroundColor:e.backgroundColor,onClick:e.onClick,lineHeight:i},r.h(l.default,{color:o.colors.RED})):null,r.h(y,{lineHeight:i},e.title||""))},w=function(e){var t,i,a;let[{cursorIndex:l,active:c},d]=n.useReducer(({cursorIndex:t,active:r},i)=>{var n;let o=t,a=r;return"Increment"===i.type?o=(o+1)%e.items.length:"Decrement"===i.type?o=(o-1+e.items.length)%e.items.length:"Set"===i.type?r||(o=null!==(n=i.payload)&&void 0!==n?n:0):"Select"===i.type?r||(a=!0,setTimeout(()=>{d({type:"SelectInactive"})},100)):"SelectInactive"===i.type&&(e.onItemClick(e.items[t].value),a=!1),{cursorIndex:o,active:a}},{cursorIndex:null!==(t=e.startingIndex)&&void 0!==t?t:0,active:!1});n.useEffect(()=>{let t=t=>{if(e.open&&!e.isInactive){let r=l;"ArrowDown"===t.code?d({type:"Increment"}):"ArrowUp"===t.code?(d({type:"Decrement"}),r=(r-1+e.items.length)%e.items.length):"Enter"===t.code?d({type:"Select"}):"Escape"===t.code&&e.onClose&&e.onClose()}};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[e.open,e.isInactive]);let m=e.lineHeight||s.MEDIUM;return r.h(u,{backgroundColor:null!==(i=e.backgroundColor)&&void 0!==i?i:o.colors.BLACK,borderColor:null!==(a=e.borderColor)&&void 0!==a?a:o.colors.WHITE,width:e.width,open:e.open},r.h(h,{key:"title",borderColor:e.borderColor},r.h(C,{backgroundColor:e.backgroundColor||o.colors.BLACK,onClick:e.onClose,lineHeight:e.lineHeight,title:e.title})),e.items.map((t,i)=>r.h(h,{key:i,borderColor:e.borderColor},r.h(p,{key:i,backgroundColor:e.backgroundColor,highlighted:l===i,lineHeight:m,active:c&&l===i,onClick:()=>{d({type:"Set",payload:i}),setTimeout(()=>{d({type:"Select"})})},onMouseOver:()=>{d({type:"Set",payload:i})}},t.label),l===i?r.h(f,null):null)))};w.defaultProps=c,t.default=w})),define("view/components/BattleSelectMenu",["require","exports","preact","view/elements/VerticalMenu","view/style","model/player","model/battle","model/character","controller/battle-management","controller/battle-actions","controller/ui-actions","model/store"],(function(e,t,r,n,o,a,l,s,c,d,u,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=i(n);let p=o.style("div",()=>({display:"flex",justifyContent:"center",alignItems:"center",height:"100%"})),m=o.style("div",()=>({display:"flex",justifyContent:"center",alignItems:"center"}));t.default=e=>r.h(p,null,r.h(n.default,{title:"SELECT BATTLE",width:"256px",open:!0,items:e.battles.map(({template:e,label:t})=>({label:r.h(m,null,r.h("span",null,t)),value:e})),onItemClick:e=>{(e=>{let t=a.playerCreate({name:"Ada",spriteBase:"ada",stats:l.battleStatsCreate(),facing:s.Facing.RIGHT,animationState:s.AnimationState.BATTLE_IDLE,skills:[d.BattleActions.Swing,d.BattleActions.Defend]}),r=s.characterCreateFromTemplate({name:"Conscience",spriteBase:"conscience",stats:l.battleStatsCreate(),facing:s.Facing.RIGHT,animationState:s.AnimationState.BATTLE_IDLE,skills:[d.BattleActions.Swing,d.BattleActions.Defend]});t.party.push(r),a.playerSetBattlePosition(t,r,l.BattlePosition.BACK),c.initiateBattle(t,e),u.showSection(h.AppSection.BattleUI,!0)})(e)}}))})),define("db/enemies",["require","exports","model/battle","model/character","controller/battle-actions"],(function(e,t,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.get=void 0;let o={};t.get=e=>{let t=o[e];if(!t)throw Error("No enemy template exists with name: "+e);return Object.assign(Object.assign({},t),{stats:Object.assign({},t.stats)})},t.init=()=>{o.ENEMY_GUY={name:"guy",spriteBase:"guy",stats:r.battleStatsCreate(),facing:i.Facing.LEFT,animationState:i.AnimationState.BATTLE_IDLE,skills:[n.BattleActions.SwingSlow]}}})),define("db/encounters",["require","exports","model/battle","controller/battle-ai","db/enemies"],(function(e,t,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.get=t.varyStats=void 0,t.varyStats=e=>{let t=e.stats,r=Object.keys(t);for(let e=0;e<r.length;e++){let i=r[e];"STAGGER"!==i&&Math.random()>.5&&(t[i]++,e--)}return e};let o={};t.get=e=>{let t=o[e];if(!t)throw Error("No encounter exists with name: "+e);return t},t.init=()=>{o.ENCOUNTER_ONE_VS_ONE={roomName:"battle1",enemies:[{chTemplate:t.varyStats(n.get("ENEMY_GUY")),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK}]},o.ENCOUNTER_ONE_VS_TWO={roomName:"battle1",enemies:[{chTemplate:t.varyStats(n.get("ENEMY_GUY")),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:t.varyStats(n.get("ENEMY_GUY")),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK}]},o.ENCOUNTER_ONE_VS_THREE={roomName:"battle1",enemies:[{chTemplate:t.varyStats(n.get("ENEMY_GUY")),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:t.varyStats(n.get("ENEMY_GUY")),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:t.varyStats(n.get("ENEMY_GUY")),position:r.BattlePosition.MIDDLE,ai:i.BATTLE_AI_ATTACK}]}},t.default=o})),define("controller/arcade-iframe-actions",["require","exports","utils"],(function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.setScaleWindow=t.setScaleOriginal=t.setButtonUp=t.setButtonDown=t.unmuteAudio=t.muteAudio=t.showControls=t.hideControls=void 0,function(e){e.HIDE_CONTROLS="HIDE_CONTROLS",e.SHOW_CONTROLS="SHOW_CONTROLS",e.MUTE_AUDIO="MUTE_AUDIO",e.UNMUTE_AUDIO="UNMUTE_AUDIO",e.BUTTON_DOWN="BUTTON_DOWN",e.BUTTON_UP="BUTTON_UP",e.SCALE_ORIGINAL="SCALE_ORIGINAL",e.SCALE_WINDOW="SCALE_WINDOW"}(i||(i={}));let n=window.location.origin,o=async()=>{let e=document.getElementById("arcade-iframe");if(e){let t=e;if(!t.contentWindow)for(let e=0;e<100&&(await r.timeoutPromise(33),!t.contentWindow);e++);return t.contentWindow}return console.error("Cannot get iframe contentWindow."),null},a=async(e,t)=>{e.postMessage(JSON.stringify(t),n)};t.hideControls=async()=>{let e=await o();e&&a(e,{action:i.HIDE_CONTROLS})},t.showControls=async()=>{let e=await o();e&&a(e,{action:i.SHOW_CONTROLS})},t.muteAudio=async()=>{let e=await o();e&&a(e,{action:i.MUTE_AUDIO})},t.unmuteAudio=async()=>{let e=await o();e&&a(e,{action:i.UNMUTE_AUDIO})},t.setButtonDown=async e=>{let t=await o();t&&a(t,{action:i.BUTTON_DOWN,payload:e})},t.setButtonUp=async e=>{let t=await o();t&&a(t,{action:i.BUTTON_UP,payload:e})},t.setScaleOriginal=async()=>{let e=await o();e&&a(e,{action:i.SCALE_ORIGINAL})},t.setScaleWindow=async()=>{let e=await o();e&&a(e,{action:i.SCALE_WINDOW})}})),define("view/elements/IframeShim",["require","exports","preact","view/style"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let n=i.style("div",e=>({border:"20px solid black",transition:"width 0.25s, height 0.25s, marginTop 0.25s",borderImage:`url(${e.borderImageUrl}) 20 round`,width:e.expanded?"calc(100% - 40px)":e.width,height:e.expanded?"calc(100% - 40px - 4rem)":e.height,marginTop:e.expanded?"4rem":"0",display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:"all",[i.MEDIA_QUERY_PHONE_WIDTH]:{width:e.expanded?"calc(100% - 40px)":e.width,height:e.expanded?"calc(100% - 40px - 7.75rem)":e.height,marginTop:e.expanded?"7.75rem":"0"}}));t.default=e=>r.h(n,{expanded:e.expanded,borderImageUrl:"res/img/arcade-border-1.png",width:e.width,height:e.height},r.h("iframe",{id:e.id,ref:e.ref,src:e.src,style:{border:"0px",width:e.width,height:e.height}}))})),define("view/icons/Arrow",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",style:"left"===e.direction?"transform: rotate(180deg)":""},r.h("g",{transform:"translate(0,0)"},r.h("path",{d:"M106.854 106.002a26.003 26.003 0 0 0-25.64 29.326c16 124 16 117.344 0 241.344a26.003 26.003 0 0 0 35.776 27.332l298-124a26.003 26.003 0 0 0 0-48.008l-298-124a26.003 26.003 0 0 0-10.136-1.994z",fill:e.color,"fill-opacity":"1"})))})),define("view/icons/Help",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",style:"width:100%"},r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M256 16C123.45 16 16 123.45 16 256s107.45 240 240 240 240-107.45 240-240S388.55 16 256 16zm0 60c99.41 0 180 80.59 180 180s-80.59 180-180 180S76 355.41 76 256 156.59 76 256 76zm0 30c-66.274 0-120 40.294-120 90 0 30 60 30 60 0 0-16.57 26.862-30 60-30 33.138 0 60 13.43 60 30s-30 15-60 30c-1.875.938-3.478 2.126-4.688 3.28C226.53 244.986 226 271.926 226 286v15c0 16.62 13.38 30 30 30 16.62 0 30-13.38 30-30v-15c0-45 90-40.294 90-90s-53.726-90-120-90zm0 240a30 30 0 0 0-30 30 30 30 0 0 0 30 30 30 30 0 0 0 30-30 30 30 0 0 0-30-30z",fill:e.color,"fill-opacity":"1"})))})),define("view/components/ArcadeCabinet",["require","exports","preact","preact/hooks","view/style","controller/arcade-iframe-actions","view/elements/Button","view/elements/IframeShim","view/icons/Arrow","view/icons/Help"],(function(e,t,n,o,a,l,s,c,d,u){"use strict";var h;Object.defineProperty(t,"__esModule",{value:!0}),t.ArcadeGamePath=void 0,s=r(s),c=i(c),d=i(d),u=i(u),function(e){e[e.Enter=13]="Enter",e[e.Space=32]="Space",e[e.Left=1073741904]="Left",e[e.Right=1073741903]="Right"}(h||(h={}));let p=e=>({onMouseDown:()=>{l.setButtonDown(e)},onMouseUp:()=>{l.setButtonUp(e)},onTouchStart:()=>{l.setButtonDown(e)},onTouchEnd:()=>{l.setButtonUp(e)}});var m;!function(e){e.PRESIDENT="iframes/president/president.html",e.TIC_TAC_TOE="iframes/tic-tac-toe/tic-tac-toe.html",e.INVADERZ="iframes/invaderz/Invaderz.html",e.ELASTICITY="iframes/elasticity/elasticity.html"}(m=t.ArcadeGamePath||(t.ArcadeGamePath={}));let g={[m.PRESIDENT]:{title:"President",controls:()=>n.h("div",null)},[m.TIC_TAC_TOE]:{title:"Tic Tac Toe",controls:()=>n.h(n.Fragment,null,n.h(S,Object.assign({width:"48px",height:"48px",type:"text"},p(h.Enter)),n.h(u.default,{color:a.colors.YELLOW})))},[m.INVADERZ]:{title:"INVADERZ",controls:()=>n.h(n.Fragment,null,n.h(S,Object.assign({width:"48px",height:"48px"},p(h.Left)),n.h(d.default,{color:a.colors.GREEN,direction:"left"})),n.h(S,Object.assign({width:"48px",height:"48px"},p(h.Right)),n.h(d.default,{color:a.colors.GREEN,direction:"right"})),n.h(S,Object.assign({width:"48px",height:"48px",type:"text"},p(h.Space)),"FIRE"),n.h(S,Object.assign({width:"48px",height:"48px",type:"text"},p(h.Enter)),"START"))},[m.ELASTICITY]:{title:"ELASTICITY",controls:()=>n.h(n.Fragment,null,n.h(S,Object.assign({width:"48px",height:"48px"},p(h.Left)),n.h(d.default,{color:a.colors.GREEN,direction:"left"})),n.h(S,Object.assign({width:"48px",height:"48px"},p(h.Right)),n.h(d.default,{color:a.colors.GREEN,direction:"right"})),n.h(S,Object.assign({width:"48px",height:"48px",type:"text"},p(h.Enter)),"START"))}},f=a.style("div",()=>({position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"})),_=a.style("div",e=>({position:"fixed",left:"0px",top:"0px",padding:"1rem",width:"100%",background:a.colors.BLACK,display:"flex",justifyContent:"flex-start",alignItems:"center",[a.MEDIA_QUERY_PHONE_WIDTH]:{padding:"2rem"}})),v=a.style("div",()=>({position:"relative",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",height:"100%",pointerEvents:"none"})),y=a.style("div",e=>({border:"20px solid "+a.colors.BLACK,background:a.colors.DARKBLUE,color:a.colors.WHITE,fontSize:"4rem",width:"646px",boxSizing:"border-box",textAlign:"center"})),C=a.style("div",()=>({backgroundImage:"url(res/img/arcade-cabinet.png)",width:"646px",height:"712px",position:"absolute",left:"0px",top:"0px",zIndex:"-1"})),w=a.style("div",e=>({minHeight:"96px",width:"548px",background:a.colors.GREY,textAlign:"center",zIndex:"1",display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:"all",transform:"perspective(512px) rotateX(24deg) translateY(12px)",border:"2px solid "+a.colors.WHITE})),S=a.style("div",e=>{var t,r;return{tapHighlightColor:"rgba(0, 0, 0, 0)",webkitTapHighlightColor:"rgba(0, 0, 0, 0)",padding:"16px",fontSize:"16px",minWidth:e.width?"unset":"48px",width:e.width,height:e.height,margin:"16px 4px",background:null!==(t=e.backgroundColor)&&void 0!==t?t:a.colors.DARKBLUE,color:null!==(r=e.color)&&void 0!==r?r:a.colors.WHITE,cursor:"pointer",borderRadius:"8px",border:"2px solid "+a.colors.GREY,textAlign:"center",fontFamily:"monospace",userSelect:"none",display:"text"===e.type?"flex":"",justifyContent:"center",touchAction:"manipulate",alignItems:"center","&:hover":{filter:"brightness(120%)"},"&:active":{filter:"brightness(80%)"}}});t.default=e=>{let[t,r]=o.useState(!1),[i,a]=o.useState(!1),d=g[e.game];return n.h(f,null,n.h(_,null,n.h(s.default,{type:s.ButtonType.CANCEL,style:{marginRight:"1rem"}},"Back"),n.h(s.default,{type:s.ButtonType.PRIMARY,style:{marginRight:"1rem"},onClick:()=>{let e=!t;r(e),e?(l.showControls(),l.setScaleWindow()):(l.hideControls(),l.setScaleOriginal())}},t?"Contract":"Expand"),n.h(s.default,{type:s.ButtonType.PRIMARY,style:{marginRight:"1rem"},onClick:()=>{let e=!i;a(e),e?l.muteAudio():l.unmuteAudio()}},i?"Unmute":"Mute")),n.h(v,null,t?null:n.h(y,null,d.title),n.h("div",{style:{transition:"height 0.25s",height:t?"0px":"32px",width:"646px",position:"relative"}},t?null:n.h(C,null)),n.h(c.default,{id:"arcade-iframe",src:e.game+"?cabinet=true&mute=true",width:t?"100%":"512px",height:t?"100%":"512px",expanded:t}),t?null:n.h(w,{id:"controls"},d.controls())))}})),define("model/overworld",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overworldCharacterCreate=void 0,t.overworldCharacterCreate=e=>({ch:e.ch})})),define("controller/overworld-management",["require","exports","model/room","model/generics","model/character"],(function(e,t,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateOverworld=t.initiateOverworld=void 0,t.initiateOverworld=(e,t,o)=>{let a=r.getRoom(t.roomName),l=e.leader,s={ch:l};n.characterSetPos(l,o||[0,0,0]),a.characters.push(l);let c={room:a,people:[s]};return i.setCurrentRoom(a),i.setCurrentPlayer(e),i.setCurrentOverworld(c),c},t.updateOverworld=e=>{let t=i.getCurrentPlayer().leader,r=!1,o=0,a=0;i.getKeyUpdateEnabled()&&(i.isKeyDown("ArrowLeft")?(r=!0,o-=1,a+=1):i.isKeyDown("ArrowRight")&&(r=!0,o+=1,a-=1),i.isKeyDown("ArrowUp")?(r=!0,o-=1,a-=1):i.isKeyDown("ArrowDown")&&(r=!0,o+=1,a+=1),n.characterSetAnimationState(t,r?n.AnimationState.WALK:n.AnimationState.IDLE),t.vx=o,t.vy=a)}})),define("model/scene",["require","exports","controller/scene-management","model/generics"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sceneGetCommands=t.sceneHasCommand=t.sceneIsWaiting=t.initScene=t.sceneCreate=void 0,t.sceneCreate=()=>{let e={storage:{},storageOnce:{},storageOnceKeys:{},commands:{},currentScript:null,currentTrigger:null,scriptStack:[],isWaitingForInput:!1,isWaitingForTime:!1,isWaitingForAnimation:!1,waitTimeoutId:-1};return Object.assign(e.commands,r.getSceneCommands(e)),e},t.initScene=()=>{i.setCurrentScene(t.sceneCreate())},t.sceneIsWaiting=e=>e.isWaitingForInput||e.isWaitingForTime||e.isWaitingForAnimation,t.sceneHasCommand=(e,r)=>!!t.sceneGetCommands(e)[r],t.sceneGetCommands=e=>e.commands})),define("lib/rpgscript",["require","exports","model/scene"],(function(e,t,r){"use strict";function i(e){return function(e){return e.map(e=>'"'===e[0]||"'"===e[0]?e.slice(1,-1):e)}(e).map(e=>isNaN(parseFloat(e))?e:parseFloat(e))}var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getTrigger=t.getScript=t.loadRPGScript=t.ScriptParser=t.Script=t.Trigger=t.TriggerType=t.formatArgs=void 0,t.formatArgs=i,(n=t.TriggerType||(t.TriggerType={})).STEP="step",n.ACTION="action";class o{constructor(e,t,r){this.name=e,this.filename=t,this.lineNum=r,this.scriptCalls=[]}addScriptCall(e,t,r){this.scriptCalls.push({type:e,condition:t,scriptName:r})}}t.Trigger=o;class a{constructor(e,t,r){this.name=e,this.filename=t,this.lineNum=r,this.blocks=[],this.soundNameStorage={},this.currentBlockIndex=0,this.currentCommandIndex=0,this.sounds=0,this.soundsPerCharacter={}}reset(){this.currentBlockIndex=0,this.currentCommandIndex=0}isValid(e){if(!e)return!0;for(let t=0;t<this.blocks.length;t++){let i=this.blocks[t];for(let t=0;t<i.commands.length;t++){let n=i.commands[t];if(!r.sceneHasCommand(e,n.type))return`Error in script "${this.name}"\n\nNo command exists with name "${n.type}" and args "${n.args.join(",")}" `}}return!0}getNextCommand(){let e=this.blocks[this.currentBlockIndex];if(e){let t=e.commands[this.currentCommandIndex];return t?(this.currentCommandIndex++,{args:t.args,type:t.type,conditional:e.conditional}):(this.currentBlockIndex++,this.currentCommandIndex=0,this.getNextCommand())}return null}getNextDialog(e){this.soundsPerCharacter[e]?this.soundsPerCharacter[e]++:this.soundsPerCharacter[e]=1;let t=this.soundsPerCharacter[e];t<10&&(t="0"+t);let r=this.name+"/"+this.sounds,i=this.name+"/"+e+"-"+t;return this.sounds++,{soundNameIndexed:r,soundNameCh:i}}addCommandBlock(){let e={conditional:!0,commands:[]};return this.blocks.push(e),e}}t.Script=a;class l{constructor(e){this.name=e,this.soundsToLoad=[]}throwParsingError(e,t,r){throw console.error(`{Line ${t}} Script parsing error ${this.name}: ${e} CONTENTS [\n"${r}"\n]`),Error("Parsing error")}parseCommand(e,t,r){let n=(e=e.trim()).indexOf("("),o=e.lastIndexOf(")");if(e.match(/^(\w)+:/))return this.createDialogCommand(e,r);-1!==n&&0!==n||this.throwParsingError("Invalid command, no name provided",t,e),-1!==o&&0!==o||this.throwParsingError("Invalid command, no end parens",t,e);let a=e.substr(n+1,e.length-(n+1)-(e.length-o));return a=function(e,t){let r=[],i="",n="",o=!1;for(let t=0;t<e.length;t++){let a=e[t];n?a===n&&(n="",o=!1):'"'===a||"'"===a?(n=a,o=!0):"("===a?o=!0:")"===a&&(o=!1),o||","!==e[t]?i+=a:(r.push(i),i="")}return i&&r.push(i),r}(a).map(e=>e.trim()),a.forEach(r=>{"'"===r[0]?"'"!==r[r.length-1]&&this.throwParsingError('Invalid command, unterminated single quote "\'"',t,e):'"'===r[0]&&'"'!==r[r.length-1]&&this.throwParsingError("Invalid command, unterminated double quote '\"'",t,e)}),{type:e.substr(0,n),args:i(a)}}parseConditional(e,t,r){let{type:i,args:n}=this.parseCommand(e,t,r);return["is","isnot","gt","lt","eq","any","all","as","once","with"].includes(i)||this.throwParsingError(`Invalid conditional, no type named "${i}"`,t,e),{type:i,args:n.map(e=>"string"==typeof e&&-1!==e.indexOf("(")?this.parseCommand(e,t,r):e)}}combineConditionals(e,t,r){return{type:r,args:[e,t]}}getConditionalFromLine(e,t,r){let i=function(e,t){let r="",i=!1;for(let t=0;t<e.length;t++){let n=e[t];if(r?n===r&&(r="",i=!1):'"'===n||"'"===n?(r=n,i=!0):"("===n?i=!0:")"===n&&(i=!1),!i&&"?"===e[t])return t}return-1}(e);if(i>-1){let n=e.indexOf(":");-1===n&&this.throwParsingError("Invalid conditional, no ending ':'",t,e);let o=e.slice(i+1,n);return{conditional:this.parseConditional(o.trim(),t,r),endIndex:n+1}}return{conditional:!0,endIndex:0}}createDialogCommand(e,t){let[r,n]=e.split(":"),o="playDialogue";"_"===r[0]&&(r=r.slice(1),o="playDialogueInterruptable"),n=n.trim();let{soundNameCh:a,soundNameIndexed:l}=t.getNextDialog(r);return this.soundsToLoad.push({soundNameCh:a,soundNameIndexed:l}),{type:o,args:i([r,n,a])}}parse(e,t){let r={},i={},n=!1,l=!1,s=!1,c=null,d=null,u=null,h=null,p=e.split("\n");if(p.forEach((e,p)=>{if(p+=1,0===(e=e.trim()).length)return;if("/"===e[0]&&"/"===e[1])return;let m=e[0];if("{"===m)n=!0;else if("}"===m)n=!1,c=null;else if("@"!==m||n){if("$"===m)s=!0,l=!1,d&&(c=d.addCommandBlock(),c.conditional=!0,c.commands.push({type:"showChoices",args:[]}));else if("#"===m)l=!0,s=!1,h=e.substr(1),u=new o(e.substr(1),this.name,p),((e,t)=>{r[e]=t})(e.substr(1),u);else if("+"===m||n){let t=e.substr(n?0:1);if(d){let{conditional:e,endIndex:r}=this.getConditionalFromLine(t,p,d);if("object"==typeof e){if("{"===t[r])return n=!0,c=d.addCommandBlock(),void(c.conditional=e);if(r===t.length)return c=d.addCommandBlock(),void(c.conditional=e)}let i=t.substr(r);"+"===i[0]&&(i=i.slice(1));let{type:o,args:a}=this.parseCommand(i,p,d),l=null;n?(null===c&&(c=d.addCommandBlock(),c.conditional=e),l=c):(l=c=d.addCommandBlock(),l.conditional=e),l.commands.push({type:o,args:a})}}else if(s){let t=e.indexOf(":");-1===t&&this.throwParsingError("Invalid choice definition, no colon '\"'",p,e);let r=e.substr(0,t),i=e.substr(t+1);c&&c.commands[0].args.push({text:r,target:i})}else if(l){let t=e.indexOf(",");-1===t&&this.throwParsingError("Invalid trigger script call, invalid number of arguments",p,e);let r=e.substr(0,t),i=e.substr(t+1),n=null;if("item"===r&&(n={type:"with",args:[i.slice(0,i.indexOf(","))]},i=i.slice(i.indexOf(",")+1)),d){let{conditional:e,endIndex:t}=this.getConditionalFromLine(i,p,d),o=e;n&&(o=this.combineConditionals(n,e,"and"));let a=i.substr(t);"this"===a&&h&&(a=h),u&&u.addScriptCall(r,o,a)}}else if(">"===m)c&&c.commands.push({type:"callScript",args:[e.substr(1)]});else if(l=!1,d){let t=d.addCommandBlock(),r=this.createDialogCommand(e,d);t.commands.push(r)}}else{let r=e.substr(1,e.length-1);if("this"===r&&(r=h||""),0===r.length&&this.throwParsingError("Invalid script name",p,e),d){let e=d.isValid(t);!0!==e&&this.throwParsingError(e,p-1,"")}d=new a(r,this.name,p),i[r]=d,l=!1,s=!1}}),d){let e=d.isValid(t);!0!==e&&this.throwParsingError(e,p.length,p[p.length-1])}return{triggers:r,scripts:i}}}t.ScriptParser=l;let s={},c={};t.loadRPGScript=async(e,t)=>{let r=`res/rpgscript/${e}.rpgscript`,i=await(await fetch(r)).text(),n=new l(e),{triggers:o,scripts:a}=n.parse(i,t);Object.assign(s,a),Object.assign(c,o)},t.getScript=e=>{let t=s[e];if(!t)throw Error("Cannot get script with name "+e);return t},t.getTrigger=e=>{let t=c[e];if(!t)throw Error("Cannot get trigger with name "+e);return t}})),define("controller/events",["require","exports","model/generics","model/canvas","model/battle","controller/loop","model/generics","controller/scene-management","model/generics","controller/ui-actions","model/store"],(function(e,t,r,i,n,o,a,l,s,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.popKeyHandler=t.pushKeyHandler=t.getCurrentKeyHandler=t.initEvents=void 0,t.initEvents=()=>{let e=document.getElementById(i.CANVAS_ID),{left:u,top:h,width:p,height:m}=(null==e?void 0:e.getBoundingClientRect())||{left:0,top:0,width:0,height:0};window.addEventListener("mousemove",e=>{let{clientX:t,clientY:i}=e,n=t-u,o=i-h;n>p&&(n=p),o>m&&(o=m),r.setMousePos(n,o)}),window.addEventListener("keydown",e=>{r.setKeyDown(e.key);let i=t.getCurrentKeyHandler();i&&i(e)}),window.addEventListener("keyup",e=>{r.setKeyUp(e.key)}),t.pushKeyHandler(async e=>{switch(e.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":break;case"p":case"P":r.getIsPaused()?o.unpause():o.pause();break;case"x":case"X":{let e=a.getCurrentBattle(),t=e.allies[0];n.battleCharacterGetSelectedSkill(t).cb(e,t);break}case"c":r.getKeyUpdateEnabled()&&(s.disableKeyUpdate(),await l.callScript(s.getCurrentScene(),"test-walkToMarker"),c.showSection(d.AppSection.Debug,!0),s.enableKeyUpdate())}})};let u=[];t.getCurrentKeyHandler=()=>u[u.length-1],t.pushKeyHandler=e=>{u.push(e)},t.popKeyHandler=e=>{let t=u.indexOf(e);t>-1&&u.splice(t,1)}})),define("controller/scene-commands",["require","exports","view/ui","controller/ui-actions","model/store","controller/events","model/character","model/room","model/generics","controller/scene-management","utils"],(function(e,t,r,i,n,o,a,l,s,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.walkToMarker=t.setCharacterAt=t.shakeScreen=t.setFacing=t.lookAtEachOther=t.lookAtMarker=t.lookAtCharacter=t.callScript=t.setStorage=t.waitMSPreemptible=t.waitMS=t.setConversationSpeaker=t.endConversation=t.setConversation=t.setConversation2=t.playDialogue=void 0,t.playDialogue=(e,t,o)=>{let{cutscene:a}=r.getUiInterface().appState,l=n.CutsceneSpeaker.None;return e=e.toLowerCase(),a.portraitLeft===e?l=n.CutsceneSpeaker.Left:a.portraitLeft2===e?l=n.CutsceneSpeaker.Left2:a.portraitRight===e?l=n.CutsceneSpeaker.Right:a.portraitRight2===e?l=n.CutsceneSpeaker.Right2:a.portraitCenter===e&&(l=n.CutsceneSpeaker.Center),i.setCutsceneText(t,l),h()},t.setConversation2=(e,t)=>{i.startConversation2(""+e.toLowerCase(),""+t.toLowerCase())},t.setConversation=e=>{i.startConversation(""+e.toLowerCase())},t.endConversation=e=>(i.setCutsceneText(""),i.hideConversation(),t.waitMS(null!=e?e:1e3)),t.setConversationSpeaker=e=>{i.setCutsceneText("",e)},t.waitMS=(e,t)=>{let r=s.getCurrentScene();return r.isWaitingForTime=!0,clearTimeout(r.waitTimeoutId),r.waitTimeoutId=setTimeout(()=>{r.isWaitingForTime=!1,t&&t()},e),!0},t.waitMSPreemptible=(e,t)=>{let r=s.getCurrentScene(),i=e=>{switch(e.key){case"Return":case"Enter":case" ":clearTimeout(r.waitTimeoutId),o.popKeyHandler(i),n()}};o.pushKeyHandler(i);let n=()=>{r.isWaitingForTime=!1,t&&t(),o.popKeyHandler(i)};return r.isWaitingForTime=!0,clearTimeout(r.waitTimeoutId),r.waitTimeoutId=setTimeout(n,e),!0};let u=()=>{let e=s.getCurrentScene();return e.isWaitingForTime=!0,()=>{e.isWaitingForTime=!1}},h=e=>{let t=s.getCurrentScene();t.isWaitingForInput=!0;let r=e=>{switch(e.key){case"Return":case"Enter":case" ":clearTimeout(t.waitTimeoutId),o.popKeyHandler(r),i()}};o.pushKeyHandler(r);let i=()=>{t.isWaitingForInput=!1,e&&e(),o.popKeyHandler(r)};return i};t.setStorage=(e,t)=>{s.getCurrentScene()[e]=t},t.callScript=e=>{let t=s.getCurrentScene();return c.callScript(t,e),!0},t.lookAtCharacter=(e,t)=>{let r=s.getCurrentRoom(),i=l.roomGetCharacterByName(r,e),n=l.roomGetCharacterByName(r,t);if(i)if(n){if(i&&n){let e=a.characterGetPosCenterPx(i),t=a.characterGetPosCenterPx(n),r=d.getAngleTowards(e,t);a.characterSetFacingFromAngle(i,r)}}else console.error("Could not find target character with name: "+t);else console.error("Could not find character with name: "+e)},t.lookAtMarker=(e,t)=>{let r=s.getCurrentRoom(),i=l.roomGetCharacterByName(r,e),n=r.markers[t];if(i)if(n){if(i&&n){let e=a.characterGetPosCenterPx(i),t=d.getAngleTowards(e,[n.x,n.y]);a.characterSetFacingFromAngle(i,t)}}else console.error("Could not find target marker with name: "+t);else console.error("Could not find character with name: "+e)},t.lookAtEachOther=(e,r)=>{t.lookAtCharacter(e,r),t.lookAtCharacter(r,e)},t.setFacing=(e,t)=>{let r=l.roomGetCharacterByName(s.getCurrentRoom(),e);r?(t===a.Facing.RIGHT2?t=a.Facing.RIGHT:t===a.Facing.RIGHT_UP2?t=a.Facing.RIGHT_UP:t===a.Facing.RIGHT_DOWN2&&(t=a.Facing.RIGHT_DOWN),a.characterSetFacing(r,t)):console.error("Cannot set facing, no character named:",e,"facing=",t)},t.shakeScreen=e=>{let r=document.getElementById("canvas-container");return r&&(r.className="shake"),t.waitMS(null!=e?e:1e3,()=>{r&&(r.className="")})},t.setCharacterAt=(e,t,r,i)=>{let n=s.getCurrentRoom(),o=l.roomGetCharacterByName(n,e);o?o&&a.characterSetPos(o,[t,r,null!=i?i:0]):console.error("Could not find character with name: "+e)},t.walkToMarker=(e,t,r,i,n)=>{let o=s.getCurrentRoom(),c=l.roomGetCharacterByName(o,e),d=o.markers[t];if(c)if(d){if(c&&d){let e=[d.x+(null!=r?r:0)+16,d.y+(null!=i?i:0)+16];if(!n)return a.characterSetWalkTarget(c,e,u()),!0;a.characterSetWalkTarget(c,e,()=>{})}}else console.error("Could not find target marker with name: "+t);else console.error("Could not find character with name: "+e)};let p={playDialogue:t.playDialogue,setConversation2:t.setConversation2,setConversation:t.setConversation,endConversation:t.endConversation,pauseConversation:e=>(i.hideConversation(),t.waitMS(null!=e?e:1e3,()=>{i.showConversation()})),setConversationSpeaker:t.setConversationSpeaker,waitMS:t.waitMS,waitMSPreemptible:t.waitMSPreemptible,waitUntil:u,waitForUserInput:h,setStorage:t.setStorage,callScript:t.callScript,lookAtCharacter:t.lookAtCharacter,lookAtMarker:t.lookAtMarker,lookAtEachOther:t.lookAtEachOther,setFacing:t.setFacing,shakeScreen:t.shakeScreen,setCharacterAt:t.setCharacterAt,walkToMarker:t.walkToMarker};t.default=p})),define("controller/scene-management",["require","exports","lib/rpgscript","model/scene","controller/scene-commands"],(function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSceneCommands=t.createAndCallScript=t.callScript=t.callTrigger=t.evalCondition=t.updateScene=void 0,o=i(o),t.updateScene=e=>{if(e.currentScript&&!n.sceneIsWaiting(e)){let r=null;for(;null!==(r=e.currentScript.getNextCommand());)if(t.evalCondition(e,r.conditional)){let t=n.sceneGetCommands(e)[r.type];if(!t)throw Error(`Script runtime error.  No command exists with name '${r.type}'`);if(t(...r.args))break}if(null===r)if(e.onScriptCompleted&&e.onScriptCompleted(),e.scriptStack.length){let r=e.scriptStack.shift();if(r){let{script:i,onScriptCompleted:n}=r;e.currentScript=i,e.onScriptCompleted=n,setTimeout(()=>t.updateScene(e))}}else e.currentScript=null,e.currentTrigger=null}},t.evalCondition=(e,i)=>{var n;if(!0===i)return!0;if("object"==typeof i){let{type:o,args:a}=i,l=r.formatArgs(a).map(t=>{if("object"==typeof t)return t;if("scene"===t&&e.currentTrigger)return e.storage[e.currentTrigger.name];if("string"==typeof t&&t.indexOf(".")>-1){let[r,i]=t.split(".");return"storage"===r?e.storage[i]:e.storage[r]?e.storage[r][i]:(console.error("No storage in scene called:",r),!1)}return t});if("is"===o)return!!l[0];if("isnot"===o)return"object"==typeof l[0]?!t.evalCondition(e,l[0]):!l[0];if("gt"===o)return l[0]>l[1];if("lt"===o)return l[0]<l[1];if("eq"===o)return l[0]===l[1];if("any"===o){for(let r=0;r<l.length;r++)if(t.evalCondition(e,l[r]))return!0;return!1}if("all"===o){for(let r=0;r<l.length;r++)if(!t.evalCondition(e,l[r]))return!1;return!0}if("as"===o)return console.error('conditional "as" is not defined for this scene.'),!1;if("once"===o){let t=l[0]||(null===(n=e.currentScript||e.currentTrigger)||void 0===n?void 0:n.name)+"-once";return!e.storageOnceKeys[t]&&(e.storageOnceKeys[t]=!0,!0)}return"with"===o&&(console.error('conditional "with" is not defined for this scene.'),!1)}},t.callTrigger=async(e,i,n)=>{let o=r.getTrigger(i);if(!e.currentScript&&o)for(let r=0;r<o.scriptCalls.length;r++){let i=o.scriptCalls[r];e.currentTrigger=o;let a=t.evalCondition(e,i.condition);if(i.type===n&&a){await t.callScript(e,i.scriptName),e.storage[o.name]=!0;break}e.currentTrigger=null}},t.callScript=async(e,i)=>new Promise(n=>{let o=r.getScript(i);o.reset(),e.currentScript&&e.scriptStack.unshift({script:e.currentScript,onScriptCompleted:e.onScriptCompleted}),e.currentScript=o,e.onScriptCompleted=n,t.updateScene(e)}),t.createAndCallScript=(e,t)=>{let i=e.commands,n=new r.Script(t,"internal",-1);n.addCommandBlock().commands=i.slice(),n.reset(),e.currentScript&&e.scriptStack.unshift({script:e.currentScript,onScriptCompleted:function(){}}),e.currentScript=n},t.getSceneCommands=e=>o.default})),define("controller/loop",["require","exports","model/generics","model/room","utils","view/draw","model/character","model/particle","view/ui","controller/battle-management","controller/overworld-management","model/canvas","controller/scene-management"],(function(e,t,r,i,n,o,a,l,s,c,d,u,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.runMainLoop=t.unpause=t.pause=void 0,t.pause=()=>{if(r.getIsPaused())return;r.setIsPaused(!0),s.renderUi();let e=r.getCurrentRoom();e&&e.characters.forEach(e=>{e.transform&&e.transform.timer.pause()});let t=r.getCurrentBattle();t&&t.allies.concat(t.enemies).forEach(e=>{e.actionTimer.pause(),e.staggerTimer.pause(),e.castTimer.pause()})},t.unpause=()=>{if(!r.getIsPaused())return;r.setIsPaused(!1),s.renderUi();let e=r.getCurrentRoom();e&&e.characters.forEach(e=>{e.transform&&e.transform.timer.unpause()});let t=r.getCurrentBattle();t&&t.allies.concat(t.enemies).forEach(e=>{e.actionTimer.unpause(),e.staggerTimer.unpause(),e.castTimer.unpause()})},t.runMainLoop=async()=>{let e=performance.now(),t=e;window.running=!0;let s=e=>{let p=e-t,m=p/13;if(r.setFrameMultiplier(m>2?2:m),r.setDeltaT(p),t=e,r.setNow(e),r.getIsPaused())return void(window.running&&requestAnimationFrame(s));o.clearScreen();let g=r.getCurrentScene(),f=r.getCurrentBattle(),_=r.getCurrentOverworld(),v=r.getCurrentRoom();if(g&&h.updateScene(g),v){for(let e=0;e<v.tiles.length;e++)v.tiles[e].highlighted=!1;_&&d.updateOverworld(_),f&&c.updateBattle(f);for(let e=0;e<v.characters.length;e++)a.characterUpdate(v.characters[e]);for(let e=0;e<v.particles.length;e++)l.particleUpdate(v.particles[e]),v.particles[e].shouldRemove&&(v.particles.splice(e,1),e--);let e=0,t=0;if(f)e=240,t=50;else{let i=r.getCurrentPlayer();if(i){let r=i.leader,[o,a]=n.isoToPixelCoords(r.x,r.y);e=256-o-16,t=256-a}}let[s,h]=r.getMousePos(),[p,m]=n.pixelToIsoCoords(s/u.getDrawScale()-e-i.TILE_WIDTH/2,h/u.getDrawScale()-t-i.TILE_HEIGHT/2),g=i.roomGetTileAt(v,Math.floor(p/i.TILE_WIDTH*2),Math.floor(m/i.TILE_HEIGHT*2));g&&(g.highlighted=!0),o.drawRoom(v,[e,t])}let y=r.getRenderables();for(let e in y)(0,y[e])();window.running&&requestAnimationFrame(s)};s(e)}})),define("view/components/OverworldSection",["require","exports","preact","view/style","view/elements/Button"],(function(e,t,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r(o);let a=n.style("div",{position:"absolute",top:"0px"});t.default=()=>i.h(i.Fragment,null,i.h(a,null,i.h(o.default,{type:o.ButtonType.PRIMARY},"Menu")))})),define("db/overworlds",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.get=void 0;let r={};t.get=e=>{let t=r[e];if(!t)throw Error("No overworld exists with name: "+e);return Object.assign({},t)},t.init=()=>{r.TEST={roomName:"test",characters:[]},r.TEST2={roomName:"test2",characters:[]}}})),define("view/components/Debug",["require","exports","preact","view/style","view/components/OverworldSection"],(function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=i(o),n.style("div",()=>({position:"absolute",left:"0px",top:"0px"})),t.default=()=>r.h("div",{id:"debug"},r.h(o.default,null))})),define("view/components/BattleConclusion",["require","exports","preact","view/style"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let n=i.style("div",()=>({display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:"4rem",color:i.colors.WHITE}));t.default=e=>r.h(n,null,r.h("span",null,e.isVictory?"VICTORY!":"DEFEATED!"))})),define("view/elements/AnimDiv",["require","exports","preact","preact/hooks","view/draw","model/animation"],(function(e,t,r,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{let t=i.useRef(null),[a,l]=i.useState(o.createAnimation(e.animName)),s=e.width,c=e.height,d=e.scale,u=e.animName;return i.useEffect(()=>{let e=t.current;if(a.name!==u)l(o.createAnimation(u));else if(e){let[t,r]=a.getSpriteSize(0),i=null!=d?d:1;e.width=(null!=s?s:t)*i,e.height=(null!=c?c:r)*i;let o=e.getContext("2d");o.imageSmoothingEnabled=!1,o.clearRect(0,0,e.width,e.height),n.drawAnimation(a,0,0,i,o)}},[d,s,c,u,a]),r.h("div",null,r.h("canvas",{ref:t}))}})),define("view/hooks",["require","exports","preact/hooks","model/generics"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useInputEventStack=t.useRenderLoop=t.useReRender=t.initHooks=void 0,t.initHooks=()=>{window.addEventListener("keydown",e=>{let t=n[n.length-1];t&&t(e)})},t.useReRender=()=>{let[e,t]=r.useState(!1);return()=>{t(!e)}},t.useRenderLoop=(e,t)=>{let[,n]=r.useReducer(e=>!e,!1),o=()=>{n("")};return r.useEffect(()=>(i.addRenderable(e,t||o),()=>{i.removeRenderable(e)}),[]),o};let n=[];t.useInputEventStack=e=>{r.useEffect(()=>(n.push(e),()=>{let t=n.indexOf(e);t>-1&&n.splice(t,1)}),[])}})),define("view/elements/ProgressBar",["require","exports","preact","view/hooks","view/style"],(function(e,t,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressBarWithRender=void 0;let o=n.style("div",e=>({background:e.backgroundColor,position:"relative",height:e.height+"px",width:"100%"})),a=n.style("div",e=>({background:e.backgroundColor,position:"absolute",left:"0",top:"0",width:e.pct+"%",height:"100%"})),l=n.style("div",{textAlign:"center",fontSize:"16px",position:"absolute",left:"0",top:"0",width:"100%",color:"white"}),s=e=>{var t;return r.h(o,{backgroundColor:e.backgroundColor,height:e.height},r.h(a,{pct:100*(null!==(t=e.pct)&&void 0!==t?t:0),backgroundColor:e.color}),r.h(l,null,e.label))};t.ProgressBarWithRender=e=>(i.useRenderLoop(e.renderKey),r.h(s,Object.assign({},e,{pct:e.renderFunc()}))),t.default=s})),define("view/components/BattleCharacterStatus",["require","exports","preact","view/style","view/elements/AnimDiv","view/elements/ProgressBar","model/character"],(function(e,t,r,n,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=i(o);let s=n.colors.GREEN,c=n.colors.BLUE,d=n.style("div",e=>({display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",width:"64px",boxShadow:e.highlighted?"0px 0px 67px 21px rgba(255, 255, 255,0.75)":"unset"})),u=n.style("div",{background:"black",border:"2px solid "+n.colors.GREY,position:"relative"}),h=n.style("div",{position:"absolute",top:"0",left:"1px"}),p=n.style("div",e=>({border:e.omitBorder?"":"2px solid "+n.colors.WHITE,width:"100%",borderBottomLeftRadius:e.bottom?"4px":0,borderBottomRightRadius:e.bottom?"4px":0,borderTopLeftRadius:e.top?"4px":0,borderTopRightRadius:e.top?"4px":0}));t.default=e=>{let t=t=>`${e.bCh.ch.name}_${t}`,i=e.bCh.ch.skills[e.bCh.ch.skillIndex];return r.h(d,null,r.h(p,{top:!0},r.h(a.ProgressBarWithRender,{renderFunc:()=>e.bCh.actionTimer.getPctComplete(),renderKey:t("action"),backgroundColor:n.colors.BLACK,color:c,height:20,label:null==i?void 0:i.name})),r.h(u,null,r.h(o.default,{animName:"battlePortraits_"+e.bCh.ch.spriteBase}),r.h(h,null,e.bCh.ch.name)),r.h(p,{top:!0,omitBorder:!0},r.h(a.ProgressBarWithRender,{renderFunc:()=>e.bCh.isStaggered?1:e.bCh.staggerGauge.getPct(),renderKey:t("stagger"),backgroundColor:n.colors.BLACK,color:e.bCh.isStaggered?n.colors.WHITE:n.colors.ORANGE,height:4,label:""})),r.h(p,{bottom:!0},r.h(a.ProgressBarWithRender,{renderFunc:()=>l.characterGetHpPct(e.bCh.ch),renderKey:t("hp"),backgroundColor:n.colors.BLACK,color:s,height:20,label:"HP: "+e.bCh.ch.hp})))}})),define("view/components/BattleActionMenu",["require","exports","preact","view/elements/VerticalMenu","view/style"],(function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=i(n);let a=o.style("div",()=>({})),l=o.style("div",()=>({display:"flex",justifyContent:"space-between",alignItems:"center"})),s=o.style("div",()=>({width:"24px",height:"24px"}));t.default=e=>r.h(a,null,r.h(n.default,{title:"ACTION",open:!0,onClose:e.onClose,width:"8rem",items:e.bCh.ch.skills.map((e,t)=>({label:r.h(l,null,r.h("span",null,e.name),r.h(s,null,r.h(e.icon,{color:o.colors.WHITE}))),value:t})),onItemClick:t=>{e.bCh.ch.skillIndex=t,e.onClose()}}))})),define("view/components/BattleUISection",["require","exports","preact","preact/hooks","view/style","view/components/BattleCharacterStatus","view/components/BattleActionMenu","view/elements/Button","controller/ui-actions","controller/loop","model/generics"],(function(e,t,n,o,a,l,s,c,d,u,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),l=i(l),s=i(s),c=r(c);let p=a.style("div",{position:"absolute",bottom:"0px",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",width:"100%"}),m=a.style("div",{display:"flex",justifyContent:"center",alignItems:"center",width:"100%"}),g=a.style("div",{position:"absolute",bottom:"150px",width:"100%",display:"flex",justifyContent:"center"}),f=a.style("div",{margin:"16px"});t.default=()=>{let[e,t]=o.useState(!1),r=h.getCurrentBattle();return n.h(n.Fragment,null,e?null:n.h(g,null,n.h(c.default,{type:c.ButtonType.PRIMARY,onClick:()=>{t(!e),u.pause()}},"Don't Click Me")),n.h(p,null,n.h(m,null,r.allies.map(e=>n.h(f,null,n.h(l.default,{battle:r,bCh:e})))),e?n.h(s.default,{onClose:()=>{u.unpause(),d.battleSetChButtonsStatus(!0),t(!1)},open:e,bCh:r.allies[0]}):null))}})),define("view/components/CutsceneSection",["require","exports","preact","view/style","preact/hooks","view/elements/AnimDiv","view/ui","model/store","model/canvas"],(function(e,t,r,n,o,a,l,s,c){"use strict";var d;Object.defineProperty(t,"__esModule",{value:!0}),t.PortraitActiveState=void 0,a=i(a),function(e){e.Active="active",e.Inactive="inactive",e.Passive="passive",e.Invisible="invisible"}(d=t.PortraitActiveState||(t.PortraitActiveState={}));let u=(e,t,r)=>{let i="";return i=t?`${e}_portrait_${t}`:e+"_portrait","right"===r&&(i+="_f"),i},h=n.style("div",{position:"absolute",top:"0px",overflow:"hidden",width:"100%",height:"100%"}),p=n.style("div",e=>({position:"absolute",top:"0px",width:"100%",height:e.visible?"12.5%":"0%",transition:"height 0.25s",background:n.colors.DARKGREY})),m=n.style("div",e=>({position:"absolute",bottom:"0px",width:"100%",height:e.visible?"12.5%":"0%",transition:"height 0.25s",background:n.colors.DARKGREY})),g=n.style("div",e=>{let t="1",r="0%",i="0%";return e.activeState===d.Active?r="3.125%":e.activeState===d.Inactive?(r="-3.125%",i="-3.125%",t="0.5"):e.activeState===d.Passive?i="-3.125%":e.activeState===d.Invisible&&(t="0"),{position:"absolute",minWidth:"50%",minHeight:"50%",transition:"left 0.25s, right 0.25s, bottom 0.25s",left:"left"===e.align?r:"",right:"right"===e.align?r:"",bottom:i,opacity:t}}),f=n.style("div",e=>{let t="left"===e.align?"6.25%":"calc(100% - 6.25% - 50%)",r="25%",i="height 0.1s, left 0.1s, transform 0.25s ease-in";return"center"===e.align&&(t="25%",r="75%",i="height 0.25s, left 0.25s, transform 0.25s ease-in"),{position:"absolute",width:"50%",height:r,left:t,display:"flex",justifyContent:"center",alignItems:"center",transition:i,bottom:"0px",transform:e.visible?"scale(1)":"scale(0)"}}),_=n.style("div",{border:"2px solid "+n.colors.WHITE,background:n.colors.BLACK,boxShadow:"0px 0px 24px 16px rgba(0, 0, 0, 0.75)",boxSizing:"border-box",width:"100%",padding:"2.5%",color:n.colors.WHITE,fontSize:22*c.getDrawScale()+"px",textAlign:"left",transition:"height 0.25s, width 0.25s"}),v=n.style("div",e=>({position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",transform:e.visible?"translateY(0%)":"translateY(55%)",transition:"transform 0.33s, width 0.33s"}));t.default=()=>{let[e,t]=o.useState(!1),i=o.useRef(null);o.useEffect(()=>{t(!0)},[]),o.useEffect(()=>{let e=null==i?void 0:i.current;e&&(e.style.transition="",e.style.opacity="0",e.innerHTML=n.text,setTimeout(()=>{e.style.transition="opacity 0.15s linear",e.style.opacity="1"},1))});let n=l.getUiInterface().appState.cutscene,c="center";return[s.CutsceneSpeaker.Left,s.CutsceneSpeaker.Center].includes(n.speaker)?c="right":[s.CutsceneSpeaker.Right].includes(n.speaker)&&(c="left"),r.h(h,null,r.h(p,{visible:n.visible&&e}),r.h(m,{visible:n.visible&&e}),r.h(v,{visible:n.visible&&e},""!==n.portraitLeft?r.h(g,{align:"left",activeState:n.speaker===s.CutsceneSpeaker.Left?d.Active:d.Inactive},r.h(a.default,{animName:u(n.portraitLeft,n.portraitLeftEmotion,"right")})):null,""!==n.portraitCenter?r.h(g,{align:"left",activeState:n.speaker===s.CutsceneSpeaker.Center?d.Active:d.Inactive},r.h(a.default,{animName:u(n.portraitCenter,n.portraitCenterEmotion,"right")})):null,""!==n.portraitRight?r.h(g,{align:"right",activeState:n.speaker===s.CutsceneSpeaker.Right?d.Active:d.Inactive},r.h(a.default,{animName:u(n.portraitRight,n.portraitRightEmotion,"left")})):null),r.h(f,{visible:e&&n.text.length>0,align:c},r.h(_,null,r.h("span",{style:{opacity:"0",transition:"unset"},ref:i}))))}})),define("view/ui",["require","exports","preact","preact/hooks","view/style","model/generics","model/store","controller/ui-actions","model/canvas","view/components/Debug","view/components/BattleConclusion","view/components/BattleUISection","view/components/CutsceneSection","model/store"],(function(e,t,r,n,o,a,l,s,c,d,u,h,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mountUi=t.renderUi=t.getUiInterface=t.uiInterface=void 0,d=i(d),u=i(u),h=i(h),p=i(p);let g=o.style("div",{position:"relative",height:"100%"}),f=o.style("div",()=>({position:"absolute",left:"0",top:"0",background:"black",opacity:"0.3",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:o.colors.WHITE,fontSize:"24px",width:"100%",height:"100%",pointerEvents:"none"})),_=o.style("div",()=>({marginBottom:"256px"}));t.uiInterface=null,t.getUiInterface=()=>t.uiInterface;let v=()=>{let[e,i]=n.useState(!1),[o,v]=n.useReducer(s.appReducer,l.AppStateInitial);n.useEffect(()=>{t.uiInterface=window.uiInterface={appState:o,render:()=>{i(!e)},dispatch:v}});let y=c.getDrawScale();return r.h("div",{style:{position:"absolute",top:"0px",width:512*(y>2?2:y),height:512*(y>2?2:y)}},r.h(g,null,a.getIsPaused()?r.h(f,null,r.h(_,null,"PAUSED")):null,o.sections.map((e,t)=>{switch(e){case m.AppSection.BattleVictory:return r.h(u.default,{key:t,isVictory:!0});case m.AppSection.BattleDefeated:return r.h(u.default,{key:t,isVictory:!1});case m.AppSection.BattleUI:return r.h(h.default,{key:t});case m.AppSection.Cutscene:return r.h(p.default,{key:t});case m.AppSection.Debug:return r.h(d.default,null);default:return r.h("div",null)}})))};t.renderUi=()=>{t.uiInterface&&t.uiInterface.render()},t.mountUi=()=>{let e=document.getElementById("ui");e&&r.render(r.h(v,null),e)}})),define("controller/ui-actions",["require","exports","view/ui","model/store"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCutsceneText=t.startConversation2=t.startConversation=t.showConversation=t.hideConversation=t.showSections=t.showSection=t.hideSections=t.battleSetChButtonsStatus=t.appReducer=void 0;let n={battleSetChButtonsStatus:(e,t)=>{e.battle.chButtonsEnabled=t},hideSections:e=>{e.sections=[]},showSection:(e,t)=>{e.sections.includes(t)||e.sections.push(t)},setCutsceneState:(e,t)=>{Object.assign(e.cutscene,t)}};t.appReducer=function(e,t){let r=Object.assign({},e),i=n[t.action];return i?i(r,t.payload,e):console.error(`Action without a reducer mutation: "${t.action}"`,t),r},t.battleSetChButtonsStatus=e=>{r.getUiInterface().dispatch({action:"battleSetChButtonsStatus",payload:e})},t.hideSections=()=>{r.getUiInterface().dispatch({action:"hideSections"})},t.showSection=(e,i)=>{i&&t.hideSections(),r.getUiInterface().dispatch({action:"showSection",payload:e})},t.showSections=(e,i)=>{i&&t.hideSections(),e.forEach(e=>{r.getUiInterface().dispatch({action:"showSection",payload:e})})},t.hideConversation=()=>{r.getUiInterface().dispatch({action:"setCutsceneState",payload:{visible:!1}})},t.showConversation=()=>{r.getUiInterface().dispatch({action:"setCutsceneState",payload:{visible:!0}})},t.startConversation=e=>{t.showSection(i.AppSection.Cutscene,!0),r.getUiInterface().dispatch({action:"setCutsceneState",payload:{portraitCenter:e,visible:!0}})},t.startConversation2=(e,n)=>{t.showSection(i.AppSection.Cutscene,!0),r.getUiInterface().dispatch({action:"setCutsceneState",payload:{portraitLeft:e,portraitRight:n,visible:!0}})},t.setCutsceneText=(e,t)=>{let i={text:e,visible:!0};t&&(i.speaker=t),r.getUiInterface().dispatch({action:"setCutsceneState",payload:i})}})),define("controller/battle-management",["require","exports","model/battle","model/character","model/room","model/generics","model/player","model/particle","utils","model/store","controller/ui-actions","model/generics"],(function(e,t,r,i,n,o,a,l,s,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.completeCast=t.interruptCast=t.setCasting=t.calculateStaggerDamage=t.resetCooldownTimer=t.applyWeaponDamage=t.endAction=t.beginAction=t.updateBattleCharacter=t.updateBattle=t.initiateBattle=void 0,t.initiateBattle=(e,l)=>{let s=n.getRoom(l.roomName);s.characters=[];let c=l.enemies.map(e=>{let t=i.characterCreateFromTemplate(e.chTemplate);return s.characters.push(t),r.battleCharacterCreateEnemy(t,e)}),d={room:s,isCompleted:!1,enemies:c,defeated:[],allies:e.party.map(t=>(s.characters.push(t),r.battleCharacterCreateAlly(t,{position:a.playerGetBattlePosition(e,t)})))};return d.allies.forEach(t.resetCooldownTimer),d.enemies.forEach(t.resetCooldownTimer),r.battleSetActorPositions(d),u.setCurrentPlayer(e),o.setCurrentBattle(d),o.setCurrentRoom(s),d},t.updateBattle=e=>{for(let r=0;r<e.allies.length;r++){let i=e.allies[r];t.updateBattleCharacter(e,i),i.shouldRemove&&(e.allies.splice(r,1),r--)}for(let r=0;r<e.enemies.length;r++){let i=e.enemies[r];t.updateBattleCharacter(e,i),i.shouldRemove&&(e.enemies.splice(r,1),r--)}if(!e.isCompleted)if(r.battleIsVictory(e)){e.isCompleted=!0,d.showSection(c.AppSection.BattleVictory,!0);for(let t in e.allies)i.characterSetAnimationState(e.allies[t].ch,i.AnimationState.BATTLE_FLOURISH);setTimeout(()=>{d.showSection(c.AppSection.Debug,!0)},2e3)}else r.battleIsLoss(e)&&(e.isCompleted=!0,d.showSection(c.AppSection.BattleDefeated,!0),setTimeout(()=>{d.showSection(c.AppSection.Debug,!0)},2e3))},t.updateBattleCharacter=(e,n)=>{n.ch.hp<=0?n.isDefeated||(n.isDefeated=!0,i.characterSetAnimationState(n.ch,i.AnimationState.BATTLE_DEFEATED),i.characterOnAnimationCompletion(n.ch,()=>{let t=e.enemies.indexOf(n);if(t>-1)return n.shouldRemove=!0,void e.defeated.push(n);t=e.allies.indexOf(n),t>-1&&(n.shouldRemove=!0,e.defeated.push(n))})):e.isCompleted||(n.isStaggered&&n.staggerTimer.isComplete()&&(n.isStaggered=!1,i.characterSetAnimationState(n.ch,i.AnimationState.BATTLE_IDLE)),n.isCasting&&n.castTimer.isComplete()&&t.completeCast(n),n.staggerGauge.update(),n.canAct?n.canAct=r.battleCharacterCanAct(e,n):r.battleCharacterCanAct(e,n)&&(n.canAct=!0,n.onCanActCb(),n.ai&&n.ai(e,n)))},t.beginAction=(e,t)=>{t.isActing=!0,t.actionTimer.start(),t.actionTimer.pause()},t.endAction=(e,r)=>{r.isActing=!1,t.resetCooldownTimer(r),r.actionTimer.unpause()},t.applyWeaponDamage=(e,o,a,c,d)=>{let u=c+o.ch.stats.POW+o.ch.stats.ACC/4;c=s.getRandBetween(u/2+u/2*o.ch.stats.ACC/100,u),a.isStaggered?(a.staggerTimer.start(),c*=2):(a.staggerGauge.fill(d),a.staggerGauge.isFull()&&r.battleCharacterSetStaggered(a)),a.isCasting&&t.interruptCast(a),c=Math.max(1,Math.floor(c));let[h,p]=i.characterGetPosCenterPx(a.ch);n.roomAddParticle(e.room,l.createDamageParticle(c+"",h,p)),r.battleCharacterApplyDamage(a,c)},t.resetCooldownTimer=e=>{let t=e.ch.skills[e.ch.skillIndex];t&&(e.actionTimer.duration=Math.max(t.cooldown-t.cooldown*(1-1/(1+e.ch.stats.SPD/100)),1e3))},t.calculateStaggerDamage=e=>Math.max(e.stats.STAGGER,1),t.setCasting=(e,t)=>{var r,i;e.isCasting=!0,e.castTimer.duration=t.castTime,e.castTimer.start(),e.onCast=null!==(r=t.onCast)&&void 0!==r?r:function(){},e.onCastInterrupted=null!==(i=t.onInterrupt)&&void 0!==i?i:function(){}},t.interruptCast=e=>{e.isCasting=!1,e.onCastInterrupted()},t.completeCast=e=>{e.isCasting=!1,e.onCast()}})),define("view/icons/Shield",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{fill:e.color,stroke:e.color,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("path",{d:"M0 0h512v512H0z",fill:"rgba(0, 0, 0, 0)","fill-opacity":"0"}),r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M256 16c25 24 100 72 150 72v96c0 96-75 240-150 312-75-72-150-216-150-312V88c50 0 125-48 150-72z",fill:e.color,"fill-opacity":"1"})))})),define("view/icons/Sword",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{fill:e.color,stroke:e.color,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M491.844 22.533l-83.42 14.865L196.572 249.25c3.262 4.815 5.37 10.72 5.37 16.932 0 5.863-1.71 11.35-4.643 15.996-5.065-1.606-10.448-2.477-16.027-2.477-15.724 0-29.904 6.89-39.69 17.796l-9.112-9.113 17.237-17.237c-4.515-5.772-8.907-11.645-13.19-17.6l-19.443 19.44-13.215-13.215 21.828-21.827c-4.403-6.59-8.67-13.278-12.792-20.068l-40.802 40.803 58.314 58.314c-1.613 5.075-2.49 10.47-2.49 16.063 0 7.666 1.65 14.96 4.592 21.564l-72.14 72.14-14.56-14.56L21.013 437l14.558 14.56-8.607 8.608 27.246 27.246 8.606-8.61 14.56 14.56 24.798-24.8-14.557-14.556 72.158-72.16c6.586 2.922 13.858 4.562 21.498 4.562 5.593 0 10.988-.877 16.063-2.49l58.363 58.363L296.5 401.48c-6.797-4.127-13.486-8.395-20.068-12.793l-21.83 21.83L241.39 397.3l19.442-19.44c-5.962-4.29-11.835-8.683-17.603-13.194l-17.238 17.238-9.16-9.16c10.905-9.785 17.795-23.965 17.795-39.69 0-5.346-.806-10.51-2.285-15.39 4.703-3.04 10.288-4.817 16.265-4.816 6.21 0 11.776 1.77 16.52 4.955L476.98 105.95l14.864-83.417zm-66.227 53.012l13.215 13.215-191.684 191.68-13.214-13.213L425.617 75.545zM181.273 298.39c19.257 0 34.665 15.41 34.665 34.665 0 19.256-15.408 34.666-34.665 34.666-19.256 0-34.666-15.41-34.666-34.665s15.41-34.666 34.666-34.666z",fill:"#fff","fill-opacity":"1"})))})),define("controller/battle-actions",["require","exports","model/battle","model/character","model/room","model/utility","utils","model/particle","controller/battle-management","view/icons/Shield","view/icons/Sword"],(function(e,t,r,n,o,a,l,s,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BattleActions=void 0,d=i(d),u=i(u);let h=(e,t)=>!!r.battleCharacterCanAct(e,t);t.BattleActions={Swing:{name:"Swing",description:"Jump to target and swing your weapon.",cooldown:1e4,icon:u.default,cb:async(e,t)=>{if(!h(e,t))return;let i=t.ch,d=r.battleGetAllegiance(e,i),u=r.battleGetNearestAttackable(e,d);if(u){c.beginAction(e,t);let h=n.characterGetPos(i),p=n.characterGetPos(u.ch);d===r.BattleAllegiance.ALLY?(p[0]-=o.TILE_WIDTH/2,r.battleCharacterGetRow(t)===r.BattleRow.BOTTOM&&(p[0]+=o.TILE_WIDTH/2,p[1]+=o.TILE_WIDTH/2)):(p[0]+=o.TILE_WIDTH/2,r.battleCharacterGetRow(t)===r.BattleRow.TOP&&(p[0]-=o.TILE_WIDTH/2,p[1]-=o.TILE_WIDTH/2));let m=l.calculateDistance(h,p),g=new a.Transform(h,p,250*l.normalize(m,35,125,1,1.75),a.TransformEase.LINEAR,(e=>e<45?a.transformOffsetJumpShort:e<100?a.transformOffsetJumpMedium:a.transformOffsetJumpFar)(m));n.characterSetTransform(i,g),n.characterSetAnimationState(i,n.AnimationState.BATTLE_JUMP),await g.timer.onCompletion(),l.timeoutPromise(300).then(()=>{let[r,i]=n.characterGetPosCenterPx(u.ch),a=s.particleCreateFromTemplate([r,i],s.EFFECT_TEMPLATE_SWORD_LEFT);o.roomAddParticle(e.room,a),c.applyWeaponDamage(e,t,u,1,1)}),n.characterSetAnimationState(i,n.AnimationState.BATTLE_ATTACK);let f=n.characterGetAnimation(i);await f.onCompletion();let _=g.createInverse();n.characterSetTransform(i,_),n.characterSetAnimationState(i,n.AnimationState.BATTLE_JUMP),await _.timer.onCompletion(),_.markForRemoval(),n.characterSetAnimationState(i,n.AnimationState.BATTLE_IDLE),c.endAction(e,t)}}},SwingSlow:{name:"SwingSlow",description:"A slower version of the swing.",cooldown:1e5,icon:u.default,cb:async(e,r)=>t.BattleActions.Swing.cb(e,r)},Defend:{name:"Defend",description:"Brace yourself for an attack, taking less damage and reducing stagger for a short time.",cooldown:5e3,icon:d.default,cb:async(e,t)=>{if(!h(e,t))return;c.beginAction(e,t);let i=t.ch,l=await(async(e,t)=>{let i=t.ch,l=r.battleGetAllegiance(e,i),s=n.characterGetPos(i),c=[...s];l===r.BattleAllegiance.ALLY?(c[0]+=o.TILE_WIDTH/2,c[1]-=o.TILE_WIDTH/2):(c[0]-=o.TILE_WIDTH/2,c[1]+=o.TILE_WIDTH/2);let d=new a.Transform(s,c,200,a.TransformEase.LINEAR,a.transformOffsetJumpShort);return n.characterSetTransform(i,d),n.characterSetAnimationState(i,n.AnimationState.BATTLE_JUMP),await d.timer.onCompletion(),d})(e,t);n.characterSetAnimationState(i,n.AnimationState.BATTLE_ITEM);let s=n.characterGetAnimation(i);await s.onCompletion(),r.battleCharacterAddStatus(t,r.Status.DEFEND);let d=l.createInverse();n.characterSetTransform(i,d),n.characterSetAnimationState(i,n.AnimationState.BATTLE_JUMP),await d.timer.onCompletion(),d.markForRemoval(),n.characterSetAnimationState(i,n.AnimationState.BATTLE_IDLE),c.setCasting(t,{castTime:5e3,onCast:()=>{r.battleCharacterRemoveStatus(t,r.Status.DEFEND)},onInterrupt:()=>{r.battleCharacterRemoveStatus(t,r.Status.DEFEND)}}),c.endAction(e,t)}}}})),define("controller/battle-ai",["require","exports","model/battle","controller/battle-actions"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BATTLE_AI_ATTACK=void 0,t.BATTLE_AI_ATTACK=(e,t)=>{let n=r.battleGetAllegiance(e,t.ch);r.battleGetNearestAttackable(e,n)&&i.BattleActions.Swing.cb(e,t)}})),define("model/battle",["require","exports","model/room","model/character","controller/battle-management","model/utility"],(function(e,t,r,i,n,o){"use strict";var a,l,s;Object.defineProperty(t,"__esModule",{value:!0}),t.battleGetNearestAttackable=t.battleGetCharactersOfAllegiance=t.battleGetOppositeAllegiance=t.battleGetAllegiance=t.battleIsLoss=t.battleIsVictory=t.battleSetActorPositions=t.battleCharacterGetRow=t.battleCharacterGetSelectedSkill=t.battleCharacterRemoveStatus=t.battleCharacterAddStatus=t.battleCharacterRemoveCanActCb=t.battleCharacterSetCanActCb=t.battleCharacterCanAct=t.battleCharacterApplyDamage=t.battleCharacterSetStaggered=t.battleCharacterCreateAlly=t.battleCharacterCreateEnemy=t.battleStatsCreate=t.Status=t.BattleAllegiance=t.BattleRow=t.BattlePosition=void 0,function(e){e.FRONT="front",e.MIDDLE="middle",e.BACK="back"}(a=t.BattlePosition||(t.BattlePosition={})),function(e){e.TOP="top",e.BOTTOM="bottom",e.NONE="none"}(l=t.BattleRow||(t.BattleRow={})),function(e){e.ALLY="ally",e.ENEMY="enemy"}(s=t.BattleAllegiance||(t.BattleAllegiance={})),(t.Status||(t.Status={})).DEFEND="defend",t.battleStatsCreate=()=>({POW:5,ACC:1,SPD:1,FOR:1,HP:1,STAGGER:2});let c=(e,t,r)=>{var i;let a=e.skills[e.skillIndex],s=n.calculateStaggerDamage(e);return{ch:e,isDefeated:!1,shouldRemove:!1,actionTimer:new o.Timer(null!==(i=null==a?void 0:a.cooldown)&&void 0!==i?i:2e3),staggerTimer:new o.Timer(1e3),staggerGauge:new o.Gauge(s,.02),castTimer:new o.Timer(1e3),position:t,isActing:!1,isCasting:!1,canAct:!1,isStaggered:!1,statuses:[],row:l.NONE,onCanActCb:function(){},onCast:function(){},onCastInterrupted:function(){},ai:r}};t.battleCharacterCreateEnemy=(e,t)=>c(e,t.position,t.ai),t.battleCharacterCreateAlly=(e,t)=>c(e,t.position),t.battleCharacterSetStaggered=e=>{e.isStaggered=!0,e.staggerTimer.start(),e.staggerGauge.empty(),i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_STAGGERED)},t.battleCharacterApplyDamage=(e,t)=>{i.characterModifyHp(e.ch,-t),e.isStaggered?i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_STAGGERED):(i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_DAMAGED),i.characterOnAnimationCompletion(e.ch,()=>{i.characterSetAnimationState(e.ch,e.isStaggered?i.AnimationState.BATTLE_STAGGERED:i.AnimationState.BATTLE_IDLE)}))},t.battleCharacterCanAct=(e,r)=>{if(r.isActing)return!1;let i=t.battleGetAllegiance(e,r.ch)===s.ALLY?e.enemies:e.allies;for(let e=0;e<i.length;e++)if(i[e].isActing)return!1;return r.actionTimer.isComplete()},t.battleCharacterSetCanActCb=(e,t)=>{e.onCanActCb=t},t.battleCharacterRemoveCanActCb=e=>{e.onCanActCb=function(){}},t.battleCharacterAddStatus=(e,t)=>{e.statuses.includes(t)||e.statuses.push(t)},t.battleCharacterRemoveStatus=(e,t)=>{let r=e.statuses.indexOf(t);r>-1&&e.statuses.splice(r,1)},t.battleCharacterGetSelectedSkill=e=>e.ch.skills[e.ch.skillIndex],t.battleCharacterGetRow=e=>e.row;let d={[a.FRONT]:[[5,7],[8,10]],[a.MIDDLE]:[[3,9],[6,12]],[a.BACK]:[[1,11],[4,14]]},u={[a.FRONT]:[[7,5],[10,8]],[a.MIDDLE]:[[9,3],[12,6]],[a.BACK]:[[11,1],[14,4]]};t.battleSetActorPositions=e=>{let t={[a.FRONT]:0,[a.MIDDLE]:0,[a.BACK]:0},i=(e,t)=>i=>{let n=[0,0],o=0;switch(i.position){case a.FRONT:o=e[a.FRONT],n=t[a.FRONT][e[a.FRONT]++];break;case a.MIDDLE:o=e[a.MIDDLE],n=t[a.MIDDLE][e[a.MIDDLE]++];break;case a.BACK:o=e[a.BACK],n=t[a.BACK][e[a.BACK]++]}let[s,c]=r.tilePosToWorldPos(n[0],n[1]);o<=1?(i.row=0===o?l.TOP:l.BOTTOM,i.ch.x=s,i.ch.y=c):console.error("Error setting actor position for battle, Row number is greater than 1 (most likely more than 2 actors in a battle position)",i)};e.allies.forEach(i({[a.FRONT]:0,[a.MIDDLE]:0,[a.BACK]:0},d)),e.enemies.forEach(i(t,u))},t.battleIsVictory=e=>0===e.enemies.length,t.battleIsLoss=e=>0===e.allies.length,t.battleGetAllegiance=(e,t)=>{if(e.enemies.find(e=>e.ch===t))return s.ENEMY;if(e.allies.find(e=>e.ch===t))return s.ALLY;throw Error(`Cannot get battle allegiance for character '${t.name}' that does not exist in battle.`)},t.battleGetOppositeAllegiance=e=>e===s.ALLY?s.ENEMY:s.ALLY,t.battleGetCharactersOfAllegiance=(e,t)=>{switch(t){case s.ALLY:return e.allies;case s.ENEMY:return e.enemies;default:return e.allies}},t.battleGetNearestAttackable=(e,r)=>{let i,n=t.battleGetCharactersOfAllegiance(e,t.battleGetOppositeAllegiance(r));return i=n.find(e=>e.position===a.FRONT),i||(i=n.find(e=>e.position===a.MIDDLE)),i||(i=n.find(e=>e.position===a.BACK)),null!=i?i:null}})),define("model/character",["require","exports","model/animation","model/battle","utils","controller/battle-actions","model/generics","model/room"],(function(e,t,r,i,n,o,a,l){"use strict";var s,c;Object.defineProperty(t,"__esModule",{value:!0}),t.characterUpdate=t.characterCollidesWithPoint=t.characterResetSpeed=t.characterSetSpeed=t.characterSetWalkTarget=t.characterGetSize=t.characterGetPosCenterPx=t.characterGetPosPx=t.characterGetPosBottom=t.characterGetPos=t.characterSetTransform=t.characterGetHpPct=t.characterModifyHp=t.characterSetFacingFromAngle=t.characterSetFacing=t.characterOnAnimationCompletion=t.characterSetPos=t.characterSetAnimationState=t.characterGetAnimation=t.characterGetAnimKey=t.characterCreateFromTemplate=t.characterCreate=t.ANIMATIONS_WITHOUT_FACING=t.AnimationState=t.Facing=t.DEFAULT_SPEED=void 0,t.DEFAULT_SPEED=1,function(e){e.LEFT="left",e.UP="up",e.DOWN="down",e.LEFT_UP="leftup",e.LEFT_DOWN="leftdown",e.RIGHT="left_f",e.RIGHT_UP="leftup_f",e.RIGHT_DOWN="leftdown_f",e.RIGHT2="right",e.RIGHT_UP2="rightup",e.RIGHT_DOWN2="rightdown"}(s=t.Facing||(t.Facing={})),function(e){e.IDLE="idle",e.WALK="walk",e.BATTLE_IDLE="battle_idle",e.BATTLE_JUMP="battle_jump",e.BATTLE_ATTACK="battle_attack",e.BATTLE_DAMAGED="battle_damaged",e.BATTLE_STAGGERED="battle_staggered",e.BATTLE_ITEM="battle_item",e.BATTLE_FLOURISH="battle_flourish",e.BATTLE_DEFEATED="battle_defeated"}(c=t.AnimationState||(t.AnimationState={})),t.ANIMATIONS_WITHOUT_FACING=[c.BATTLE_FLOURISH],t.characterCreate=e=>{let r={name:e,spriteBase:"ada",x:0,y:0,z:0,vx:0,vy:0,speed:t.DEFAULT_SPEED,transform:null,hp:10,stats:i.battleStatsCreate(),skills:[o.BattleActions.SWING],skillIndex:0,facing:s.LEFT,animationState:c.IDLE,animationKey:"",storedAnimations:{},walkTarget:null,onReachWalkTarget:null};return r.animationKey=t.characterGetAnimKey(r),r},t.characterCreateFromTemplate=e=>{let r=t.characterCreate(e.name);return r.spriteBase=e.spriteBase,r.facing=e.facing||r.facing,r.animationState=e.animationState||r.animationState,r.animationKey=t.characterGetAnimKey(r),r.hp=r.stats.HP,r.stats=Object.assign({},e.stats||r.stats),r.skills=e.skills||r.skills,r},t.characterGetAnimKey=e=>{let{spriteBase:r,facing:i,animationState:n}=e;return t.ANIMATIONS_WITHOUT_FACING.includes(n)?`${r}_${n}`:`${r}_${n}_${i}`},t.characterGetAnimation=e=>{let{storedAnimations:i}=e,n=t.characterGetAnimKey(e),o=i[n];if(o)return o;{let e=r.createAnimation(n);return i[n]=e,e}},t.characterSetAnimationState=(e,r)=>{e.animationState=r;let i=t.characterGetAnimKey(e);if(i!==e.animationKey){e.animationPromise&&(e.animationPromise.reject(),e.animationPromise=void 0),e.animationKey=i;let r=t.characterGetAnimation(e);r.reset(),r.start()}},t.characterSetPos=(e,t)=>{e.x=t[0],e.y=t[1],e.z=t[2]},t.characterOnAnimationCompletion=(e,r)=>{e.animationPromise&&e.animationPromise.reject();let i=t.characterGetAnimation(e),n={},o=new Promise((t,r)=>{n.resolve=t,n.reject=r,(async()=>{await i.onCompletion(),e.animationPromise=void 0,t()})()}).then(()=>{r()}).catch(e=>{});return e.animationPromise=n,o},t.characterSetFacing=(e,r)=>{e.facing=r,t.characterSetAnimationState(e,e.animationState)},t.characterSetFacingFromAngle=(e,r)=>{if(r>337.5||r<22.5)return void t.characterSetFacing(e,s.UP);let i=[s.UP,s.RIGHT_UP,s.RIGHT,s.RIGHT_DOWN,s.DOWN,s.LEFT_DOWN,s.LEFT,s.LEFT_UP];for(let n=1;n<8;n++)r>=45*n-22.5&&r<45*(n+1)-22.5&&t.characterSetFacing(e,i[n])},t.characterModifyHp=(e,t)=>{e.hp+=t,e.hp>e.stats.HP?e.hp=e.stats.HP:e.hp<0&&(e.hp=0)},t.characterGetHpPct=e=>+(e.hp/e.stats.HP).toFixed(2),t.characterSetTransform=(e,t)=>{e.transform=t},t.characterGetPos=e=>e.transform?e.transform.current():[e.x,e.y,e.z],t.characterGetPosBottom=e=>{let{x:t,y:r}=e;return[t+16,r+16]},t.characterGetPosPx=e=>{let[r,i,o]=t.characterGetPos(e);return n.isoToPixelCoords(r,i,o)},t.characterGetPosCenterPx=e=>{let[r,i]=t.characterGetPosPx(e),[n,o]=t.characterGetSize(e);return[r+n/2,i+o/2]},t.characterGetSize=e=>t.characterGetAnimation(e).getSpriteSize(0),t.characterSetWalkTarget=(e,t,r)=>{e.walkTarget=t,e.onReachWalkTarget=r},t.characterSetSpeed=(e,t)=>{e.speed=t},t.characterResetSpeed=e=>{e.speed=t.DEFAULT_SPEED},t.characterCollidesWithPoint=(e,r,i)=>{let o=[...t.characterGetPosBottom(e),2];return n.circleCircleCollision(o,[r[0],r[1],i])},t.characterUpdate=e=>{let r=a.getCurrentRoom();e.transform&&(e.transform.update(),e.transform.shouldRemove&&(e.transform=null));let i=a.getFrameMultiplier();if(e.walkTarget){let r=t.characterGetPosBottom(e),i=n.getAngleTowards(r,e.walkTarget),o=Math.sin(i),a=-Math.cos(i);e.vx=o,e.vy=a,t.characterSetAnimationState(e,c.WALK),t.characterCollidesWithPoint(e,e.walkTarget,6)&&(t.characterSetAnimationState(e,c.IDLE),e.onReachWalkTarget&&e.onReachWalkTarget(),e.walkTarget=null,e.onReachWalkTarget=null)}if(0!==e.vx||0!==e.vy){let[o,a]=n.getNormalizedVec(e.vx,e.vy),s=o*i*e.speed,c=a*i*e.speed;e.x+=s,e.y+=c;let d=n.getAngleFromVector(-s,-c)-45;t.characterSetFacingFromAngle(e,d);let u=l.roomGetTileBelow(r,e),h=null,p=null;u&&(h=l.roomGetTileAt(r,u.x,u.y+1),p=l.roomGetTileAt(r,u.x+1,u.y)),((null==u?void 0:u.isWall)||(null==h?void 0:h.isWall)||(null==p?void 0:p.isWall))&&(e.x-=s,e.y-=c),e.vx=0,e.vy=0}}})),define("db/characters",["require","exports","model/character"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.get=void 0;let i={};t.get=e=>{let t=i[e];if(!t)throw Error("No character template exists with name: "+e);return Object.assign({},t)},t.init=()=>{i.Skye={name:"Skye",spriteBase:"skye",talkTrigger:"",facing:r.Facing.LEFT_UP,animationState:r.AnimationState.IDLE},i.Conscience={name:"Conscience",spriteBase:"conscience",talkTrigger:"",facing:r.Facing.LEFT_UP,animationState:r.AnimationState.IDLE}}})),define("map/battle1",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"battle1.json"}},height:16,infinite:!1,layers:[{data:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],height:16,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:16,x:0,y:0},{draworder:"topdown",id:5,name:"Props",objects:[{gid:17,height:64,id:4,name:"",rotation:0,type:"",visible:!0,width:32,x:32,y:96},{gid:17,height:64,id:7,name:"",rotation:0,type:"",visible:!0,width:32,x:224,y:240},{gid:17,height:64,id:8,name:"",rotation:0,type:"",visible:!0,width:32,x:64,y:32},{gid:18,height:32,id:9,name:"1",rotation:0,type:"",visible:!0,width:32,x:96,y:128},{gid:18,height:32,id:10,name:"3",rotation:0,type:"",visible:!0,width:32,x:80,y:240},{gid:18,height:32,id:11,name:"4",rotation:0,type:"",visible:!0,width:32,x:64,y:160},{gid:18,height:32,id:12,name:"2",rotation:0,type:"",visible:!0,width:32,x:144,y:176},{gid:19,height:32,id:13,name:"2",rotation:0,type:"",visible:!0,width:32,x:160,y:64},{gid:19,height:32,id:14,name:"4",rotation:0,type:"",visible:!0,width:32,x:192,y:32},{gid:19,height:32,id:15,name:"1",rotation:0,type:"",visible:!0,width:32,x:176,y:144},{gid:19,height:32,id:16,name:"3",rotation:0,type:"",visible:!0,width:32,x:128,y:96},{gid:18,height:32,id:24,name:"4",rotation:0,type:"",visible:!0,width:32,x:112,y:208},{gid:18,height:32,id:25,name:"3",rotation:0,type:"",visible:!0,width:32,x:32,y:192},{gid:19,height:32,id:26,name:"2",rotation:0,type:"",visible:!0,width:32,x:208,y:112},{gid:19,height:32,id:27,name:"4",rotation:0,type:"",visible:!0,width:32,x:240,y:80}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:7,nextobjectid:28,orientation:"isometric",renderorder:"left-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:4,firstgid:1,image:"../../res/battle-terrain1.png",imageheight:128,imagewidth:128,margin:0,name:"battle-terrain1",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:0,firstgid:17,grid:{height:1,orientation:"orthogonal",width:1},margin:0,name:"props",spacing:0,tilecount:4,tileheight:64,tiles:[{id:0,image:"../../res/tree1.png",imageheight:64,imagewidth:32},{id:1,image:"../../res/markerGreen.png",imageheight:32,imagewidth:32},{id:2,image:"../../res/markerOrange.png",imageheight:32,imagewidth:32},{id:3,image:"../../res/test-prop.png",imageheight:32,imagewidth:96}],tilewidth:96}],tilewidth:32,type:"map",version:1.4,width:16}),define("map/test",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"test.json"}},height:64,infinite:!1,layers:[{data:[129,2,2,11,2,2,2,13,2,2,2,11,2,2,2,2,2,5,5,5,5,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,12,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,8,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,6,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,6,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,10,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,5,5,5,5,5,5,5,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129],height:64,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:64,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:193,height:32,id:1,name:"Skye",rotation:0,type:"",visible:!0,width:32,x:288,y:112}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:4,nextobjectid:3,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:2,firstgid:193,image:"../../res/control.png",imageheight:64,imagewidth:64,margin:0,name:"control",spacing:0,tilecount:4,tileheight:32,tilewidth:32},{columns:16,firstgid:197,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32}],tilewidth:32,type:"map",version:1.4,width:64}),define("map/test2",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"test2.json"}},height:64,infinite:!1,layers:[{data:[129,2,2,11,2,2,2,13,2,2,2,11,2,2,2,2,2,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,129,129,129,129,129,129,129,129,129,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,197,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,129,129,129,129,129,129,129,129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,129,129,129,2,2,2,2,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],height:64,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:64,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:193,height:32,id:3,name:"Skye",rotation:0,type:"",visible:!0,width:32,x:44,y:248},{gid:193,height:32,id:4,name:"Conscience",rotation:0,type:"",visible:!0,width:32,x:76,y:236},{gid:194,height:32,id:5,name:"MarkerWalkTest1",rotation:0,type:"",visible:!0,width:32,x:76,y:68},{gid:194,height:32,id:6,name:"MarkerWalkTest2",rotation:0,type:"",visible:!0,width:32,x:76,y:276}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:4,nextobjectid:7,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:2,firstgid:193,image:"../../res/control.png",imageheight:64,imagewidth:64,margin:0,name:"control",spacing:0,tilecount:4,tileheight:32,tilewidth:32},{columns:16,firstgid:197,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32}],tilewidth:32,type:"map",version:1.4,width:64}),define("model/room",["require","exports","model/sprite","utils","model/character","db/characters","map/battle1","map/test","map/test2"],(function(e,t,i,n,o,a,l,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.roomGetCharacterByName=t.roomGetTileBelow=t.roomRemoveRemoveCharacter=t.roomAddParticle=t.roomGetTileAt=t.getRoom=t.loadRooms=t.tilePosToWorldPos=t.TILE_HEIGHT=t.TILE_WIDTH=void 0,l=r(l),s=r(s),c=r(c),t.TILE_WIDTH=32,t.TILE_HEIGHT=32,t.tilePosToWorldPos=(e,r)=>[e*t.TILE_WIDTH/2,r*t.TILE_HEIGHT/2];let d={};t.loadRooms=async()=>{await u("battle1",l),await u("test",s),await u("test2",c)},t.getRoom=e=>d[e];let u=async(e,r)=>{let{width:l,height:s,data:c}=r.layers[0],{objects:u}=r.layers.find(e=>"Props"===e.name)||{},{objects:h}=r.layers.find(e=>"Objects"===e.name)||{},{tiles:p,firstgid:m}=r.tilesets.find(e=>"props"===e.name)||{},g={tiledJson:r,width:l,height:s,widthPx:l*t.TILE_WIDTH,heightPx:s*t.TILE_HEIGHT/2,props:[],tiles:[],characters:[],particles:[],markers:{}},f=[];return c.forEach((e,t)=>{let{sprite:i,tileWidth:n,tileHeight:o}=((e,t)=>{if(0===t)return{sprite:"invisible",tileWidth:32,tileHeight:32};let r=0;do{let i=e[r],n=e[r+1];if(!n||t>=i.firstgid&&t<n.firstgid)return{sprite:i.name+"_"+(t-i.firstgid),tileWidth:i.tilewidth,tileHeight:i.tileheight};r++}while(r<e.length);throw Error("Could not determine sprite from gid:"+t)})(r.tilesets,e);g.tiles.push({sprite:i,tileWidth:n,tileHeight:o,isWall:i.indexOf("wall")>-1||i.indexOf("prop")>-1,id:e-1,x:t%l,y:Math.floor(t/l),highlighted:!1})}),u&&u.forEach((t,r)=>{let o=t.x,a=t.y,l=t.gid,s=l-m,c=p[s];if(!c)throw Error(`Could not load prop '${r}' in room definition '${e}', the propIndex '${s}' has no associated tilesetTile. (gid=${l} startingGid=${m})`);let d=c.image.slice(c.image.lastIndexOf("/")+1);f.push(i.loadImageAsSprite(d,n.removeFileExtension(d))),g.props.push({x:o,y:a,sprite:d.slice(0,-4)})}),h&&h.forEach((t,r)=>{let i=t.x,l=t.y,[s,c]=n.isoToPixelCoords(i,l),[d,u]=n.pixelToIsoCoords(s,c-16);if(t.name.toLowerCase().indexOf("marker")>-1){if(g.markers[t.name])throw Error(`Could not load marker '${t.name}' in room definition '${e}', a marker with that name already exists.)`);g.markers[t.name]={name:t.name,x:d,y:u}}else{let i=a.get(t.name);if(!i)throw Error(`Could not load character '${r}' in room definition '${e}', the character '${t.name}' does not exist in the db.`);let n=o.characterCreateFromTemplate(i);o.characterSetPos(n,[d,u,0]),g.characters.push(n)}}),await Promise.all(f),d[e]=g,g};t.roomGetTileAt=(e,t,r)=>t<0||t>=e.width||r<0||r>=e.height?null:e.tiles[r*e.width+t],t.roomAddParticle=(e,t)=>{e.particles.push(t)},t.roomRemoveRemoveCharacter=(e,t)=>{let r=e.characters.indexOf(t);r>-1&&e.characters.splice(r,1)},t.roomGetTileBelow=(e,r)=>{let{x:i,y:n}=r;return t.roomGetTileAt(e,Math.floor((i+16-3)/t.TILE_WIDTH*2),Math.floor((n+16-3)/t.TILE_HEIGHT*2))},t.roomGetCharacterByName=(e,t)=>{for(let r=0;r<e.characters.length;r++){let i=e.characters[r];if(i.name===t)return i}return null}})),define("model/generics",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.disableKeyUpdate=t.enableKeyUpdate=t.getKeyUpdateEnabled=t.getRenderables=t.removeRenderable=t.addRenderable=t.setIsPaused=t.getIsPaused=t.isKeyDown=t.setKeyUp=t.setKeyDown=t.setMousePos=t.getMousePos=t.setFrameMultiplier=t.getFrameMultiplier=t.setDeltaT=t.getDeltaT=t.setNow=t.getNow=t.setCurrentPlayer=t.getCurrentPlayer=t.setCurrentScene=t.getCurrentScene=t.setCurrentOverworld=t.getCurrentOverworld=t.setCurrentBattle=t.getCurrentBattle=t.setCurrentRoom=t.getCurrentRoom=void 0;let r=window.room=null;t.getCurrentRoom=()=>r,t.setCurrentRoom=e=>{r=window.room=e};let i=window.battle=null;t.getCurrentBattle=()=>i,t.setCurrentBattle=e=>{i=window.battle=e};let n=window.overworld=null;t.getCurrentOverworld=()=>n,t.setCurrentOverworld=e=>{n=window.overworld=e};let o=window.scene=null;t.getCurrentScene=()=>o,t.setCurrentScene=e=>{o=window.scene=e};let a=window.player=null;t.getCurrentPlayer=()=>a,t.setCurrentPlayer=e=>{a=window.player=e};let l=0;t.getNow=()=>l,t.setNow=e=>{l=e};let s=0;t.getDeltaT=()=>s,t.setDeltaT=e=>{s=e};let c=0;t.getFrameMultiplier=()=>c,t.setFrameMultiplier=e=>{c=e};let d=[0,0];t.getMousePos=()=>d,t.setMousePos=(e,t)=>{d=[e,t]};let u={};t.setKeyDown=e=>{u[e]=!0},t.setKeyUp=e=>{u[e]=!1},t.isKeyDown=e=>{var t;return null!==(t=u[e])&&void 0!==t&&t};let h=!1;t.getIsPaused=()=>h,t.setIsPaused=e=>{h=e};let p={};t.addRenderable=(e,t)=>{p[e]=t},t.removeRenderable=e=>{delete p[e]},t.getRenderables=()=>p;let m=!0;t.getKeyUpdateEnabled=()=>m,t.enableKeyUpdate=()=>{m=!0},t.disableKeyUpdate=()=>{m=!1}})),define("model/animation",["require","exports","model/generics","model/sprite"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAnimation=t.createAnimationBuilder=t.Animation=void 0,t.Animation=class{constructor(e){this.loop=e||!1,this.sprites=[],this.done=!1,this.totalDurationMs=0,this.currentSpriteIndex=0,this.timestampStart=0,this.name="",this.awaits=[]}reset(){this.done=!1,this.currentSpriteIndex=0}start(){this.timestampStart=r.getNow()}getDurationMs(){return this.totalDurationMs}addSprite({name:e,duration:t,offsetX:r,offsetY:i,opacity:n}){this.sprites.push({name:e,timestampBegin:this.totalDurationMs,timestampEnd:this.totalDurationMs+t,duration:t,offsetX:r||0,offsetY:i||0,opacity:n}),this.totalDurationMs+=t}getAnimIndex(e){let t=0,r=this.currentSpriteIndex,i=this.sprites.length-1;for(;r<=i;){let n=r+Math.floor((i-r)/2);t=n;let{timestampEnd:o,timestampBegin:a}=this.sprites[n],l=(a||0)+this.timestampStart,s=(o||0)+this.timestampStart;if(e<s&&e>l)return n;e>=s?r=n+1:i=n-1}return t}update(){let e=r.getNow();if(this.currentSpriteIndex===this.sprites.length-1&&this.loop&&e-this.timestampStart>this.totalDurationMs){let t=this.timestampStart+this.totalDurationMs;this.reset(),this.start(),e-t<this.totalDurationMs&&(this.timestampStart=t)}this.currentSpriteIndex=this.getAnimIndex(e),this.loop||e-this.timestampStart>=this.totalDurationMs&&(this.done=!0,this.awaits.forEach(e=>e()),this.awaits=[])}onCompletion(){return new Promise(e=>{this.isDone()||this.loop||this.awaits.push(e)})}getSprite(){var e;return null===(e=this.sprites[this.currentSpriteIndex])||void 0===e?void 0:e.name}getSpriteSize(e){let t=r.getNow();e=null!=e?e:this.getAnimIndex(t);let{name:n}=this.sprites[e],[,,,o,a]=i.getSprite(n);return[o,a]}isDone(){return this.done}};let n=window.animations={};t.createAnimationBuilder=(e,t)=>{n[e]=t},t.createAnimation=e=>{let t=n[e];if(t){let r=t();return r.name=e,r}throw Error(`No animation exists which is named '${e}'`)}})),define("view/draw",["require","exports","model/sprite","model/canvas","model/room","utils","model/character","model/particle"],(function(e,t,r,i,n,o,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawRoom=t.drawParticle=t.drawCharacter=t.drawAnimation=t.drawSprite=t.drawText=t.measureText=t.drawRect=t.clearScreen=void 0;let s={font:"monospace",color:"#fff",size:14,align:"left",strokeColor:""};t.clearScreen=()=>{t.drawRect(0,0,i.getScreenSize(),i.getScreenSize(),"black")},t.drawRect=(e,t,r,n,o,a,l)=>{(l=l||i.getCtx()).lineWidth=1,l[a?"strokeStyle":"fillStyle"]=o,l[a?"strokeRect":"fillRect"](e,t,r,n)},t.measureText=(e,t,r)=>{r=r||i.getCtx();let{font:n,size:o}=Object.assign(Object.assign({},s),t||{});return r.textAlign="left",r.textBaseline="top",r.font=o+"px "+n,[r.measureText(e).width,o]},t.drawText=(e,t,r,n,o)=>{let{font:a,size:l,color:c,align:d,strokeColor:u}=Object.assign(Object.assign({},s),n||{});(o=o||i.getCtx()).font=`${l}px ${a}`,o.fillStyle=c,o.textAlign=d,o.textBaseline="middle",o.fillText(e,t,r),u&&(o.strokeStyle=u,o.lineWidth=.5,o.strokeText(e,t,r))},t.drawSprite=(e,t,n,o,a)=>{o=o||1,a=a||i.getCtx();try{let[i,l,s,c,d]="string"==typeof e?r.getSprite(e):e;a.drawImage(i,l,s,c,d,t,n,c*o,d*o)}catch(t){throw console.error(e),Error("Could not draw sprite: "+t)}},t.drawAnimation=(e,t,n,o,a)=>{o=o||1,a=a||i.getCtx(),e.update();let l=e.getSprite();if(!l)throw console.error(e),Error("Cannot draw animation that did not provide a sprite.");try{let[e,i,s,c,d]="string"==typeof l?r.getSprite(l):l;a.drawImage(e,i,s,c,d,t,n,c*o,d*o)}catch(e){throw Error(`Error attempting to draw animation sprite: "${l}"`)}},t.drawCharacter=(e,r,i)=>{let[n,l,s]=a.characterGetPos(e),c=a.characterGetAnimation(e),[d,u]=o.isoToPixelCoords(n,l,s);t.drawAnimation(c,d,u,r,i)},t.drawParticle=(e,r,i)=>{let[n,o]=l.particleGetPos(e),{anim:a,text:s,textParams:c}=e;a&&t.drawAnimation(a,n,o,r,i),s&&c&&t.drawText(s,n,o,c)},t.drawRoom=(e,l,s)=>{let{width:c,height:d,tiles:u,props:h,characters:p,particles:m}=e,[g,f]=l;(s=s||i.getCtx()).save(),s.translate(g,f);let _=[];for(let e=0;e<=c+d-2;e++)for(let t=0;t<=e;t++){let r=e-t;if(r<d&&t<c){let e=u[r*c+t],[i,a]=o.isoToPixelCoords(e.x*n.TILE_WIDTH/2,e.y*n.TILE_HEIGHT/2),l=a;a-=e.tileHeight-32,_.push({sprite:e.sprite,origPy:l,px:i,py:a,highlighted:e.highlighted,sortY:a+(e.tileHeight-32)+(e.tileHeight>32?20:16)})}}for(let e=0;e<h.length;e++){let t=h[e],[i,a]=o.isoToPixelCoords(t.x,t.y),[,,,l,s]=r.getSprite(t.sprite);i-=i-l/2+n.TILE_WIDTH/2,a=a-s+n.TILE_HEIGHT/2,_.push({sprite:t.sprite,px:i,py:a,sortY:a+s})}for(let e=0;e<p.length;e++){let t=p[e],[r,i,n]=a.characterGetPos(t),[,l]=o.isoToPixelCoords(r,i,n);_.push({character:t,sortY:l+32})}_=_.sort((e,t)=>e.sortY<t.sortY?-1:1);for(let e=0;e<_.length;e++){let{sprite:r,character:i,px:n,py:o}=_[e];r?(t.drawSprite(r,n,o),0===r.indexOf("control_1")&&t.drawRect(n+16-4,o+32-4,8,8,"orange")):i&&t.drawCharacter(i)}for(let e=0;e<m.length;e++)t.drawParticle(m[e]);s.restore()}})),define("model/sprite",["require","exports","view/draw","model/canvas","model/room"],(function(e,t,r,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSprite=t.loadImageAsSpritesheet=t.loadImageAsSprite=t.loadTiles=t.SpriteModification=t.loadImage=void 0;let o={};window.sprites=o;let a=(e,t,r,i,n)=>[e,t,r,i,n];var l;t.loadImage=async e=>new Promise((t,r)=>{let i=new Image;i.onload=()=>{t(i)},i.onerror=()=>{r("Failed to load image: "+e)},i.src="res/"+e}),function(e){e.NORMAL="",e.FLIPPED="_f",e.ROT90="_r1",e.ROT180="_r2",e.ROT270="_r3"}(l=t.SpriteModification||(t.SpriteModification={}));let s=e=>{let[t,r,n,o]=i.createCanvas(e.width,e.height),a=n/2,l=o/2;return r.translate(a,l),r.rotate(Math.PI/2),r.drawImage(e,-a,-l),t},c=e=>{let[,,,t,n]=e,[o,a]=i.createCanvas(t,n);return r.drawSprite(e,0,0,1,a),o},d=(e,t,r,n,o)=>{let d=(t,r,i,n,o,l)=>e[t]=a(r,i,n,o,l),u=(e,t,r)=>{let i=e;for(let e=0;e<r;e++)i=s(i);d(`${t}_r${r}`,i,0,0,n,o)},h=(e,r,a)=>{let s=d(e,t,a*n,r*o,n,o);u(c(s),e,1),u(c(s),e,2),u(c(s),e,3),d(`${e}${l.FLIPPED}`,(e=>{let[t,r,n]=i.createCanvas(e.width,e.height);return r.translate(n,0),r.scale(-1,1),r.drawImage(e,0,0),t})(c(s)),0,0,n,o)},p=t.width/n,m=t.height/o;for(let e=0;e<m;e++)for(let t=0;t<p;t++){let i=`${r}_${e*p+t}`;1!==p||1!==m||i.includes("512")||(i=r),h(i,e,t)}};t.loadTiles=async()=>{let e=await t.loadImage("battle-terrain1.png");d(o,e,"terrain",n.TILE_WIDTH,n.TILE_HEIGHT)},t.loadImageAsSprite=async(e,r)=>{let i=t.getSprite(r);if(i)return i[0];{o[r]=[new Image,0,0,0,0];let i=await t.loadImage(e);return d(o,i,r,i.width,i.height),i}},t.loadImageAsSpritesheet=async(e,r,i,n)=>{let a=t.getSprite(r);if(a)return a[0];{o[r]=[new Image,0,0,0,0];let a=await t.loadImage(e);return d(o,a,r,i,n),d(o,a,r,a.width,a.height),a}};let u=a(document.createElement("canvas"),0,0,1,1);t.getSprite=e=>0===e.indexOf("invisible")?u:o[e]})),define("controller/res-loader",["require","exports","model/animation","model/sprite"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadRes=void 0;class n{async processAssetFile(e){let t=[],n=async function(e){throw Error("cannot load sounds yet: "+e)},o=async function(e){let[,t,r,n,o]=e;if("invisible"!==t)return await i.loadImageAsSpritesheet(r,t,+n,+o)},a=function(e,t){let r=e[2];t.name=e[1],t.loop="true"===r},l=function(e,t){t.sprites.push({name:e[1],duration:parseFloat(e[2])})},s=e.split("\n"),c=new r.Animation(!1),d=function(){r.createAnimationBuilder(c.name,function(e){let t=new r.Animation(e.loop);return e.sprites.forEach(e=>{t.addSprite({name:e.name,duration:e.duration,opacity:e.opacity,offsetX:e.offsetX,offsetY:e.offsetY})}),t}.bind(this,c)),r.createAnimationBuilder(c.name+i.SpriteModification.FLIPPED,function(e){let t=new r.Animation(e.loop);return e.sprites.forEach(e=>{t.addSprite({name:e.name+i.SpriteModification.FLIPPED,duration:e.duration,opacity:e.opacity,offsetX:e.offsetX,offsetY:e.offsetY})}),t}.bind(this,c))};for(let e of s){let i=e.split(","),[s]=i;if("AnimSprite"!==s)switch(c&&d(),s){case"Picture":t.push(()=>o(i));break;case"Animation":c=new r.Animation(!1),a(i,c);continue;case"Sound":t.push(()=>n(i))}else{if(!c)throw console.error("Error reading res.txt, AnimSprite without Anim",i),Error("display loading error");l(i,c)}}c&&d();for(let e=0;e<t.length;e++)await t[e]()}async loadAssets(e){await this.processAssetFile(e)}}t.loadRes=async()=>{let e=await(await fetch("res/res.txt")).text();return(new n).loadAssets(e)}})),define("db/index",["require","exports","db/enemies","db/encounters","db/characters","db/overworlds"],(function(e,t,r,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=()=>{r.init(),i.init(),n.init(),o.init()}})),define("main",["require","exports","model/sprite","model/room","controller/loop","controller/res-loader","model/canvas","controller/events","view/ui","view/hooks","model/scene","db/index","lib/rpgscript","model/generics","db/overworlds","controller/overworld-management","model/player","model/character"],(function(e,t,r,n,o,a,l,s,c,d,u,h,p,m,g,f,_,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.main=void 0,h=i(h),t.main=async()=>{h.default(),await r.loadTiles(),await n.loadRooms(),await a.loadRes(),l.getCanvas(),l.setDrawScale(2),s.initEvents(),d.initHooks(),u.initScene();let e=m.getCurrentScene();await p.loadRPGScript("floor1",e),await p.loadRPGScript("test",e);let t=_.playerCreate({name:"Ada",spriteBase:"ada",facing:v.Facing.LEFT_DOWN,animationState:v.AnimationState.IDLE,skills:[]});f.initiateOverworld(t,g.get("TEST2"),[35,205,0]),c.mountUi(),o.runMainLoop()}})),define("lib/picostyle",["require","exports"],(function(e,t){"use strict";function r(e,t){var r="p"+o++,i=t+r;return e.forEach((function(e){if(/^@/.test(e)){var t=e.indexOf("{")+1;e=e.slice(0,t)+i+e.slice(t)}else e=i+e;a.insertRule(e,a.cssRules.length)})),r}function i(e,t){return t+"{"+e+"}"}function n(e,t){var r=[""];for(var o in t=t||0,e){var a=e[o];o=o.replace(/[A-Z]/g,"-$&").toLowerCase(),a.sub||Array.isArray(a)?(a=Array.isArray(a)?a:[a]).forEach((function(e){return r[0]+=o+":"+e+";"})):(o=o.replace(/&/g,""),r.push(i(n(a,!/^@/.test(o)).join(""),o)))}return t||(r[0]=i(r[0],"")),r}Object.defineProperty(t,"__esModule",{value:!0}),t.keyframes=void 0;var o=0,a=document.head.appendChild(document.createElement("style")).sheet;t.default=function(e,t){function i(t){return function(r){return function(i,n){n=(i=i||{}).children||n;var a="function"==typeof r?r(i):r;return i.class=[o(a),i.class].filter(Boolean).join(" "),e(t,i,n)}}}function o(e){var t=n(e),i=t.join("");return a[i]||(a[i]=r(t,"."))}var a={};return(t=t||{}).returnObject?{style:i,css:o}:i},t.keyframes=function(e){return r([i(n(e,1).join(""),"")],"@keyframes ")}})),define("lib/preact-hooks",["require","exports","preact"],(function(e,t,r){"use strict";function i(e,t){r.options.__h&&r.options.__h(m,e,f||t),f=0;var i=m.__H||(m.__H={__:[],__h:[]});return e>=i.__.length&&i.__.push({}),i.__[e]}function n(e){return f=1,o(h,e)}function o(e,t,r){var n=i(p++,2);return n.t=e,n.__c||(n.__=[r?r(t):h(void 0,t),function(e){var t=n.t(n.__[0],e);n.__[0]!==t&&(n.__=[t,n.__[1]],n.__c.setState({}))}],n.__c=m),n.__}function a(e,t){var n=i(p++,4);!r.options.__s&&u(n.__H,t)&&(n.__=e,n.__H=t,m.__h.push(n))}function l(e,t){var r=i(p++,7);return u(r.__H,t)&&(r.__=e(),r.__H=t,r.__h=e),r.__}function s(){_.forEach((function(e){if(e.__P)try{e.__H.__h.forEach(c),e.__H.__h.forEach(d),e.__H.__h=[]}catch(t){e.__H.__h=[],r.options.__e(t,e.__v)}})),_=[]}function c(e){var t=m;"function"==typeof e.__c&&e.__c(),m=t}function d(e){var t=m;e.__c=e.__(),m=t}function u(e,t){return!e||e.length!==t.length||t.some((function(t,r){return t!==e[r]}))}function h(e,t){return"function"==typeof t?t(e):t}Object.defineProperty(t,"__esModule",{value:!0}),t.useErrorBoundary=t.useDebugValue=t.useContext=t.useCallback=t.useMemo=t.useImperativeHandle=t.useRef=t.useLayoutEffect=t.useEffect=t.useReducer=t.useState=void 0;var p,m,g,f=0,_=[],v=r.options.__b,y=r.options.__r,C=r.options.diffed,w=r.options.__c,S=r.options.unmount;t.useState=n,t.useReducer=o,t.useEffect=function(e,t){var n=i(p++,3);!r.options.__s&&u(n.__H,t)&&(n.__=e,n.__H=t,m.__H.__h.push(n))},t.useLayoutEffect=a,t.useRef=function(e){return f=5,l((function(){return{current:e}}),[])},t.useImperativeHandle=function(e,t,r){f=6,a((function(){"function"==typeof e?e(t()):e&&(e.current=t())}),null==r?r:r.concat(e))},t.useMemo=l,t.useCallback=function(e,t){return f=8,l((function(){return e}),t)},t.useContext=function(e){var t=m.context[e.__c],r=i(p++,9);return r.__c=e,t?(null==r.__&&(r.__=!0,t.sub(m)),t.props.value):e.__},t.useDebugValue=function(e,t){r.options.useDebugValue&&r.options.useDebugValue(t?t(e):e)},t.useErrorBoundary=function(e){var t=i(p++,10),r=n();return t.__=e,m.componentDidCatch||(m.componentDidCatch=function(e){t.__&&t.__(e),r[1](e)}),[r[0],function(){r[1](void 0)}]},r.options.__b=function(e){m=null,v&&v(e)},r.options.__r=function(e){y&&y(e),p=0;var t=(m=e.__c).__H;t&&(t.__h.forEach(c),t.__h.forEach(d),t.__h=[])},r.options.diffed=function(e){C&&C(e);var t=e.__c;t&&t.__H&&t.__H.__h.length&&(1!==_.push(t)&&g===r.options.requestAnimationFrame||((g=r.options.requestAnimationFrame)||function(e){var t,r=function(){clearTimeout(i),b&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(r,100);b&&(t=requestAnimationFrame(r))})(s)),m=void 0},r.options.__c=function(e,t){t.some((function(e){try{e.__h.forEach(c),e.__h=e.__h.filter((function(e){return!e.__||d(e)}))}catch(i){t.some((function(e){e.__h&&(e.__h=[])})),t=[],r.options.__e(i,e.__v)}})),w&&w(e,t)},r.options.unmount=function(e){S&&S(e);var t=e.__c;if(t&&t.__H)try{t.__H.__.forEach(c)}catch(e){r.options.__e(e,t.__v)}};var b="function"==typeof requestAnimationFrame})),define("lib/preact",["require","exports"],(function(e,t){"use strict";function r(e,t){for(var r in t)e[r]=t[r];return e}function i(e){var t=e.parentNode;t&&t.removeChild(e)}function n(e,t,r){var i,n,a,l=arguments,s={};for(a in t)"key"==a?i=t[a]:"ref"==a?n=t[a]:s[a]=t[a];if(arguments.length>3)for(r=[r],a=3;a<arguments.length;a++)r.push(l[a]);if(null!=r&&(s.children=r),"function"==typeof e&&null!=e.defaultProps)for(a in e.defaultProps)void 0===s[a]&&(s[a]=e.defaultProps[a]);return o(e,s,i,n,null)}function o(e,t,r,i,n){var o={type:e,props:t,key:r,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==n?++E.__v:n};return null!=E.vnode&&E.vnode(o),o}function a(e){return e.children}function l(e,t){this.props=e,this.context=t}function s(e,t){if(null==t)return e.__?s(e.__,e.__.__k.indexOf(e)+1):null;for(var r;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e)return r.__e;return"function"==typeof e.type?s(e):null}function c(e){var t,r;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e){e.__e=e.__c.base=r.__e;break}return c(e)}}function d(e){(!e.__d&&(e.__d=!0)&&I.push(e)&&!u.__r++||k!==E.debounceRendering)&&((k=E.debounceRendering)||P)(u)}function u(){for(var e;u.__r=I.length;)e=I.sort((function(e,t){return e.__v.__b-t.__v.__b})),I=[],e.some((function(e){var t,i,n,o,a,l,d;e.__d&&(l=(a=(t=e).__v).__e,(d=t.__P)&&(i=[],(n=r({},a)).__v=a.__v+1,o=y(d,a,n,t.__n,void 0!==d.ownerSVGElement,null!=a.__h?[l]:null,i,null==l?s(a):l,a.__h),C(i,a),o!=l&&c(a)))}))}function h(e,t,r,n,l,c,d,u,h,m){var g,f,_,v,C,w,T,A=n&&n.__k||L,E=A.length;for(h==D&&(h=null!=d?d[0]:E?s(n,0):null),r.__k=[],g=0;g<t.length;g++)if(null!=(v=r.__k[g]=null==(v=t[g])||"boolean"==typeof v?null:"string"==typeof v||"number"==typeof v?o(null,v,null,null,v):Array.isArray(v)?o(a,{children:v},null,null,null):null!=v.__e||null!=v.__c?o(v.type,v.props,v.key,null,v.__v):v)){if(v.__=r,v.__b=r.__b+1,null===(_=A[g])||_&&v.key==_.key&&v.type===_.type)A[g]=void 0;else for(f=0;f<E;f++){if((_=A[f])&&v.key==_.key&&v.type===_.type){A[f]=void 0;break}_=null}C=y(e,v,_=_||D,l,c,d,u,h,m),(f=v.ref)&&_.ref!=f&&(T||(T=[]),_.ref&&T.push(_.ref,null,v),T.push(f,v.__c||C,v)),null!=C?(null==w&&(w=C),h=p(e,v,_,A,d,C,h),m||"option"!=r.type?"function"==typeof r.type&&(r.__d=h):e.value=""):h&&_.__e==h&&h.parentNode!=e&&(h=s(_))}if(r.__e=w,null!=d&&"function"!=typeof r.type)for(g=d.length;g--;)null!=d[g]&&i(d[g]);for(g=E;g--;)null!=A[g]&&b(A[g],A[g]);if(T)for(g=0;g<T.length;g++)S(T[g],T[++g],T[++g])}function p(e,t,r,i,n,o,a){var l,s,c;if(void 0!==t.__d)l=t.__d,t.__d=void 0;else if(n==r||o!=a||null==o.parentNode)e:if(null==a||a.parentNode!==e)e.appendChild(o),l=null;else{for(s=a,c=0;(s=s.nextSibling)&&c<i.length;c+=2)if(s==o)break e;e.insertBefore(o,a),l=a}return void 0!==l?l:o.nextSibling}function m(e,t,r){"-"===t[0]?e.setProperty(t,r):e[t]=null==r?"":"number"!=typeof r||B.test(t)?r:r+"px"}function g(e,t,r,i,n){var o,a,l;if(n&&"className"==t&&(t="class"),"style"===t)if("string"==typeof r)e.style.cssText=r;else{if("string"==typeof i&&(e.style.cssText=i=""),i)for(t in i)r&&t in r||m(e.style,t,"");if(r)for(t in r)i&&r[t]===i[t]||m(e.style,t,r[t])}else"o"===t[0]&&"n"===t[1]?(o=t!==(t=t.replace(/Capture$/,"")),(a=t.toLowerCase())in e&&(t=a),t=t.slice(2),e.l||(e.l={}),e.l[t+o]=r,l=o?_:f,r?i||e.addEventListener(t,l,o):e.removeEventListener(t,l,o)):"list"!==t&&"tagName"!==t&&"form"!==t&&"type"!==t&&"size"!==t&&"download"!==t&&"href"!==t&&!n&&t in e?e[t]=null==r?"":r:"function"!=typeof r&&"dangerouslySetInnerHTML"!==t&&(t!==(t=t.replace(/xlink:?/,""))?null==r||!1===r?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):null==r||!1===r&&!/^ar/.test(t)?e.removeAttribute(t):e.setAttribute(t,r))}function f(e){this.l[e.type+!1](E.event?E.event(e):e)}function _(e){this.l[e.type+!0](E.event?E.event(e):e)}function v(e,t,r){var i,n;for(i=0;i<e.__k.length;i++)(n=e.__k[i])&&(n.__=e,n.__e&&("function"==typeof n.type&&n.__k.length>1&&v(n,t,r),t=p(r,n,n,e.__k,null,n.__e,t),"function"==typeof e.type&&(e.__d=t)))}function y(e,t,i,n,o,s,c,d,u){var p,m,g,f,_,y,C,S,b,A,x,I=t.type;if(void 0!==t.constructor)return null;null!=i.__h&&(u=i.__h,d=t.__e=i.__e,t.__h=null,s=[d]),(p=E.__b)&&p(t);try{e:if("function"==typeof I){if(S=t.props,b=(p=I.contextType)&&n[p.__c],A=p?b?b.props.value:p.__:n,i.__c?C=(m=t.__c=i.__c).__=m.__E:("prototype"in I&&I.prototype.render?t.__c=m=new I(S,A):(t.__c=m=new l(S,A),m.constructor=I,m.render=T),b&&b.sub(m),m.props=S,m.state||(m.state={}),m.context=A,m.__n=n,g=m.__d=!0,m.__h=[]),null==m.__s&&(m.__s=m.state),null!=I.getDerivedStateFromProps&&(m.__s==m.state&&(m.__s=r({},m.__s)),r(m.__s,I.getDerivedStateFromProps(S,m.__s))),f=m.props,_=m.state,g)null==I.getDerivedStateFromProps&&null!=m.componentWillMount&&m.componentWillMount(),null!=m.componentDidMount&&m.__h.push(m.componentDidMount);else{if(null==I.getDerivedStateFromProps&&S!==f&&null!=m.componentWillReceiveProps&&m.componentWillReceiveProps(S,A),!m.__e&&null!=m.shouldComponentUpdate&&!1===m.shouldComponentUpdate(S,m.__s,A)||t.__v===i.__v){m.props=S,m.state=m.__s,t.__v!==i.__v&&(m.__d=!1),m.__v=t,t.__e=i.__e,t.__k=i.__k,m.__h.length&&c.push(m),v(t,d,e);break e}null!=m.componentWillUpdate&&m.componentWillUpdate(S,m.__s,A),null!=m.componentDidUpdate&&m.__h.push((function(){m.componentDidUpdate(f,_,y)}))}m.context=A,m.props=S,m.state=m.__s,(p=E.__r)&&p(t),m.__d=!1,m.__v=t,m.__P=e,p=m.render(m.props,m.state,m.context),m.state=m.__s,null!=m.getChildContext&&(n=r(r({},n),m.getChildContext())),g||null==m.getSnapshotBeforeUpdate||(y=m.getSnapshotBeforeUpdate(f,_)),h(e,Array.isArray(x=null!=p&&p.type==a&&null==p.key?p.props.children:p)?x:[x],t,i,n,o,s,c,d,u),m.base=t.__e,t.__h=null,m.__h.length&&c.push(m),C&&(m.__E=m.__=null),m.__e=!1}else null==s&&t.__v===i.__v?(t.__k=i.__k,t.__e=i.__e):t.__e=w(i.__e,t,i,n,o,s,c,u);(p=E.diffed)&&p(t)}catch(e){t.__v=null,(u||null!=s)&&(t.__e=d,t.__h=!!u,s[s.indexOf(d)]=null),E.__e(e,t,i)}return t.__e}function C(e,t){E.__c&&E.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){E.__e(e,t.__v)}}))}function w(e,t,r,i,n,o,a,l){var s,c,d,u,p,m=r.props,f=t.props;if(n="svg"===t.type||n,null!=o)for(s=0;s<o.length;s++)if(null!=(c=o[s])&&((null===t.type?3===c.nodeType:c.localName===t.type)||e==c)){e=c,o[s]=null;break}if(null==e){if(null===t.type)return document.createTextNode(f);e=n?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type,f.is&&{is:f.is}),o=null,l=!1}if(null===t.type)m===f||l&&e.data===f||(e.data=f);else{if(null!=o&&(o=L.slice.call(e.childNodes)),d=(m=r.props||D).dangerouslySetInnerHTML,u=f.dangerouslySetInnerHTML,!l){if(null!=o)for(m={},p=0;p<e.attributes.length;p++)m[e.attributes[p].name]=e.attributes[p].value;(u||d)&&(u&&(d&&u.__html==d.__html||u.__html===e.innerHTML)||(e.innerHTML=u&&u.__html||""))}(function(e,t,r,i,n){var o;for(o in r)"children"===o||"key"===o||o in t||g(e,o,null,r[o],i);for(o in t)n&&"function"!=typeof t[o]||"children"===o||"key"===o||"value"===o||"checked"===o||r[o]===t[o]||g(e,o,t[o],r[o],i)})(e,f,m,n,l),u?t.__k=[]:h(e,Array.isArray(s=t.props.children)?s:[s],t,r,i,"foreignObject"!==t.type&&n,o,a,D,l),l||("value"in f&&void 0!==(s=f.value)&&(s!==e.value||"progress"===t.type&&!s)&&g(e,"value",s,m.value,!1),"checked"in f&&void 0!==(s=f.checked)&&s!==e.checked&&g(e,"checked",s,m.checked,!1))}return e}function S(e,t,r){try{"function"==typeof e?e(t):e.current=t}catch(e){E.__e(e,r)}}function b(e,t,r){var n,o,a;if(E.unmount&&E.unmount(e),(n=e.ref)&&(n.current&&n.current!==e.__e||S(n,null,t)),r||"function"==typeof e.type||(r=null!=(o=e.__e)),e.__e=e.__d=void 0,null!=(n=e.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){E.__e(e,t)}n.base=n.__P=null}if(n=e.__k)for(a=0;a<n.length;a++)n[a]&&b(n[a],t,r);null!=o&&i(o)}function T(e,t,r){return this.constructor(e,r)}function A(e,t,r){var i,o,l;E.__&&E.__(e,t),o=(i=r===O)?null:r&&r.__k||t.__k,e=n(a,null,[e]),l=[],y(t,(i?t:r||t).__k=e,o||D,D,void 0!==t.ownerSVGElement,r&&!i?[r]:o?null:t.childNodes.length?L.slice.call(t.childNodes):null,l,r||D,i),C(l,e)}Object.defineProperty(t,"__esModule",{value:!0}),t.options=t.__u=t.toChildArray=t.createContext=t.cloneElement=t.Component=t.isValidElement=t.createRef=t.Fragment=t.h=t.createElement=t.hydrate=t.render=void 0;var E,x,I,P,k,O,R,D={},L=[],B=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;t.options=E,t.isValidElement=x,t.createElement=n,t.h=n,t.createRef=function(){return{current:null}},t.Fragment=a,t.Component=l,t.toChildArray=function e(t,r){return r=r||[],null==t||"boolean"==typeof t||(Array.isArray(t)?t.some((function(t){e(t,r)})):r.push(t)),r},t.__u=b,t.render=A,t.hydrate=function(e,t){A(e,t,O)},t.cloneElement=function(e,t,i){var n,a,l,s=arguments,c=r({},e.props);for(l in t)"key"==l?n=t[l]:"ref"==l?a=t[l]:c[l]=t[l];if(arguments.length>3)for(i=[i],l=3;l<arguments.length;l++)i.push(s[l]);return null!=i&&(c.children=i),o(e.type,c,n||e.key,a||e.ref,null)},t.createContext=function(e,t){var r={__c:t="__cC"+R++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e,r,i){return this.getChildContext||(r=[],(i={})[t]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&r.some(d)},this.sub=function(e){r.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){r.splice(r.indexOf(e),1),t&&t.call(e)}}),e.children}};return r.Provider.__=r.Consumer.contextType=r},t.options=E={__e:function(e,t){for(var r,i,n,o=t.__h;t=t.__;)if((r=t.__c)&&!r.__)try{if((i=r.constructor)&&null!=i.getDerivedStateFromError&&(r.setState(i.getDerivedStateFromError(e)),n=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e),n=r.__d),n)return t.__h=o,r.__E=r}catch(t){e=t}throw e},__v:0},t.isValidElement=x=function(e){return null!=e&&void 0===e.constructor},l.prototype.setState=function(e,t){var i;i=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=r({},this.state),"function"==typeof e&&(e=e(r({},i),this.props)),e&&r(i,e),null!=e&&this.__v&&(t&&this.__h.push(t),d(this))},l.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),d(this))},l.prototype.render=a,I=[],P="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,u.__r=0,O=D,R=0}))})();