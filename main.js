(()=>{var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},__createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__rest=this&&this.__rest||function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(r[i[a]]=e[i[a]])}return r};define("lib/webgl-canvas",["require","exports"],(function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){function i(e){return e>0&&0==(e-1&e)}function a(e){return this.clearStack(e)}var o=[1,0,0,0,1,0,0,0,1],n=function(e,t){var r=e[0],i=e[1],a=e[2],o=e[3],n=e[4],s=e[5],l=e[6],c=e[7],A=e[8],d=t[0],u=t[1],h=t[2],m=t[3],g=t[4],p=t[5],E=t[6],f=t[7],w=t[8];t[0]=d*r+m*i+E*a,t[1]=u*r+g*i+f*a,t[2]=h*r+p*i+w*a,t[3]=d*o+m*n+E*s,t[4]=u*o+g*n+f*s,t[5]=h*o+p*n+w*s,t[6]=d*l+m*c+E*A,t[7]=u*l+g*c+f*A,t[8]=h*l+p*c+w*A};a.prototype.clearStack=function(e){this.m_stack=[],this.m_cache=[],this.c_stack=0,this.valid=0,this.result=null;for(var t=0;t<16;t++)this.m_stack[t]=this.getIdentity();void 0!==e?this.m_stack[0]=e:this.setIdentity()},a.prototype.setIdentity=function(){this.m_stack[this.c_stack]=this.getIdentity(),this.valid===this.c_stack&&this.c_stack&&this.valid--},a.prototype.getIdentity=function(){return[1,0,0,0,1,0,0,0,1]},a.prototype.getResult=function(){if(!this.c_stack)return this.m_stack[0];var e=o;this.valid>this.c_stack-1&&(this.valid=this.c_stack-1);for(var t=this.valid;t<this.c_stack+1;t++)e=n(this.m_stack[t],e),this.m_cache[t]=e;return this.valid=this.c_stack-1,this.result=this.m_cache[this.c_stack],this.result},a.prototype.pushMatrix=function(){this.c_stack++,this.m_stack[this.c_stack]=this.getIdentity()},a.prototype.popMatrix=function(){0!==this.c_stack&&this.c_stack--};var s=a.prototype.getIdentity();a.prototype.translate=function(e,t){s[6]=e,s[7]=t,n(s,this.m_stack[this.c_stack])};var l=a.prototype.getIdentity();a.prototype.scale=function(e,t){l[0]=e,l[4]=t,n(l,this.m_stack[this.c_stack])};var c,A,d=a.prototype.getIdentity();a.prototype.rotate=function(t){var r,i;r=e.sin(-t),i=e.cos(-t),d[0]=i,d[3]=r,d[1]=-r,d[4]=i,n(d,this.m_stack[this.c_stack])},(r=function(e,t){var r;this.canvas=e,this.options=t||{},this.gl=void 0,this.fs=void 0,this.vs=void 0,this.shaderProgram=void 0,this.transform=new a,this.shaderPool=[],this.maxTextureSize=void 0,e.gl2d=this,e.$getContext=e.getContext,e.getContext=(r=this,function(t){if(!r.options.force&&"webgl-2d"!==t||0===e.width||0===e.height)return r.canvas.$getContext(t);if(r.gl)return r.gl;var i=r.gl=r.canvas.$getContext("experimental-webgl");return r.initShaders(),r.initBuffers(),r.initCanvas2DAPI(),i.viewport(0,0,r.canvas.width,r.canvas.height),i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),r.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),i}),this.postInit()}).enable=function(e,t){return e.gl2d||new r(e,t)},r.prototype.getFragmentShaderSource=function(e){return["#ifdef GL_ES\nprecision highp float;\n#endif","#define hasTexture "+(1&e?"1":"0"),"#define hasCrop "+(2&e?"1":"0"),"varying vec4 vColor;\n#if hasTexture\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n#if hasCrop\nuniform vec4 uCropSource;\n#endif\n#endif\nvoid main(void) {\n#if hasTexture\n#if hasCrop\n//gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x * uCropSource.z, vTextureCoord.y * uCropSource.w) + uCropSource.xy) / vec4(0.9, 0.9, 0.9, 1);\ngl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x * uCropSource.z, vTextureCoord.y * uCropSource.w) + uCropSource.xy);\n#else\ngl_FragColor = texture2D(uSampler, vTextureCoord);\n#endif\n#else\ngl_FragColor = vColor;\n#endif\n}"].join("\n")},r.prototype.getVertexShaderSource=function(e,t){return["#define hasTexture "+(1&t?"1":"0"),"attribute vec4 aVertexPosition;\n#if hasTexture\nvarying vec2 vTextureCoord;\n#endif\nuniform vec4 uColor;","uniform mat3 uTransforms["+(e=e||1)+"];","varying vec4 vColor;","let mat4 pMatrix = mat4("+2/this.canvas.width+",0,0,0, 0,"+-2/this.canvas.height+",0,0, 0,0,1.0,1.0, -1.0,1.0,0,0);","mat3 crunchStack(void) {\nmat3 result = uTransforms[0];","for (int i = 1; i < "+e+"; ++i) {","result = uTransforms[i] * result;\n}\nreturn result;\n}\nvoid main(void) {\nvec3 position = crunchStack() * vec3(aVertexPosition.x, aVertexPosition.y, 1.0);\ngl_Position = pMatrix * vec4(position, 1.0);\nvColor = uColor;\n#if hasTexture\nvTextureCoord = aVertexPosition.zw;\n#endif\n}"].join("\n")},r.prototype.initShaders=function(e,t){var r=this.gl;t=t||0;var i=this.shaderPool[e=e||1];if(i||(i=this.shaderPool[e]=[]),i=i[t])return r.useProgram(i),this.shaderProgram=i,i;var a=this.fs=r.createShader(r.FRAGMENT_SHADER);if(r.shaderSource(this.fs,this.getFragmentShaderSource(t)),r.compileShader(this.fs),!r.getShaderParameter(this.fs,r.COMPILE_STATUS))throw"fragment shader error: "+r.getShaderInfoLog(this.fs);var o=this.vs=r.createShader(r.VERTEX_SHADER);if(r.shaderSource(this.vs,this.getVertexShaderSource(e,t)),r.compileShader(this.vs),!r.getShaderParameter(this.vs,r.COMPILE_STATUS))throw"vertex shader error: "+r.getShaderInfoLog(this.vs);var n=this.shaderProgram=r.createProgram();if(n.stackDepth=e,r.attachShader(n,a),r.attachShader(n,o),r.linkProgram(n),!r.getProgramParameter(n,r.LINK_STATUS))throw"Could not initialise shaders.";r.useProgram(n),n.vertexPositionAttribute=r.getAttribLocation(n,"aVertexPosition"),r.enableVertexAttribArray(n.vertexPositionAttribute),n.uColor=r.getUniformLocation(n,"uColor"),n.uSampler=r.getUniformLocation(n,"uSampler"),n.uCropSource=r.getUniformLocation(n,"uCropSource"),n.uTransforms=[];for(var s=0;s<e;++s)n.uTransforms[s]=r.getUniformLocation(n,"uTransforms["+s+"]");return this.shaderPool[e][t]=n,n};var u=new Float32Array([0,0,0,0,0,1,0,1,1,1,1,1,1,0,1,0]);r.prototype.initBuffers=function(){var e=this.gl;c=e.createBuffer(),e.createBuffer(),A=e.createBuffer(),e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,u,e.STATIC_DRAW)},r.instances=[],r.prototype.postInit=function(){r.instances.push(this)},r.prototype.initCanvas2DAPI=function(){function e(t){var r,i,a,o,n,s,l=[];if(r=u.exec(t)){if(o=r[1],n=parseFloat(r[8]),o&&isNaN(n)||!o&&!isNaN(n))return!1;s=r[3];for(var c=2;c<8;c+=2){if(i=r[c],(a=r[c+1])!==s)return!1;i=a?(i=i>100?1:i/100)<0?0:i:(i=i>255?1:i/255)<0?0:i,l.push(i)}l.push(o?n:1)}else if(r=h.exec(t))o=r[1],n=parseFloat(r[5]),l=function(e,t,r,i){function a(e){return 6*e<1?o+(n-o)*e*6:2*e<1?n:3*e<2?o+(n-o)*(2/3-e)*6:o}var o,n;return t=(t=t>100?1:t/100)<0?0:t,o=2*(r=(r=r>100?1:r/100)<0?0:r)-(n=r<=.5?r*(t+1):r+t-r*t),[a((e=(e%360+360)%360/360)+1/3),a(e),a(e-1/3),i]}(r[2],r[3],r[4],parseFloat(o&&n?n:1));else if(r=m.exec(t)){var A=parseInt(r[1],16);l=[((16711680&A)>>16)/255,((65280&A)>>8)/255,(255&A)/255,1]}else if(r=g.exec(t))l=e("#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]);else if(t.toLowerCase()in p)l=e(p[t.toLowerCase()]);else{if("transparent"!==t.toLowerCase())return!1;l=[0,0,0,0]}return l}function t(e){return"rgba("+255*e[0]+", "+255*e[1]+", "+255*e[2]+", "+parseFloat(e[3])+")"}function r(e){for(var t=n.transform.m_stack,r=0,i=n.transform.c_stack+1;r<i;++r)s.uniformMatrix3fv(e.uTransforms[r],!1,t[i-1-r])}function a(e,t){this.closed=!1,this.verts=[e,t,0,0]}function o(e){if(this.obj=s.createTexture(),this.index=b.push(this),y.push(e),e.width>n.maxTextureSize||e.height>n.maxTextureSize){var t=document.createElement("canvas");t.width=e.width>n.maxTextureSize?n.maxTextureSize:e.width,t.height=e.height>n.maxTextureSize?n.maxTextureSize:e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}s.bindTexture(s.TEXTURE_2D,this.obj),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),i(e.width)&&i(e.height)?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_LINEAR),s.generateMipmap(s.TEXTURE_2D)):s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.bindTexture(s.TEXTURE_2D,null)}var n=this,s=this.gl,l=document.createElement("canvas");l.width=n.canvas.width,l.height=n.canvas.height;var d=l.getContext("2d"),u=/^rgb(a)?\(\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,\s*(-?[\d]+)(%)?\s*,?\s*(-?[\d\.]+)?\s*\)$/,h=/^hsl(a)?\(\s*(-?[\d\.]+)\s*,\s*(-?[\d\.]+)%\s*,\s*(-?[\d\.]+)%\s*,?\s*(-?[\d\.]+)?\s*\)$/,m=/^#([0-9A-Fa-f]{6})$/,g=/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/,p={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},E={},f=[];E.fillStyle=[0,0,0,1],Object.defineProperty(s,"fillStyle",{get:function(){return t(E.fillStyle)},set:function(t){E.fillStyle=e(t)||E.fillStyle}}),E.strokeStyle=[0,0,0,1],Object.defineProperty(s,"strokeStyle",{get:function(){return t(E.strokeStyle)},set:function(t){E.strokeStyle=e(t)||drawStyle.strokeStyle}}),s.$lineWidth=s.lineWidth,E.lineWidth=1,Object.defineProperty(s,"lineWidth",{get:function(){return E.lineWidth},set:function(e){s.$lineWidth(e),E.lineWidth=e}}),E.lineCap="butt",Object.defineProperty(s,"lineCap",{get:function(){return E.lineCap},set:function(e){E.lineCap=e}}),E.lineJoin="miter",Object.defineProperty(s,"lineJoin",{get:function(){return E.lineJoin},set:function(e){E.lineJoin=e}}),E.miterLimit=10,Object.defineProperty(s,"miterLimit",{get:function(){return E.miterLimit},set:function(e){E.miterLimit=e}}),E.shadowOffsetX=0,Object.defineProperty(s,"shadowOffsetX",{get:function(){return E.shadowOffsetX},set:function(e){E.shadowOffsetX=e}}),E.shadowOffsetY=0,Object.defineProperty(s,"shadowOffsetY",{get:function(){return E.shadowOffsetY},set:function(e){E.shadowOffsetY=e}}),E.shadowBlur=0,Object.defineProperty(s,"shadowBlur",{get:function(){return E.shadowBlur},set:function(e){E.shadowBlur=e}}),E.shadowColor="rgba(0, 0, 0, 0.0)",Object.defineProperty(s,"shadowColor",{get:function(){return E.shadowColor},set:function(e){E.shadowColor=e}}),E.font="10px sans-serif",Object.defineProperty(s,"font",{get:function(){return E.font},set:function(e){d.font=e,E.font=e}}),E.textAlign="start",Object.defineProperty(s,"textAlign",{get:function(){return E.textAlign},set:function(e){E.textAlign=e}}),E.textBaseline="alphabetic",Object.defineProperty(s,"textBaseline",{get:function(){return E.textBaseline},set:function(e){E.textBaseline=e}}),E.globalAlpha=1,Object.defineProperty(s,"globalAlpha",{get:function(){return E.globalAlpha},set:function(e){E.globalAlpha=e}}),E.globalCompositeOperation="source-over",Object.defineProperty(s,"globalCompositeOperation",{get:function(){return E.globalCompositeOperation},set:function(e){E.globalCompositeOperation=e}}),s.fillText=function(e,t,r){},s.strokeText=function(){},s.measureText=function(){return 1};var w=document.createElement("canvas").getContext("2d");s.save=function(){n.transform.pushMatrix(),f.push({fillStyle:[E.fillStyle[0],E.fillStyle[1],E.fillStyle[2],E.fillStyle[3]],strokeStyle:[E.strokeStyle[0],E.strokeStyle[1],E.strokeStyle[2],E.strokeStyle[3]],globalAlpha:E.globalAlpha,globalCompositeOperation:E.globalCompositeOperation,lineCap:E.lineCap,lineJoin:E.lineJoin,lineWidth:E.lineWidth,miterLimit:E.miterLimit,shadowColor:E.shadowColor,shadowBlur:E.shadowBlur,shadowOffsetX:E.shadowOffsetX,shadowOffsetY:E.shadowOffsetY,textAlign:E.textAlign,font:E.font,textBaseline:E.textBaseline})},s.restore=function(){n.transform.popMatrix(),f.length&&(E=f.pop())},s.translate=function(e,t){n.transform.translate(e,t)},s.rotate=function(e){n.transform.rotate(e)},s.scale=function(e,t){n.transform.scale(e,t)},s.createImageData=function(e,t){return w.createImageData(e,t)},s.getImageData=function(e,t,r,i){var a=w.createImageData(r,i),o=new Uint8Array(r*i*4);s.readPixels(e,t,r,i,s.RGBA,s.UNSIGNED_BYTE,o);for(var n=4*r,l=i,c=0,A=l/2;c<A;++c)for(var d=0,u=n;d<u;++d){var h=c*n+d,m=(l-c-1)*n+d;a.data[h]=o[m],a.data[m]=o[h]}return a},s.putImageData=function(e,t,r){s.drawImage(e,t,r)},s.transform=function(e,t,r,i,a,o){var s=n.transform.m_stack[n.transform.c_stack];s[0]*=e,s[1]*=r,s[2]*=a,s[3]*=t,s[4]*=i,s[5]*=o,s[6]=0,s[7]=0},s.setTransform=function(e,t,r,i,a,o){n.transform.setIdentity(),s.transform.apply(this,arguments)},s.fillRect=function(e,t,i,a){var o=n.transform,l=n.initShaders(o.c_stack+2,0);s.bindBuffer(s.ARRAY_BUFFER,c),s.vertexAttribPointer(l.vertexPositionAttribute,4,s.FLOAT,!1,0,0),o.pushMatrix(),o.translate(e,t),o.scale(i,a),r(l),s.uniform4f(l.uColor,E.fillStyle[0],E.fillStyle[1],E.fillStyle[2],E.fillStyle[3]),s.drawArrays(s.TRIANGLE_FAN,0,4),o.popMatrix()},s.strokeRect=function(e,t,i,a){var o=n.transform,l=n.initShaders(o.c_stack+2,0);s.bindBuffer(s.ARRAY_BUFFER,c),s.vertexAttribPointer(l.vertexPositionAttribute,4,s.FLOAT,!1,0,0),o.pushMatrix(),o.translate(e,t),o.scale(i,a),r(l),s.uniform4f(l.uColor,E.strokeStyle[0],E.strokeStyle[1],E.strokeStyle[2],E.strokeStyle[3]),s.drawArrays(s.LINE_LOOP,0,4),o.popMatrix()},s.clearRect=function(e,t,r,i){};var C=[];s.beginPath=function(){C.length=0},s.closePath=function(){if(C.length){var e=C[C.length-1],t=e.verts[0],r=e.verts[1];e.closed=!0;var i=new a(t,r);C.push(i)}},s.moveTo=function(e,t){C.push(new a(e,t))},s.lineTo=function(e,t){C.length?C[C.length-1].verts.push(e,t,0,0):s.moveTo(e,t)},s.quadraticCurveTo=function(e,t,r,i){},s.bezierCurveTo=function(e,t,r,i,a,o){},s.arcTo=function(){},s.rect=function(e,t,r,i){s.moveTo(e,t),s.lineTo(e+r,t),s.lineTo(e+r,t+i),s.lineTo(e,t+i),s.closePath()},s.arc=function(e,t,r,i,a,o){},s.fill=function(){for(var e=0;e<C.length;e++)t=e,i=void 0,a=n.initShaders((i=n.transform).c_stack+2,0),o=C[t].verts,s.bindBuffer(s.ARRAY_BUFFER,A),s.bufferData(s.ARRAY_BUFFER,new Float32Array(o),s.STATIC_DRAW),s.vertexAttribPointer(a.vertexPositionAttribute,4,s.FLOAT,!1,0,0),i.pushMatrix(),r(a),s.uniform4f(a.uColor,E.fillStyle[0],E.fillStyle[1],E.fillStyle[2],E.fillStyle[3]),s.drawArrays(s.TRIANGLE_FAN,0,o.length/4),i.popMatrix();var t,i,a,o},s.stroke=function(){for(var e=0;e<C.length;e++)t=e,i=void 0,a=n.initShaders((i=n.transform).c_stack+2,0),l=(o=C[t]).verts,s.bindBuffer(s.ARRAY_BUFFER,A),s.bufferData(s.ARRAY_BUFFER,new Float32Array(l),s.STATIC_DRAW),s.vertexAttribPointer(a.vertexPositionAttribute,4,s.FLOAT,!1,0,0),i.pushMatrix(),r(a),s.uniform4f(a.uColor,E.strokeStyle[0],E.strokeStyle[1],E.strokeStyle[2],E.strokeStyle[3]),s.drawArrays(o.closed?s.LINE_LOOP:s.LINE_STRIP,0,l.length/4),i.popMatrix();var t,i,a,o,l},s.clip=function(){},s.isPointInPath=function(){},s.drawFocusRing=function(){};var y=[],b=[];s.drawImage=function(e,t,i,a,l,A,d,u,h){var m=n.transform;m.pushMatrix();var g=1,p=!1;3===arguments.length?(m.translate(t,i),m.scale(e.width,e.height)):5===arguments.length?(m.translate(t,i),m.scale(a,l)):9===arguments.length&&(m.translate(A,d),m.scale(u,h),g|=2,p=!0);var E,f=n.initShaders(m.c_stack,g),w=y.indexOf(e);E=-1!==w?b[w]:new o(e),p&&s.uniform4f(f.uCropSource,t/e.width,i/e.height,a/e.width,l/e.height),s.bindBuffer(s.ARRAY_BUFFER,c),s.vertexAttribPointer(f.vertexPositionAttribute,4,s.FLOAT,!1,0,0),s.bindTexture(s.TEXTURE_2D,E.obj),s.activeTexture(s.TEXTURE0),s.uniform1i(f.uSampler,0),r(f),s.drawArrays(s.TRIANGLE_FAN,0,4),m.popMatrix()}}}(Math),t.default=r})),define("model/canvas",["require","exports","lib/webgl-canvas"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getScreenSize=t.getDrawScale=t.setDrawScale=t.getCtx=t.getCanvas=t.createCanvas=t.CANVAS_ID_OUTER=t.CANVAS_ID=t.SCREEN_WIDTH=t.SCREEN_HEIGHT=void 0,r=__importDefault(r),t.SCREEN_HEIGHT=512,t.SCREEN_WIDTH=683,t.CANVAS_ID="canv",t.CANVAS_ID_OUTER="canv-outer";let i=null,a=null,o=1;t.createCanvas=(e,t,a)=>{let o,n=i?new OffscreenCanvas(e||1,t||1):document.createElement("canvas");return n.width=e||1,n.height=t||1,a?(r.default.enable(n),o=n.getContext("webgl-2d")):o=n.getContext("2d"),[n,o,e,t]},t.getCanvas=e=>{if("outer"===e&&a)return a;if(i)return i;{let[e,r]=t.createCanvas(t.SCREEN_WIDTH,t.SCREEN_HEIGHT);e.id=t.CANVAS_ID,r.imageSmoothingEnabled=!1;let a=document.getElementById("canvas-container");if(a){let[r,i]=t.createCanvas(t.SCREEN_WIDTH,t.SCREEN_HEIGHT);r.id=t.CANVAS_ID_OUTER,i.imageSmoothingEnabled=!1;let o=document.createElement("div");o.style.position="absolute",o.style.width="100%",o.style.height="100%",o.style.top="0",o.id="fade",a.appendChild(e),a.appendChild(o),a.appendChild(r)}return i=e,e}},t.getCtx=e=>{var r;let i=t.getCanvas(e);return null!==(r=i.getContext("2d"))&&void 0!==r?r:i.getContext("webgl-2d")},t.setDrawScale=e=>{o=e;let r=document.getElementById(t.CANVAS_ID);r&&((e,r)=>{e&&(e.style.width=t.SCREEN_WIDTH*r+"",e.style.height=t.SCREEN_HEIGHT*r+"",r>2&&(e.style.position="relative",e.style.left=-parseInt(e.style.width)/4+"px",e.style.top=-parseInt(e.style.height)/4+"px"))})(r,e);let i=document.getElementById(t.CANVAS_ID_OUTER);i&&(i.width=t.SCREEN_WIDTH*e/2,i.height=t.SCREEN_HEIGHT*e/2,i.style.position="absolute",i.style.left="0px",i.style.top="0px",a=i)},t.getDrawScale=()=>o,t.getScreenSize=()=>[t.SCREEN_WIDTH,t.SCREEN_HEIGHT]})),define("model/particle",["require","exports","model/utility","model/animation","utils","model/sprite","view/draw","model/room","model/generics"],(function(e,t,r,i,a,o,n,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.particleUpdate=t.particleGetSize=t.particleGetPos=t.particleCreateFromTemplate=t.particleCreate=t.createStatusParticle=t.createWeightedParticle=t.createRiseParticle=t.createDamageParticle=t.EFFECT_TEMPLATE_DEAD32=t.EFFECT_TEMPLATE_AGGROED=t.EFFECT_TEMPLATE_TREASURE=t.EFFECT_TEMPLATE_GEM=t.EFFECT_TEMPLATE_RANGED_HIT=t.EFFECT_TEMPLATE_RANGED_LEFT=t.EFFECT_TEMPLATE_ARMOR_REDUCED=t.EFFECT_TEMPLATE_SMOKE=t.EFFECT_TEMPLATE_FIREBALL=t.EFFECT_TEMPLATE_PIERCE_LEFT=t.EFFECT_TEMPLATE_SWORD_LEFT=void 0,t.EFFECT_TEMPLATE_SWORD_LEFT={animName:"effect_sword_left"},t.EFFECT_TEMPLATE_PIERCE_LEFT={animName:"effect_pierce_left"},t.EFFECT_TEMPLATE_FIREBALL={animName:"effect_fireball_explosion_anim",opacity:.65},t.EFFECT_TEMPLATE_SMOKE={animName:"effect_smoke_anim"},t.EFFECT_TEMPLATE_ARMOR_REDUCED={animName:"effect_armor_shatter",scale:.5},t.EFFECT_TEMPLATE_RANGED_LEFT={animName:"effect_range_projectile_left",duration:300},t.EFFECT_TEMPLATE_RANGED_HIT={animName:"effect_range_hit_left"},t.EFFECT_TEMPLATE_GEM={animName:"effect_gem"},t.EFFECT_TEMPLATE_TREASURE={animName:"effect_treasure_anim"},t.EFFECT_TEMPLATE_AGGROED={animName:"effect_aggro",duration:500,offset:[0,-32]},t.EFFECT_TEMPLATE_DEAD32={animName:"effect_dead2_anim",offset:[0,-12.5],opacity:.65,duration:2320},t.createDamageParticle=(e,i,o,n)=>{let l={size:16,color:null!=n?n:"white",align:"center",strokeColor:"black"},c=t.particleCreate();return c.anim=void 0,c.text=e,c.textParams=l,c.timer=new r.Timer(1e3),c.transform=new r.Transform([i,o,0],[i+a.getRandBetween(-s.TILE_WIDTH/2,s.TILE_WIDTH/2),o-s.TILE_HEIGHT,0],1e3,r.TransformEase.EASE_OUT),c.x=i,c.y=o,c.timer.start(),c},t.createRiseParticle=(e,i,a,o)=>{let n=null!=o?o:1e3,l=t.particleCreateFromTemplate([i,a],e);return l.transform=new r.Transform([l.x,l.y,0],[l.x,l.y-s.TILE_HEIGHT,0],n,r.TransformEase.EASE_OUT),l.timer.start(n),l},t.createWeightedParticle=(e,i,o,n)=>{let l=null!=n?n:1e3,c=t.particleCreateFromTemplate([i,o],e);return c.transform=new r.Transform([c.x,c.y,0],[c.x+a.getRandBetween(-s.TILE_WIDTH,s.TILE_WIDTH),c.y,0],l,r.TransformEase.EASE_OUT,r.transformOffsetWeightedParticle),c.timer.start(l),c},t.createStatusParticle=(e,i,a,o)=>{let n={size:16,color:null!=o?o:"white",align:"center",strokeColor:"black"},l=t.particleCreate();return l.anim=void 0,l.text=e,l.textParams=n,l.timer=new r.Timer(1500),l.transform=new r.Transform([i,a,0],[i,a-s.TILE_HEIGHT,0],1500,r.TransformEase.EASE_OUT),l.x=i,l.y=a,l.timer.start(),l},t.particleCreate=()=>({timer:new r.Timer(1e3),shouldRemove:!1,opacity:1,x:0,y:0,vx:0,vy:0,w:0,h:0,scale:1,meta:{},useOuterCanvas:!1}),t.particleCreateFromTemplate=(e,a)=>{var s,l,c,A,d,u,h,m,g,p,E,f,w;let C=a.animName?i.createAnimation(a.animName+(a.flipped?o.SpriteModification.FLIPPED:o.SpriteModification.NORMAL)):void 0,[y,b]=null!==(s=null==C?void 0:C.getSpriteSize(1))&&void 0!==s?s:[1,1],T=null!==(l=a.scale)&&void 0!==l?l:1;y*=T,b*=T;let S=t.particleCreate();return S.anim=C,S.timer=new r.Timer(null!==(A=null!==(c=a.duration)&&void 0!==c?c:null==C?void 0:C.getDurationMs())&&void 0!==A?A:1e3),S.opacity=null!==(d=a.opacity)&&void 0!==d?d:1,S.x=e[0]-y/2+(null!==(h=null===(u=a.offset)||void 0===u?void 0:u[0])&&void 0!==h?h:0),S.y=e[1]-b/2+(null!==(g=null===(m=a.offset)||void 0===m?void 0:m[1])&&void 0!==g?g:0),S.scale=null!==(p=a.scale)&&void 0!==p?p:1,S.text=null!==(E=a.text)&&void 0!==E?E:"",S.useOuterCanvas=null!==(f=a.useOuterCanvas)&&void 0!==f&&f,S.textParams=null!==(w=a.textParams)&&void 0!==w?w:n.DEFAULT_TEXT_PARAMS,null==C||C.start(),S.timer.start(),S},t.particleGetPos=e=>e.transform?a.truncatePoint3d(e.transform.current()):[e.x,e.y],t.particleGetSize=e=>{let t=e.anim;return(null==t?void 0:t.getSpriteSize(0))||[0,0]},t.particleUpdate=e=>{let t=l.getFrameMultiplier();e.x+=e.vx*t,e.y+=e.vy*t,e.timer.isComplete()&&(e.shouldRemove=!0)}})),define("view/style",["require","exports","preact","picostyle"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keyframes=t.style=t.MEDIA_QUERY_PHONE_WIDTH=t.colors=void 0;let a=(i=__importStar(i)).default(r.h);t.colors={BLACK:"#111",WHITE:"#F8F8F8",LIGHTGREY:"#BCB7C5",GREY:"#999",DARKGREY:"#2E3740",DARKGREY_ALT:"#5A5353",BGGREY:"#333",RED:"#BE2633",DARKRED:"#5E3643",PINK:"#FFAEB6",LIGHTGREEN:"#B6D53C",GREEN:"#44891A",DARKGREEN:"#005F1B",BROWN:"#A46422",ORANGE:"#FAB40B",PURPLE:"#9964F9",LIGHTBLUE:"#42CAFD",BLUE:"#31A2F2",DARKBLUE:"#243F72",YELLOW:"#F4B41B"},t.MEDIA_QUERY_PHONE_WIDTH="@media (max-width: 850px)",t.style=function(e,t){return a(e)(t)},t.keyframes=e=>i.keyframes(e)})),define("model/sound",["require","exports","utils","model/generics"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setVolumeForMusic=t.setVolumeForActiveSounds=t.stopSound=t.playSoundName=t.stopCurrentMusic=t.stopMusic=t.playMusic=t.playSound=t.getSound=t.loadSound=t.SoundType=void 0;let a={},o={},n=[];var s;!function(e){e.NORMAL="normal",e.MUSIC="music"}(s=t.SoundType||(t.SoundType={})),t.loadSound=async(e,r,i,n)=>(r="res/snd/"+r,new Promise((l,c)=>{let A=new Audio(r);A.autoplay=!1;let d=()=>{A.oncanplay=null,A.currentTime=99999999999;let r=A.currentTime;A.currentTime=0,A.onended=function(){A.pause(),A.currentTime=0},a[e]={sound:A,audio:A,soundDuration:r,soundType:i,volumeModifier:n},i===s.MUSIC&&(t.getSound(e),o[e]=t.getSound(e)),clearTimeout(u),l(A)};A.oncanplay=A.onloadeddata=d;let u=setTimeout(()=>{console.error("Sound load timed out:",e,r),d()},3e3);A.addEventListener("error",t=>{console.error("sound error",t),c('Cannot load sound: name="'+e+'", url="'+r+'", type='+i)}),A.src=r})),t.getSound=e=>{let t=a[e];if(t){let r=Object.assign(Object.assign({duration:0},t),{audio:t.audio.cloneNode(!0),soundName:e,lastStartTimestamp:i.getNow()});return t.sound.currentTime=0,r}return console.error("Could not find sound with name: ",e),null},t.playSound=(e,t)=>{if(!i.getSoundEnabled())return;t=null!=t?t:i.getVolume(e.soundType);let{sound:r}=e;r.volume=t*e.volumeModifier,r.play(),e.lastStartTimestamp=i.getNow()},t.playMusic=async(e,a,n)=>{let l=o[e];if(l){if(l.sound.loop=a,l.sound.paused&&(l.sound.currentTime=0,t.playSound(l),(n=null!=n?n:0)>0)){let e=13;for(let t=0;t<n;t+=e){let a=i.getVolume(s.MUSIC);l.sound.volume=r.normalizeClamp(t,0,n,0,a),await r.timeoutPromise(e)}l.sound.volume=i.getVolume(s.MUSIC)}}else console.error("playMusic: Could not find music with name:",e)},t.stopMusic=async(e,t)=>{let a=o[e];if(a){if(!a.sound.paused)if((t=null!=t?t:0)>0){let e=13;for(let o=0;o<t;o+=e){let n=i.getVolume(s.MUSIC);a.sound.volume=n-r.normalizeClamp(o,0,t,0,n),await r.timeoutPromise(e)}a.sound.pause(),a.sound.volume=i.getVolume(s.MUSIC)}else a.sound.pause()}else console.error("stopMusic: Could not find music with name:",e)},t.stopCurrentMusic=e=>{for(let r in o)o[r].sound.paused||t.stopMusic(r,e)},t.playSoundName=(e,r)=>{let i=t.getSound(e);i&&t.playSound(i,r)},t.stopSound=e=>{let{sound:t}=e;t.pause(),t.currentTime=0},t.setVolumeForActiveSounds=e=>{n.forEach(t=>{t.sound.volume=e})},t.setVolumeForMusic=e=>{for(let t in o)o[t].sound.volume=e}})),define("controller/events",["require","exports","model/generics","model/canvas"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isConfirmKey=t.popKeyHandler=t.pushEmptyKeyHandler=t.pushKeyHandler=t.getCurrentKeyHandler=t.initEvents=void 0,t.initEvents=()=>{let e=document.getElementById(i.CANVAS_ID),{left:a,top:o,width:n,height:s}=(null==e?void 0:e.getBoundingClientRect())||{left:0,top:0,width:0,height:0};window.addEventListener("mousemove",e=>{let{clientX:t,clientY:i}=e,l=t-a,c=i-o;l>n&&(l=n),c>s&&(c=s),r.setMousePos(l,c)}),window.addEventListener("keydown",e=>{r.setKeyDown(e.key);let i=t.getCurrentKeyHandler();i&&i(e)}),window.addEventListener("keyup",e=>{r.setKeyUp(e.key)}),t.pushKeyHandler(async e=>{})};let a=[];t.getCurrentKeyHandler=()=>a[a.length-1],t.pushKeyHandler=e=>{a.push(e)},t.pushEmptyKeyHandler=()=>{let e=()=>{};return a.push(e),e},t.popKeyHandler=e=>{if(e){let t=a.indexOf(e);t>-1&&a.splice(t,1)}else a.splice(a.length-1,1)},t.isConfirmKey=e=>["Return","Enter"," ","x","X"].includes(e)})),define("controller/ui-actions",["require","exports","view/ui","model/store","model/generics","model/overworld","model/sound","controller/events"],(function(e,t,r,i,a,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showModal=t.setCharacterText=t.setBattleCharacterSelectedAction=t.setBattleCharacterIndexSelected=t.hideChoices=t.showChoices=t.hideArcadeGame=t.setArcadeGameReady=t.setArcadeGameRunning=t.showArcadeGame=t.setCutsceneText=t.startConversation2=t.startConversation=t.showConversation=t.hideConversation=t.hideSection=t.showSections=t.showSection=t.hideSections=t.appReducer=void 0;let l={hideSections:e=>{e.sections=[]},showSection:(e,t)=>{e.sections.includes(t)||e.sections.push(t)},hideSection:(e,t)=>{let r=e.sections.filter(e=>e!==t);e.sections=r},setCutsceneState:(e,t)=>{Object.assign(e.cutscene,t)},setArcadeGameState:(e,t)=>{Object.assign(e.arcadeGame,t)},setBattleState:(e,t)=>{Object.assign(e.battle,t)},setChoicesState:(e,t)=>{Object.assign(e.choices,t)},setOverworldState:(e,t)=>{void 0!==t.characterText&&t.characterText!==e.overworld.characterText&&(t.prevCharacterText=e.overworld.characterText),Object.assign(e.overworld,t)},setModalState:(e,t)=>{Object.assign(e.modal,t)}};t.appReducer=function(e,t){let r=Object.assign({},e),i=l[t.action];return i?i(r,t.payload,e):console.error(`Action without a reducer mutation: "${t.action}"`,t),r},t.hideSections=()=>{r.getUiInterface().dispatch({action:"hideSections"})},t.showSection=(e,i)=>{i&&t.hideSections(),r.getUiInterface().dispatch({action:"showSection",payload:e})},t.showSections=(e,i)=>{i&&t.hideSections(),e.forEach(e=>{r.getUiInterface().dispatch({action:"showSection",payload:e})})},t.hideSection=e=>{let t=e;r.getUiInterface().dispatch({action:"hideSection",payload:t})},t.hideConversation=()=>{r.getUiInterface().dispatch({action:"setCutsceneState",payload:{visible:!1,portraitLeft:"",portraitLeft2:"",portraitRight:"",portraitRight2:"",portraitCenter:"",portraitLeftEmotion:"",portraitLeft2Emotion:"",portraitRightEmotion:"",portraitRight2Emotion:"",portraitCenterEmotion:""}})},t.showConversation=()=>{r.getUiInterface().dispatch({action:"setCutsceneState",payload:{visible:!0}})},t.startConversation=(e,a)=>{t.hideSection(i.AppSection.Debug),t.showSection(i.AppSection.Cutscene,!1),r.getUiInterface().dispatch({action:"setCutsceneState",payload:{showBars:a,portraitCenter:e,portraitLeft:"",portraitRight:"",portraitLeft2:"",portraitRight2:"",portraitLeftEmotion:"",portraitLeft2Emotion:"",portraitRightEmotion:"",portraitRight2Emotion:"",portraitCenterEmotion:"",speaker:i.CutsceneSpeaker.None,visible:!0}})},t.startConversation2=(e,a)=>{t.hideSection(i.AppSection.Debug),t.showSection(i.AppSection.Cutscene,!1),r.getUiInterface().dispatch({action:"setCutsceneState",payload:{showBars:!0,portraitLeft:e,portraitRight:a,portraitLeft2:"",portraitRight2:"",portraitCenter:"",portraitLeftEmotion:"",portraitLeft2Emotion:"",portraitRightEmotion:"",portraitRight2Emotion:"",portraitCenterEmotion:"",speaker:i.CutsceneSpeaker.None,speakerName:"",visible:!0}})},t.setCutsceneText=(e,t,i)=>{let a={text:e,visible:!0,speakerName:""};t&&(a.speaker=t,a.speakerName=i),r.getUiInterface().dispatch({action:"setCutsceneState",payload:a})},t.showArcadeGame=e=>{let a={path:e,isGameRunning:!1,isGameReady:!1};r.getUiInterface().dispatch({action:"setArcadeGameState",payload:a}),t.showSection(i.AppSection.ArcadeCabinet,!0)},t.setArcadeGameRunning=e=>{let t={isGameRunning:e};r.getUiInterface().dispatch({action:"setArcadeGameState",payload:t})},t.setArcadeGameReady=e=>{let t={isGameReady:e};r.getUiInterface().dispatch({action:"setArcadeGameState",payload:t})},t.hideArcadeGame=()=>{r.getUiInterface().dispatch({action:"setArcadeGameState",payload:{path:"",isGameRunning:!1,isGameReady:!1}}),t.showSection(i.AppSection.Debug,!0);let e=a.getCurrentOverworld();o.overworldShow(e)},t.showChoices=e=>{t.showSection(i.AppSection.Choices,!1);let a={choiceTexts:e};r.getUiInterface().dispatch({action:"setChoicesState",payload:a}),s.pushEmptyKeyHandler(),n.playSoundName("menu_choice_open")},t.hideChoices=()=>{let e=i.AppSection.Choices;s.popKeyHandler(),r.getUiInterface().dispatch({action:"hideSection",payload:e})},t.setBattleCharacterIndexSelected=e=>{let t={characterIndexSelected:e};r.getUiInterface().dispatch({action:"setBattleState",payload:t})},t.setBattleCharacterSelectedAction=(e,t)=>{e.ch.skillIndex=t,r.renderUi()},t.setCharacterText=e=>{let t=r.getUiInterface();t.appState.overworld.characterText!==e&&t.dispatch({action:"setOverworldState",payload:{characterText:e}})},t.showModal=(e,a)=>{let o={section:e,onClose:a};r.getUiInterface().dispatch({action:"setModalState",payload:o}),t.showSection(i.AppSection.Modal,!1)}})),define("controller/arcade-iframe-actions",["require","exports","utils","view/ui","controller/ui-actions","view/components/ArcadeCabinet/index"],(function(e,t,r,i,a,o){"use strict";var n,s;Object.defineProperty(t,"__esModule",{value:!0}),t.beginCurrentArcadeGame=t.setScaleWindow=t.setScaleOriginal=t.setButtonUp=t.setButtonDown=t.unmuteAudio=t.muteAudio=t.showControls=t.hideControls=void 0,function(e){e.HIDE_CONTROLS="HIDE_CONTROLS",e.SHOW_CONTROLS="SHOW_CONTROLS",e.MUTE_AUDIO="MUTE_AUDIO",e.UNMUTE_AUDIO="UNMUTE_AUDIO",e.BUTTON_DOWN="BUTTON_DOWN",e.BUTTON_UP="BUTTON_UP",e.SCALE_ORIGINAL="SCALE_ORIGINAL",e.SCALE_WINDOW="SCALE_WINDOW",e.BEGIN_GAME="BEGIN_GAME"}(n||(n={})),function(e){e.GAME_READY="GAME_READY",e.GAME_STARTED="GAME_STARTED",e.GAME_CONCLUDED="GAME_CONCLUDED",e.GAME_CANCELLED="GAME_CANCELLED"}(s||(s={}));let l=window.location.origin;window.addEventListener("message",async e=>{try{let t=JSON.parse(e.data);if(t.action===s.GAME_READY)a.setArcadeGameReady(!0);else if(t.action===s.GAME_STARTED)a.setArcadeGameRunning(!0);else if(t.action===s.GAME_CONCLUDED){window.focus();let e=i.getUiInterface().appState.arcadeGame.path;if(e){let r=o.getArcadeGamePathMeta(e);(null==r?void 0:r.onGameCompleted)&&await(null==r?void 0:r.onGameCompleted(t.payload))}a.setArcadeGameRunning(!1)}else t.action===s.GAME_CANCELLED&&a.setArcadeGameRunning(!1)}catch(e){}});let c=async()=>{let e=document.getElementById("arcade-iframe");if(e){let t=e;if(!t.contentWindow)for(let e=0;e<100&&(await r.timeoutPromise(33),!t.contentWindow);e++);return t.contentWindow}return console.error("Cannot get iframe contentWindow."),null},A=async(e,t)=>{e.postMessage(JSON.stringify(t),l)};t.hideControls=async()=>{let e=await c();e&&A(e,{action:n.HIDE_CONTROLS})},t.showControls=async()=>{let e=await c();e&&A(e,{action:n.SHOW_CONTROLS})},t.muteAudio=async()=>{let e=await c();e&&A(e,{action:n.MUTE_AUDIO})},t.unmuteAudio=async()=>{let e=await c();e&&A(e,{action:n.UNMUTE_AUDIO})},t.setButtonDown=async e=>{let t=await c();t&&A(t,{action:n.BUTTON_DOWN,payload:e})},t.setButtonUp=async e=>{let t=await c();t&&A(t,{action:n.BUTTON_UP,payload:e})},t.setScaleOriginal=async()=>{let e=await c();e&&A(e,{action:n.SCALE_ORIGINAL})},t.setScaleWindow=async()=>{let e=await c();e&&A(e,{action:n.SCALE_WINDOW})},t.beginCurrentArcadeGame=async()=>{let e=await c();e&&A(e,{action:n.BEGIN_GAME})}})),define("view/icons/Cursor",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{style:"transform: rotate(75deg)",stroke:e.color,width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.h("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M21.1568 4.15379C21.5068 3.32658 20.6734 2.49321 19.8462 2.84319L3.46966 9.77172C2.60871 10.136 2.67381 11.3772 3.56814 11.6494L8.7707 13.2327C9.72737 13.5239 10.4761 14.2726 10.7672 15.2293L12.3506 20.4318C12.6228 21.3262 13.864 21.3913 14.2283 20.5303L21.1568 4.15379ZM19.0669 1.00125C21.5485 -0.048667 24.0486 2.45145 22.9987 4.93307L16.0702 21.3096C14.9775 23.8924 11.2538 23.6971 10.4373 21.0142L8.85389 15.8116C8.75683 15.4927 8.50727 15.2432 8.18837 15.1461L2.98581 13.5627C0.302836 12.7462 0.107539 9.02252 2.69038 7.92979L19.0669 1.00125Z",fill:e.color}))})),define("view/elements/Button",["require","exports","preact","view/style","view/icons/Cursor"],(function(e,t,r,i,a){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonType=void 0,a=__importDefault(a),function(e){e[e.NEUTRAL=0]="NEUTRAL",e[e.PRIMARY=1]="PRIMARY",e[e.SECONDARY=2]="SECONDARY",e[e.ENEMY=3]="ENEMY",e[e.CANCEL=4]="CANCEL",e[e.TOKEN=5]="TOKEN"}(o=t.ButtonType||(t.ButtonType={}));let n={[o.NEUTRAL]:{top:i.colors.GREY,bottom:i.colors.DARKGREY_ALT},[o.PRIMARY]:{top:i.colors.BLUE,bottom:i.colors.DARKBLUE},[o.SECONDARY]:{top:i.colors.GREEN,bottom:i.colors.DARKGREEN},[o.ENEMY]:{top:i.colors.RED,bottom:i.colors.DARKRED},[o.CANCEL]:{top:i.colors.RED,bottom:i.colors.DARKRED},[o.TOKEN]:{top:i.colors.ORANGE,bottom:i.colors.YELLOW}},s=i.keyframes({"0%":{filter:"brightness(100%)"},"50%":{filter:"brightness(80%)"},"100%":{filter:"brightness(100%)"}}),l=i.keyframes({"0%":{transform:"translateX(-10px)"},"20%":{transform:"translateX(-1px)"},"100%":{transform:"translateX(-10px)"}}),c=i.style("div",()=>({color:i.colors.WHITE,position:"absolute",top:"-8px",left:"-32px",animation:l+" 750ms linear infinite"})),A=()=>r.h(c,null,r.h(a.default,{color:i.colors.BLUE})),d=i.style("div",(e={type:o.NEUTRAL})=>Object.assign({fontSize:"16px",textAlign:"center",padding:"2px 8px",cursor:e.disabled?"unset":"pointer",background:n[e.type].bottom,textDecoration:e.selected?"underline":"unset",transition:"border-radius 250sm",border:"2px solid "+(e.selected?i.colors.WHITE:e.disabled?i.colors.GREY:n[e.type].top),borderBottom:"2px solid "+i.colors.GREY,filter:e.disabled?"brightness(80%)":"unset",minWidth:"80px",animation:e.selected?s+" 1500ms linear infinite":"unset","&:hover":{filter:e.disabled?"unset":"brightness(120%)"},"&:active":{filter:e.disabled?"unset":"brightness(80%)",transform:"translateY(2px)"}},e.active?{filter:e.disabled?"unset":"brightness(80%)",transform:"translateY(2px)"}:{}));t.default=e=>r.h("div",{style:{position:"relative",pointerEvents:e.disabled?"none":"unset"}},e.showCursor?r.h(A,null):null,r.h(d,Object.assign({},e)))})),define("view/elements/IframeShim",["require","exports","preact","view/style"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=i.style("div",e=>({border:"20px solid black",transition:"width 0.25s, height 0.25s, marginTop 0.25s",borderImage:`url(${e.borderImageUrl}) 20 round`,width:e.expanded?"calc(100% - 40px)":e.width,height:e.expanded?"calc(100% - 40px - 4rem)":e.height,marginTop:e.expanded?"4rem":"0",display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:"all",[i.MEDIA_QUERY_PHONE_WIDTH]:{width:e.expanded?"calc(100% - 40px)":e.width,height:e.expanded?"calc(100% - 40px - 7.75rem)":e.height,marginTop:e.expanded?"7.75rem":"0"}}));t.default=e=>{var t;return r.h(a,{expanded:e.expanded,borderImageUrl:"res/img/arcade-border-1.png",width:e.width,height:e.height},e.loading?r.h("div",{id:"iframe-loading"},"Loading"):null,r.h("iframe",{id:e.id,ref:e.ref,src:e.src,style:Object.assign({border:"0px",width:e.width,height:e.height,display:e.loading?"none":"block"},null!==(t=e.style)&&void 0!==t?t:{})}))}})),define("view/icons/Arrow",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",style:"left"===e.direction?"transform: rotate(180deg)":""},r.h("g",{transform:"translate(0,0)"},r.h("path",{d:"M106.854 106.002a26.003 26.003 0 0 0-25.64 29.326c16 124 16 117.344 0 241.344a26.003 26.003 0 0 0 35.776 27.332l298-124a26.003 26.003 0 0 0 0-48.008l-298-124a26.003 26.003 0 0 0-10.136-1.994z",fill:e.color,"fill-opacity":"1"})))})),define("view/icons/Help",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",style:"width:100%"},r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M256 16C123.45 16 16 123.45 16 256s107.45 240 240 240 240-107.45 240-240S388.55 16 256 16zm0 60c99.41 0 180 80.59 180 180s-80.59 180-180 180S76 355.41 76 256 156.59 76 256 76zm0 30c-66.274 0-120 40.294-120 90 0 30 60 30 60 0 0-16.57 26.862-30 60-30 33.138 0 60 13.43 60 30s-30 15-60 30c-1.875.938-3.478 2.126-4.688 3.28C226.53 244.986 226 271.926 226 286v15c0 16.62 13.38 30 30 30 16.62 0 30-13.38 30-30v-15c0-45 90-40.294 90-90s-53.726-90-120-90zm0 240a30 30 0 0 0-30 30 30 30 0 0 0 30 30 30 30 0 0 0 30-30 30 30 0 0 0-30-30z",fill:e.color,"fill-opacity":"1"})))})),define("model/player",["require","exports","model/character","model/battle","utils","model/canvas"],(function(e,t,r,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.playerModifyTickets=t.playerModifyTokens=t.playerHasItem=t.playerRemoveItem=t.playerAddItem=t.playerGetCameraOffset=t.playerGetBattlePosition=t.playerSetBattlePosition=t.playerCreate=void 0,t.playerCreate=e=>{let t=r.characterCreateFromTemplate(e);return{leader:t,tokens:99,tickets:99,backpack:["Haptic Bracer"],party:[t],battlePositions:[t],partyStorage:[]}},t.playerSetBattlePosition=(e,t,r)=>{a.removeIfPresent(e.battlePositions,t),r===i.BattlePosition.FRONT?e.battlePositions.unshift(t):e.battlePositions.push(t)},t.playerGetBattlePosition=(e,t)=>{let r=e.battlePositions.indexOf(t);return r>=4?i.BattlePosition.BACK:r>=2?i.BattlePosition.MIDDLE:i.BattlePosition.FRONT},t.playerGetCameraOffset=e=>{let t=e.leader,[r,i]=a.isoToPixelCoords(t.x,t.y),[n,s]=o.getScreenSize();return[Math.round(n/2-r-16),Math.floor(s/2-i)]},t.playerAddItem=(e,t)=>(e.backpack.push(t),!0),t.playerRemoveItem=(e,t)=>{let r=e.backpack.indexOf(t);return r>-1&&(e.backpack.splice(r,1),!0)},t.playerHasItem=(e,t)=>e.backpack.indexOf(t)>-1,t.playerModifyTokens=(e,t)=>{e.tokens+=t,e.tokens<0&&(e.tokens=0)},t.playerModifyTickets=(e,t)=>{e.tickets+=t,e.tickets<0&&(e.tickets=0)}})),define("view/components/ArcadeCabinet/ArcadeCabinetHelpers",["require","exports","preact","view/style"],(function(e,t,r,i){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.CabinetControlButton=t.getArcadeGamePathMeta=t.ArcadeGamePathMeta=t.ArcadeGamePath=t.registerArcadeGameMeta=void 0,t.registerArcadeGameMeta=(e,r)=>{t.ArcadeGamePathMeta[e]=r},(a=t.ArcadeGamePath||(t.ArcadeGamePath={})).PRESIDENT="iframes/president/president.html",a.TIC_TAC_TOE="iframes/tic-tac-toe/tic-tac-toe.html",a.INVADERZ="iframes/invaderz/Invaderz.html",a.ELASTICITY="iframes/elasticity/elasticity.html",t.ArcadeGamePathMeta={default:{title:"No Game Specified",tokensRequired:99,controls:()=>r.h("div",null)}},t.getArcadeGamePathMeta=e=>t.ArcadeGamePathMeta[e],t.CabinetControlButton=i.style("div",e=>{var t,r;return{tapHighlightColor:"rgba(0, 0, 0, 0)",webkitTapHighlightColor:"rgba(0, 0, 0, 0)",padding:"16px",fontSize:"16px",minWidth:e.width?"unset":"48px",width:e.width,height:e.height,margin:"16px 4px",background:null!==(t=e.backgroundColor)&&void 0!==t?t:i.colors.DARKBLUE,color:null!==(r=e.color)&&void 0!==r?r:i.colors.WHITE,cursor:"pointer",borderRadius:"8px",border:"2px solid "+i.colors.GREY,textAlign:"center",fontFamily:"monospace",userSelect:"none",display:"text"===e.type?"flex":"",justifyContent:"center",touchAction:"manipulate",alignItems:"center","&:hover":{filter:"brightness(120%)"},"&:active":{filter:"brightness(80%)"}}})})),define("view/components/ArcadeCabinet/ArcadeCabinetHelpDialog",["require","exports","preact","view/style","view/elements/Button"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=__importStar(a);let o=i.style("div",()=>({background:"rgba(0, 0, 0, 0.5)",position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"2",pointerEvents:"all"})),n=i.style("div",()=>({margin:"4px",padding:"4px",minWidth:"50%",maxWidth:"90%",border:"2px solid "+i.colors.BLUE,background:i.colors.BGGREY,color:i.colors.WHITE})),s=i.style("div",()=>({margin:"8px",padding:"8px",fontSize:"32px",textTransform:"uppercase",borderBottom:"2px solid "+i.colors.BLACK})),l=i.style("div",()=>({margin:"8px",padding:"8px",fontSize:"16px"})),c=i.style("div",()=>({display:"flex",justifyContent:"flex-end",padding:"8px",margin:"8px"}));t.default=e=>r.h(o,null,r.h(n,null,r.h(s,null,e.title),r.h(l,null,e.children),r.h(c,null,r.h(a.default,{type:a.ButtonType.PRIMARY,style:{marginRight:"1rem"},onClick:()=>{e.setOpen(!1)}},"Close"))))})),define("lib/hud-gamepad",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});let GamePad=function(){function setup(config){document.addEventListener("touchmove",(function(e){e.preventDefault()}),!1),css();let length=Object.keys(config).length;length>0?(config.canvas?stage.assign(config.canvas):stage.create(),Object.keys(config).forEach((prop,i)=>{switch(prop){case"debug":case"trace":case"layout":case"start":case"select":case"hidden":case"joystick":case"hint":switch(typeof config[prop]){case"string":eval(`${prop} = '${config[prop]}'`);break;case"boolean":case"number":eval(`${prop} = ${config[prop]}`);break;case"object":switch(prop){case"start":case"select":eval(prop+" = true"),eval(`${prop}_button.key = '${config[prop].key}'`)}}break;case"buttons":buttons=config[prop].length-1,config[prop].length>buttons_layout.length&&(buttons=buttons_layout.length-1),buttons_layout=buttons_layout[buttons];for(var n=0;n<buttons+1;n++){var button=config[prop][n];button.name&&(buttons_layout[n].name=button.name),button.color&&(buttons_layout[n].color=button.color),button.key&&(buttons_layout[n].key=button.key),buttons_layout_built=!0}break;case"observerFunction":observerFunction=config[prop]}})):stage.create(),buttons_layout_built||(buttons_layout=buttons_layout[buttons]),start&&buttons_layout.push(start_button),select&&buttons_layout.push(select_button),events.bind(),controller.init(),init()}function init(){ctx.fillStyle="rgba(0,0,0,0.5)",ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=bit.small,ctx.fillText("loading",width/2,height/2),joystick&&controller.stick.draw(),controller.buttons.draw(),setTimeout((function(){ready=!0}),250)}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height),hidden||(debug&&helper.debug(),trace&&helper.trace(),joystick&&controller.stick.draw(),controller.buttons.draw())}function invert(e){}function css(){var e=document.createElement("style");e.innerHTML=`\n      @font-face {\n        font-family: 'bit';\n        src: url(${bit}) format('truetype');\n        font-weight: normal;\n        font-style: normal;\n      }\n      * {\n        padding: 0;\n        margin: 0;\n        -webkit-touch-callout: none;\n        -webkit-user-select: none;\n      }\n      html {\n        -ms-touch-action: manipulation;\n        touch-action: manipulation;\n      }\n      body {\n        width:  100%;\n        height: 100%;\n        margin: 0px;\n        padding:0px;\n        touch-action: none;\n        -ms-touch-action: none;\n        overflow: hidden;\n      }\n      canvas#controls {\n        image-rendering: optimizeSpeed;\n        image-rendering: -moz-crisp-edges;\n        image-rendering: -webkit-optimize-contrast;\n        image-rendering: -o-crisp-edges;\n        image-rendering: crisp-edges;\n        -ms-interpolation-mode: nearest-neighbor;\n         touch-action-delay: none;\n        touch-action: none;\n        -ms-touch-action: none;\n        position:fixed;\n      }\n      .touch {\n        display:flex;\n        position:fixed;\n        left:-1000rem;\n        top:-1000rem;\n        width:10px;\n        height:10px;\n      }\n      @media (any-pointer: coarse) {\n        .touch {\n          display:none;\n        }\n      }\n    `,document.head.appendChild(e),bit={button:"18px 'bit'",small:"12px 'bit'",medium:"16px 'bit'",large:"24px 'bit'",huge:"48px 'bit'"}}var canvas,ctx,px=0,py=0,width=window.innerWidth,height=window.innerHeight,scale=[window.innerWidth/width,window.innerHeight/height],bit="data:font/truetype;charset=utf-8;base64,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",font={},touches={},map={},observerFunction,toggle=!1,ready=!1,hint=!1,debug=!1,trace=!1,hidden=!1,layout="BOTTOM_RIGHT",radius=25,opacity=.4,colors={red:`rgba(255,0,0,${opacity})`,green:`rgba(0,255,0,${opacity})`,blue:`rgba(0,0,255,${opacity})`,purple:`rgba(255,0,255,${opacity})`,yellow:`rgba(255,255,0,${opacity})`,cyan:`rgba(0,255,255,${opacity})`,black:`rgba(0,0,0,${opacity})`,white:`rgba(255,255,255,${opacity})`,joystick:{base:`rgba(0,0,0,${opacity})`,dust:`rgba(0,0,0,${opacity})`,stick:"rgba(204,204,204,1)",ball:"rgba(255,255,255,1)"}},buttons=0,buttons_layout=[[{x:0,y:0,r:radius,color:colors.red,name:"a"}],[{x:-radius/4,y:radius+radius/2,r:radius,color:colors.red,name:"a"},{x:radius+radius/.75,y:radius/2-radius,r:radius,color:colors.green,name:"b"}],[{x:.75*-radius,y:2*radius,r:radius,color:colors.red,name:"a"},{x:1.75*radius,y:radius,r:radius,color:colors.green,name:"b"},{x:3.5*radius,y:-radius,r:radius,color:colors.blue,name:"c"}],[{x:-radius,y:radius,r:radius,color:colors.red,name:"a"},{x:2*radius-radius,y:-(radius+radius)+radius,r:radius,color:colors.green,name:"b"},{x:2*radius-radius,y:radius+radius+radius,r:radius,color:colors.blue,name:"x"},{x:3*radius,y:0+radius,r:radius,color:colors.purple,name:"y"}]],button_offset={x:3*radius,y:3*radius},buttons_layout_built=!1,start=!0,start_button={x:width/2,y:-15,w:50,h:15,color:colors.black,name:"start"},select=!1,select_button={x:width/2,y:-15,w:50,h:15,color:colors.black,name:"select"},joystick=!0,stage={create:function(e){e=e||"GamePad",(canvas=document.createElement("canvas")).setAttribute("id",e);var t=document.createElement("div");t.setAttribute("class","touch"),document.querySelector(".App")?(document.querySelector(".App").appendChild(canvas),document.querySelector(".App").appendChild(t)):(document.body.appendChild(canvas),document.body.appendChild(t)),stage.assign(e)},assign:function(e){document.getElementById(e)||stage.create(e),canvas=document.getElementById(e),stage.adjust()},adjust:function(){(ctx=canvas.getContext("2d")).canvas.width=width*scale[0],ctx.canvas.height=height*scale[1],ctx.scale(scale[0],scale[1])}},controller={init:function(){var e=layout;switch(layout={x:0,y:0},e){case"TOP_LEFT":for(var t=0,r=0;r<buttons_layout.length;r++)buttons_layout[r].r&&(t+=buttons_layout[r].r,buttons_layout[r].y-=2*buttons_layout[r].r);layout.x=t+button_offset.x,layout.y=0+button_offset.y;break;case"TOP_RIGHT":layout.x=width-button_offset.x,layout.y=0+button_offset.y;break;case"BOTTOM_LEFT":for(t=0,r=0;r<buttons_layout.length;r++)buttons_layout[r].r&&(t+=buttons_layout[r].r);layout.x=t+button_offset.x,layout.y=height-button_offset.y;break;case"BOTTOM_RIGHT":layout.x=width-button_offset.x,layout.y=height-button_offset.y}controller.buttons.init(),joystick&&controller.stick.init()},buttons:{init:function(){for(var e=0;e<buttons_layout.length;e++){var t=buttons_layout[e],r=layout.x-t.x,i=layout.y-t.y;if(t.r){var a=t.r;buttons_layout[e].hit={x:[r-a,r+2*a],y:[i-a,i+2*a],active:!1}}else{if(t.x=width/2-t.w,start&&select)switch(t.name){case"select":t.x=width/2-t.w-2*t.h;break;case"start":t.x=width/2}buttons_layout[e].hit={x:[r=t.x,r+t.w],y:[i=layout.y-t.y,i+t.h],active:!1}}map[t.name]=0}},draw:function(){for(var e=0;e<buttons_layout.length;e++){var t=buttons_layout[e],r=t.color,i=layout.y-t.y;if(t.dx=s=layout.x-t.x,t.dy=i,t.r){var a=t.r;t.hit&&t.hit.active&&(ctx.fillStyle=r,ctx.beginPath(),ctx.arc(s,i,a+5,0,2*Math.PI,!1),ctx.fill(),ctx.closePath()),ctx.fillStyle=r,ctx.beginPath(),ctx.arc(s,i,a,0,2*Math.PI,!1),ctx.fill(),ctx.closePath(),ctx.strokeStyle=r,ctx.lineWidth=2,ctx.stroke(),ctx.fillStyle="rgba(255,255,255,1)",ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=bit.button,ctx.fillText(t.name,s,i)}else{var o=t.w,n=t.h,s=t.x;i=t.dy,a=10,ctx.fillStyle=r,t.hit&&t.hit.active&&ctx.roundRect(s-5,i-5,o+10,n+10,2*a).fill(),ctx.roundRect(s,i,o,n,a).fill(),ctx.strokeStyle=r,ctx.lineWidth=2,ctx.stroke(),ctx.fillStyle="rgba(0,0,0,0.5)",ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=bit.button,ctx.fillText(t.name,s+o/2,i+2*n)}t.key&&hint&&(ctx.fillStyle="rgba(0,0,0,0.25)",ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=bit.button,"start"!=t.name&&"select"!=t.name||(s+=o/2),ctx.fillText(t.key,s,i-1.5*a))}},state:function(e,t,r){if("stick"!=touches[e].id){var i={x:touches[e].x,y:touches[e].y},a=buttons_layout[t],o=a.name,n=parseInt(i.x-a.dx),s=parseInt(i.y-a.dy),l=width;if(a.r?l=parseInt(Math.sqrt(n*n+s*s)):i.x>a.hit.x[0]&&i.x<a.hit.x[1]&&i.y>a.hit.y[0]&&i.y<a.hit.y[1]&&(l=0),l<radius&&"stick"!=touches[e].id)if(r)switch(r){case"mousedown":touches[e].id=o;break;case"mouseup":delete touches[e].id,controller.buttons.reset(t)}else touches[e].id=o;touches[e].id==o&&(map[o]=1,a.hit.active=!0,l>radius&&(a.hit.active=!1,map[o]=0,delete touches[e].id),"function"==typeof observerFunction&&observerFunction())}},reset:function(e){var t=buttons_layout[e],r=t.name;t.hit.active=!1,map[r]=0}},stick:{radius:40,x:0,y:0,dx:0,dy:0,init:function(){this.radius=40,this.x=width-layout.x,this.y=layout.y,this.dx=this.x,this.dy=this.y,map["x-dir"]=0,map["y-dir"]=0,map["x-axis"]=0,map["y-axis"]=0},draw:function(){ctx.fillStyle=colors.joystick.base,ctx.beginPath(),ctx.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),ctx.fill(),ctx.closePath(),ctx.fillStyle=colors.joystick.dust,ctx.beginPath(),ctx.arc(this.x,this.y,this.radius-5,0,2*Math.PI,!1),ctx.fill(),ctx.closePath(),ctx.fillStyle=colors.joystick.stick,ctx.beginPath(),ctx.arc(this.x,this.y,10,0,2*Math.PI,!1),ctx.fill(),ctx.closePath(),ctx.fillStyle=colors.joystick.ball,ctx.beginPath(),ctx.arc(this.dx,this.dy,this.radius-10,0,2*Math.PI,!1),ctx.fill(),ctx.closePath()},state:function(e,t){var r=touches[e].y,i=parseInt(touches[e].x-this.x),a=parseInt(r-this.y),o=parseInt(Math.sqrt(i*i+a*a));if(o<1.5*this.radius)if(t)switch(t){case"mousedown":touches[e].id="stick";break;case"mouseup":delete touches[e].id,controller.stick.reset()}else touches[e].id="stick";"stick"==touches[e].id&&(Math.abs(parseInt(i))<this.radius/2&&(this.dx=this.x+i),Math.abs(parseInt(a))<this.radius/2&&(this.dy=this.y+a),map["x-axis"]=(this.dx-this.x)/(this.radius/2),map["y-axis"]=(this.dy-this.y)/(this.radius/2),map["x-dir"]=Math.round(map["x-axis"]),map["y-dir"]=Math.round(map["y-axis"]),o>1.5*this.radius&&(controller.stick.reset(),delete touches[e].id),"function"==typeof observerFunction&&observerFunction())},reset:function(){this.dx=this.x,this.dy=this.y,map["x-dir"]=0,map["y-dir"]=0,map["x-axis"]=0,map["y-axis"]=0}}},events={bind:function(){var e={browser:["mousedown","mouseup","mousemove"],app:["touchstart","touchend","touchmove"]};for(var t in document.querySelector(".touch"),e=""===document.querySelector(".touch").style.display?e.app:e.browser)canvas.addEventListener(e[t],GamePad.events,!1)},listen:function(e){if(e.type){var t=e.type;-1!=e.type.indexOf("mouse")&&(e.identifier="desktop",e={touches:[e]});for(var r=0;r<(e.touches.length>5?5:e.touches.length);r++)touches[i=e.touches[r].identifier]?(touches[i].x=e.touches[r].pageX,touches[i].y=e.touches[r].pageY):touches[i]={x:e.touches[r].pageX,y:e.touches[r].pageY};for(var i in touches)switch(t){case"touchstart":case"touchmove":for(controller.stick.state(i),r=0;r<buttons_layout.length;r++)controller.buttons.state(i,r);break;case"mousedown":case"mousemove":case"mouseup":for(controller.stick.state(i,t),r=0;r<buttons_layout.length;r++)controller.buttons.state(i,r,t)}if("touchend"==e.type){for("stick"==touches[i=e.changedTouches[0].identifier].id&&controller.stick.reset(),r=0;r<buttons_layout.length;r++)touches[i].id==buttons_layout[r].name&&controller.buttons.reset(r);if(touches[i]&&delete touches[i],e.changedTouches.length>e.touches.length){var a=0,o=e.changedTouches.length-e.touches.length;for(var i in touches)a>=o&&delete touches[i],a++}if(0==e.touches.length){for(touches={},r=0;r<buttons_layout.length;r++)controller.buttons.reset(r);controller.stick.reset()}}}else{var n=e,s=0;for(var l in n){switch(l){case"%":n[l]&&(s+=1);break;case"&":n[l]&&(s+=2);break;case"'":n[l]&&(s+=4);break;case"(":n[l]&&(s+=8);break;default:if(n[l])for(r=0;r<buttons_layout.length;r++)buttons_layout[r].key&&buttons_layout[r].key==l&&(touches[buttons_layout[r].name]={id:buttons_layout[r].name,x:buttons_layout[r].hit.x[0]+buttons_layout[r].w/2,y:buttons_layout[r].hit.y[0]+buttons_layout[r].h/2},controller.buttons.state(buttons_layout[r].name,r,"mousedown"));else if(!n[l]){for(r=0;r<buttons_layout.length;r++)buttons_layout[r].key&&buttons_layout[r].key==l&&(controller.buttons.reset(r),delete touches[buttons_layout[r].name]);delete n[l]}}switch(controller.stick.dx=controller.stick.x,controller.stick.dy=controller.stick.y,s){case 1:controller.stick.dx=controller.stick.x-controller.stick.radius/2;break;case 2:controller.stick.dy=controller.stick.y-controller.stick.radius/2;break;case 3:controller.stick.dx=controller.stick.x-controller.stick.radius/2,controller.stick.dy=controller.stick.y-controller.stick.radius/2;break;case 4:controller.stick.dx=controller.stick.x+controller.stick.radius/2;break;case 6:controller.stick.dx=controller.stick.x+controller.stick.radius/2,controller.stick.dy=controller.stick.y-controller.stick.radius/2;break;case 8:controller.stick.dy=controller.stick.y+controller.stick.radius/2;break;case 9:controller.stick.dx=controller.stick.x-controller.stick.radius/2,controller.stick.dy=controller.stick.y+controller.stick.radius/2;break;case 12:controller.stick.dx=controller.stick.x+controller.stick.radius/2,controller.stick.dy=controller.stick.y+controller.stick.radius/2;break;default:controller.stick.dx=controller.stick.x,controller.stick.dy=controller.stick.y}0!=s?(touches.stick={id:"stick"},controller.stick.state("stick","mousemove")):(controller.stick.reset(),delete touches.stick)}}return events.broadcast()},broadcast:function(){return map},observe:function(){return events.broadcast()}},helper={debug:function(){var e=30;for(var t in ctx.fillStyle="rgba(0,0,0,0.5)",ctx.textAlign="left",ctx.textBaseline="middle",ctx.font=bit.medium,ctx.fillText("debug",10,e),ctx.font=bit.small,e+=5,touches){e+=10;var r=t+" : "+JSON.stringify(touches[t]).slice(1,-1);ctx.fillText(r,10,e)}},trace:function(){var e=30;for(var t in ctx.fillStyle="rgba(0,0,0,0.5)",ctx.textAlign="right",ctx.textBaseline="middle",ctx.font=bit.medium,ctx.fillText("trace",width-10,e),ctx.font=bit.small,e+=5,map)ctx.fillText(t+" : "+map[t],width-10,e+=10)}};return function e(){(toggle=!toggle)||ready&&draw(),requestAnimationFrame(e)}(),CanvasRenderingContext2D.prototype.roundRect=function(e,t,r,i,a){return r<2*a&&(a=r/2),i<2*a&&(a=i/2),this.beginPath(),this.moveTo(e+a,t),this.arcTo(e+r,t,e+r,t+i,a),this.arcTo(e+r,t+i,e,t+i,a),this.arcTo(e,t+i,e,t,a),this.arcTo(e,t,e+r,t,a),this.closePath(),this},{setup:function(e){setup(e)},draw:function(){draw()},events:function(e){return events.listen(e)},observe:function(){return events.observe()}}}(),MultiKey=function(){function e(){"keydown keyup".split(" ").forEach((function(e){window.addEventListener(e,MultiKey.handler,!1)}))}var t,r={},i=!1,a=!0;return{setup:function(r,a,o){!function(r,a,o){t=r,a&&(i=a.split("")),o&&(i=i.concat("&%'(".split(""))),e()}(r,a,o)},bind:function(){e()},unbind:function(){"keydown keyup".split(" ").forEach((function(e){window.removeEventListener(e,MultiKey.handler,!1)}))},handler:function(e){!function(e){var o=String.fromCharCode(e.keyCode).toLowerCase();i?(a=!1,-1!=i.indexOf(o)&&(r[o]="keydown"===e.type,a=!0)):r[o]="keydown"===e.type,"function"==typeof t&&a&&t(r)}(e)}}}();exports.default={GamePad:GamePad,MultiKey:MultiKey}})),define("controller/loop",["require","exports","model/generics","view/draw","model/character","model/particle","view/ui","controller/battle-management","controller/overworld-management","model/canvas","controller/scene-management","model/player","model/battle"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.runMainLoop=t.unpause=t.pause=void 0,t.pause=()=>{if(r.getIsPaused())return;r.setIsPaused(!0),n.renderUi(),r.getAllTimers().forEach(e=>{e.pauseOverride()});let e=r.getCameraTransform();e&&e.timer.pauseOverride();let t=r.getCurrentRoom();t&&(t.characters.forEach(e=>{e.transform&&e.transform.timer.pauseOverride(),a.characterGetAnimation(e).pause()}),t.particles.forEach(e=>{e.timer.pauseOverride(),e.anim&&e.anim.pause(),e.transform&&e.transform.timer.pauseOverride()}));let i=r.getCurrentBattle();i&&(u.battlePauseTimers(i),i.isPaused=!0)},t.unpause=()=>{if(!r.getIsPaused())return;r.setIsPaused(!1),n.renderUi(),r.getAllTimers().forEach(e=>{e.unpauseOverride()});let e=r.getCameraTransform();e&&e.timer.unpauseOverride();let t=r.getCurrentRoom();t&&(t.characters.forEach(e=>{e.transform&&e.transform.timer.unpauseOverride(),a.characterGetAnimation(e).unpause()}),t.particles.forEach(e=>{e.timer.unpauseOverride(),e.anim&&e.anim.unpause(),e.transform&&e.transform.timer.unpauseOverride()}));let i=r.getCurrentBattle();i&&(u.battleUnpauseTimers(i),i.isPaused=!1)},t.runMainLoop=async()=>{let e=performance.now(),t=e;window.running=!0,c.getCanvas("outer").getContext("2d");let n=()=>window.running&&requestAnimationFrame(u),u=e=>{let u=e-t,h=u/16;if(r.setFrameMultiplier(h>4?4:h),r.setDeltaT(u),t=e,r.setNow(e),r.getIsPaused()){let[e,t]=c.getScreenSize(),a=r.getCurrentRoom(),o=r.getCurrentBattle(),s=a.visible,l=0,A=0;if(o)l=e/2-16,A=t/4-13;else{let e=r.getCurrentPlayer();if(e){let[t,r]=d.playerGetCameraOffset(e);l=t,A=r}}return r.setCameraDrawOffset([l,A]),s&&i.drawRoom(a,[l,A],void 0,!0),void n()}r.getAllTimers().forEach(e=>{e.update()});let[m,g]=c.getScreenSize(),p=r.getCurrentScene(),E=r.getCurrentBattle(),f=r.getCurrentOverworld(),w=r.getCurrentRoom();p&&A.updateScene(p);let C=!1,y=0,b=0;if(w){C=w.visible;for(let e=0;e<w.tiles.length;e++)w.tiles[e].highlighted=!1;f&&l.updateOverworld(f),E&&s.updateBattle(E);for(let e=0;e<w.characters.length;e++)a.characterUpdate(w.characters[e]);for(let e=0;e<w.particles.length;e++)o.particleUpdate(w.particles[e]),w.particles[e].shouldRemove&&(w.particles.splice(e,1),e--);if(E)y=m/2-16,b=g/4-13;else{let e=r.getCurrentPlayer();if(e){let t=r.getCameraTransform();if(t){let[e,r]=t.current();y=e,b=r,t.update()}else{let[t,r]=d.playerGetCameraOffset(e);y=t,b=r}}}r.setCameraDrawOffset([y,b])}let T=r.getGlobalParticleSystem();if(T)return T.updateDraw(),void n();i.clearScreen(),i.clearScreen(c.getCtx("outer")),i.drawRect(0,0,m,g,r.getRenderBackgroundColor()),C&&i.drawRoom(w,[y,b]);let S=r.getRenderables();for(let e in S)(0,S[e])();n()};u(e)}})),define("controller/overworld-management",["require","exports","model/room","model/generics","model/overworld","model/character","controller/scene-management","controller/scene-commands","lib/rpgscript","controller/ui-actions","model/store","controller/events","lib/hud-gamepad","controller/loop"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateOverworld=t.callStepTriggers=t.overworldKeyHandler=t.callScriptDuringOverworld=t.enableOverworldControl=t.initiateOverworld=void 0,u=__importDefault(u),t.initiateOverworld=(e,t,c)=>{let A=a.createOverworldFromTemplate(t);if(A){let a=A.room,d=e.leader;r.roomAddCharacter(a,d),i.setCurrentRoom(a),i.setCurrentPlayer(e),i.setCurrentOverworld(A),i.setRenderBackgroundColor(t.backgroundColor);let u=c?a.markers[c]:null;if(u?o.characterSetPos(d,[u.x,u.y,0]):a.markers.MarkerPlayer?s.setCharacterAtMarker(d.name,"MarkerPlayer"):o.characterSetPos(d,[0,0,0]),A.loadTriggerName)try{let e=n.invokeTrigger(i.getCurrentScene(),A.loadTriggerName,l.TriggerType.ACTION);null!==e&&m(e)}catch(e){console.error(e)}return A.playerIsCollidingWithInteractable=!0,A}return null},t.enableOverworldControl=()=>{d.pushKeyHandler(t.overworldKeyHandler)},t.callScriptDuringOverworld=async e=>{let t=i.getCurrentOverworld();a.overworldDisableTriggers(t),i.disableKeyUpdate(),await n.callScript(i.getCurrentScene(),e);let r=i.getCurrentOverworld();a.overworldEnableTriggers(r),i.enableKeyUpdate(),r.visible&&c.showSection(A.AppSection.Debug,!0)};let m=async e=>{let t=i.getCurrentOverworld();a.overworldDisableTriggers(t),i.disableKeyUpdate(),await e();let r=i.getCurrentOverworld();a.overworldEnableTriggers(r),i.enableKeyUpdate(),r.visible&&c.showSection(A.AppSection.Debug,!0)},g=(e,t,r)=>n.invokeTrigger(i.getCurrentScene(),e,t,r),p=()=>{let e=i.getCurrentPlayer(),t=i.getCurrentRoom(),r=e.leader,a=[];for(let e=0;e<t.triggerActivators.length;e++){let i=t.triggerActivators[e];o.characterCollidesWithRect(r,[i.x,i.y,i.width,i.height])&&a.push(i)}return a},E=async e=>{let t=i.getCurrentPlayer().leader,r=Array.isArray(e)?e:[e],a=p();for(let e=0;e<a.length;e++){let i=a[e];for(let e=0;e<r.length;e++){let a=r[e],n=g(i.name,a);if(null!==n)return a!==l.TriggerType.ACTION&&a!==l.TriggerType.STEP_FIRST||o.characterSetAnimationState(t,o.AnimationState.IDLE),await m(n),i.name}}return""};t.overworldKeyHandler=async e=>{let t=i.getCurrentOverworld(),r=i.getIsPaused();switch(e.key){case" ":r?h.unpause():h.pause();break;case"X":case"x":t.triggersEnabled&&(await E(l.TriggerType.ACTION)||await(async()=>{let e=i.getCurrentPlayer(),t=i.getCurrentRoom(),r=e.leader;for(let a=0;a<t.characters.length;a++){let s=t.characters[a],[c,A]=o.characterGetPosBottom(s);if(s.talkTrigger&&o.characterCollidesWithPoint(r,[c,A,25])){let t=n.invokeTrigger(i.getCurrentScene(),s.talkTrigger,l.TriggerType.ACTION);if(null!==t)return o.characterStopAi(s),o.characterSetAnimationState(e.leader,o.AnimationState.IDLE),await m(t),o.characterStartAi(s),!0}}return!1})());break;case"b":i.getKeyUpdateEnabled()&&(i.disableKeyUpdate(),await n.callScript(i.getCurrentScene(),"test-tut-battle"),t.visible&&c.showSection(A.AppSection.Debug,!0),i.enableKeyUpdate());break;case"p":i.disableKeyUpdate(),await n.createAndCallScript(i.getCurrentScene(),'\n        +setConversation(\'Ada\');\n        Ada: "You are testing \'createAndCallScript\'"\n        Ada: "Hopefully you can see me speaking."\n        Ada: "This text was not specified in an rpgscript file, but instead in the code directly."\n        Ada: "The test will now conclude."\n        +endConversation();\n      '),i.enableKeyUpdate();break;case"d":i.getTriggersVisible()?(i.hideTriggers(),i.hideMarkers()):(i.showTriggers(),i.showMarkers());break;case"s":i.getKeyUpdateEnabled()&&(i.disableKeyUpdate(),d.pushEmptyKeyHandler(),a.overworldDisableTriggers(t),await n.callScript(i.getCurrentScene(),"intro"),a.overworldEnableTriggers(i.getCurrentOverworld()),c.showSection(A.AppSection.Debug,!0),d.popKeyHandler(),i.enableKeyUpdate());break;case"c":i.getKeyUpdateEnabled()&&(i.disableKeyUpdate(),d.pushEmptyKeyHandler(),a.overworldDisableTriggers(t),await n.callScript(i.getCurrentScene(),"floor1-tut-vr2-battle2-on-after-end"),a.overworldEnableTriggers(i.getCurrentOverworld()),c.showSection(A.AppSection.Debug,!0),d.popKeyHandler(),i.enableKeyUpdate())}},t.callStepTriggers=async e=>{let t=(e=>{let t=p();for(let r=0;r<t.length;r++){let i=t[r];for(let t=0;t<e.length;t++)if(g(i.name,e[t],!0))return!0}return!1})([l.TriggerType.STEP_FIRST,l.TriggerType.STEP]);t&&(e.playerIsCollidingWithInteractable?await E(l.TriggerType.STEP):await E([l.TriggerType.STEP_FIRST,l.TriggerType.STEP])),t!==e.playerIsCollidingWithInteractable&&(t||c.setCharacterText("")),e.playerIsCollidingWithInteractable=!!i.getCurrentScene().currentScript||t},t.updateOverworld=e=>{let r=i.getCurrentPlayer().leader;if(!e.visible)return;let{"x-dir":a,"y-dir":n}=u.default.GamePad.observe(),s=!1,l=0,c=0;i.getKeyUpdateEnabled()&&(i.isKeyDown("ArrowLeft")||a<0?(s=!0,l-=1,c+=1):(i.isKeyDown("ArrowRight")||a>0)&&(s=!0,l+=1,c-=1),i.isKeyDown("ArrowUp")||n<0?(s=!0,l-=1,c-=1):(i.isKeyDown("ArrowDown")||n>0)&&(s=!0,l+=1,c+=1),o.characterSetAnimationState(r,s?o.AnimationState.WALK:o.AnimationState.IDLE),r.vx=l,r.vy=c),e.triggersEnabled&&e.stepTimer.isComplete()&&(t.callStepTriggers(e),e.stepTimer.start()),e.room.characters.forEach(e=>{e.aiEnabled&&(e.timers=e.timers.filter(e=>(e.update(),!e.isComplete()||(e.shouldRemove=!0,!1))),e.overworldAi.update(e))})}})),define("db/tiles",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.getReplacementTemplate=t.getIfExists=t.get=void 0;let r={},i={};t.get=e=>{let t=r[e];if(!t)throw Error("No tile template exists with name: "+e);return Object.assign({},t)},t.getIfExists=e=>{let t=r[e];return t?Object.assign({},t):null},t.getReplacementTemplate=e=>{let r=i[e];if(!r)return null;let a=t.get(r);return Object.assign({},a)},t.init=()=>{r.RED_DOOR_BCK_CLOSED1={baseSprite:"walls_14",animName:"walls-anims_red_door_bck_close1",isWall:!0},i.walls_14="RED_DOOR_BCK_CLOSED1",r.RED_DOOR_BCK_CLOSED2={baseSprite:"walls_14",animName:"walls-anims_red_door_bck_close2",isWall:!0},r.RED_DOOR_FWD_CLOSED1={baseSprite:"walls_13",animName:"walls-anims_red_door_fwd_close1",isWall:!0},i.walls_13="RED_DOOR_FWD_CLOSED1",r.RED_DOOR_FWD_CLOSED2={baseSprite:"walls_13",animName:"walls-anims_red_door_fwd_close2",isWall:!0},r.RED_DOOR_BCK_OPEN1={baseSprite:"walls_14",animName:"walls-anims_red_door_bck_open1",isWall:!1},r.RED_DOOR_BCK_OPEN2={baseSprite:"walls_14",animName:"walls-anims_red_door_bck_open2",isWall:!1},r.RED_DOOR_FWD_OPEN1={baseSprite:"walls_13",animName:"walls-anims_red_door_fwd_open1",isWall:!1},r.RED_DOOR_FWD_OPEN2={baseSprite:"walls_13",animName:"walls-anims_red_door_fwd_open2",isWall:!1},r.ELEVATOR_BCK_CLOSED1={baseSprite:"walls_7",animName:"walls-anims_elevator_bck_close1",isWall:!0},r.ELEVATOR_BCK_CLOSED2={baseSprite:"walls_7",animName:"walls-anims_elevator_bck_close2",isWall:!0},r.ELEVATOR_FWD_CLOSED1={baseSprite:"walls_6",animName:"walls-anims_elevator_fwd_close1",isWall:!0},r.ELEVATOR_FWD_CLOSED2={baseSprite:"walls_6",animName:"walls-anims_elevator_fwd_close2",isWall:!0},r.ELEVATOR_BCK_OPEN1={baseSprite:"walls_7",animName:"walls-anims_elevator_bck_open1",isWall:!1},r.ELEVATOR_BCK_OPEN2={baseSprite:"walls_7",animName:"walls-anims_elevator_bck_open2",isWall:!1},r.ELEVATOR_FWD_OPEN1={baseSprite:"walls_6",animName:"walls-anims_elevator_fwd_open1",isWall:!1},r.ELEVATOR_FWD_OPEN2={baseSprite:"walls_6",animName:"walls-anims_elevator_fwd_open2",isWall:!1},r.KIOSK_STATS_ACTIVE={baseSprite:"props_26",animName:"tile_vr_portal_active",isWall:!0},r.KIOSK_STATS_PASSIVE={baseSprite:"props_26",animName:"tile_vr_portal_passive",isWall:!0},r.VR_PORTAL_FLOOR={baseSprite:"floors_15",animName:"tile_vr_portal_floor_anim"},r.TUT_GATE_FLOOR={baseSprite:"floors_59",isWall:!1,hasFloorTile:!1,size:[32,32],pxOffset:[0,48]},i.floors_15="VR_PORTAL_FLOOR"}})),define("view/icons/Sword",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{fill:e.color,stroke:e.color,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M491.844 22.533l-83.42 14.865L196.572 249.25c3.262 4.815 5.37 10.72 5.37 16.932 0 5.863-1.71 11.35-4.643 15.996-5.065-1.606-10.448-2.477-16.027-2.477-15.724 0-29.904 6.89-39.69 17.796l-9.112-9.113 17.237-17.237c-4.515-5.772-8.907-11.645-13.19-17.6l-19.443 19.44-13.215-13.215 21.828-21.827c-4.403-6.59-8.67-13.278-12.792-20.068l-40.802 40.803 58.314 58.314c-1.613 5.075-2.49 10.47-2.49 16.063 0 7.666 1.65 14.96 4.592 21.564l-72.14 72.14-14.56-14.56L21.013 437l14.558 14.56-8.607 8.608 27.246 27.246 8.606-8.61 14.56 14.56 24.798-24.8-14.557-14.556 72.158-72.16c6.586 2.922 13.858 4.562 21.498 4.562 5.593 0 10.988-.877 16.063-2.49l58.363 58.363L296.5 401.48c-6.797-4.127-13.486-8.395-20.068-12.793l-21.83 21.83L241.39 397.3l19.442-19.44c-5.962-4.29-11.835-8.683-17.603-13.194l-17.238 17.238-9.16-9.16c10.905-9.785 17.795-23.965 17.795-39.69 0-5.346-.806-10.51-2.285-15.39 4.703-3.04 10.288-4.817 16.265-4.816 6.21 0 11.776 1.77 16.52 4.955L476.98 105.95l14.864-83.417zm-66.227 53.012l13.215 13.215-191.684 191.68-13.214-13.213L425.617 75.545zM181.273 298.39c19.257 0 34.665 15.41 34.665 34.665 0 19.256-15.408 34.666-34.665 34.666-19.256 0-34.666-15.41-34.666-34.665s15.41-34.666 34.666-34.666z",fill:"#fff","fill-opacity":"1"})))})),define("db/characters/party",["require","exports","controller/battle-actions","model/battle","view/icons/Sword","model/character","controller/battle-management","model/particle"],(function(e,t,r,i,a,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.initBattleActions=void 0,a=__importDefault(a),t.initBattleActions=()=>{let e={AdaTrainingSwing:{name:"Training Swing",description:"Jump to target and swing your weapon.",cooldown:1250,type:r.BattleActionType.SWING,meta:{swings:[r.SwingType.NORMAL,r.SwingType.NORMAL],icon:a.default},cb:async function(e,t){var i,a,o;let n=r.getTarget(e,t);n&&await r.doSwing(e,this,t,n,{baseDamage:3,baseStagger:5,swingType:null!==(o=null===(a=null===(i=this.meta)||void 0===i?void 0:i.swings)||void 0===a?void 0:a[t.actionStateIndex])&&void 0!==o?o:r.SwingType.NORMAL})}},BowLevel1:{name:"BowLevel1",description:"Fire an arrow at a target.",cooldown:750,type:r.BattleActionType.RANGED,meta:{ranges:[r.RangeType.NORMAL,r.RangeType.NORMAL]},cb:async function(e,t){var i,a,o;let n=r.getTarget(e,t);n&&await r.doRange(e,this,t,n,{baseDamage:1,baseStagger:1,rangeType:null!==(o=null===(a=null===(i=this.meta)||void 0===i?void 0:i.ranges)||void 0===a?void 0:a[t.actionStateIndex])&&void 0!==o?o:r.RangeType.NORMAL})}},Fireball:{name:"Fireball",description:"Shoot a big fireball.",cooldown:2e3,type:r.BattleActionType.CAST,meta:{castTime:3e3,icon:a.default},cb:async(t,a)=>{await n.beginAction(a),n.setCasting(a,{castTime:e.Fireball.meta.castTime,onCast:async()=>{let o=i.battleGetTargetedEnemy(t,r.BattleActionType.RANGED);o&&await r.doSpell(t,e.Fireball,a,o,{baseDamage:15,baseStagger:15,particleText:"Fireball!",particleTemplate:s.EFFECT_TEMPLATE_FIREBALL})},onInterrupt:async()=>{}}),await n.endAction(a)}}};return e},t.init=()=>{let e={},r=t.initBattleActions();return e.Ada={name:"Ada",spriteBase:"ada",stats:Object.assign(Object.assign({},i.battleStatsCreate()),{HP:50}),facing:o.Facing.DOWN,animationState:o.AnimationState.IDLE,skills:[r.AdaTrainingSwing],speed:1.5},e.Conscience={name:"Conscience",spriteBase:"conscience",talkTrigger:"",facing:o.Facing.DOWN,animationState:o.AnimationState.IDLE,skills:[r.BowLevel1],weaponEquipState:o.WeaponEquipState.RANGED,stats:Object.assign(Object.assign({},i.battleStatsCreate()),{HP:45})},e}})),define("db/characters/tutorial-roamers",["require","exports","model/character"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0,t.init=()=>{let e={};return e.TutRobotRoamer1={name:"TutRobotRoamer1",spriteBase:"tut_robot_roamer",facing:r.Facing.LEFT,animationState:r.AnimationState.IDLE,overworldAi:"ROAM_WALK_RIGHT_LEFT"},e.TutRobotDummy1={name:"TutRobotDummy1",spriteBase:"tut_robot_roamer",facing:r.Facing.LEFT_DOWN,animationState:r.AnimationState.IDLE},e}})),define("db/characters/index",["require","exports","model/character","db/characters/party","db/characters/tutorial-roamers"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.getIfExists=t.get=void 0;let o={};t.get=e=>{let t=o[e];if(!t)throw Error("No character template exists with name: "+e);return Object.assign({},t)},t.getIfExists=e=>{let t=o[e];return t?Object.assign({},t):null},t.init=()=>{Object.assign(o,i.init()),o.Skye={name:"Skye",spriteBase:"skye",talkTrigger:"",facing:r.Facing.LEFT_UP,animationState:r.AnimationState.IDLE},o.Roger={name:"Roger",spriteBase:"guy2",talkTrigger:"test-roger",facing:r.Facing.LEFT_DOWN,animationState:r.AnimationState.IDLE,tags:["A"],overworldAi:"WALK_BETWEEN_MARKERS_ABC"},o.Rho={name:"Rho",spriteBase:"rho",talkTrigger:"test-rho",facing:r.Facing.DOWN,animationState:r.AnimationState.IDLE},o.Sigma={name:"Sigma",spriteBase:"sigma",talkTrigger:"test-sigma",facing:r.Facing.LEFT,animationState:r.AnimationState.IDLE},o.Floor1AtriumDeskEmployee={name:"Atrium Desk Employee",spriteBase:"employee-girl",talkTrigger:"floor1-atrium-desk-employee",facing:r.Facing.RIGHT_UP,animationState:r.AnimationState.IDLE},o.Floor1AtriumElevatorEmployee={name:"Atrium Elevator Employee",spriteBase:"employee-guy",talkTrigger:"floor1-atrium-elevator-employee",facing:r.Facing.LEFT_DOWN,animationState:r.AnimationState.IDLE},o.Floor1AtriumTicTacToeGirl={name:"Tic Tac Toe Girl",nameLabel:"Girl",spriteBase:"girl",talkTrigger:"floor1-atrium-TicTacToeGirl",facing:r.Facing.RIGHT_DOWN,animationState:r.AnimationState.IDLE},o.Floor1AtriumEmployeeJason={name:"Atrium Employee Jason",nameLabel:"Employee Jason",spriteBase:"employee-guy2",talkTrigger:"floor1-atrium-employee-jason",facing:r.Facing.LEFT_DOWN,animationState:r.AnimationState.IDLE,speed:1},Object.assign(o,a.init());for(let e in o)""===o[e].name&&(o[e].name=e)}})),define("db/enemies/tutorial",["require","exports","model/battle","model/character","controller/battle-actions","controller/battle-management","model/particle"],(function(e,t,r,i,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.initBattleActions=void 0,t.initBattleActions=()=>{let e={RobotSwingNormalNNStaggerable:{name:"RobotSwingNormalNNStaggerable",description:"AI",cooldown:1e4,type:a.BattleActionType.SWING,meta:{swings:[a.SwingType.NORMAL,a.SwingType.NORMAL]},cb:async function(e,t){var r,i,o;let n=a.getTarget(e,t);n&&await a.doSwing(e,this,t,n,{baseDamage:1,baseStagger:5,swingType:null!==(o=null===(i=null===(r=this.meta)||void 0===r?void 0:r.swings)||void 0===i?void 0:i[t.actionStateIndex])&&void 0!==o?o:a.SwingType.NORMAL})}},RobotSwingNormalNN:{name:"RobotSwingNormalNN",description:"AI",cooldown:1e4,type:a.BattleActionType.SWING,meta:{swings:[a.SwingType.NORMAL,a.SwingType.NORMAL]},cb:async function(e,t){var r,i,o;let n=a.getTarget(e,t);n&&await a.doSwing(e,this,t,n,{baseDamage:1,baseStagger:5,swingType:null!==(o=null===(i=null===(r=this.meta)||void 0===r?void 0:r.swings)||void 0===i?void 0:i[t.actionStateIndex])&&void 0!==o?o:a.SwingType.NORMAL})}},RobotSwingSpeedyN:{name:"RobotSwingSpeedyN",description:"AI",cooldown:4e3,type:a.BattleActionType.SWING,meta:{swings:[a.SwingType.NORMAL]},cb:async function(e,t){var r,i,o;let n=a.getTarget(e,t);n&&await a.doSwing(e,this,t,n,{baseDamage:1,baseStagger:5,swingType:null!==(o=null===(i=null===(r=this.meta)||void 0===r?void 0:r.swings)||void 0===i?void 0:i[t.actionStateIndex])&&void 0!==o?o:a.SwingType.NORMAL})}},RobotSwingArmoredNK:{name:"RobotSwingArmoredNK",description:"AI",cooldown:11e3,type:a.BattleActionType.SWING,meta:{swings:[a.SwingType.KNOCK_DOWN,a.SwingType.KNOCK_DOWN]},cb:async function(e,t){var r,i,o;let n=a.getTarget(e,t);n&&await a.doSwing(e,this,t,n,{baseDamage:3,baseStagger:6,swingType:null!==(o=null===(i=null===(r=this.meta)||void 0===r?void 0:r.swings)||void 0===i?void 0:i[t.actionStateIndex])&&void 0!==o?o:a.SwingType.NORMAL})}},RobotSwingPierce:{name:"RobotSwingPierce",description:"AI",cooldown:9e3,type:a.BattleActionType.SWING,meta:{swings:[a.SwingType.PIERCE]},cb:async function(e,t){var r,i,o;let n=a.getTarget(e,t);n&&await a.doSwing(e,this,t,n,{baseDamage:1,baseStagger:5,swingType:null!==(o=null===(i=null===(r=this.meta)||void 0===r?void 0:r.swings)||void 0===i?void 0:i[t.actionStateIndex])&&void 0!==o?o:a.SwingType.NORMAL})}},RobotRanged:{name:"RobotRanged",description:"AI",cooldown:5e3,type:a.BattleActionType.RANGED,meta:{ranges:[a.RangeType.NORMAL,a.RangeType.NORMAL]},cb:async function(e,t){var r,i,o;let n=a.getTarget(e,t);n&&await a.doRange(e,this,t,n,{baseDamage:1,baseStagger:0,rangeType:null!==(o=null===(i=null===(r=this.meta)||void 0===r?void 0:r.ranges)||void 0===i?void 0:i[t.actionStateIndex])&&void 0!==o?o:a.RangeType.NORMAL})}},RobotBlackFireSnap:{name:"RobotBlackFireSnap",description:"AI",cooldown:3e3,type:a.BattleActionType.CAST,meta:{castTime:3e3},cb:async function(t,r){a.getTarget(t,r)&&o.setCasting(r,{castTime:e.RobotBlackFireSnap.meta.castTime,onCast:async()=>{let i=a.getTarget(t,r);i&&await a.doSpell(t,e.RobotBlackFireSnap,r,i,{baseDamage:5,baseStagger:15,particleText:"Black Fire Snap!",particleTemplate:n.EFFECT_TEMPLATE_FIREBALL})},onInterrupt:async()=>{}})}}};return e},t.init=e=>{let a=t.initBattleActions();e.TUT_ROBOT_MELEE_REALLY_EASY={name:"Robot M",spriteBase:"tut_robot_melee",stats:Object.assign(Object.assign({},r.battleStatsCreate()),{HP:1,STAGGER:5}),facing:i.Facing.LEFT,animationState:i.AnimationState.BATTLE_IDLE,skills:[a.RobotSwingNormalNNStaggerable],armor:0},e.TUT_ROBOT_MELEE_EASY={name:"Robot M",spriteBase:"tut_robot_melee",stats:Object.assign(Object.assign({},r.battleStatsCreate()),{HP:15,STAGGER:5}),facing:i.Facing.LEFT,animationState:i.AnimationState.BATTLE_IDLE,skills:[a.RobotSwingNormalNNStaggerable],armor:0},e.TUT_ROBOT_MELEE_STAGGERABLE={name:"Robot M",spriteBase:"tut_robot_melee",stats:Object.assign(Object.assign({},r.battleStatsCreate()),{HP:25,STAGGER:1}),facing:i.Facing.LEFT,animationState:i.AnimationState.BATTLE_IDLE,skills:[a.RobotSwingNormalNNStaggerable],armor:0},e.TUT_ROBOT_MELEE={name:"Robot M",spriteBase:"tut_robot_melee",stats:Object.assign(Object.assign({},r.battleStatsCreate()),{HP:25,STAGGER:5}),facing:i.Facing.LEFT,animationState:i.AnimationState.BATTLE_IDLE,skills:[a.RobotSwingNormalNN],armor:0},e.TUT_ROBOT_MELEE_SPEEDY={name:"Robot M Fast",spriteBase:"tut_robot_melee_speedy",stats:Object.assign(Object.assign({},r.battleStatsCreate()),{HP:20,STAGGER:3}),facing:i.Facing.LEFT,animationState:i.AnimationState.BATTLE_IDLE,skills:[a.RobotSwingSpeedyN],armor:0},e.TUT_ROBOT_ARMORED={name:"Robot Armored",spriteBase:"tut_robot_armored",spriteSize:[40,40],stats:Object.assign(Object.assign({},r.battleStatsCreate()),{HP:28,STAGGER:5}),facing:i.Facing.LEFT,animationState:i.AnimationState.BATTLE_IDLE,skills:[a.RobotSwingArmoredNK,a.RobotSwingPierce],armor:1},e.TUT_ROBOT_RANGED={name:"Robot R",spriteBase:"tut_robot_ranged",stats:Object.assign(Object.assign({},r.battleStatsCreate()),{HP:20,STAGGER:5}),facing:i.Facing.LEFT,animationState:i.AnimationState.BATTLE_IDLE,skills:[a.RobotRanged],armor:0},e.TUT_ROBOT_MAGE={name:"Robot Mage",spriteBase:"tut_robot_mage",stats:Object.assign(Object.assign({},r.battleStatsCreate()),{HP:18,STAGGER:5}),facing:i.Facing.LEFT,animationState:i.AnimationState.BATTLE_IDLE,skills:[a.RobotBlackFireSnap],armor:0},e.TUT_ROBOT_BOSS={name:"Giga Robot",spriteBase:"tut_robot_boss",spriteSize:[96,96],stats:Object.assign(Object.assign({},r.battleStatsCreate()),{HP:100,STAGGER:25}),facing:i.Facing.LEFT,animationState:i.AnimationState.BATTLE_IDLE,skills:[a.RobotSwingArmoredNK,a.RobotSwingPierce],armor:1}}})),define("db/enemies/index",["require","exports","model/battle","model/character","controller/battle-actions","db/enemies/tutorial"],(function(e,t,r,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.get=void 0;let n={};t.get=e=>{let t=n[e];if(!t)throw Error("No enemy template exists with name: "+e);return Object.assign(Object.assign({},t),{stats:Object.assign({},t.stats)})},t.init=()=>{n.ENEMY_GUY={name:"guy",spriteBase:"guy-battle",stats:Object.assign(Object.assign({},r.battleStatsCreate()),{HP:15,STAGGER:25}),facing:i.Facing.LEFT,animationState:i.AnimationState.BATTLE_IDLE,skills:[a.BattleActions.SwingSlow],armor:1},o.init(n),window.enemies=n;for(let e in n){let t=n[e];for(let e in t.skills)if(!t.skills[e])throw Error(`Enemy template '${t.name}' has invalid skill at index: ${e}`)}}})),define("db/encounters",["require","exports","model/battle","controller/battle-ai","db/enemies/index","controller/battle-management","controller/overworld-management"],(function(e,t,r,i,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.getIfExists=t.get=t.varyStats=void 0,t.varyStats=e=>{let t=e.stats,r=Object.keys(t);for(let e=0;e<r.length;e++){let i=r[e];"STAGGER"!==i&&Math.random()>.5&&(t[i]++,e--)}return e};let s={};t.get=e=>{let t=s[e];if(!t)throw Error("No encounter exists with name: "+e);return t},t.getIfExists=e=>{let t=s[e];return t?Object.assign({},t):null},t.init=()=>{s.ENCOUNTER_ONE_VS_ONE={roomName:"battle1",enemies:[{chTemplate:t.varyStats(a.get("ENEMY_GUY")),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK}]},s.ENCOUNTER_ONE_VS_TWO={roomName:"battle1",enemies:[{chTemplate:t.varyStats(a.get("ENEMY_GUY")),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:t.varyStats(a.get("ENEMY_GUY")),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK}]},s.ENCOUNTER_ONE_VS_THREE={roomName:"battle1",enemies:[{chTemplate:t.varyStats(a.get("ENEMY_GUY")),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:t.varyStats(a.get("ENEMY_GUY")),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:t.varyStats(a.get("ENEMY_GUY")),position:r.BattlePosition.MIDDLE,ai:i.BATTLE_AI_ATTACK}]},s.ENCOUNTER_TUT1={roomName:"battleTut1",enemies:[{chTemplate:a.get("TUT_ROBOT_MELEE_EASY"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK}],events:{onBattleStart:async e=>{await o.callScriptDuringBattle("floor1-tut-vr2-battle1-on-start")},onAfterBattleEnded:async()=>{await n.callScriptDuringOverworld("floor1-tut-vr2-battle1-on-after-end")}}},s.ENCOUNTER_TUT1_5={roomName:"battleTut1",enemies:[{chTemplate:a.get("TUT_ROBOT_MELEE_STAGGERABLE"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK}],events:{onBattleStart:async e=>{await o.callScriptDuringBattle("floor1-tut-vr2-battle1_5-on-start")},onAfterBattleEnded:async()=>{await n.callScriptDuringOverworld("floor1-tut-vr2-battle1_5-on-after-end")}}},s.ENCOUNTER_TUT2={roomName:"battleTut1",enemies:[{chTemplate:a.get("TUT_ROBOT_MELEE"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:a.get("TUT_ROBOT_MELEE_SPEEDY"),position:r.BattlePosition.BACK,ai:i.BATTLE_AI_ATTACK}],events:{onBattleStart:async e=>{await o.callScriptDuringBattle("floor1-tut-vr2-battle2-on-start")},onAfterBattleEnded:async()=>{await n.callScriptDuringOverworld("floor1-tut-vr2-battle2-on-after-end")}}},s.ENCOUNTER_TUT3={roomName:"battleTut1",enemies:[{chTemplate:a.get("TUT_ROBOT_MELEE"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:a.get("TUT_ROBOT_MAGE"),position:r.BattlePosition.MIDDLE,ai:i.BATTLE_AI_ATTACK}],events:{onBattleStart:async e=>{await o.callScriptDuringBattle("floor1-tut-vr2-battle3-on-start")},onBattleEnd:async e=>{await o.callScriptDuringBattle("floor1-tut-vr2-battle3-on-end")},onAfterBattleEnded:async()=>{await n.callScriptDuringOverworld("floor1-tut-vr2-battle3-on-after-end")}}},s.ENCOUNTER_TUT4={roomName:"battleTut1",enemies:[{chTemplate:a.get("TUT_ROBOT_ARMORED"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:a.get("TUT_ROBOT_MELEE"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK}]},s.ENCOUNTER_TUT5={roomName:"battleTut1",enemies:[{chTemplate:a.get("TUT_ROBOT_MELEE"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:a.get("TUT_ROBOT_MELEE"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:a.get("TUT_ROBOT_RANGED"),position:r.BattlePosition.MIDDLE,ai:i.BATTLE_AI_ATTACK}]},s.ENCOUNTER_TUT6={roomName:"battleTut1",enemies:[{chTemplate:a.get("TUT_ROBOT_ARMORED"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:a.get("TUT_ROBOT_MAGE"),position:r.BattlePosition.MIDDLE,ai:i.BATTLE_AI_ATTACK}]},s.ENCOUNTER_TUT_BOSS={roomName:"battleTut1",enemies:[{chTemplate:a.get("TUT_ROBOT_BOSS"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK}]},s.ENCOUNTER_TEST_EVENTS={roomName:"battleTut1",enemies:[{chTemplate:a.get("TUT_ROBOT_MELEE"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK}],events:{onBattleStart:async e=>{await o.callScriptDuringBattle("test-fight-event-start")},onBattleEnd:async e=>{r.battleIsVictory(e)&&await o.callScriptDuringBattle("test-fight-event-end")}}},s.ENCOUNTER_TEST_MULTI_DEATH={roomName:"battleTut1",enemies:[{chTemplate:a.get("TUT_ROBOT_MELEE_REALLY_EASY"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK},{chTemplate:a.get("TUT_ROBOT_MELEE_REALLY_EASY"),position:r.BattlePosition.FRONT,ai:i.BATTLE_AI_ATTACK}]}},t.default=s})),define("db/particles",["require","exports","view/style"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.getIfExists=t.get=void 0;let i={};t.get=e=>{let t=i[e];if(!t)throw Error("No particle exists with name: "+e);return t},t.getIfExists=e=>{let t=i[e];return t?Object.assign({},t):null},t.init=()=>{Object.assign(i,{EFFECT_TEMPLATE_SWORD_LEFT:{animName:"effect_sword_left"},EFFECT_TEMPLATE_PIERCE_LEFT:{animName:"effect_pierce_left"},EFFECT_TEMPLATE_FIREBALL:{animName:"effect_fireball_explosion_anim",opacity:.65},EFFECT_TEMPLATE_SMOKE:{animName:"effect_smoke_anim"},EFFECT_TEMPLATE_ARMOR_REDUCED:{animName:"effect_armor_shatter",scale:.5},EFFECT_TEMPLATE_RANGED_LEFT:{animName:"effect_range_projectile_left",duration:300},EFFECT_TEMPLATE_RANGED_HIT:{animName:"effect_range_hit_left"},EFFECT_TEMPLATE_GEM:{animName:"effect_gem"},EFFECT_TEMPLATE_TREASURE:{duration:1e3,animName:"effect_treasure_anim"},EFFECT_TEMPLATE_AGGROED:{animName:"effect_aggro",duration:500,offset:[0,-32]},EFFECT_TEMPLATE_DEAD32:{animName:"effect_dead2_anim",offset:[8,-12.5],opacity:1,duration:2320},EFFECT_TEMPLATE_RING:{duration:1e3,text:"RING!",useOuterCanvas:!0,offset:[0,8],textParams:{size:32,color:r.colors.YELLOW,align:"center",strokeColor:r.colors.WHITE}},EFFECT_TEMPLATE_GIGGLE:{duration:750,text:"Ha",useOuterCanvas:!0,offset:[0,-16],textParams:{size:24,color:r.colors.WHITE,align:"center",strokeColor:r.colors.BLACK}},EFFECT_TEMPLATE_SIGH:{duration:1500,text:"*Sigh*",useOuterCanvas:!0,offset:[4,-16],textParams:{size:24,color:r.colors.WHITE,align:"center",strokeColor:r.colors.BLACK}},EFFECT_TEMPLATE_VR_PORTAL:{animName:"effect_vr_anim",duration:5e3,scale:4,offset:[0,-32]},EFFECT_TEMPLATE_PORTAL_SPAWN:{animName:"effect_dead2_anim",offset:[3,-12.5],opacity:1,duration:2320},EFFECT_TEMPLATE_SPAWN:{animName:"effect_spawn",duration:1e3}})}})),define("model/render-object",["require","exports","model/sprite","utils","model/room"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTileRenderObject=t.createTriggerActivatorRenderObject=t.createMarkerRenderObject=t.createPropRenderObject=void 0,t.createPropRenderObject=e=>{if(e.isDynamic){let[,,,t,a]=r.getSprite(e.sprite),[o,n]=i.isoToPixelCoords(e.x,e.y);return 32===t&&32===a?(n=n-a+20-4+1-1,o=o-t/2+20-4+0):(n=n-a+20,o=o-t/2+20),{sprite:e.sprite,px:o,py:n,sortY:e.isFront?1/0:n+a,visible:!0}}{let[t,o]=i.isoToPixelCoords(e.x,e.y),[,,,n,s]=r.getSprite(e.sprite);return t-=t-n/2+a.TILE_WIDTH/2,o=o-s+a.TILE_HEIGHT/2,{sprite:e.sprite,px:t,py:o,sortY:o+s,visible:!0}}},t.createMarkerRenderObject=e=>{let{x:t,y:r}=e,[a,o]=i.isoToPixelCoords(t,r,0);return{name:e.name,sprite:"control_1",px:a,py:o,sortY:o+32,visible:!0,isMarker:!0}},t.createTriggerActivatorRenderObject=e=>{if(e.polygon)return{name:e.name,polygon:e.polygon,sortY:1/0,visible:!0,isTrigger:!0};{let{x:t,y:r}=e,[a,o]=i.isoToPixelCoords(t,r,0);return{name:e.name,sprite:"control_2",px:a,py:o,sortY:o+32,visible:!0,isTrigger:!0}}},t.createTileRenderObject=(e,t)=>{let r=i.isoToPixelCoords(e.x*a.TILE_WIDTH/2,e.y*a.TILE_HEIGHT/2),o=r[0],n=r[1],s=n;n-=e.tileHeight-32;let l=parseFloat(e.sprite.slice(e.sprite.lastIndexOf("_")+1)),c=e.sprite.indexOf("floors")>-1,A=n+(e.tileHeight-32)+(e.tileHeight>32?20:16)+(null!=t?t:0),d=e.sprite;return c&&(!isNaN(l)&&l>=56&&(n+=16),"floors_0"===e.sprite&&(d="invisible")),{sprite:d,origPy:s,px:o,py:n,highlighted:e.highlighted,isFloor:c,sortY:A,visible:!0}}})),define("controller/scene-commands",["require","exports","view/ui","controller/ui-actions","model/store","controller/events","model/character","model/room","model/generics","controller/scene-management","utils","model/animation","controller/overworld-management","db/tiles","db/characters/index","db/overworlds","db/encounters","db/particles","model/player","model/utility","view/components/ArcadeCabinet/index","model/overworld","model/sound","controller/battle-management","model/particle","model/battle","model/scene","model/render-object"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u,h,m,g,p,E,f,w,C,y,b,T,S,v,x,B){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setBattlePaused=t.showUISection=t.setCharacterText=t.spawnParticleAtMarker=t.spawnParticleAtCharacter=t.spawnParticleAtTarget=t.playSound=t.panCameraBackToPlayer=t.panCameraRelativeToPlayer=t.enterCombat=t.awaitChoice=t.setDoorStateAtMarker=t.resetAi=t.setAnimationState=t.setAnimation=t.setAnimationAndWait=t.runArcadeCabinetGame=t.applyZTransform=t.jump=t.modifyTickets=t.modifyTokens=t.removeItem=t.acquireQuestItem=t.acquireItem=t.changeRoom=t.fadeInColor=t.fadeOutColor=t.fadeIn=t.fadeOut=t.despawnCharacter=t.spawnPartyMembersInFormation=t.despawnPartyMembers=t.spawnPartyMembers=t.spawnCharacterAtMarker=t.spawnCharacterAtCharacter=t.removeWallAtTilePosition=t.removeWallAtMarker=t.changeTileAtMarker=t.setCharacterAtMarker=t.walkToOffset=t.setAtMarker=t.walkToCharacter=t.walkToMarker=t.setCharacterAt=t.shakeScreen=t.setFacing=t.lookAtEachOther=t.lookAtMarker=t.lookAtCharacter=t.callScript=t.setStorage=t.waitMSPreemptible=t.waitMS=t.setConversationSpeaker=t.endConversation=t.setConversationWithoutBars=t.setConversation=t.setConversation2=t.playDialogue=void 0,t.playDialogue=(e,o,n)=>{let{cutscene:c}=r.getUiInterface().appState;if(!c.visible)return void console.error("Tried to play dialog while cutscene was not visible",e,o);let A=a.CutsceneSpeaker.None,d=e.toLowerCase();c.portraitLeft===d?A=a.CutsceneSpeaker.Left:c.portraitLeft2===d?A=a.CutsceneSpeaker.Left2:c.portraitRight===d?A=a.CutsceneSpeaker.Right:c.portraitRight2===d?A=a.CutsceneSpeaker.Right2:c.portraitCenter===d&&(A=a.CutsceneSpeaker.Center);let u=e,h=l.getCurrentRoom(),m=s.roomGetCharacterByName(h,e);return m&&(u=m.nameLabel),A!==c.speaker&&[a.CutsceneSpeaker.Left,a.CutsceneSpeaker.Right].includes(A)&&b.playSoundName("dialog_woosh"),i.setCutsceneText(o,A,"narrator"!==d?u:""),t.waitMS(150,()=>{_()})},t.setConversation2=(e,r)=>{if(e){if(r)return b.playSoundName("dialog_woosh"),i.startConversation2(""+e.toLowerCase(),""+r.toLowerCase()),t.waitMS(500);console.error("No right actor specified.")}else console.error("No left actor specified.")},t.setConversation=e=>(i.startConversation(""+e.toLowerCase(),!0),b.playSoundName("dialog_woosh"),t.waitMS(100)),t.setConversationWithoutBars=e=>(i.startConversation(""+e.toLowerCase(),!1),b.playSoundName("dialog_woosh"),t.waitMS(100)),t.endConversation=e=>(i.setCutsceneText(""),i.hideConversation(),t.waitMS(null!=e?e:500)),t.setConversationSpeaker=e=>{i.setCutsceneText("",e)},t.waitMS=(e,t)=>{let r=l.getCurrentScene();return r.isWaitingForTime=!0,clearTimeout(r.waitTimeoutId),r.waitTimeoutId=setTimeout(()=>{r.isWaitingForTime=!1,t&&t()},e),!0},t.waitMSPreemptible=(e,t)=>{let r=l.getCurrentScene(),i=e=>{switch(e.key){case"Return":case"Enter":case" ":clearTimeout(r.waitTimeoutId),o.popKeyHandler(i),a()}};o.pushKeyHandler(i);let a=()=>{r.isWaitingForTime=!1,t&&t(),o.popKeyHandler(i)};return r.isWaitingForTime=!0,clearTimeout(r.waitTimeoutId),r.waitTimeoutId=setTimeout(a,e),!0};let I=()=>{let e=l.getCurrentScene();return e.isWaitingForTime=!0,()=>{e.isWaitingForTime=!1}},_=e=>{let t=l.getCurrentScene();t.isWaitingForInput=!0;let r=e=>{switch(e.key){case"Return":case"Enter":case"x":case"X":case" ":b.playSoundName("dialog_select"),setTimeout(()=>{clearTimeout(t.waitTimeoutId),o.popKeyHandler(r),i()},100)}};o.pushKeyHandler(r);let i=()=>{t.isWaitingForInput=!1,e&&e(),o.popKeyHandler(r)};return i};t.setStorage=(e,t)=>{l.getCurrentScene().storage[e]=null==t||t},t.callScript=(e,...t)=>{let r=l.getCurrentScene();return c.callScript(r,e,...t),!0},t.lookAtCharacter=(e,t)=>{let r=l.getCurrentRoom(),i=s.roomGetCharacterByName(r,e),a=s.roomGetCharacterByName(r,t);if(i)if(a){if(i&&a){let e=n.characterGetPosCenterPx(i),t=n.characterGetPosCenterPx(a),r=A.getAngleTowards(e,t);n.characterSetFacingFromAngle(i,r)}}else console.error("Could not find target character with name: "+t);else console.error("Could not find character with name: "+e)},t.lookAtMarker=(e,t)=>{let r=l.getCurrentRoom(),i=s.roomGetCharacterByName(r,e),a=r.markers[t];if(i)if(a){if(i&&a){let e=n.characterGetPosCenterPx(i),t=A.getAngleTowards(e,[a.x,a.y]);n.characterSetFacingFromAngle(i,t)}}else console.error("Could not find target marker with name: "+t);else console.error("Could not find character with name: "+e)},t.lookAtEachOther=(e,r)=>{t.lookAtCharacter(e,r),t.lookAtCharacter(r,e)},t.setFacing=(e,t)=>{let r=s.roomGetCharacterByName(l.getCurrentRoom(),e);r?(t===n.Facing.RIGHT2?t=n.Facing.RIGHT:t===n.Facing.RIGHT_UP2?t=n.Facing.RIGHT_UP:t===n.Facing.RIGHT_DOWN2&&(t=n.Facing.RIGHT_DOWN),n.characterSetFacing(r,t)):console.error("Cannot set facing, no character named:",e,"facing=",t)},t.shakeScreen=e=>{let r=document.getElementById("canvas-container");return r&&(r.className="shake"),t.waitMS(null!=e?e:1e3,()=>{r&&(r.className="")})},t.setCharacterAt=(e,t,r,i)=>{let a=l.getCurrentRoom(),o=s.roomGetCharacterByName(a,e);o?n.characterSetPos(o,[t,r,null!=i?i:0]):console.error("Could not find character with name: "+e)},t.walkToMarker=(e,t,r,i,a)=>{let o=l.getCurrentRoom(),c=s.roomGetCharacterByName(o,e),A=o.markers[t];if(!c)return void console.error("Could not find character with name: "+e);if(!A)return void console.error("Could not find target marker with name: "+t);if(void 0!==r&&"number"!=typeof r)return void console.error("xOffset is not a number");if(void 0!==i&&"number"!=typeof i)return void console.error("yOffset is not a number");let d=[A.x+(null!=r?r:0),A.y+(null!=i?i:0)];if(!a)return n.characterSetWalkTarget(c,d,I()),!0;n.characterSetWalkTarget(c,d,()=>{})},t.walkToCharacter=(e,t,r,i,a)=>{let o=l.getCurrentRoom(),c=s.roomGetCharacterByName(o,e),A=s.roomGetCharacterByName(o,t);if(!c)return void console.error("Could not find character with name: "+e);if(!A)return void console.error("Could not find target ch with name: "+t);if(void 0!==r&&"number"!=typeof r)return void console.error("xOffset is not a number");if(void 0!==i&&"number"!=typeof i)return void console.error("yOffset is not a number");let[d,u]=n.characterGetPos(A),h=[d+(null!=r?r:0),u+(null!=i?i:0)];if(!a)return n.characterSetWalkTarget(c,h,I()),!0;n.characterSetWalkTarget(c,h,()=>{})},t.setAtMarker=(e,t,r,i)=>{let a=l.getCurrentRoom(),o=s.roomGetCharacterByName(a,e),c=a.markers[t];o?c?void 0===r||"number"==typeof r?void 0===i||"number"==typeof i?n.characterSetPos(o,[c.x+(null!=r?r:0),c.y+(null!=i?i:0),0]):console.error("yOffset is not a number"):console.error("xOffset is not a number"):console.error("Could not find target marker with name: "+t):console.error("Could not find character with name: "+e)},t.walkToOffset=(e,t,r,i)=>{let a=l.getCurrentRoom(),o=s.roomGetCharacterByName(a,e);if(!o)return void console.error("Could not find character with name: "+e);if(void 0!==t&&"number"!=typeof t)return void console.error("xOffset is not a number");if(void 0!==r&&"number"!=typeof r)return void console.error("yOffset is not a number");let c=[o.x+t,o.y+r];if(!i)return n.characterSetWalkTarget(o,c,I()),!0;n.characterSetWalkTarget(o,c,()=>{})},t.setCharacterAtMarker=(e,t,r,i)=>{let a=l.getCurrentRoom(),o=s.roomGetCharacterByName(a,e),c=a.markers[t];o?c?void 0===r||"number"==typeof r?void 0===i||"number"==typeof i?o&&c&&n.characterSetPos(o,A.extrapolatePoint([c.x+(null!=r?r:0),c.y+(null!=i?i:0)])):console.error("yOffset is not a number"):console.error("xOffset is not a number"):console.error("Could not find target marker with name: "+t):console.error("Could not find character with name: "+e)},t.changeTileAtMarker=(e,t,r,i)=>{var a,o,n;let c=l.getCurrentRoom(),A=c.markers[e],d=h.getIfExists(t);if(d)if(A)if(void 0===r||"number"==typeof r)if(void 0===i||"number"==typeof i){if(A){let t=s.roomGetTileBelow(c,[A.x+(null!=r?r:0),A.y+(null!=i?i:0)]);if(!t)return void console.error("Could not get a tile below the provided marker: "+e);if(t.isWall=null!==(a=d.isWall)&&void 0!==a?a:t.isWall,t.isProp=null!==(o=d.isProp)&&void 0!==o?o:t.isProp,t.ro){if(t.ro.sprite=d.baseSprite,t.floorTileBeneath&&!1===d.hasFloorTile){let e=c.renderObjects.indexOf(null===(n=t.floorTileBeneath)||void 0===n?void 0:n.ro);e>-1&&c.renderObjects.splice(e,1)}t.animName!==d.animName&&(d.animName?t.animName=d.animName:t.ro.anim=void 0),d.size&&(t.tileWidth=d.size[0],t.tileHeight=d.size[1]),t.ro=B.createTileRenderObject(t)}}}else console.error("yOffset is not a number");else console.error("xOffset is not a number");else console.error("Could not find target marker with name: "+e);else console.error("Could not get a tile template with name: "+t)},t.removeWallAtMarker=(e,t,r)=>{let i=l.getCurrentRoom(),a=i.markers[e];if(a)if(void 0===t||"number"==typeof t)if(void 0===r||"number"==typeof r){if(a){let o=s.roomGetTileBelow(i,[a.x+(null!=t?t:0),a.y+(null!=r?r:0)]);if(!o)return void console.error("Could not get a tile below the provided marker: "+e);if(o.isWall=!1,o.isProp=!1,o.ro&&o.floorTileBeneath){let e=i.renderObjects.indexOf(o.ro);e>-1&&i.renderObjects.splice(e,1)}}}else console.error("yOffset is not a number",r);else console.error("xOffset is not a number",t);else console.error("Could not find target marker with name: "+e)},t.removeWallAtTilePosition=(e,t)=>{let r=l.getCurrentRoom();if("number"!=typeof e)return void console.error("tileX is not a number",e);if("number"!=typeof t)return void console.error("tileY is not a number",t);let i=s.roomGetTileAt(r,e,t);if(i){if(!i)return void console.error("Could not get a tile at the provided position: "+[e,t].join(","));if(i.isWall=!1,i.isProp=!1,i.ro&&i.floorTileBeneath){let e=r.renderObjects.indexOf(i.ro);e>-1&&r.renderObjects.splice(e,1)}}},t.spawnCharacterAtCharacter=(e,t,r,i)=>{let a=l.getCurrentRoom(),o=s.roomGetCharacterByName(a,t),c=m.getIfExists(e);if(!c)return void console.error("Could not get a character template with name: "+e);if(!o)return void console.error("Could not find target character with name: "+t);if(void 0!==r&&"number"!=typeof r)return void console.error("xOffset is not a number");if(void 0!==i&&"number"!=typeof i)return void console.error("yOffset is not a number");if(s.roomGetCharacterByName(a,c.name))return void console.error("The character to be spawned already exists in the current room: "+c.name);let A=[o.x+(null!=r?r:0),o.y+(null!=i?i:0),0],d=n.characterCreateFromTemplate(c);n.characterSetPos(d,A),s.roomAddCharacter(a,d)},t.spawnCharacterAtMarker=(e,t,r,i)=>{let a=l.getCurrentRoom(),o=a.markers[t],c=m.getIfExists(e);if(!c)return void console.error("Could not get a character template with name: "+e);if(!o)return void console.error("Could not find target marker with name: "+t);if(void 0!==r&&"number"!=typeof r)return void console.error("xOffset is not a number");if(void 0!==i&&"number"!=typeof i)return void console.error("yOffset is not a number");if(s.roomGetCharacterByName(a,c.name))return void console.error("The character to be spawned already exists in the current room: "+c.name);let A=[o.x+(null!=r?r:0),o.y+(null!=i?i:0),0],d=n.characterCreateFromTemplate(c);n.characterSetPos(d,A),s.roomAddCharacter(a,d)},t.spawnPartyMembers=()=>{let e=l.getCurrentPlayer(),r=e.partyStorage.filter(t=>t!==e.leader),i=[[12,1],[1,-12],[-12,1],[1,12]],a=l.getCurrentRoom();return r.forEach((r,o)=>{var l,c;let A=i[o];t.spawnCharacterAtCharacter(r.name,e.leader.name,null==A?void 0:A[0],null==A?void 0:A[1]);let d=s.roomGetCharacterByName(a,r.name);if(d){let r=[null!==(l=d.x+A[0])&&void 0!==l?l:0,null!==(c=d.y+A[1])&&void 0!==c?c:0];n.characterSetWalkTarget(d,r,()=>{t.lookAtCharacter(d.name,e.leader.name)})}}),t.waitMS(1e3)},t.despawnPartyMembers=()=>{let e=l.getCurrentPlayer(),r=e.leader,i=l.getCurrentRoom();return e.partyStorage.filter(t=>t!==e.leader&&s.roomGetCharacterByName(i,t.name)).forEach(e=>{let t=s.roomGetCharacterByName(i,e.name);t&&n.characterSetWalkTarget(t,[r.x,r.y],()=>{s.roomRemoveCharacter(i,t)})}),t.waitMS(1e3)},t.spawnPartyMembersInFormation=()=>{let e=l.getCurrentRoom(),r=l.getCurrentPlayer(),i=r.partyStorage.filter(e=>e!==r.leader),a=[[16,1],[1,-16],[-16,1],[1,16]];i.forEach((e,i)=>{let o=a[i];t.spawnCharacterAtCharacter(e.name,r.leader.name,null==o?void 0:o[0],null==o?void 0:o[1])}),r.party.forEach(r=>{let i=s.roomGetCharacterByName(e,r.name);i&&(n.characterSetFacing(i,n.Facing.DOWN),t.spawnParticleAtCharacter("EFFECT_TEMPLATE_PORTAL_SPAWN",i.name,"normal"))})},t.despawnCharacter=e=>{let t=l.getCurrentRoom(),r=s.roomGetCharacterByName(t,e);r?s.roomRemoveCharacter(t,r):console.error("Could not find character with name: "+e)},t.fadeOut=(e,r)=>{let i=null!=e?e:750,a=document.getElementById("fade");if(a&&(a.style.transition=`background-color ${i}ms`,a.style["background-color"]="rgba(0, 0, 0, 255)"),!r)return t.waitMS(i)},t.fadeIn=(e,r)=>{let i=null!=e?e:1e3,a=document.getElementById("fade");if(a&&(a.style.transition=`background-color ${i}ms`,a.style["background-color"]="rgba(0, 0, 0, 0)"),!r)return t.waitMS(i)},t.fadeOutColor=(e,r,i,a,o)=>{let n=null!=a?a:750,s=document.getElementById("fade");if(s&&(s.style.transition=`background-color ${n}ms`,s.style["background-color"]=`rgba(${e}, ${r}, ${i}, 255)`),!o)return t.waitMS(n)},t.fadeInColor=(e,r,i,a,o)=>{let n=null!=a?a:1e3,s=document.getElementById("fade");if(s&&(s.style.transition=`background-color ${n}ms`,s.style["background-color"]=`rgba(${e}, ${r}, ${i}, 0)`),!o)return t.waitMS(n)},t.changeRoom=(e,t)=>{let r=l.getCurrentPlayer(),i=g.getIfExists(e);if(!r)return void console.error("Player has not been initialized.");if(!i)return void console.error("No overworld template exists with name:",e);let a=u.initiateOverworld(r,i,t);a&&(a.triggersEnabled=!1)},t.acquireItem=(e,r)=>{let i=l.getCurrentPlayer();if(f.playerAddItem(i,e))return t.playDialogue("Narrator",null!=r?r:"Acquired: "+e)},t.acquireQuestItem=(e,r)=>{let i=l.getCurrentPlayer();if(f.playerAddItem(i,e))return t.playDialogue("Narrator",null!=r?r:"Acquired: "+e)},t.removeItem=(e,r)=>{let i=l.getCurrentPlayer();if(f.playerRemoveItem(i,e))return t.playDialogue("Narrator",null!=r?r:"Removed: "+e)},t.modifyTokens=e=>{let r=l.getCurrentPlayer();return f.playerModifyTokens(r,e),t.playDialogue("Narrator",e>0?`Gained ${e} Regem Ludos Tokens.`:`Removed ${-e} Regem Ludos Tokens.`)},t.modifyTickets=e=>{let r=l.getCurrentPlayer();return f.playerModifyTickets(r,e),t.playDialogue("Narrator",e>0?`Gained ${e} Prize Tickets.`:`Removed ${-e} Prize Tickets.`)},t.jump=e=>{let r=l.getCurrentRoom(),i=s.roomGetCharacterByName(r,e);if(!i)return void console.error("Could not find character with name: "+e);let a=e=>new Promise(r=>{t.waitMS(33,()=>{let t=n.characterGetPos(i);t[2]=e,n.characterSetPos(i,t),r()})});return(async()=>{await a(8),await a(16),await a(20),await a(22),await a(20),await a(16),await a(8),await a(0),t.waitMS(500)})(),!0},t.applyZTransform=(e,r,i)=>{let a=l.getCurrentRoom(),o=s.roomGetCharacterByName(a,e);if(!o)return void console.error("Could not find character with name: "+e);let c=n.characterGetPos(o),A=[...c];A[2]+=r;let d=null!=i?i:1e3,u=new w.Transform(c,A,d,w.TransformEase.LINEAR);return n.characterSetTransform(o,u),t.waitMS(d,()=>{n.characterSetPos(o,A),o.transform=null})},t.runArcadeCabinetGame=e=>{let t=C.ArcadeGamePath[e];t?(y.overworldHide(l.getCurrentOverworld()),b.playSoundName("start_arcade_game"),i.showArcadeGame(t)):console.error("No game exists with name:",e)},t.setAnimationAndWait=(e,r,i)=>{let a=l.getCurrentRoom(),o=s.roomGetCharacterByName(a,e);if(!o)return void console.error("Could not find character with name: "+e);if(!d.hasAnimation(r))return void console.error("Could not find animation with name: "+r);let c=d.createAnimation(r);n.characterOverrideAnimation(o,c);let A=c.getDurationMs();return t.waitMS(A+(null!=i?i:0),()=>{t.setAnimationState(e,n.AnimationState.IDLE)})},t.setAnimation=(e,t)=>{let r=l.getCurrentRoom(),i=s.roomGetCharacterByName(r,e);if(!i)return void console.error("Could not find character with name: "+e);if(!d.hasAnimation(t))return void console.error("Could not find animation with name: "+t);let a=d.createAnimation(t);n.characterOverrideAnimation(i,a)},t.setAnimationState=(e,t)=>{let r=l.getCurrentRoom(),i=s.roomGetCharacterByName(r,e);i?n.characterSetAnimationState(i,t):console.error("Could not find character with name: "+e)},t.resetAi=e=>{let t=l.getCurrentRoom(),r=s.roomGetCharacterByName(t,e);r?n.characterStartAi(r):console.error("Could not find character with name: "+e)},t.setDoorStateAtMarker=(e,r,i,a)=>{["BCK","FWD"].includes(i)?["OPEN","CLOSED"].includes(a)?"BCK"===i?(t.changeTileAtMarker(e,`${r}_${i}_${a}2`),t.changeTileAtMarker(e,`${r}_${i}_${a}1`,16,0)):(t.changeTileAtMarker(e,`${r}_${i}_${a}2`),t.changeTileAtMarker(e,`${r}_${i}_${a}1`,0,16)):console.error("Cannot setDoorStateAtMarker. Invalid door state (needs OPEN or CLOSED)"):console.error("Cannot setDoorStateAtMarker. Invalid door direction (needs BCK or FWD)")},t.awaitChoice=(...e)=>(setTimeout(()=>{i.showChoices(e)},250),I()),t.enterCombat=e=>{let t=p.getIfExists(e);if(!t)return void console.error("No encounter exists with name:",e);y.overworldHide(l.getCurrentOverworld()),b.playSoundName("battle_encountered");let r=l.getCurrentPlayer(),i=n.characterGetPos(r.leader),a=r.leader.facing,o=l.getCurrentRoom();T.transitionToBattle(r,t,T.getReturnToOverworldBattleCompletionCB(o,i,a,t),!1)},t.panCameraRelativeToPlayer=(e,r,i,a)=>{let o=null!=i?i:1e3,n=l.getCurrentPlayer();if(n){let i=l.getCameraTransform(),[s,c]=f.playerGetCameraOffset(n),A=s,d=c;if(i){let e=i.current();A=e[0],d=e[1]}let u=new w.Transform([A,d,0],[s-e,c-r,0],o,w.TransformEase.EASE_OUT);if(l.setCameraTransform(u),!a)return t.waitMS(o)}},t.panCameraBackToPlayer=(e,r)=>{let i=null!=e?e:1e3,a=l.getCurrentPlayer(),o=l.getCameraTransform();if(a&&o){let[e,n]=f.playerGetCameraOffset(a),[s,c]=o.current(),A=new w.Transform([s,c,0],[e,n,0],i,w.TransformEase.EASE_OUT);if(A.timer.awaits.push(()=>{l.setCameraTransform(null)}),l.setCameraTransform(A),!r)return t.waitMS(i)}},t.playSound=e=>{b.playSoundName(e)},t.spawnParticleAtTarget=(e,t,r)=>{let i=l.getCurrentRoom();if("normal"===r){let r=S.particleCreateFromTemplate(t,e);s.roomAddParticle(i,r)}else"weighted"===r?s.roomAddParticle(i,S.createWeightedParticle(e,t[0],t[1],e.duration)):"rise"===r?s.roomAddParticle(i,S.createRiseParticle(e,t[0],t[1],e.duration)):console.error(`Particle method not known: "${r}"`)},t.spawnParticleAtCharacter=(e,r,i)=>{let a=l.getCurrentRoom(),o=s.roomGetCharacterByName(a,r),c=E.getIfExists(e);if(!o)return void console.error("Could not find character with name: "+r);if(!c)return void console.error("Could not find particle with name: "+e);let A=n.characterGetPosCenterPx(o);t.spawnParticleAtTarget(c,A,i)},t.spawnParticleAtMarker=(e,r,i)=>{let a=l.getCurrentRoom(),o=E.getIfExists(e),n=a.markers[r];if(!n)return void console.error("Could not find target marker with name: "+r);if(!o)return void console.error("Could not find particle with name: "+e);let[s,c]=A.isoToPixelCoords(n.x,n.y);s+=16,c+=16,t.spawnParticleAtTarget(o,[s,c],i)},t.setCharacterText=e=>{r.getUiInterface().appState.overworld.characterText!==e&&i.setCharacterText(e)},t.showUISection=(e,...t)=>{if("BattleUI"===e)i.showSection(a.AppSection.BattleUI,!1);else if("Modal"===e)return i.showModal(t[0],()=>{x.sceneStopWaitingUntil(l.getCurrentScene())}),I()},t.setBattlePaused=e=>{let t=l.getCurrentBattle();t&&("true"===e?(t.isPaused=!0,v.battlePauseTimers(t)):(t.isPaused=!1,v.battleUnpauseTimers(t)))},t.default={playDialogue:t.playDialogue,setConversation2:t.setConversation2,setConversation:t.setConversation,setConversationWithoutBars:t.setConversationWithoutBars,endConversation:t.endConversation,setConversationSpeaker:t.setConversationSpeaker,waitMS:t.waitMS,waitMSPreemptible:t.waitMSPreemptible,waitUntil:I,waitForUserInput:e=>{let t=l.getCurrentScene();t.isWaitingForInput=!0;let r=e=>{switch(e.key){case"Return":case"Enter":case"x":case"X":case" ":clearTimeout(t.waitTimeoutId),o.popKeyHandler(r),i()}};o.pushKeyHandler(r);let i=()=>{t.isWaitingForInput=!1,e&&e(),o.popKeyHandler(r)};return i},setStorage:t.setStorage,callScript:t.callScript,lookAtCharacter:t.lookAtCharacter,lookAtMarker:t.lookAtMarker,lookAtEachOther:t.lookAtEachOther,setFacing:t.setFacing,shakeScreen:t.shakeScreen,setCharacterAt:t.setCharacterAt,walkToMarker:t.walkToMarker,walkToCharacter:t.walkToCharacter,setAtMarker:t.setAtMarker,walkToOffset:t.walkToOffset,setCharacterAtMarker:t.setCharacterAtMarker,changeTileAtMarker:t.changeTileAtMarker,removeWallAtMarker:t.removeWallAtMarker,removeWallAtTilePosition:t.removeWallAtTilePosition,spawnCharacterAtCharacter:t.spawnCharacterAtCharacter,spawnCharacterAtMarker:t.spawnCharacterAtMarker,spawnPartyMembersInFormation:t.spawnPartyMembersInFormation,spawnPartyMembers:t.spawnPartyMembers,despawnPartyMembers:t.despawnPartyMembers,despawnCharacter:t.despawnCharacter,fadeOut:t.fadeOut,fadeIn:t.fadeIn,fadeOutColor:t.fadeOutColor,fadeInColor:t.fadeInColor,changeRoom:t.changeRoom,acquireItem:t.acquireItem,acquireQuestItem:t.acquireQuestItem,removeItem:t.removeItem,modifyTokens:t.modifyTokens,modifyTickets:t.modifyTickets,jump:t.jump,applyZTransform:t.applyZTransform,runArcadeCabinetGame:t.runArcadeCabinetGame,setAnimationAndWait:t.setAnimationAndWait,setAnimation:t.setAnimation,setAnimationState:t.setAnimationState,resetAi:t.resetAi,setDoorStateAtMarker:t.setDoorStateAtMarker,awaitChoice:t.awaitChoice,enterCombat:t.enterCombat,panCameraRelativeToPlayer:t.panCameraRelativeToPlayer,panCameraBackToPlayer:t.panCameraBackToPlayer,playSound:t.playSound,spawnParticleAtCharacter:t.spawnParticleAtCharacter,spawnParticleAtMarker:t.spawnParticleAtMarker,setCharacterText:t.setCharacterText,showUISection:t.showUISection,setBattlePaused:t.setBattlePaused}})),define("view/components/ArcadeCabinet/GameTicTacToe",["require","exports","preact","view/style","view/components/ArcadeCabinet/ArcadeCabinetHelpers","view/components/ArcadeCabinet/ArcadeCabinetHelpDialog","view/icons/Help","controller/scene-management","model/generics","controller/ui-actions","model/store"],(function(e,t,r,i,a,o,n,s,l,c,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a.registerArcadeGameMeta(a.ArcadeGamePath.TIC_TAC_TOE,{title:"Tic Tac Toe",tokensRequired:1,controls:e=>r.h(r.Fragment,null,r.h(a.CabinetControlButton,{width:"48px",height:"48px",type:"text",onClick:()=>{e.setHelpDialogOpen(!0)}},r.h(n.default,{color:i.colors.YELLOW}))),help:e=>r.h(o.default,{setOpen:e.setHelpDialogOpen,title:"Tic Tac Toe Help"},r.h("p",null,"On this machine you can play Tic Tac Toe."),r.h("p",null,"Insert a Token to start: 1 token = 3 games"),r.h("p",null,"You are the 'X' player for each game."),r.h("p",null,"Place an 'X' by tapping/clicking the grid area where you wish to play."),r.h("p",null,"Place three 'X' in a row to win the game. You lose if there are three 'O' in a row."),r.h("p",null,"Tickets are awarded based off of the number of times you beat the AI.")),onGameCompleted:async e=>{let t=e,r=l.getCurrentScene();if(-1!==t||r.storage["quest_floor1-atrium_tic-tac-toe-complete"])t>-1&&(l.disableKeyUpdate(),l.getCurrentOverworld().triggersEnabled=!1,await s.createAndCallScript(r,`\n        +setConversation('Ada');\n        +modifyTickets(${t});\n        +endConversation();`),l.getCurrentOverworld().triggersEnabled=!0,l.enableKeyUpdate(),c.hideSection(A.AppSection.Cutscene));else{let e=l.getCurrentScene();c.hideArcadeGame(),l.disableKeyUpdate(),l.getCurrentOverworld().triggersEnabled=!1,await s.callScript(e,"floor1-atrium-TicTacToeGirl-complete"),l.getCurrentOverworld().triggersEnabled=!0,l.enableKeyUpdate()}}})})),define("view/components/ArcadeCabinet/GamePresident",["require","exports","preact","view/style","view/components/ArcadeCabinet/ArcadeCabinetHelpers","view/components/ArcadeCabinet/ArcadeCabinetHelpDialog","view/icons/Help"],(function(e,t,r,i,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a.registerArcadeGameMeta(a.ArcadeGamePath.PRESIDENT,{title:"President",tokensRequired:1,controls:e=>r.h(r.Fragment,null,r.h(a.CabinetControlButton,{width:"48px",height:"48px",type:"text",onClick:()=>{e.setHelpDialogOpen(!0)}},r.h(n.default,{color:i.colors.YELLOW}))),help:e=>r.h(o.default,{setOpen:e.setHelpDialogOpen,title:"President Help"},r.h("p",null,"This is the game President"))})})),define("view/components/ArcadeCabinet/GameInvaderz",["require","exports","preact","view/style","view/components/ArcadeCabinet/ArcadeCabinet","view/components/ArcadeCabinet/ArcadeCabinetHelpers","view/icons/Arrow"],(function(e,t,r,i,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=__importDefault(n),o.registerArcadeGameMeta(o.ArcadeGamePath.INVADERZ,{title:"INVADERZ",tokensRequired:1,controls:()=>r.h(r.Fragment,null,r.h(o.CabinetControlButton,Object.assign({width:"48px",height:"48px"},a.buttonHandlers(a.SDLKeyID.Left)),r.h(n.default,{color:i.colors.GREEN,direction:"left"})),r.h(o.CabinetControlButton,Object.assign({width:"48px",height:"48px"},a.buttonHandlers(a.SDLKeyID.Right)),r.h(n.default,{color:i.colors.GREEN,direction:"right"})),r.h(o.CabinetControlButton,Object.assign({width:"48px",height:"48px",type:"text"},a.buttonHandlers(a.SDLKeyID.Space)),"FIRE"),r.h(o.CabinetControlButton,Object.assign({width:"48px",height:"48px",type:"text"},a.buttonHandlers(a.SDLKeyID.Enter)),"START"))})})),define("view/components/ArcadeCabinet/GameElasticity",["require","exports","preact","view/style","view/components/ArcadeCabinet/ArcadeCabinet","view/components/ArcadeCabinet/ArcadeCabinetHelpers","view/icons/Arrow"],(function(e,t,r,i,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=__importDefault(n),o.registerArcadeGameMeta(o.ArcadeGamePath.ELASTICITY,{title:"ELASTICITY",tokensRequired:2,controls:()=>r.h(r.Fragment,null,r.h(o.CabinetControlButton,Object.assign({width:"48px",height:"48px"},a.buttonHandlers(a.SDLKeyID.Left)),r.h(n.default,{color:i.colors.GREEN,direction:"left"})),r.h(o.CabinetControlButton,Object.assign({width:"48px",height:"48px"},a.buttonHandlers(a.SDLKeyID.Right)),r.h(n.default,{color:i.colors.GREEN,direction:"right"})),r.h(o.CabinetControlButton,Object.assign({width:"48px",height:"48px",type:"text"},a.buttonHandlers(a.SDLKeyID.Enter)),"START"))})})),define("view/components/ArcadeCabinet/ArcadeCabinet",["require","exports","preact","preact/hooks","view/style","controller/arcade-iframe-actions","view/elements/Button","view/elements/IframeShim","controller/ui-actions","model/generics","view/ui","model/player","model/sound","view/components/ArcadeCabinet/ArcadeCabinetHelpers","view/components/ArcadeCabinet/GameTicTacToe","view/components/ArcadeCabinet/GamePresident","view/components/ArcadeCabinet/GameInvaderz","view/components/ArcadeCabinet/GameElasticity"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u,h){"use strict";var m;Object.defineProperty(t,"__esModule",{value:!0}),t.buttonHandlers=t.SDLKeyID=void 0,n=__importStar(n),s=__importDefault(s),(m=t.SDLKeyID||(t.SDLKeyID={}))[m.Enter=13]="Enter",m[m.Space=32]="Space",m[m.Left=1073741904]="Left",m[m.Right=1073741903]="Right",t.buttonHandlers=e=>({onMouseDown:()=>{o.setButtonDown(e)},onMouseUp:()=>{o.setButtonUp(e)},onTouchStart:()=>{o.setButtonDown(e)},onTouchEnd:()=>{o.setButtonUp(e)}});let g=a.style("div",()=>({background:a.colors.BGGREY,position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"})),p=a.style("div",e=>({position:"fixed",left:"0px",top:"0px",padding:"1rem",width:"100%",background:a.colors.BLACK,display:"flex",justifyContent:"flex-start",alignItems:"center",[a.MEDIA_QUERY_PHONE_WIDTH]:{padding:"2rem"}})),E=a.style("div",()=>({display:"flex",justifyContent:"space-between"})),f=a.style("div",()=>({display:"flex"})),w=a.style("div",()=>({display:"flex",justifyContent:"space-between",alignItems:"center"})),C=a.style("div",()=>({padding:"0px 8px"})),y=a.style("div",()=>({position:"relative",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",height:"100%",pointerEvents:"none"})),b=a.style("div",e=>({border:"20px solid "+a.colors.BLACK,background:a.colors.DARKBLUE,color:a.colors.WHITE,fontSize:"4rem",width:"646px",boxSizing:"border-box",textAlign:"center"})),T=a.style("div",()=>({backgroundImage:"url(res/img/arcade-cabinet.png)",width:"646px",height:"712px",position:"absolute",left:"0px",top:"0px",zIndex:"-1"})),S=a.style("div",e=>({minHeight:"96px",width:"548px",background:a.colors.GREY,textAlign:"center",zIndex:"1",display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:"all",transform:"perspective(512px) rotateX(24deg) translateY(12px)",border:"2px solid "+a.colors.WHITE}));a.style("div",e=>{var t,r;return{tapHighlightColor:"rgba(0, 0, 0, 0)",webkitTapHighlightColor:"rgba(0, 0, 0, 0)",padding:"16px",fontSize:"16px",minWidth:e.width?"unset":"48px",width:e.width,height:e.height,margin:"16px 4px",background:null!==(t=e.backgroundColor)&&void 0!==t?t:a.colors.DARKBLUE,color:null!==(r=e.color)&&void 0!==r?r:a.colors.WHITE,cursor:"pointer",borderRadius:"8px",border:"2px solid "+a.colors.GREY,textAlign:"center",fontFamily:"monospace",userSelect:"none",display:"text"===e.type?"flex":"",justifyContent:"center",touchAction:"manipulate",alignItems:"center","&:hover":{filter:"brightness(120%)"},"&:active":{filter:"brightness(80%)"}}}),t.default=e=>{var t;let[a,m]=i.useState(!1),[v,x]=i.useState(!1),[B,I]=i.useState(!1),[_,R]=i.useState(0),M=null!==(t=h.ArcadeGamePathMeta[e.game])&&void 0!==t?t:h.ArcadeGamePathMeta.default,k=c.getCurrentPlayer().tokens,D=c.getCurrentPlayer().tickets,O=M.tokensRequired,P=A.getUiInterface().appState.arcadeGame.isGameRunning,L=A.getUiInterface().appState.arcadeGame.isGameReady;return r.h(g,null,r.h(p,null,r.h(E,null,r.h(f,null,r.h(n.default,{type:n.ButtonType.CANCEL,onClick:()=>{l.hideArcadeGame()},style:{marginRight:"1rem"}},"Back"),r.h(n.default,{type:n.ButtonType.PRIMARY,style:{marginRight:"1rem"},onClick:()=>{let e=!a;m(e),e?(o.showControls(),o.setScaleWindow()):(o.hideControls(),o.setScaleOriginal())}},a?"Contract":"Expand"),r.h(n.default,{type:n.ButtonType.PRIMARY,style:{marginRight:"1rem"},onClick:()=>{let e=!v;x(e),e?o.muteAudio():o.unmuteAudio()}},v?"Unmute":"Mute")),r.h(w,null,r.h(C,null,"TOKENS: ",k-_),r.h(C,null,"TICKETS: ",D),r.h(C,null,r.h(n.default,{disabled:!L||P||k<=0,style:{width:"140px"},type:_===O?n.ButtonType.PRIMARY:n.ButtonType.TOKEN,onClick:()=>{_===O?(d.playerModifyTokens(c.getCurrentPlayer(),-_),R(0),o.beginCurrentArcadeGame()):(R(_+1),u.playSoundName("insert_token"),_+1===O&&setTimeout(()=>{u.playSoundName("ready_arcade_game")},250))}},_===O?"PLAY":"Insert Token")),r.h(C,null,r.h(n.default,{disabled:0===_,type:n.ButtonType.CANCEL,onClick:()=>{R(0),u.playSoundName("eject_tokens")}},"Eject Tokens")),r.h(C,null,"TOKENS INSERTED: ",_,"/",O)))),r.h(y,null,a?null:r.h(b,null,M.title),r.h("div",{style:{transition:"height 0.25s",height:a?"0px":"32px",width:"646px",position:"relative"}},a?null:r.h(T,null)),e.game?r.h(s.default,{id:"arcade-iframe",src:e.game+"?cabinet=true&mute=true",width:a?"100%":"512px",height:a?"100%":"512px",expanded:a,loading:!L}):r.h("div",null,"No game was specified."),a?null:r.h(S,{id:"controls-arcade"},r.h(M.controls,{setHelpDialogOpen:I})),(null==M?void 0:M.help)&&B?r.h(M.help,{setHelpDialogOpen:I}):null))}})),define("view/components/ArcadeCabinet/index",["require","exports","view/components/ArcadeCabinet/ArcadeCabinet","view/components/ArcadeCabinet/ArcadeCabinetHelpers"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getArcadeGamePathMeta=t.ArcadeGamePathMeta=t.ArcadeGamePath=t.default=void 0,Object.defineProperty(t,"default",{enumerable:!0,get:function(){return __importDefault(r).default}}),Object.defineProperty(t,"ArcadeGamePath",{enumerable:!0,get:function(){return i.ArcadeGamePath}}),Object.defineProperty(t,"ArcadeGamePathMeta",{enumerable:!0,get:function(){return i.ArcadeGamePathMeta}}),Object.defineProperty(t,"getArcadeGamePathMeta",{enumerable:!0,get:function(){return i.getArcadeGamePathMeta}})})),define("model/store",["require","exports"],(function(e,t){"use strict";var r,i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.AppStateInitial=t.ModalSection=t.CutsceneSpeaker=t.AppSection=void 0,function(e){e.BattleUI="battleMenu",e.BattleVictory="battleVictory",e.BattleDefeated="battleDefeated",e.Cutscene="cutscene",e.Debug="debug",e.ArcadeCabinet="arcadeCabinet",e.Choices="choices",e.Settings="settings",e.Modal="modal"}(r=t.AppSection||(t.AppSection={})),function(e){e.Left="left",e.Left2="left2",e.Right="right",e.Right2="right2",e.Center="center",e.None="none"}(i=t.CutsceneSpeaker||(t.CutsceneSpeaker={})),function(e){e.TUTORIAL_ATTACK="TUTORIAL_ATTACK",e.TUTORIAL_PAUSING="TUTORIAL_PAUSING",e.TUTORIAL_ATTACK_AMOUNTS="TUTORIAL_ATTACK_AMOUNTS",e.TUTORIAL_STAGGER="TUTORIAL_STAGGER",e.TUTORIAL_BACK_ROW="TUTORIAL_BACK_ROW",e.TUTORIAL_MAGIC="TUTORIAL_MAGIC"}(a=t.ModalSection||(t.ModalSection={})),t.AppStateInitial={sections:[r.Debug],overworld:{characterText:"",prevCharacterText:""},cutscene:{showBars:!0,text:"",speaker:i.None,speakerName:"",visible:!0,portraitLeft:"",portraitLeftEmotion:"",portraitLeft2:"",portraitLeft2Emotion:"",portraitRight:"",portraitRightEmotion:"",portraitRight2:"",portraitRight2Emotion:"",portraitCenter:"",portraitCenterEmotion:""},battle:{characterIndexSelected:0,targetIndexSelected:0,disabled:!1,paused:!1},arcadeGame:{path:"",isGameRunning:!1,isGameReady:!1},choices:{choiceTexts:[]},modal:{section:a.TUTORIAL_ATTACK,onClose:()=>{}}}})),define("view/icons/Close",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{xmlns:"http://www.w3.org/2000/svg",id:"svg2",viewBox:"0 0 84.853 84.853",version:"1.0"},r.h("g",{id:"layer1",transform:"translate(-153.29 -132.79)"},r.h("g",{id:"g2762",transform:"matrix(.70711 -.70711 .70711 .70711 -66.575 189.71)",fill:e.color},r.h("rect",{id:"rect1872",y:"165.22",width:"100",x:"145.71",height:"20"}),r.h("rect",{id:"rect1874",transform:"rotate(90)",height:"20",width:"100",y:"-205.71",x:"125.22"}))))})),define("view/elements/VerticalMenu",["require","exports","preact","preact/hooks","view/style","view/icons/Cursor","view/icons/Close","model/sound"],(function(e,t,r,i,a,o,n,s){"use strict";var l;Object.defineProperty(t,"__esModule",{value:!0}),t.MenuLineHeight=void 0,o=__importDefault(o),n=__importDefault(n),function(e){e[e.SMALL=0]="SMALL",e[e.MEDIUM=1]="MEDIUM",e[e.LARGE=2]="LARGE"}(l=t.MenuLineHeight||(t.MenuLineHeight={}));let c={backgroundColor:a.colors.BLACK,borderColor:a.colors.WHITE,lineHeight:l.MEDIUM,startingIndex:0},A=e=>{switch(e){case l.SMALL:return{fontSize:"12px",padding:"0.25rem",minHeight:"12px"};case l.MEDIUM:return{fontSize:"16px",padding:"0.5rem",minHeight:"16px"};case l.LARGE:return{fontSize:"24px",padding:"1rem",minHeight:"24px"}}},d=a.style("div",e=>({background:e.backgroundColor,position:"relative",width:e.width||"100%",border:"4px double "+e.borderColor,boxSizing:"border-box",transition:e.open?"transform 0.15s ease-out":"unset",transform:e.open?"scale(1.0)":"scale(0.0)"})),u=a.style("div",e=>({position:"relative","&:not(:last-child)":{borderBottom:"2px solid "+e.borderColor}})),h=a.style("div",e=>Object.assign(Object.assign({textAlign:"center"},A(e.lineHeight)),{color:"white",backgroundColor:e.backgroundColor,cursor:"pointer",filter:e.active?"brightness(80%)":"",transform:e.active?"translateY(2px)":""})),m=a.keyframes({"0%":{transform:"translateX(-5px)"},"20%":{transform:"translateX(0px)"},"100%":{transform:"translateX(-5px)"}}),g=a.style("div",()=>({color:a.colors.WHITE,position:"absolute",top:"-4px",left:"-32px",animation:m+" 500ms linear infinite"})),p=()=>r.h(g,null,r.h(o.default,{color:a.colors.BLUE})),E=a.style("div",e=>({textAlign:"center",position:"relative",background:a.colors.DARKBLUE,display:"flex",justifyContent:e.title?"space-around":"center",alignItems:"baseline"})),f=a.style("div",e=>Object.assign(Object.assign({},A(e.lineHeight)),{width:"1rem",cursor:"pointer",background:e.backgroundColor,borderRight:"2px solid "+a.colors.WHITE,marginTop:"0.15rem","&:hover":{filter:"brightness(120%)"},"&:active":{filter:"brightness(80%)"}})),w=a.style("div",e=>Object.assign(Object.assign({},A(e.lineHeight)),{width:"calc(100% - 34px)"})),C=e=>{var t;let i=null!==(t=e.lineHeight)&&void 0!==t?t:l.MEDIUM;return r.h(E,{title:e.title},e.onClick?r.h(f,{backgroundColor:e.backgroundColor,onClick:e.onClick,lineHeight:i},r.h(n.default,{color:a.colors.RED})):null,r.h(w,{lineHeight:i},e.title||""))},y=function(e){var t,o,n;let[{cursorIndex:c,active:A},m]=i.useReducer(({cursorIndex:t,active:r},i)=>{var a;let o=t,n=r;return"Increment"===i.type?o=(o+1)%e.items.length:"Decrement"===i.type?o=(o-1+e.items.length)%e.items.length:"Set"===i.type?r||(o=null!==(a=i.payload)&&void 0!==a?a:0):"Select"===i.type?r||(n=!0,setTimeout(()=>{m({type:"SelectInactive"})},100)):"SelectInactive"===i.type&&(e.onItemClick(e.items[t].value),n=!1),{cursorIndex:o,active:n}},{cursorIndex:null!==(t=e.startingIndex)&&void 0!==t?t:0,active:!1});i.useEffect(()=>{let t=t=>{if(e.open&&!e.isInactive){let r=c;"ArrowDown"===t.code?m({type:"Increment"}):"ArrowUp"===t.code?(m({type:"Decrement"}),r=(r-1+e.items.length)%e.items.length):"Enter"===t.code||"KeyX"===t.code||"Keyx"===t.code?(m({type:"Select"}),e.onItemClickSound&&s.playSoundName(e.onItemClickSound)):"Escape"===t.code&&e.onClose&&e.onClose()}};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[e.open,e.isInactive]);let g=e.lineHeight||l.MEDIUM;return r.h(d,{backgroundColor:null!==(o=e.backgroundColor)&&void 0!==o?o:a.colors.BLACK,borderColor:null!==(n=e.borderColor)&&void 0!==n?n:a.colors.WHITE,width:e.width,open:e.open,style:e.style},r.h(u,{key:"title",borderColor:e.borderColor},e.hideTitle?null:r.h(C,{backgroundColor:e.backgroundColor||a.colors.BLACK,onClick:e.onClose,lineHeight:e.lineHeight,title:e.title})),e.items.map((t,i)=>r.h(u,{key:i,borderColor:e.borderColor},r.h(h,{key:i,backgroundColor:e.backgroundColor,highlighted:c===i,lineHeight:g,active:A&&c===i,onClick:()=>{m({type:"Set",payload:i}),e.onItemClickSound&&s.playSoundName(e.onItemClickSound),setTimeout(()=>{m({type:"Select"})})},onMouseOver:()=>{m({type:"Set",payload:i})}},t.label),c===i?r.h(p,null):null)))};y.defaultProps=c,t.default=y})),define("view/components/BattleSelectMenu",["require","exports","preact","view/elements/VerticalMenu","view/style","model/player","model/battle","model/character","controller/battle-management","controller/battle-actions","controller/ui-actions","model/store"],(function(e,t,r,i,a,o,n,s,l,c,A,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=__importDefault(i);let u=a.style("div",()=>({display:"flex",justifyContent:"center",alignItems:"center",height:"100%"})),h=a.style("div",()=>({display:"flex",justifyContent:"center",alignItems:"center"}));t.default=e=>r.h(u,null,r.h(i.default,{title:"SELECT BATTLE",width:"256px",open:!0,items:e.battles.map(({template:e,label:t})=>({label:r.h(h,null,r.h("span",null,t)),value:e})),onItemClick:e=>{(e=>{let t=o.playerCreate({name:"Ada",spriteBase:"ada",stats:n.battleStatsCreate(),facing:s.Facing.RIGHT,animationState:s.AnimationState.BATTLE_IDLE,skills:[c.BattleActions.Swing,c.BattleActions.Defend]}),r=s.characterCreateFromTemplate({name:"Conscience",spriteBase:"conscience",stats:n.battleStatsCreate(),facing:s.Facing.RIGHT,animationState:s.AnimationState.BATTLE_IDLE,skills:[c.BattleActions.Swing,c.BattleActions.Defend]});t.party.push(r),o.playerSetBattlePosition(t,r,n.BattlePosition.BACK),l.initiateBattle(t,e),A.showSection(d.AppSection.BattleUI,!0)})(e)}}))})),define("view/hooks",["require","exports","preact/hooks","model/generics","model/battle"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useBattleSubscriptionWithBattleCharacter=t.useBattleSubscription=t.useCursorIndexStateWithKeypress=t.useInputEventStack=t.useRenderLoop=t.useReRender=t.initHooks=void 0,t.initHooks=()=>{window.addEventListener("keydown",e=>{let t=o[o.length-1];t&&t(e)})},t.useReRender=()=>{let[e,t]=r.useState(!1);return()=>{t(!e)}},t.useRenderLoop=(e,t)=>{let[,a]=r.useReducer(e=>!e,!1),o=()=>{a("")};return r.useEffect(()=>(i.addRenderable(e,t||o),()=>{i.removeRenderable(e)}),[]),o};let o=[];t.useInputEventStack=e=>{r.useEffect(()=>(o.push(e),()=>{let t=o.indexOf(e);t>-1&&o.splice(t,1)}),[])},t.useCursorIndexStateWithKeypress=(e,t,i,a)=>{let[{cursorIndex:o,active:n},s]=r.useReducer(({cursorIndex:e,active:t},r)=>{var o;let n=e,s=t;return"Increment"===r.type&&t?n=(n+1)%i.length:"Decrement"===r.type&&t?n=(n-1+i.length)%i.length:"Set"===r.type?n=null!==(o=r.payload)&&void 0!==o?o:0:"Select"===r.type&&t?(a(i[e]),s=!1):"SetActive"===r.type&&(s=r.payload),{cursorIndex:n,active:s}},{cursorIndex:null!=t?t:0,active:e});return r.useEffect(()=>{let e=e=>{"ArrowDown"===e.code?s({type:"Increment"}):"ArrowUp"===e.code?s({type:"Decrement"}):"Enter"===e.code&&s({type:"Select"})};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),r.useEffect(()=>{e!==n&&s({type:"SetActive",payload:e})}),[o,e=>{s({type:"Set",payload:e})}]},t.useBattleSubscription=(e,t,i)=>{r.useEffect(()=>(a.battleSubscribeEvent(e,t,i),()=>{a.battleUnsubscribeEvent(e,t,i)}),[e,t,i])},t.useBattleSubscriptionWithBattleCharacter=(e,t,i,o)=>{r.useEffect(()=>{let r=e=>{t===e&&o(e)};return a.battleSubscribeEvent(e,i,r),()=>{a.battleUnsubscribeEvent(e,i,r)}},[e,i,o])}})),define("view/elements/CharacterFollower",["require","exports","preact","view/hooks","view/style","model/canvas","model/character","utils"],(function(e,t,r,i,a,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let l=a.style("div",()=>({position:"absolute",pointerEvents:"all"}));t.default=e=>{let{renderKey:t,ch:a,style:c}=e,A=__rest(e,["renderKey","ch","style"]);i.useRenderLoop(t);let[d,u,h]=n.characterGetPosTopLeft(a),[m,g]=n.characterGetSize(a),[p,E]=s.worldToCanvasCoords4by3(d,u,h);return r.h(l,Object.assign({style:Object.assign({left:p+"px",top:E+"px",width:m*o.getDrawScale()+"px",height:g*o.getDrawScale()+"px"},c)},A))}})),define("view/components/OverworldSection",["require","exports","preact","view/style","view/elements/Button","controller/loop","model/generics","controller/ui-actions","model/store","controller/events","view/ui"],(function(e,t,r,i,a,o,n,s,l,c,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=__importStar(a);let d=i.style("div",{position:"absolute",top:"0px",width:"100%",display:"flex","& > div":{marginRight:"4px"}}),u=i.style("div",e=>({background:"rgba(0, 0, 0, 0.3)",padding:"4px",fontSize:"24px",color:i.colors.WHITE,width:"100%",textAlign:"center",position:"absolute",top:"256px",left:"0px",opacity:e.visible?"1":"0",transform:e.visible?"scaleY(1)":"scaleY(0)",transition:"opacity 100ms, transform 100ms"}));t.default=()=>{var e;let t=null===(e=A.getUiInterface())||void 0===e?void 0:e.appState.overworld;return t?r.h(r.Fragment,null,r.h(d,null,r.h(a.default,{type:a.ButtonType.PRIMARY,onClick:()=>{s.showSection(l.AppSection.Settings,!0),c.pushEmptyKeyHandler(),n.getIsPaused()||o.pause()}},"Settings"),r.h(a.default,{type:a.ButtonType.PRIMARY,onClick:()=>{n.getTriggersVisible()?(n.hideTriggers(),n.hideMarkers()):(n.showTriggers(),n.showMarkers())}},"Toggle Debug"),r.h(u,{visible:""!==t.characterText},t.characterText||t.prevCharacterText))):r.h("div",null)}})),define("view/components/Debug",["require","exports","preact","view/style","view/components/OverworldSection"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=__importDefault(a),i.style("div",()=>({position:"absolute",left:"0px",top:"0px"})),t.default=()=>r.h("div",{id:"debug"},r.h(a.default,null))})),define("view/components/BattleConclusion",["require","exports","preact","view/style","model/generics","model/battle","view/elements/VerticalMenu"],(function(e,t,r,i,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=__importDefault(n);let s=i.style("div",()=>({display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",height:"100%",fontSize:"4rem",color:i.colors.WHITE}));t.default=e=>r.h(s,null,r.h("span",null,e.isVictory?"VICTORY!":"DEFEATED!"),r.h(n.default,{title:"Choose",width:"50%",open:!0,hideTitle:!0,style:{transition:"transform 0.15s",transform:"scaleX(1)",width:"128px"},items:[{label:r.h("div",null,r.h("span",null,"Continue")),value:0}],onItemClickSound:"menu_select",onItemClick:()=>{let e=a.getCurrentBattle();e&&o.battleInvokeEvent(e,o.BattleEvent.onCompletion,e)}}))})),define("view/elements/AnimDiv",["require","exports","preact","preact/hooks","view/draw","model/animation"],(function(e,t,r,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>{let t=i.useRef(null),[n,s]=i.useState(o.createAnimation(e.animName)),l=e.width,c=e.height,A=e.scale,d=e.animName;return i.useEffect(()=>{let e=t.current;if(n.name!==d)s(o.createAnimation(d));else if(e){let[t,r]=n.getSpriteSize(0),i=null!=A?A:1;e.width=(null!=l?l:t)*i,e.height=(null!=c?c:r)*i;let o=e.getContext("2d");o.imageSmoothingEnabled=!1,o.clearRect(0,0,e.width,e.height),a.drawAnimation(n,0,0,i,o)}},[A,l,c,d,n]),r.h("div",null,r.h("canvas",{style:e.style,ref:t}))}})),define("view/components/BattleSection/ActionSelectMenu",["require","exports","preact","view/style","view/elements/Button","view/icons/Cursor"],(function(e,t,r,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=__importStar(a),o=__importDefault(o);let n=i.style("div",()=>({width:"100%",height:"100%"})),s=i.style("div",()=>({position:"relative",margin:"10px 6px"})),l=i.keyframes({"0%":{transform:"translateX(-10px)"},"20%":{transform:"translateX(-1px)"},"100%":{transform:"translateX(-10px)"}}),c=i.style("div",()=>({color:i.colors.WHITE,position:"absolute",top:"-8px",left:"-32px",animation:l+" 750ms linear infinite"})),A=()=>r.h(c,null,r.h(o.default,{color:i.colors.BLUE}));t.default=e=>{let t=t=>()=>{e.disabled||e.onActionClicked(t)},i=t=>()=>{e.disabled||e.setCursorIndex(t)};return r.h(n,{id:"action-select-menu-"+e.bCh.ch.name},e.bCh.ch.skills.map((o,n)=>{let l=e.bCh.ch.skillIndex===n,c=e.cursorIndex===n;return r.h(s,{id:"action-select-menu-button-row-"+n},c?r.h(A,null):null,r.h(a.default,{type:l?a.ButtonType.PRIMARY:a.ButtonType.NEUTRAL,selected:c,onClick:t(n),onMouseOver:i(n),disabled:e.disabled},o.name))}))}})),define("view/components/BattleSection/ActionInfoTooltip",["require","exports","model/generics","preact","view/style"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let o=a.style("div",e=>({color:a.colors.WHITE,border:"2px solid "+a.colors.WHITE,fontSize:"20px",position:"absolute",padding:"8px",margin:"32px",bottom:"192px",width:"424px",background:"rgba(0, 0, 0, 0.5)",pointerEvents:"none",[e.placement]:"0px"}));t.default=e=>{return i.h(o,{placement:(t=e.characterIndexSelected,t>=r.getCurrentBattle().allies.length/2?"right":"left")},e.children);var t}})),define("view/elements/ProgressBar",["require","exports","preact","view/hooks","view/style"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressBarWithRender=void 0;let o=a.style("div",e=>({background:e.backgroundColor,position:"relative",height:e.height+"px",width:"100%"})),n=a.style("div",e=>({background:e.backgroundColor,position:"absolute",left:"0",top:"0",width:"100%",height:"100%",transformOrigin:"top left"})),s=a.style("div",{textAlign:"center",fontSize:"16px",position:"absolute",left:"0",top:"0",width:"100%",color:"white"}),l=e=>{var t;return r.h(o,{backgroundColor:e.backgroundColor,height:e.height},r.h(n,{backgroundColor:e.color,style:{transform:`scaleX(${null!==(t=e.pct)&&void 0!==t?t:0})`}}),r.h(s,null,e.label))};t.ProgressBarWithRender=e=>(i.useRenderLoop(e.renderKey),r.h(l,Object.assign({},e,{pct:e.renderFunc()}))),t.default=l})),define("view/components/BattleSection/PrimaryInfo",["require","exports","preact","view/style","model/generics","model/battle-character","view/elements/ProgressBar","model/character","view/hooks","model/battle"],(function(e,t,r,i,a,o,n,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let A=i.colors.GREEN,d=i.colors.BLUE,u=i.colors.YELLOW,h=i.colors.PURPLE,m=i.style("div",()=>({display:"flex",justifyContent:"space-between",alignItems:"baseline",marginBottom:"4px"})),g=i.style("div",e=>{var t;return{width:e.short?"65%":"100%",border:e.short?"unset":"2px solid "+(null!==(t=e.borderColor)&&void 0!==t?t:i.colors.WHITE),borderBottom:e.short?"unset":"0px"}});t.default=e=>{let t=l.useReRender(),p=t=>`${e.bCh.ch.name}_${t}`;l.useBattleSubscriptionWithBattleCharacter(a.getCurrentBattle(),e.bCh,c.BattleEvent.onCharacterDamaged,()=>{t()}),l.useBattleSubscriptionWithBattleCharacter(a.getCurrentBattle(),e.bCh,c.BattleEvent.onCharacterStaggered,()=>{t()}),l.useBattleSubscriptionWithBattleCharacter(a.getCurrentBattle(),e.bCh,c.BattleEvent.onCharacterRecovered,()=>{t()});let E=a.getCurrentBattle();return r.h(r.Fragment,null,r.h(m,null,r.h(g,{short:!1,borderColor:o.battleCharacterCanAct(E,e.bCh)?i.colors.YELLOW:void 0},r.h(n.ProgressBarWithRender,{id:"progress-action",renderFunc:()=>e.bCh.actionTimer.getPctComplete(),renderKey:p("action"),backgroundColor:i.colors.BLACK,color:o.battleCharacterIsStaggered(e.bCh)?i.colors.GREY:d,height:24,label:""}))),r.h(m,null,r.h(g,{short:!1},r.h(n.ProgressBarWithRender,{id:"progress-hp",renderFunc:()=>s.characterGetHpPct(e.bCh.ch),renderKey:p("hp"),backgroundColor:i.colors.BLACK,color:A,height:24,label:"HP: "+e.bCh.ch.hp}))),r.h(m,null,r.h("span",null," STAG "),r.h(g,{short:!0},r.h(n.ProgressBarWithRender,{id:"progress-stagger",renderFunc:()=>o.battleCharacterIsStaggered(e.bCh)?1-e.bCh.staggerTimer.getPctComplete():e.bCh.staggerGauge.getPct(),renderKey:p("stagger"),backgroundColor:i.colors.BLACK,color:o.battleCharacterIsStaggered(e.bCh)?i.colors.WHITE:u,height:6,label:""}))),r.h(m,null,r.h("span",null," RESV "),r.h(g,{short:!0},r.h(n.ProgressBarWithRender,{id:"progress-reserve",renderFunc:()=>.25,renderKey:p("reserve"),backgroundColor:i.colors.BLACK,color:h,height:6,label:""}))))}})),define("lib/preact-hooks",["require","exports","preact"],(function(e,t,r){"use strict";function i(e,t){r.options.__h&&r.options.__h(m,e,p||t),p=0;var i=m.__H||(m.__H={__:[],__h:[]});return e>=i.__.length&&i.__.push({}),i.__[e]}function a(e){return p=1,o(u,e)}function o(e,t,r){var a=i(h++,2);return a.t=e,a.__c||(a.__=[r?r(t):u(void 0,t),function(e){var t=a.t(a.__[0],e);a.__[0]!==t&&(a.__=[t,a.__[1]],a.__c.setState({}))}],a.__c=m),a.__}function n(e,t){var a=i(h++,4);!r.options.__s&&d(a.__H,t)&&(a.__=e,a.__H=t,m.__h.push(a))}function s(e,t){var r=i(h++,7);return d(r.__H,t)&&(r.__=e(),r.__H=t,r.__h=e),r.__}function l(){E.forEach((function(e){if(e.__P)try{e.__H.__h.forEach(c),e.__H.__h.forEach(A),e.__H.__h=[]}catch(t){e.__H.__h=[],r.options.__e(t,e.__v)}})),E=[]}function c(e){var t=m;"function"==typeof e.__c&&e.__c(),m=t}function A(e){var t=m;e.__c=e.__(),m=t}function d(e,t){return!e||e.length!==t.length||t.some((function(t,r){return t!==e[r]}))}function u(e,t){return"function"==typeof t?t(e):t}Object.defineProperty(t,"__esModule",{value:!0}),t.useErrorBoundary=t.useDebugValue=t.useContext=t.useCallback=t.useMemo=t.useImperativeHandle=t.useRef=t.useLayoutEffect=t.useEffect=t.useReducer=t.useState=void 0;var h,m,g,p=0,E=[],f=r.options.__b,w=r.options.__r,C=r.options.diffed,y=r.options.__c,b=r.options.unmount;t.useState=a,t.useReducer=o,t.useEffect=function(e,t){var a=i(h++,3);!r.options.__s&&d(a.__H,t)&&(a.__=e,a.__H=t,m.__H.__h.push(a))},t.useLayoutEffect=n,t.useRef=function(e){return p=5,s((function(){return{current:e}}),[])},t.useImperativeHandle=function(e,t,r){p=6,n((function(){"function"==typeof e?e(t()):e&&(e.current=t())}),null==r?r:r.concat(e))},t.useMemo=s,t.useCallback=function(e,t){return p=8,s((function(){return e}),t)},t.useContext=function(e){var t=m.context[e.__c],r=i(h++,9);return r.__c=e,t?(null==r.__&&(r.__=!0,t.sub(m)),t.props.value):e.__},t.useDebugValue=function(e,t){r.options.useDebugValue&&r.options.useDebugValue(t?t(e):e)},t.useErrorBoundary=function(e){var t=i(h++,10),r=a();return t.__=e,m.componentDidCatch||(m.componentDidCatch=function(e){t.__&&t.__(e),r[1](e)}),[r[0],function(){r[1](void 0)}]},r.options.__b=function(e){m=null,f&&f(e)},r.options.__r=function(e){w&&w(e),h=0;var t=(m=e.__c).__H;t&&(t.__h.forEach(c),t.__h.forEach(A),t.__h=[])},r.options.diffed=function(e){C&&C(e);var t=e.__c;t&&t.__H&&t.__H.__h.length&&(1!==E.push(t)&&g===r.options.requestAnimationFrame||((g=r.options.requestAnimationFrame)||function(e){var t,r=function(){clearTimeout(i),T&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(r,100);T&&(t=requestAnimationFrame(r))})(l)),m=void 0},r.options.__c=function(e,t){t.some((function(e){try{e.__h.forEach(c),e.__h=e.__h.filter((function(e){return!e.__||A(e)}))}catch(i){t.some((function(e){e.__h&&(e.__h=[])})),t=[],r.options.__e(i,e.__v)}})),y&&y(e,t)},r.options.unmount=function(e){b&&b(e);var t=e.__c;if(t&&t.__H)try{t.__H.__.forEach(c)}catch(e){r.options.__e(e,t.__v)}};var T="function"==typeof requestAnimationFrame})),define("view/icons/Circle",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("path",{d:"M0 0h512v512H0z",fill:"rgba(0, 0, 0, 0.0)","fill-opacity":"1"}),r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M256 23.05C127.5 23.05 23.05 127.5 23.05 256S127.5 488.9 256 488.9 488.9 384.5 488.9 256 384.5 23.05 256 23.05z",fill:e.color,"fill-opacity":"1"})))})),define("view/icons/SwingNormal",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{fill:e.color,stroke:e.color,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M146.326 6.15l87.813 128.725-60.87-39.916 34.925 62.864L38.56 48.06h-.003c40.207 71.33 82.046 134.913 129.23 191.764L303.94 103.67c-45.164-37.052-96.674-69.324-157.614-97.52zm347.145 9.496L372.983 61.713l-214.59 214.09 13.213 13.215L383.367 77.75l78.078-29.85-29.402 78.56-211.746 211.25 13.213 13.214 214.61-214.106 45.35-121.172zM407.177 89.13l-259.95 259.95c-11.956-17.32-11.687-40.444.25-57.764l-31.26-31.255c-28.637 34.832-28.588 85.102.167 119.864L52.336 443.97c-2.528-.95-5.184-1.43-7.842-1.43-5.74 0-11.476 2.216-15.908 6.647-8.864 8.865-8.866 22.953 0 31.82 8.864 8.863 22.954 8.863 31.818 0 6.512-6.513 8.234-15.844 5.178-23.853l64.057-64.056c34.788 28.437 85.12 28.65 119.817.203l-31.262-31.26c-17.28 11.84-40.352 11.907-57.68.18l259.876-259.874-13.214-13.215zm-2.196 117.01L268.186 342.937c55.29 48.057 118.235 90.138 192.464 127.216L398.783 351.41l102.78 68.85-117.75-164.645 86.816 42.908c-20.895-33.04-42.523-63.772-65.65-92.382z",fill:e.color,"fill-opacity":"1"})))})),define("view/icons/SwingPierce",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{fill:e.color,stroke:e.color,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M259.632 28.52c-15.21 29.776-26.798 59.26-36.147 88.652l-3.888 12.226-10.172-7.82c-23.276-17.89-44.87-38.798-63.885-63.892 1.717 33.39 6.423 64.716 13.022 94.843l2.746 12.533-12.72-1.686c-29.102-3.856-58.257-11.165-87.27-23.39 18.18 28.057 37.92 52.835 58.7 75.626l8.64 9.48-11.856 4.9c-27.133 11.213-56.04 19.458-87.28 23.376 29.775 15.208 59.26 26.797 88.65 36.146l12.227 3.888-7.82 10.172c-17.892 23.276-38.8 44.87-63.893 63.885 33.39-1.716 64.716-6.422 94.843-13.02l12.533-2.747-1.685 12.72c-3.856 29.102-11.165 58.257-23.39 87.27 28.057-18.18 52.835-37.92 75.626-58.7l9.48-8.64 4.9 11.856c11.213 27.132 19.458 56.038 23.376 87.28 15.21-29.776 26.798-59.26 36.147-88.652l3.888-12.226 10.172 7.82c23.276 17.89 44.87 38.798 63.885 63.892-1.717-33.39-6.423-64.716-13.022-94.843l-2.746-12.532 12.72 1.685c29.102 3.856 58.257 11.165 87.27 23.39-18.18-28.057-37.92-52.835-58.7-75.626l-8.64-9.48 11.856-4.9c27.133-11.213 56.038-19.458 87.28-23.376-29.775-15.208-59.26-26.797-88.65-36.146l-12.227-3.888 7.82-10.172c17.89-23.276 38.798-44.87 63.892-63.885-18.057.927-35.508 2.736-52.496 5.24L276.195 276.4c-6.194 6.236-14.033 9.328-21.386 9.077-7.354-.253-13.934-3.538-18.73-8.396-9.59-9.716-11.724-27.68.407-40.166l.045-.047 118.098-118.1c4.217-19.508 10.193-39.013 18.385-58.454-28.058 18.182-52.836 37.92-75.627 58.7l-9.48 8.642-4.9-11.857C271.794 88.67 263.55 59.763 259.63 28.52zm224.03.818l-86.112 54.8v31.313h31.314l54.8-86.112zM379.55 119.31l-8.37 8.372-121.783 121.78c-6.11 6.288-4.212 11.222-.505 14.977 1.853 1.877 4.235 2.972 6.533 3.05 2.297.08 4.797-.547 8.002-3.773l.01-.01L393.69 133.45h-14.14v-14.14zM144.64 374.507a662.042 662.042 0 0 1-24.73 4.443l-92.39 92.39 14.14 14.14 101.163-101.162a341.49 341.49 0 0 0 1.817-9.812z",fill:e.color,"fill-opacity":"1"})))})),define("view/icons/SwingFinisher",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{fill:e.color,stroke:e.color,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M47.688 19.156c-.376-.003-.748.016-1.126.032-6.044.245-12.252 2.815-17.28 7.843-10.057 10.058-10.297 24.924-1.72 33.5 3.94 3.94 9.21 6.034 14.72 6.157l3.062-3.093L67.5 41.437l1.406-1.406c-.123-5.515-2.217-10.78-6.156-14.718-4.022-4.02-9.423-6.114-15.063-6.156zm28.28 40.25L63.063 72.313c13.653 33.245 37.167 56.274 67.438 73.718l18.75-18.75C130.385 97.324 105.988 74.1 75.97 59.407zm129.344 38.25L99.906 203.094l23.844 23.844c29.782-40.624 65.415-75.33 105.5-105.344l-23.938-23.938zm12.813 56.406c-22.467 18.703-43.183 39.077-61.875 61.438 34.053 43.905 76.278 82.775 122.406 112.375-20.858 1.702-40.402 1.278-58.562-1.28 34.15 24.845 71.227 45.65 110.25 61.155-28.237 2.647-54.58 2.25-78.97-1.188 72.535 52.773 155.472 91.19 243.064 107.47-20.59-94.733-58.107-178.44-109.844-249.094 3.565 24.952 4.537 52.326 2.47 82.312-16.075-41.127-36.744-78.823-61.564-112.72 2.653 18.574 3.49 38.852 2.22 60.94-29.64-47.287-66.485-88.237-109.595-121.408z",fill:e.color,"fill-opacity":"1"})))})),define("view/components/BattleSection/PrimaryActingWeapon",["require","exports","preact","view/style","model/generics","controller/battle-actions","lib/preact-hooks","view/hooks","model/battle","view/icons/Circle","view/icons/Close","view/icons/SwingNormal","view/icons/SwingPierce","view/icons/SwingFinisher"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),c=__importDefault(c),A=__importDefault(A),d=__importDefault(d),u=__importDefault(u),h=__importDefault(h);let m=i.style("div",()=>({pointerEvents:"none",width:"100%",height:"100%"})),g=i.style("div",()=>({display:"flex",justifyContent:"center",alignItems:"center",height:"100%"})),p=i.style("div",()=>({border:"2px solid "+i.colors.WHITE,borderBottom:"2px solid "+i.colors.GREEN,background:i.colors.DARKGREY,display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:"column",width:"28px",padding:"8px","& > span":{width:"24px",marginTop:"8px"}}));t.default=e=>{var t;let E=e.battleAction,f=e.bCh.actionStateIndex,w=n.useRef(null),C="acting-weapon-primary-"+e.bCh.ch.name,y=s.useReRender();return n.useEffect(()=>{let e=document.getElementById(C);e&&(e.style.transition="unset",e.style.transform="scale(0.9)",e.style.transition="transform 150ms",setTimeout(()=>{e.style.transform="scale(1.0)"},100))},[f,w,C]),s.useBattleSubscriptionWithBattleCharacter(a.getCurrentBattle(),e.bCh,l.BattleEvent.onCharacterAction,()=>{y()}),r.h(m,{ref:w,id:C},r.h(g,null,null===(t=E.meta.swings)||void 0===t?void 0:t.map((t,a)=>{let n=a<f||0===f;switch(t){case o.SwingType.PIERCE:case o.SwingType.NORMAL:return r.h(p,{id:"swing-table-cell-"+e.bCh.ch.name+"-"+a},((e,t)=>({[o.SwingType.NORMAL]:r.h(d.default,{color:t}),[o.SwingType.PIERCE]:r.h(u.default,{color:t}),[o.SwingType.FINISH]:r.h(h.default,{color:t})}[e]))(t,i.colors.BLUE),r.h("span",null,n?r.h(A.default,{color:i.colors.LIGHTGREEN}):r.h(c.default,{color:i.colors.WHITE})));default:return r.h(p,null)}})))}})),define("view/icons/RangedNormal",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{fill:e.color,stroke:e.color,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M492.656 20.406l-118.594 56.22L413.875 86l-86.97 86.97-305.5 259.374.69.687 104.75-47.467-46.376 105.843.905.906 272.5-319.875 73.22-73.218 9.342 39.81 56.22-118.624zm-473.25.063c-1.347 23.43 5 39.947 16.563 52.218l24.093 302.28 17.562-14.874-21.72-272.438c57.975 31.954 169.096 25.165 216.907 106.72l66.625-56.564 1.22-1.218C292.74 38.666 86.01 99.716 19.406 20.47zm359.531 151.56l-1.156 1.157-57.25 67.188c82.006 47.945 75.587 159.267 107.283 218.03l-272.157-24.5-14.812 17.408 301.562 27.125c12.48 12.283 29.4 19.084 53.688 17.687-79.95-67.2-18.36-275.754-117.156-324.094z",fill:e.color,"fill-opacity":"1"})))})),define("view/components/BattleSection/PrimaryActingRanged",["require","exports","preact","view/style","model/generics","controller/battle-actions","lib/preact-hooks","view/hooks","model/battle","view/icons/Circle","view/icons/Close","view/icons/RangedNormal"],(function(e,t,r,i,a,o,n,s,l,c,A,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),c=__importDefault(c),A=__importDefault(A),d=__importDefault(d);let u=i.style("div",()=>({pointerEvents:"none",width:"100%",height:"100%"})),h=i.style("div",()=>({display:"flex",justifyContent:"center",alignItems:"center",height:"100%"})),m=i.style("div",()=>({border:"2px solid "+i.colors.WHITE,borderBottom:"2px solid "+i.colors.GREEN,background:i.colors.DARKGREY,display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:"column",width:"28px",padding:"8px","& > span":{width:"24px",marginTop:"8px"}}));t.default=e=>{var t;let g=e.battleAction,p=e.bCh.actionStateIndex,E=n.useRef(null),f="acting-range-primary-"+e.bCh.ch.name,w=s.useReRender();return n.useEffect(()=>{let e=document.getElementById(f);e&&(e.style.transition="unset",e.style.transform="scale(0.9)",e.style.transition="transform 150ms",setTimeout(()=>{e.style.transform="scale(1.0)"},100))},[p,E,f]),s.useBattleSubscriptionWithBattleCharacter(a.getCurrentBattle(),e.bCh,l.BattleEvent.onCharacterAction,()=>{w()}),r.h(u,{ref:E,id:f},r.h(h,null,null===(t=g.meta.ranges)||void 0===t?void 0:t.map((t,a)=>{let n=a<p||0===p;switch(t){case o.RangeType.NORMAL:return r.h(m,{id:"range-table-cell-"+e.bCh.ch.name+"-"+a},((e,t)=>({[o.RangeType.NORMAL]:r.h(d.default,{color:t})}[e]))(t,i.colors.BLUE),r.h("span",null,n?r.h(A.default,{color:i.colors.LIGHTGREEN}):r.h(c.default,{color:i.colors.WHITE})));default:return r.h(m,null)}})))}})),define("view/components/BattleSection/PrimaryCasting",["require","exports","preact","view/style","controller/battle-actions","view/icons/SwingNormal","view/icons/SwingPierce","view/icons/SwingFinisher","view/elements/ProgressBar"],(function(e,t,r,i,a,o,n,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),s=__importDefault(s);let c=i.style("div",()=>({pointerEvents:"none",width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",fontSize:"20px"})),A=i.style("div",()=>({border:"2px solid "+i.colors.WHITE,borderBottom:"0px",width:"100%"}));t.default=e=>r.h(c,{id:"casting-primary-"+e.bCh.ch.name},r.h("div",null,e.battleAction.name),r.h(A,null,r.h(l.ProgressBarWithRender,{id:"progress-cast-"+e.bCh.ch.name,renderFunc:()=>e.bCh.castTimer.getPctComplete(),renderKey:e.bCh.ch.name+"_cast",backgroundColor:i.colors.BLACK,color:i.colors.PURPLE,height:32,label:""})))})),define("view/components/BattleSection/CharacterInfoCard",["require","exports","preact","model/battle-character","view/style","view/elements/AnimDiv","view/components/BattleSection/ActionSelectMenu","view/hooks","controller/ui-actions","model/generics","view/components/BattleSection/ActionInfoTooltip","model/battle","view/components/BattleSection/PrimaryInfo","view/components/BattleSection/PrimaryActingWeapon","view/components/BattleSection/PrimaryActingRanged","view/components/BattleSection/PrimaryCasting","view/icons/Circle","controller/battle-actions"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u,h,m,g,p,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),A=__importDefault(A),u=__importDefault(u),h=__importDefault(h),m=__importDefault(m),g=__importDefault(g),p=__importDefault(p);let f="0px 0px 12px 8px rgba(0, 0, 0, 0.75)",w=["X","C","Z","V"],C=a.style("div",e=>({boxSizing:"border-box",transition:"height 250ms",height:e.expanded?"326px":"180px"})),y=a.style("div",e=>({opacity:e.visible?"1.0":"0.0",transition:"opacity 100ms linear"})),b=a.style("div",()=>({display:"flex",justifyContent:"space-between",alignItems:"baseline",marginLeft:"32px"})),T=a.style("div",()=>({fontSize:"18px",color:a.colors.BLACK,background:a.colors.WHITE,boxShadow:f,borderTopLeftRadius:"8px",borderTopRightRadius:"8px",textTransform:"uppercase",border:"2px solid "+a.colors.BLACK,padding:"8px",marginBottom:"12px"})),S=a.style("div",()=>({fontSize:"16px",color:a.colors.WHITE,background:`linear-gradient(${a.colors.BLUE}, ${a.colors.DARKBLUE})`,boxShadow:f,borderRadius:"8px",padding:"2px 8px",borderBottom:"0px",display:"flex",justifyContent:"center",alignItems:"center"})),v=a.style("div",()=>({display:"flex"})),x=a.style("div",()=>({background:a.colors.DARKGREY,display:"flex",justifyContent:"center",alignItems:"center",borderRight:"2px solid "+a.colors.BLACK,width:"96px",height:"96px",cursor:"pointer",overflow:"hidden"})),B=a.keyframes({"0%":{filter:"brightness(100%)"},"50%":{filter:"brightness(115%)"},"100%":{filter:"brightness(100%)"}}),I=a.style("div",e=>({border:"2px solid "+a.colors.BLACK,background:a.colors.DARKBLUE,display:"flex",justifyContent:"space-between",animation:e.ready?B+" 1000ms linear infinite":"unset",boxShadow:f,height:"96px","&:hover":{border:"2px solid "+a.colors.BLUE}})),_=a.style("div",()=>({display:"flex",alignItems:"column",width:"32px"})),R=a.style("div",()=>({display:"flex",flexDirection:"column",width:"192px",padding:"0px 8px"})),M=a.style("div",e=>({display:"flex",justifyContent:"space-between",alignItems:e.actionsEnabled?"flex-end":"center",position:"relative"})),k=a.keyframes({"0%":{filter:"brightness(100%)",transform:"scale(1)"},"30%":{filter:"brightness(200%)",transform:"scale(1.2)"},"100%":{filter:"brightness(100%)",transform:"scale(1)"}}),D=a.style("div",e=>({position:"relative",fontSize:"16px",textAlign:"center",width:"32px",height:"32px",padding:"0px 8px",color:a.colors.BLACK,marginLeft:"57px",marginTop:"8px",animation:e.active?k+" 750ms linear infinite":"unset"})),O=a.style("div",()=>({position:"absolute",top:"0px",padding:"6px 12px"})),P=a.style("div",()=>({fontSize:"16px",textAlign:"center",width:"192px",padding:"2px 8px",background:`linear-gradient(${a.colors.GREY}, ${a.colors.BGGREY})`,borderRadius:"8px",boxShadow:f,marginTop:"8px"})),L=a.style("div",e=>({transition:"transform 250ms, border 250ms, opacity 250ms",transformOrigin:"top left",opacity:e.expanded?"1":"0",transform:e.expanded?"scaleY(1)":"scaleY(0)",maxHeight:146,width:"208px",background:a.colors.DARKGREY,border:"2px solid "+a.colors.BLACK,position:e.expanded?"unset":"absolute",top:"0px",right:"0px"})),Q=a.style("div",()=>({color:a.colors.WHITE,fontSize:"16px",width:"96px",marginLeft:"32px"}));t.default=e=>{var t;let f=s.useReRender(),B=t=>{q||l.setBattleCharacterSelectedAction(e.bCh,t)};s.useBattleSubscriptionWithBattleCharacter(c.getCurrentBattle(),e.bCh,d.BattleEvent.onCharacterReady,()=>{f()}),s.useBattleSubscriptionWithBattleCharacter(c.getCurrentBattle(),e.bCh,d.BattleEvent.onCharacterActionStarted,()=>{f()}),s.useBattleSubscriptionWithBattleCharacter(c.getCurrentBattle(),e.bCh,d.BattleEvent.onCharacterActionEnded,()=>{f()}),s.useBattleSubscriptionWithBattleCharacter(c.getCurrentBattle(),e.bCh,d.BattleEvent.onCharacterCasting,()=>{f()});let[k,F]=s.useCursorIndexStateWithKeypress(e.isSelected,e.bCh.ch.skillIndex,e.bCh.ch.skills.map((e,t)=>t),B),N=c.getCurrentBattle(),G=e.bCh.ch.name,U=e.bCh.ch.spriteBase+"_portrait_f",K=e.bCh.ch.skills[e.bCh.ch.skillIndex],j=e.bCh.actionState,H=K.type===E.BattleActionType.CAST&&i.battleCharacterIsActing(e.bCh),W=i.battleCharacterIsActing(e.bCh)&&!H&&K.type===E.BattleActionType.SWING,z=i.battleCharacterIsActing(e.bCh)&&!H&&K.type===E.BattleActionType.RANGED,Y=i.battleCharacterIsCasting(e.bCh)||H,V=!i.battleCharacterIsActing(e.bCh)&&!i.battleCharacterIsCasting(e.bCh),J=e.isSelected,q=i.battleCharacterIsCasting(e.bCh)||i.battleCharacterIsActing(e.bCh);return r.h(r.Fragment,null,r.h(y,{visible:J},r.h(A.default,{characterIndexSelected:e.characterIndex},null===(t=e.bCh.ch.skills[k])||void 0===t?void 0:t.description)),r.h(C,{expanded:J},r.h(b,{id:"top-row-ctr"},r.h(T,{id:"name-label-"+G},G),r.h(S,null,"EVA: ",0,"%")),r.h(v,{id:"primary-row-ctr"},r.h(_,null),r.h(I,{id:"primary-root",onClick:()=>{if(c.getIsPaused()){let t=c.getCurrentBattle();l.setBattleCharacterIndexSelected(t.allies.indexOf(e.bCh))}},ready:j===i.BattleActionState.IDLE},r.h(x,{id:"portrait-"+U},r.h(o.default,{style:{width:"152px"},animName:U})),r.h(R,{id:"primary-"+e.bCh.ch.name},W?r.h(h.default,{bCh:e.bCh,battleAction:K}):null,z?r.h(m.default,{bCh:e.bCh,battleAction:K}):null,Y?r.h(g.default,{bCh:e.bCh,battleAction:K}):null,V?r.h(u.default,{bCh:e.bCh}):null))),r.h(M,{actionsEnabled:J,id:"bottom-row-ctr-"+e.bCh.ch.name},J?r.h(Q,null,"SWAP"):null,r.h(L,{expanded:J},r.h(n.default,{bCh:e.bCh,cursorIndex:k,setCursorIndex:F,onActionClicked:B,disabled:q})),J?null:r.h(D,{active:(i.battleCharacterCanAct(N,e.bCh)||i.battleCharacterIsActingReady(e.bCh))&&!c.getIsPaused()},r.h(p.default,{color:a.colors.GREY}),r.h(O,null,w[e.characterIndex])),J?null:r.h(P,null,K.name))))}})),define("view/icons/Armor",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{fill:e.color,stroke:e.color,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M129.656 21.188L37.936 79.78c3.54 26.805 8.915 53.547 16.127 80.126L240.72 39.594l-19.282-12.5c-31.28-.885-62.204-2.842-91.782-5.907zm253.47.625c-40.51 3.975-83.496 5.938-126.47 5.843l204.625 132.72c7.108-25.89 12.487-51.92 16.095-78.032l-94.25-60.53zM257.937 50.75L59.468 178.656c8.025 26.32 17.865 52.456 29.532 78.313l243.25-158-74.313-48.22zm91.468 59.344l-74.562 48.437 151.28 98.782c11.714-25.803 21.592-51.91 29.688-78.187l-106.406-69.03zm-91.687 59.562L97 274.062c12.202 25.17 26.14 50.064 41.844 74.563l196.094-128.53-77.22-50.44zM352 231.22l-77.53 50.843 101.405 67.187c15.822-24.6 29.895-49.584 42.22-74.875L352 231.22zm-94.53 61.968l-108.345 71.03c13.564 20.062 28.326 39.847 44.28 59.313l132.032-85.28-67.968-45.063zm84.967 56.312L274.5 393.406l47.03 30.375c15.845-19.342 30.513-38.993 44.033-58.936L342.438 349.5zm-84.968 54.875L205.5 437.97c16.233 18.933 33.614 37.54 52.156 55.78 18.385-18.152 35.637-36.678 51.78-55.53l-52.092-33.626.125-.22z",fill:e.color,"fill-opacity":"1"})))})),define("view/components/BattleSection/EnemyInfoCard",["require","exports","preact","model/battle-character","view/style","view/elements/ProgressBar","model/character","view/hooks","view/ui","model/generics","model/battle","view/icons/Armor"],(function(e,t,r,i,a,o,n,s,l,c,A,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),d=__importDefault(d);let u=a.colors.GREEN,h=a.colors.BLUE,m=a.colors.YELLOW,g=a.style("div",()=>({boxSizing:"border-box",transition:"height 250ms",height:"180px"})),p=a.style("div",()=>({display:"flex",justifyContent:"center",alignItems:"baseline",marginLeft:"32px",marginBottom:"12px",pointerEvents:"none"})),E=a.style("div",()=>({fontSize:"18px",color:a.colors.WHITE,textAlign:"center",padding:"8px"})),f=a.style("div",()=>({display:"flex"})),w=a.style("div",()=>({border:"2px solid "+a.colors.BLACK,borderBottom:"2px solid "+a.colors.RED,background:a.colors.DARKRED,display:"flex",justifyContent:"space-between",boxShadow:"0px 0px 12px 8px rgba(0, 0, 0, 0.75)","&:hover":{border:"2px solid "+a.colors.RED}})),C=a.style("div",()=>({display:"flex",alignItems:"column",width:"32px","& > div":{width:"28px",marginBottom:"8px",zIndex:"1"}})),y=a.style("div",()=>({display:"flex",flexDirection:"column",width:"192px",padding:"0px 8px"})),b=a.style("div",()=>({display:"flex",justifyContent:"space-between",alignItems:"baseline",marginBottom:"4px"})),T=a.style("div",e=>({width:e.short?"65%":"100%",border:e.short?"unset":"2px solid "+a.colors.WHITE,borderBottom:e.short?"unset":"0px"}));t.default=e=>{let t=t=>`${e.bCh.ch.name}_${t}`;s.useBattleSubscriptionWithBattleCharacter(c.getCurrentBattle(),e.bCh,A.BattleEvent.onCharacterDamaged,()=>{l.renderUi()});let S=e.bCh.ch.name,v=[];for(let t=0;t<e.bCh.armor;t++)v.push(r.h("div",null,r.h(d.default,{key:t,color:a.colors.LIGHTGREY})));return r.h(r.Fragment,null,r.h(g,null,r.h(p,{id:"top-row-ctr"}),r.h(f,{id:"primary-row-ctr",onMouseOver:()=>{e.bCh.ch.highlighted=!0},onMouseOut:()=>{e.bCh.ch.highlighted=!1}},r.h(C,null,v),r.h(w,{id:"primary-root",onClick:()=>{let t=c.getCurrentBattle();null===A.battleGetActingAllegiance(t)&&(A.battleSetEnemyTargetIndex(t,e.characterIndex),l.renderUi())}},r.h(y,{id:"primary"},r.h(E,{id:"name-label-"+S},S),r.h(b,null,r.h(T,{short:!1},r.h(o.ProgressBarWithRender,{id:"progress-action",renderFunc:()=>e.bCh.actionTimer.getPctComplete(),renderKey:t("action"),backgroundColor:a.colors.BLACK,color:h,height:6,label:""}))),r.h(b,null,r.h(T,{short:!1},r.h(o.ProgressBarWithRender,{id:"progress-hp",renderFunc:()=>n.characterGetHpPct(e.bCh.ch),renderKey:t("hp"),backgroundColor:a.colors.BLACK,color:u,height:24,label:"HP: "+e.bCh.ch.hp}))),r.h(b,null,r.h("span",null," STAG "),r.h(T,{short:!0},r.h(o.ProgressBarWithRender,{id:"progress-stagger",renderFunc:()=>i.battleCharacterIsStaggered(e.bCh)?1-e.bCh.staggerTimer.getPctComplete():e.bCh.staggerGauge.getPct(),renderKey:t("stagger"),backgroundColor:a.colors.BLACK,color:i.battleCharacterIsStaggered(e.bCh)?a.colors.WHITE:m,height:6,label:""}))))))))}})),define("view/icons/Target",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:e.color,stroke:e.color},r.h("path",{d:"M0 0h512v512H0z",fill:"rgba(0, 0, 0, 0)","fill-opacity":"1"}),r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M138.563 16.063C83.49 42.974 41.459 86.794 16.124 138.53l59.938 29.407c18.988-38.845 50.47-71.807 91.812-92l-29.313-59.874zm234.843.156L344 76.124c38.846 18.99 71.807 50.47 92 91.813l59.875-29.313c-26.913-55.073-70.732-97.073-122.47-122.406zm62.53 327.717c-18.982 38.865-50.53 71.673-91.873 91.875l29.437 60.125c55.116-26.925 97.085-70.76 122.375-122.562l-59.938-29.438zm-359.936.125l-60 29.375c26.928 55.097 70.776 97.082 122.563 122.375l29.406-59.937C129.122 416.885 96.192 385.4 76 344.062z",fill:e.color,"fill-opacity":"1"})))})),define("view/icons/TargetMelee",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{fill:e.color,stroke:e.color,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M122.1 17.52L186.6 161l104.5-44.9-44.5-98.58h-51.1l35.8 80.75-16.4 7.23-39-87.98zm265.2 77.75L110.4 215.2l12 28.2 278.1-119.8zm-69.7 98.53l-23.9 11.5c12.8 5.4 26 13.7 38.3 15.6 18.1-13.1-4.9-30.5-14.4-27.1zm-60.7 11.1l-36.2 16.7c-11.9 18.4-14.8 46-18.2 69.7 20.6 30.1 30.5 62.4 39.5 94 17.9-3.7 32.2-6.8 48.7-11.5-24.4-38.7-42.2-78.4-53.6-118.9 0 0 5.6-10.5 8.4-15.8 11.9 7.3 24.9 12.4 36.6 9.9 10-4.1 21.5-7.9 27.7-16.6-17.6-6.9-37.1-17.5-52.9-27.5zm92.6 26.6c-10.8 5.8-23 11.2-31.9 18.9-5.3 4.7-12.1 8.8-20.5 12.3 1.1 7.3-.1 19.6 8.1 18.8 20.5-6.2 40.5-15 59.7-28.4-.1-9.2-8-24.1-15.4-21.6zm-90.2 34.2c11.3 34.8 27.6 69 49.3 102.6 4.7-1.6 9.3-3.3 13.5-5-7.3-6.2-11.7-15.9-12-25.3-16.6-4.1-20.8-29.4-17.2-41.6-9.5-7-13.6-18.1-14.2-28.7-7.2.7-13.6-.1-19.4-2zm103.3 10.4c-13.6 8.1-27.6 14.3-41.6 19.2l-9 4.4c-4.4 4.6-4.5 15.6 1 20.3 9.7 3.5 50.1-21.2 57.7-27.9 1.3-5.8-3.5-14.9-8.1-16zm-178.1 21.2L19.1 335.8V495c95.7-25.3 146.9-47.1 209.7-90.2-10.8-38-20.5-74.8-44.3-107.5zm187.8 16.9c-13.6 10.2-27.2 16.2-42.9 21.4-.4 6.7 2.5 18.1 12.1 16 19.9-4.3 36.3-17.5 36.6-24.6.2-3.7-2-10.5-5.8-12.8zm-7.5 48.6c-14.3 8.2-31.5 15.9-46.7 21.4l18.7 31.8 39.3-18.8zm22.2 49.1L342.9 433l3.1 21.9c15.1.5 46.6-11.3 55.4-26.1v-.1z",fill:e.color,"fill-opacity":"1"})))})),define("view/components/BattleSection/BattleCharacterFollower",["require","exports","preact","view/style","model/generics","view/hooks","model/battle","view/elements/CharacterFollower","view/ui","lib/preact-hooks","view/icons/TargetMelee","view/icons/Target","view/icons/Armor","controller/battle-actions"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=__importDefault(s),A=__importDefault(A),d=__importDefault(d),u=__importDefault(u);let m=i.keyframes({"0%":{transform:"rotateZ(0deg)"},"50%":{transform:"rotateZ(180deg)"},"100%":{transform:"rotateZ(360deg)"}}),g=i.keyframes({"0%":{transform:"translateY(-2px)"},"30%":{transform:"translateY(2px)"},"100%":{transform:"translateY(-2px)"}}),p=i.style("div",()=>({position:"absolute",width:"100%",height:"100%",display:"flex",alignItems:"center",flexDirection:"column",top:"-42px","& > span":{marginLeft:"3px",fontSize:"20px",textTransform:"uppercase",marginBottom:"8px"}})),E=i.style("div",()=>({animation:g+" 750ms linear infinite",width:"48px",height:"48px"})),f=i.style("div",()=>({animation:m+" 3000ms linear infinite",width:"48px",height:"48px"})),w=i.style("div",e=>({position:"absolute",right:"right"===e.align?"0px":"unset",left:"left"===e.align?"0px":"unset",width:"32px",height:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-end","& > div":{width:"28px",marginTop:"4px"}}));t.default=e=>{let t=e.bCh,m=a.getCurrentBattle(),[g,C]=c.useState(null);o.useBattleSubscription(a.getCurrentBattle(),n.BattleEvent.onTurnStarted,e=>{C(e)}),o.useBattleSubscription(a.getCurrentBattle(),n.BattleEvent.onTurnEnded,()=>{C(null)});let y=n.battleGetTargetedEnemy(m,h.BattleActionType.SWING)===t,b=n.battleGetTargetedEnemy(m,h.BattleActionType.RANGED)===t,T=[];for(let t=0;t<e.bCh.armor;t++)T.push(r.h("div",null,r.h(u.default,{key:t,color:i.colors.LIGHTGREY})));let S=null===g,v=a.getIsPaused(),x=!t.isDefeated&&(v||S);return r.h(s.default,{ch:t.ch,renderKey:"follower-"+t.ch.name,onClick:()=>{e.isEnemy&&(n.battleGetActingAllegiance(m),null===n.battleGetActingAllegiance(m))&&(y?n.battleSetEnemyRangeTargetIndex(m,e.battleIndex):n.battleSetEnemyTargetIndex(m,e.battleIndex)||n.battleSetEnemyRangeTargetIndex(m,e.battleIndex),l.renderUi())},onMouseOver:()=>{t.ch.highlighted=!0},onMouseOut:()=>{t.ch.highlighted=!1}},y&&x?r.h(p,null,r.h(E,null,r.h(A.default,{color:i.colors.YELLOW}))):null,b&&x?r.h(p,null,r.h(f,null,r.h(d.default,{color:i.colors.RED}))):null,r.h(w,{align:e.isEnemy?"right":"left"},T))}})),define("view/components/BattleSection/BattleSection",["require","exports","model/generics","preact","view/style","controller/loop","view/components/BattleSection/CharacterInfoCard","view/components/BattleSection/EnemyInfoCard","view/ui","model/battle","lib/preact-hooks","view/hooks","view/components/BattleSection/BattleCharacterFollower"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=__importDefault(n),s=__importDefault(s),u=__importDefault(u);let h=a.style("div",()=>({position:"absolute",top:"0px",left:"0px",overflow:"hidden",width:"100%",height:"100%",pointerEvents:"none"})),m=a.style("div",()=>({position:"absolute",bottom:"0px",left:"0px",width:"calc(100% - 64px)",margin:"32px",display:"flex",justifyContent:"center",alignItems:"flex-end",flexDirection:"row-reverse",pointerEvents:"all"})),g=a.style("div",()=>({position:"absolute",top:"0px",right:"0px",width:"calc(100% - 64px)",margin:"8px 32px",display:"flex",justifyContent:"flex-end",alignItems:"flex-end",pointerEvents:"all"})),p=a.style("div",()=>({position:"absolute",left:"0px",top:"0px",display:"flex",justifyContent:"flex-start",alignItems:"flex-start",pointerEvents:"all"})),E=a.style("div",()=>({color:a.colors.WHITE,background:"rgba(0, 0, 0, 0.5)",border:"2px solid "+a.colors.WHITE,padding:"32px",fontSize:"24px",borderRadius:"8px",textAlign:"center",minWidth:"161px",cursor:"pointer",pointerEvents:"all","&:hover":{filter:"brightness(120%)"},"&:active":{filter:"brightness(80%)"}})),f=a.style("div",()=>({pointerEvents:"all",color:a.colors.WHITE,background:"rgba(0, 0, 0, 0.5)",border:"2px solid "+a.colors.WHITE,padding:"8px",fontSize:"16px",borderRadius:"8px",cursor:"pointer","&:hover":{filter:"brightness(120%)"},"&:active":{filter:"brightness(80%)"},marginLeft:"8px"}));t.default=e=>{let t=r.getCurrentBattle(),a=l.getUiInterface().appState.battle,w=r.getIsPaused(),[C,y]=A.useState(null);return d.useBattleSubscription(r.getCurrentBattle(),c.BattleEvent.onTurnStarted,e=>{y(e)}),d.useBattleSubscription(r.getCurrentBattle(),c.BattleEvent.onTurnEnded,()=>{y(null)}),i.h(h,{id:"battle-section-root"},i.h(m,{id:"ch-info-cards-ctr"},t.allies.map((e,t)=>i.h(n.default,{bCh:e,isSelected:a.characterIndexSelected===t&&w,characterIndex:t,key:e.ch.name,id:"ch-info-card-"+e.ch.name}))),i.h(g,{id:"enemy-info-cards-ctr"},t.enemies.map((e,t)=>i.h(s.default,{bCh:e,isSelected:!1,characterIndex:t,key:e.ch.name,id:"ch-info-card-"+e.ch.name}))),i.h(p,null,i.h(E,{onClick:()=>{r.getIsPaused()?o.unpause():o.pause()}},w?"Unpause":"Pause"),i.h(f,null,"Options")),t.allies.map((e,t)=>i.h(u.default,{bCh:e,battleIndex:t,isEnemy:!1})),t.enemies.map((e,t)=>i.h(u.default,{bCh:e,battleIndex:t,isEnemy:!0})))}})),define("view/components/BattleSection/index",["require","exports","view/components/BattleSection/BattleSection"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,Object.defineProperty(t,"default",{enumerable:!0,get:function(){return __importDefault(r).default}})})),define("view/icons/Talk",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:e.color,stroke:e.color},r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M488 348.78h-70.24l-15.1 87.44-48.78-87.44H169v-50h190v-157h129zm-145-273v207H158.13l-48.79 87.47-15.11-87.47H24v-207zM136.724 215.324c0-10.139-12.257-15.214-19.425-8.046-7.168 7.168-2.093 19.426 8.046 19.426 6.285 0 11.38-5.095 11.38-11.38zm60.945 0c-.068-10.12-12.32-15.122-19.452-7.943-7.131 7.18-2.047 19.399 8.073 19.399 6.314 0 11.422-5.141 11.38-11.456zm60.945 0c0-10.139-12.257-15.214-19.425-8.046-7.169 7.168-2.093 19.426 8.046 19.426 6.284 0 11.38-5.095 11.38-11.38z",fill:e.color,"fill-opacity":"1"})))})),define("view/components/CutsceneSection",["require","exports","preact","view/style","preact/hooks","view/elements/AnimDiv","view/ui","model/store","controller/events","view/icons/Talk"],(function(e,t,r,i,a,o,n,s,l,c){"use strict";var A;Object.defineProperty(t,"__esModule",{value:!0}),t.PortraitActiveState=void 0,o=__importDefault(o),c=__importDefault(c),function(e){e.Active="active",e.Inactive="inactive",e.Passive="passive",e.Invisible="invisible"}(A=t.PortraitActiveState||(t.PortraitActiveState={}));let d=(e,t,r)=>{let i="";return i=t?`${e}_portrait_${t}`:e+"_portrait","right"===r&&(i+="_f"),i},u=i.style("div",e=>({position:e.fixed?"fixed":"absolute",top:"0px",left:"0px",overflow:"hidden",width:"100%",height:"100%"})),h=i.style("div",e=>({position:"absolute",top:"0px",width:"100%",height:e.visible?"12.5%":"0%",transition:"height 0.25s",background:i.colors.DARKGREY})),m=i.style("div",e=>({position:"absolute",bottom:"0px",width:"100%",height:e.visible?"17%":"0%",transition:"height 0.25s",background:i.colors.DARKGREY})),g=i.style("div",e=>{let t="1",r="0%",i="0%",a="left 0.2s, right 0.2s, bottom 0.2s";return e.activeState===A.Active?r="3.125%":e.activeState===A.Inactive?(r="-3.125%",i="-3.125%",t="0.5"):e.activeState===A.Passive?i="-3.125%":e.activeState===A.Invisible&&(t="0",r="-50%",a=""),{position:"absolute",minWidth:"50%",minHeight:"50%",transition:a,left:"left"===e.align?r:"",right:"right"===e.align?r:"",bottom:i,opacity:t}}),p=i.style("div",e=>{let t="40%",r="left"===e.align?"29%":`calc(100% - 29% - ${t})`,i="25%",a="height 0.1s, left 0.1s, transform 0.1s ease-in";return"center"===e.align?(r="25%",t="50%",i="50%",a="height 0.1s, left 0.25s, transform 0.1s ease-in"):"center-low"===e.align?(i="35%",r="25%",t="50%"):e.visible?"center-high"===e.align&&(r="25%",t="50%",i="80%",a="height 0.1s, left 0.25s, transform 0.1s ease-in"):a="",{position:"absolute",width:t,height:i,left:r,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",transition:a,bottom:"0px",transform:e.visible?"scale(1)":"scale(0)"}}),E=i.style("div",e=>{let t="unset",r="unset",a="solid",o="solid",n="2.5%",s="2.5%",l=i.colors.WHITE,c=i.colors.WHITE;return"right"===e.align?(n="5%",t="48px",a="16px solid",c=i.colors.BLUE):"left"===e.align&&(s="5%",r="48px",o="16px solid",l=i.colors.BLUE),{border:"2px solid "+i.colors.WHITE,background:e.isNarration?i.colors.DARKBLUE:i.colors.BLACK,boxShadow:"0px 0px 24px 16px rgba(0, 0, 0, 0.75)",boxSizing:"border-box",width:"100%",padding:"2.5%",color:i.colors.WHITE,fontSize:"24px",textAlign:"left",transition:"height 0.1s, width 0.1s",borderBottomLeftRadius:t,borderBottomRightRadius:r,borderLeft:a,borderRight:o,paddingLeft:n,paddingRight:s,borderRightColor:l,borderLeftColor:c,borderTopColor:i.colors.BLUE,position:"relative"}}),f=i.style("div",e=>({position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",transform:e.visible?"translateY(0%)":"translateY(55%)",transition:"transform 0.15s"})),w=i.style("div",e=>({width:e.visible?"100%":"0px",display:"flex",marginBottom:"16px",opacity:e.visible?"100%":"0%",justifyContent:"right"===e.align?"flex-end":"flex-start"})),C=i.style("div",e=>({color:i.colors.BLACK,padding:"8px",fontSize:"18px",fontWeight:"bold",boxShadow:"0px 0px 24px 16px rgba(0, 0, 0, 0.75)",background:i.colors.WHITE,border:"2px solid black",borderTopRightRadius:"8px",borderTopLeftRadius:"8px",minWidth:"64px",textAlign:"center",textTransform:"uppercase"})),y=i.keyframes({"0%":{transform:"translateY(-2px)"},"30%":{transform:"translateY(2px)"},"100%":{transform:"translateY(-2px)"}}),b=i.style("div",e=>({position:"absolute",animation:y+" 750ms linear infinite",bottom:"calc(50% - 12px)",right:e.flipped?"unset":"-42px",left:e.flipped?"-42px":"unset",width:"24px"}));t.default=()=>{let[e,t]=a.useState(!1),y=a.useRef(null);a.useEffect(()=>{t(!0)},[]),a.useEffect(()=>{let e=null==y?void 0:y.current;e&&(e.style.transition="",e.style.opacity="0",e.innerHTML=T.text,setTimeout(()=>{e.style.transition="opacity 0.15s linear",e.style.opacity="1"},25))});let T=n.getUiInterface().appState.cutscene,S="center";[s.CutsceneSpeaker.Left].includes(T.speaker)||[s.CutsceneSpeaker.Center].includes(T.speaker)?S="right":[s.CutsceneSpeaker.Right].includes(T.speaker)?S="left":T.portraitCenter&&(S="center-low"),!1===T.showBars&&(S="center-high");let v=[s.CutsceneSpeaker.None].includes(T.speaker);return r.h(u,{id:"cutscene-root",fixed:!!n.getUiInterface().appState.arcadeGame.path,onClick:()=>{let t=l.getCurrentKeyHandler();t&&e&&T.visible&&t({key:"x"})}},r.h(h,{visible:T.visible&&T.showBars&&e}),r.h(m,{visible:T.visible&&T.showBars&&e}),r.h(f,{visible:T.visible&&e},""!==T.portraitLeft?r.h(g,{align:"left",activeState:T.speaker===s.CutsceneSpeaker.Left?A.Active:A.Inactive},r.h(o.default,{animName:d(T.portraitLeft,T.portraitLeftEmotion,"right")})):null,""!==T.portraitCenter?r.h(g,{align:"left",activeState:T.speaker===s.CutsceneSpeaker.Center?A.Active:A.Invisible},r.h(o.default,{animName:d(T.portraitCenter,T.portraitCenterEmotion,"right")})):null,""!==T.portraitRight?r.h(g,{align:"right",activeState:T.speaker===s.CutsceneSpeaker.Right?A.Active:A.Inactive},r.h(o.default,{animName:d(T.portraitRight,T.portraitRightEmotion,"left")})):null),r.h(p,{visible:e&&T.text.length>0,align:S},r.h(w,{visible:!!T.speakerName,align:T.speaker===s.CutsceneSpeaker.Right?"right":"left"},r.h(C,null,T.speakerName)),r.h(E,{id:"cutscene-textbox",align:S,isNarration:!T.speakerName&&!v},r.h("span",{style:{opacity:"0",transition:"unset"},ref:y}),r.h(b,{flipped:T.speaker===s.CutsceneSpeaker.Right},r.h(c.default,{color:i.colors.WHITE})))))}})),define("view/components/CutsceneChoicesSection",["require","exports","preact","preact/hooks","model/scene","view/style","model/generics","view/ui","view/elements/VerticalMenu","controller/ui-actions"],(function(e,t,r,i,a,o,n,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),l=__importDefault(l);let A=o.style("div",{position:"absolute",top:"0px",overflow:"hidden",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",background:"rgba(0, 0, 0, 0.5)"});t.default=()=>{let e=s.getUiInterface().appState.choices,[t,o]=i.useState(!1);return i.useEffect(()=>{t||o(!0)},[t]),r.h(A,null,r.h(l.default,{title:"Choose",width:"50%",open:!0,style:{transition:"transform 0.15s",transform:t?"scaleX(1)":"scaleX(0)"},items:e.choiceTexts.map((e,t)=>({label:r.h("div",null,r.h("span",null,e)),value:t})),onItemClickSound:"menu_select",onItemClick:e=>{let t=n.getCurrentScene();t.storage.lastChoiceIndex=e,a.sceneStopWaitingUntil(t),c.hideChoices()}}))}})),define("view/elements/Card",["require","exports","preact","view/style"],(function(e,t,r,i){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.CardSize=void 0,function(e){e[e.SMALL=0]="SMALL",e[e.MEDIUM=1]="MEDIUM",e[e.LARGE=2]="LARGE"}(a=t.CardSize||(t.CardSize={}));let o={[a.SMALL]:{width:"256px",height:"256px"},[a.MEDIUM]:{width:"352px",height:"352px"},[a.LARGE]:{width:"512px",height:"512px"}},n=i.style("div",e=>Object.assign({background:i.colors.DARKGREY,border:"2px solid "+i.colors.WHITE,borderBottom:"2px solid "+i.colors.GREY},o[e.size]));t.default=e=>r.h(n,{size:e.size,style:e.style},e.children)})),define("view/components/AppSettings/AppSettings",["require","exports","model/generics","model/sound","preact","view/elements/Card","view/hooks","view/style"],(function(e,t,r,i,a,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=__importStar(o);let l=s.style("div",()=>({color:s.colors.WHITE,fontSize:"16px",margin:"8px",width:"100%","& > h2":{fontSize:"24px",textDecoration:"underline",margin:"0px",textAlign:"center",width:"100%"},"& > div":{margin:"8px",display:"flex",flexDirection:"column",alignItems:"flex-start",width:"calc(100% - 32px)"}}));t.default=()=>{let e=n.useReRender(),t=(t,i)=>{r.setVolume(i,t),e()},s=e=>{setTimeout(()=>i.playSoundName("aggro_alert",r.getVolume(e)),25)},c=r.getVolume(i.SoundType.NORMAL),A=r.getVolume(i.SoundType.MUSIC);return a.h(o.default,{size:o.CardSize.MEDIUM,style:{borderTopWidth:"0px"}},a.h(l,null,a.h("h2",null,"Volume Settings"),a.h("div",null,a.h("label",{name:"generic-volume"},"Effects Volume - ",Math.floor(100*c),"%"),a.h("input",{style:{width:"100%"},value:c,type:"range",step:.05,min:0,max:1,onChange:e=>{var r,a;return t(null!==(a=null===(r=null==e?void 0:e.target)||void 0===r?void 0:r.value)&&void 0!==a?a:1,i.SoundType.NORMAL)},onMouseUp:()=>s(i.SoundType.NORMAL)})),a.h("div",null,a.h("label",{name:"music-volume"},"Music Volume - ",Math.floor(100*A),"%"),a.h("input",{style:{width:"100%"},value:A,type:"range",step:.05,min:0,max:1,onChange:e=>{var r,a;return t(null!==(a=null===(r=null==e?void 0:e.target)||void 0===r?void 0:r.value)&&void 0!==a?a:1,i.SoundType.MUSIC)},onMouseUp:()=>s(i.SoundType.MUSIC)}))))}})),define("view/components/AppSettings/index",["require","exports","view/components/AppSettings/AppSettings"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,Object.defineProperty(t,"default",{enumerable:!0,get:function(){return __importDefault(r).default}})})),define("controller/save-management",["require","exports","model/generics","model/sound"],(function(e,t,r,i){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.loadSettingsFromLS=t.saveSettingsToLS=t.setCurrentSettings=t.getCurrentSettings=void 0,function(e){e[e.SETTINGS=0]="SETTINGS",e[e.SAVE=1]="SAVE"}(a||(a={})),t.getCurrentSettings=()=>({volumeLevels:{[i.SoundType.NORMAL]:r.getVolume(i.SoundType.NORMAL),[i.SoundType.MUSIC]:r.getVolume(i.SoundType.MUSIC)}}),t.setCurrentSettings=e=>{r.setVolume(i.SoundType.NORMAL,e.volumeLevels[i.SoundType.NORMAL]),r.setVolume(i.SoundType.MUSIC,e.volumeLevels[i.SoundType.MUSIC])};let o=(e,t)=>"regem_ludos__"+(e===a.SETTINGS?"settings":"save_"+(t||""));t.saveSettingsToLS=e=>{try{localStorage.setItem(o(a.SETTINGS),JSON.stringify(e))}catch(e){throw console.error(e),Error("Unable to saveSettingsToLS.")}},t.loadSettingsFromLS=()=>{var e,t,r,n;let s=localStorage.getItem(o(a.SETTINGS));if(!s)throw Error("Unable to loadSettingsFromLS, no settings were found.");try{let a=JSON.parse(s);return{volumeLevels:{[i.SoundType.NORMAL]:null!==(t=null===(e=null==a?void 0:a.volumeLevels)||void 0===e?void 0:e[i.SoundType.NORMAL])&&void 0!==t?t:1,[i.SoundType.MUSIC]:null!==(n=null===(r=null==a?void 0:a.volumeLevels)||void 0===r?void 0:r[i.SoundType.MUSIC])&&void 0!==n?n:1}}}catch(e){throw console.error(e),Error("Unable to loadSettingsFromLS, malformed JSON in localStorage item.")}}})),define("view/components/SettingsSection",["require","exports","preact","view/style","view/elements/Button","view/components/AppSettings/index","controller/ui-actions","model/store","view/elements/Card","controller/loop","controller/events","lib/preact-hooks","controller/save-management"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=__importStar(a),o=__importDefault(o),l=__importStar(l);let h=i.style("div",{position:"absolute",top:"0px",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",background:"rgba(0, 0, 0, 0.5)"}),m=i.style("div",{display:"flex",justifyContent:"space-between",flexDirection:"column",alignItems:"center",height:"100%"}),g=i.style("div",{display:"flex",justifyContent:"center",padding:"8px"});t.default=()=>(d.useEffect(()=>()=>{let e=u.getCurrentSettings();u.saveSettingsToLS(e)},[]),r.h(r.Fragment,null,r.h(h,null,r.h(l.default,{size:l.CardSize.LARGE},r.h(m,{id:"settings-spacer"},r.h(o.default,null),r.h(g,null,r.h(a.default,{type:a.ButtonType.PRIMARY,onClick:()=>{n.showSection(s.AppSection.Debug,!0),A.popKeyHandler(),c.unpause()}},"Close")))))))})),define("view/elements/DialogBox",["require","exports","preact","view/style","view/elements/Button","view/hooks","controller/events","lib/preact-hooks","utils","preact/hooks"],(function(e,t,r,i,a,o,n,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=__importStar(a);let A=i.style("div",()=>({opacity:"0",transition:"opacity 100ms",background:"rgba(0, 0, 0, 0.5)",position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"2",pointerEvents:"all"})),d=i.style("div",e=>{var t;return{margin:"4px",padding:"4px",minWidth:"50%",maxWidth:null!==(t=e.maxWidth)&&void 0!==t?t:"90%",border:"2px solid "+i.colors.BLUE,background:i.colors.BGGREY,color:i.colors.WHITE,transform:"scale(0)",transition:"transform 100ms"}}),u=i.style("div",()=>({margin:"8px",padding:"8px",fontSize:"32px",textTransform:"uppercase",borderBottom:"2px solid "+i.colors.BLUE})),h=i.style("div",()=>({margin:"8px",padding:"8px",fontSize:"16px"})),m=i.style("div",()=>({display:"flex",justifyContent:"flex-end",padding:"8px",margin:"8px"}));t.default=e=>{var t;let[i,g]=s.useState(!1),p=()=>{let t=document.getElementById("dialog-container");t&&(t.style.transform="scale(0)");let r=document.getElementById("dialog-wrapper");r&&(r.style.opacity="0"),l.timeoutPromise(100).then(()=>{e.onClose()})};return o.useInputEventStack(e=>{n.isConfirmKey(e.key)&&(g(!0),l.timeoutPromise(100).then(()=>{p()}))}),c.useEffect(()=>{let e=document.getElementById("dialog-container");e&&(e.style.transform="scale(1)");let t=document.getElementById("dialog-wrapper");t&&(t.style.opacity="1")},[]),r.h(A,{id:"dialog-wrapper"},r.h(d,{id:"dialog-container",maxWidth:e.maxWidth},r.h(u,null,e.title),r.h(h,null,e.children),r.h(m,null,r.h(a.default,{type:a.ButtonType.PRIMARY,style:{marginRight:"1rem"},onClick:p,showCursor:!0,active:i},null!==(t=e.closeButtonLabel)&&void 0!==t?t:"Close"))))}})),define("view/components/ModalSection/ModalSection",["require","exports","preact","controller/ui-actions","model/store","view/elements/DialogBox","view/style","view/ui","controller/scene-commands"],(function(e,t,r,i,a,o,n,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);let c=n.style("div",()=>({width:"100%",display:"flex",justifyContent:"center"})),A=e=>r.h(o.default,{title:"Tutorial",onClose:e.onClose,maxWidth:"500px"},r.h("p",null,"Welcome to the Regem Ludos Battle System!"),r.h("p",null,"To attack an enemy, wait for the action bar to fill up, then click the character portrait or press the action button corresponding to that character."),r.h(c,null,r.h("img",{src:"res/img/tutorial-ada-waiting-ready.png",alt:"tutorial-image"}))),d=e=>r.h(o.default,{title:"Tutorial",onClose:e.onClose,maxWidth:"500px"},r.h("p",null,"At any time you can pause the game via the button in the top left or by pressing ",r.h("b",null,"Spacebar.")),r.h("p",null,"When the game is paused, you can see information about the currently selected actions for your party.")),u=e=>r.h(o.default,{title:"Tutorial",onClose:e.onClose,maxWidth:"500px"},r.h("p",null,"Ada currently has a ",r.h("b",null,"Swing")," action equipped with two attacks."),r.h(c,null,r.h("img",{src:"res/img/tutorial-training-swing.png",alt:"tutorial-image"})),r.h("p",null,"A ",r.h("b",null,"Swing")," action will cause Ada to jump to the character targeted by the yellow sword symbol and initiate an attack. This consumes the first attack."),r.h("p",null,"For a short time afterwards, the action button can be pressed again to consume the next attack."),r.h("p",null,"This can be repeated until all the attacks specified on the action are consumed.")),h=e=>r.h(o.default,{title:"Tutorial",onClose:e.onClose,maxWidth:"500px"},r.h("p",null,"STAGGER is an important mechanic in the Regem Ludos Arcade Battle System!"),r.h("p",null,"Below the HP bar of each character is a STAG gauge. This gage fills when the character is hit."),r.h("p",null,"If this gauge completely fills, then the character is STAGGERED"),r.h("p",null,"While STAGGERED, a character takes double damage and their action bar is reset.")),m=e=>r.h(o.default,{title:"Tutorial",onClose:e.onClose,maxWidth:"500px"},r.h("p",null,"Characters equipped with a ",r.h("b",null,"Swing")," action can only target characters in the first row. Only when characters in the first row have been defeated can a character target the back rows with a ",r.h("b",null,"Swing")," ","action."),r.h("p",null,"However, a character equipped with a ",r.h("b",null,"Shoot")," action can target any character in the battle."),r.h("p",null,"Characters with a ",r.h("b",null,"Shoot")," action will target the character indicated by the spinning, red circle. ",r.h("b",null,"Shoot")," actions typically inflict less damage, but are especially useful at chipping down enemies on the back line.")),g=e=>r.h(o.default,{title:"Tutorial",onClose:e.onClose,maxWidth:"500px"},r.h("p",null,"Some enemies are able to use a ",r.h("b",null,"Magic")," action. These abilities are usually very powerful and may also have a wide range of effects."),r.h("p",null,"To use a ",r.h("b",null,"Magic")," action, however, a character must prepare the action first by entering into a CASTING state. During this state, a character cannot act until the CASTING is complete, or that character is interrupted. When a character is interrupted, the spell is stopped the character's action timer is reset."),r.h("p",null,"While a character is CASTING, they can be interrupted by taking damage from a character with a ",r.h("b",null," Swing ")," action. A ",r.h("b",null,"Ranged")," action does not interrupt a cast unless it otherwise states on the action description."));t.default=()=>{var e;let t=null===(e=s.getUiInterface())||void 0===e?void 0:e.appState.modal,o=null==t?void 0:t.onClose,n=()=>{i.hideSection(a.AppSection.Modal),l.playSound("menu_close"),o&&o()},c=null;switch(null==t?void 0:t.section){case a.ModalSection.TUTORIAL_ATTACK:c=r.h(A,{onClose:n});break;case a.ModalSection.TUTORIAL_PAUSING:c=r.h(d,{onClose:n});break;case a.ModalSection.TUTORIAL_ATTACK_AMOUNTS:c=r.h(u,{onClose:n});break;case a.ModalSection.TUTORIAL_STAGGER:c=r.h(h,{onClose:n});break;case a.ModalSection.TUTORIAL_BACK_ROW:c=r.h(m,{onClose:n});break;case a.ModalSection.TUTORIAL_MAGIC:c=r.h(g,{onClose:n});break;default:c=r.h("div",null,"No Modal Specified.")}return c}})),define("view/components/ModalSection/index",["require","exports","view/components/ModalSection/ModalSection"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,Object.defineProperty(t,"default",{enumerable:!0,get:function(){return __importDefault(r).default}})})),define("view/ui",["require","exports","preact","preact/hooks","view/style","model/generics","model/store","controller/ui-actions","model/canvas","view/components/Debug","view/components/BattleConclusion","view/components/BattleSection/index","view/components/CutsceneSection","view/components/ArcadeCabinet/index","view/components/CutsceneChoicesSection","view/components/SettingsSection","view/components/ModalSection/index"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u,h,m,g,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mountUi=t.renderUi=t.getUiInterface=t.uiInterface=void 0,c=__importDefault(c),A=__importDefault(A),d=__importDefault(d),u=__importDefault(u),h=__importDefault(h),m=__importDefault(m),g=__importDefault(g),p=__importDefault(p);let E=a.style("div",{position:"relative",height:"100%"}),f=a.style("div",()=>({position:"absolute",left:"0",top:"0",background:"black",opacity:"0.3",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:a.colors.WHITE,fontSize:"24px",width:"100%",height:"100%",pointerEvents:"none"})),w=a.style("div",()=>({marginBottom:"256px"}));t.uiInterface=null,t.getUiInterface=()=>t.uiInterface;let C=()=>{let[e,a]=i.useState(!1),[C,y]=i.useReducer(s.appReducer,n.AppStateInitial);i.useEffect(()=>{t.uiInterface=window.uiInterface={appState:C,render:()=>{a(!e)},dispatch:y}});let b=l.getDrawScale();return r.h("div",{style:{position:"absolute",top:"0px",width:l.SCREEN_WIDTH*(b>2?2:b),height:l.SCREEN_HEIGHT*(b>2?2:b)}},r.h(E,{id:"ui-sections"},o.getIsPaused()?r.h(f,null,r.h(w,null,"PAUSED")):null,C.sections.map((e,t)=>{switch(e){case n.AppSection.BattleVictory:return r.h(A.default,{key:t,isVictory:!0});case n.AppSection.BattleDefeated:return r.h(A.default,{key:t,isVictory:!1});case n.AppSection.BattleUI:return r.h(d.default,{key:t});case n.AppSection.Cutscene:return r.h(u.default,{key:t});case n.AppSection.ArcadeCabinet:return r.h(h.default,{key:t,game:C.arcadeGame.path});case n.AppSection.Choices:return r.h(m.default,{key:t});case n.AppSection.Settings:return r.h(g.default,{key:t});case n.AppSection.Modal:return r.h(p.default,{key:t});case n.AppSection.Debug:return r.h(c.default,null);default:return r.h("div",null)}})))};t.renderUi=()=>{t.uiInterface&&t.uiInterface.render()},t.mountUi=()=>{let e=document.getElementById("ui");if(e){let t=document.getElementById("canvas-area-parent");if(t){let e=2;t.style["max-width"]=l.SCREEN_WIDTH*e,t.style["max-height"]=l.SCREEN_HEIGHT*e}r.render(r.h(C,null),e)}}})),define("controller/scene-management",["require","exports","lib/rpgscript","model/scene","model/generics","model/room","controller/scene-commands","model/player","db/characters/index"],(function(e,t,r,i,a,o,n,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSceneCommands=t.createAndCallScript=t.callScript=t.invokeTrigger=t.evalCondition=t.updateScene=void 0,n=__importStar(n),t.updateScene=e=>{if(e.currentScript&&!i.sceneIsWaiting(e)){let r=null;for(;null!==(r=e.currentScript.getNextCommand());)if(t.evalCondition(e,r.conditional)){let t=i.sceneGetCommands(e)[r.type];if(!t)throw Error(`Script runtime error.  No command exists with name '${r.type}'`);if(t(...null==r?void 0:r.args.map(t=>{if("string"==typeof t&&"["===t[0]&&"]"===t[t.length-1]){let r=t.slice(1,-1);return e.storage[r]}return t})))break}if(null===r)if(e.onScriptCompleted&&e.onScriptCompleted(),e.scriptStack.length){let r=e.scriptStack.shift();if(r){let{script:i,onScriptCompleted:a,args:o}=r;e.currentScript=i,e.onScriptCompleted=a;for(let t=0;t<10;t++){let r=o[t],i="ARG"+t;void 0===r?delete e.storage[i]:n.setStorage(i,r)}setTimeout(()=>t.updateScene(e))}}else e.currentScript=null,e.currentTrigger=null}},t.evalCondition=(e,i,n)=>{var c,A,d;if(!0===i)return!0;if("object"==typeof i){let{type:u,args:h}=i,m=r.formatArgs(h).map(t=>{if("object"==typeof t)return t;if("scene"===t&&e.currentTrigger)return e.storage[e.currentTrigger.name];if("string"==typeof t&&t.indexOf(".")>-1){let[r,i]=t.split(".");return"storage"===r?e.storage[i]:e.storage[r]?e.storage[r][i]:(console.error("No storage in scene called:",r),!1)}return t});if("is"===u)return l.getIfExists(m[0])?!!o.roomGetCharacterByName(a.getCurrentRoom(),m[0]):!!e.storage[m[0]];if("isnot"===u)return"object"==typeof m[0]?!t.evalCondition(e,m[0]):l.getIfExists(m[0])?!o.roomGetCharacterByName(a.getCurrentRoom(),m[0]):!e.storage[m[0]];if("gt"===u)return m[0]>m[1];if("lt"===u)return m[0]<m[1];if("eq"===u)return m[0]===m[1]||e.storage[m[0]]===m[1]||e.storage[m[1]]===m[0]||e.storage[m[0]]===e.storage[m[1]];if("any"===u){for(let r=0;r<m.length;r++)if(t.evalCondition(e,m[r]))return!0;return!1}if("all"===u){for(let r=0;r<m.length;r++)if(!t.evalCondition(e,m[r]))return!1;return!0}if("as"===u)return console.error('conditional "as" is not defined for this scene.'),!1;if("once"===u){let t=null!==(c=m[0])&&void 0!==c?c:(null===(A=e.currentScript||e.currentTrigger)||void 0===A?void 0:A.name)+"-once";return!e.storageOnceKeys[t]&&(n||(e.storageOnceKeys[t]=!0),!0)}if("with"===u){let e=null!==(d=m[0])&&void 0!==d?d:"",t=a.getCurrentPlayer();return e&&s.playerHasItem(t,e)}return!1}},t.invokeTrigger=(e,i,a,o)=>{let n=r.getTrigger(i);if(!e.currentScript&&n)for(let r=0;r<n.scriptCalls.length;r++){let i=n.scriptCalls[r];if(i.type===a){if(e.currentTrigger=n,t.evalCondition(e,i.condition,o))return async()=>{await t.callScript(e,i.scriptName),e.storage[n.name]=!0};e.currentTrigger=null}}return null},t.callScript=async(e,i,...a)=>new Promise(o=>{let s=r.getScript(i);if(s.reset(),e.currentScript){let t=[];for(let r=0;r<10;r++){let i=e.storage["ARG"+r];void 0!==i&&t.push(i)}e.scriptStack.unshift({script:e.currentScript,onScriptCompleted:e.onScriptCompleted,args:t})}e.currentScript=s,e.onScriptCompleted=o;for(let t=0;t<10;t++){let r=a[t],i="ARG"+t;void 0===r?delete e.storage[i]:n.setStorage(i,r)}t.updateScene(e)}),t.createAndCallScript=(e,i)=>new Promise(a=>{let o=r.parseSingleScript(i="@tmp\n"+i,e).tmp;o.reset(),e.currentScript&&e.scriptStack.unshift({script:e.currentScript,onScriptCompleted:function(){},args:[]}),e.currentScript=o,e.onScriptCompleted=a,t.updateScene(e)}),t.getSceneCommands=e=>n.default})),define("model/scene",["require","exports","controller/scene-management","model/generics"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sceneGetCommands=t.sceneHasCommand=t.sceneStopWaitingUntil=t.sceneIsWaiting=t.initScene=t.sceneCreate=void 0,t.sceneCreate=()=>{let e={storage:{quest_tutorial_active:"true"},storageOnce:{},storageOnceKeys:{},commands:{},currentScript:null,currentTrigger:null,scriptStack:[],isWaitingForInput:!1,isWaitingForTime:!1,isWaitingForAnimation:!1,waitTimeoutId:-1};return Object.assign(e.commands,r.getSceneCommands(e)),e},t.initScene=()=>{i.setCurrentScene(t.sceneCreate())},t.sceneIsWaiting=e=>e.isWaitingForInput||e.isWaitingForTime||e.isWaitingForAnimation,t.sceneStopWaitingUntil=e=>{e.isWaitingForTime=!1},t.sceneHasCommand=(e,r)=>!!t.sceneGetCommands(e)[r],t.sceneGetCommands=e=>e.commands})),define("lib/rpgscript",["require","exports","model/scene"],(function(e,t,r){"use strict";function i(e){return function(e){return e.map(e=>'"'===e[0]||"'"===e[0]?e.slice(1,-1):e)}(e).map(e=>isNaN(parseFloat(e))?e:parseFloat(e))}var a;Object.defineProperty(t,"__esModule",{value:!0}),t.getTrigger=t.getScript=t.parseSingleScript=t.parseRPGScript=t.loadRPGScript=t.ScriptParser=t.Script=t.Trigger=t.TriggerType=t.formatArgs=void 0,t.formatArgs=i,(a=t.TriggerType||(t.TriggerType={})).STEP="step",a.STEP_FIRST="step-first",a.ACTION="action";class o{constructor(e,t,r){this.name=e,this.filename=t,this.lineNum=r,this.scriptCalls=[]}addScriptCall(e,t,r){this.scriptCalls.push({type:e,condition:t,scriptName:r})}}t.Trigger=o;class n{constructor(e,t,r){this.name=e,this.filename=t,this.lineNum=r,this.blocks=[],this.soundNameStorage={},this.currentBlockIndex=0,this.currentCommandIndex=0,this.sounds=0,this.soundsPerCharacter={}}reset(){this.currentBlockIndex=0,this.currentCommandIndex=0}isValid(e){if(!e)return!0;for(let t=0;t<this.blocks.length;t++){let i=this.blocks[t];for(let t=0;t<i.commands.length;t++){let a=i.commands[t];if(!r.sceneHasCommand(e,a.type))return`Error in script "${this.name}"\n\nNo command exists with name "${a.type}" and args "${a.args.join(",")}" `}}return!0}getNextCommand(){let e=this.blocks[this.currentBlockIndex];if(e){let t=e.commands[this.currentCommandIndex];return t?(this.currentCommandIndex++,{args:t.args,type:t.type,conditional:e.conditional}):(this.currentBlockIndex++,this.currentCommandIndex=0,this.getNextCommand())}return null}getNextDialog(e){this.soundsPerCharacter[e]?this.soundsPerCharacter[e]++:this.soundsPerCharacter[e]=1;let t=this.soundsPerCharacter[e];t<10&&(t="0"+t);let r=this.name+"/"+this.sounds,i=this.name+"/"+e+"-"+t;return this.sounds++,{soundNameIndexed:r,soundNameCh:i}}addCommandBlock(){let e={conditional:!0,commands:[]};return this.blocks.push(e),e}}t.Script=n;class s{constructor(e){this.name=e,this.soundsToLoad=[]}throwParsingError(e,t,r){throw console.error(`{Line ${t}} Script parsing error ${this.name}: ${e} CONTENTS [\n"${r}"\n]`),Error("Parsing error")}parseCommand(e,t,r){let a=(e=e.trim()).indexOf("("),o=e.lastIndexOf(")");if(e.match(/^(\w)+:/)&&r)return this.createDialogCommand(e,r);-1!==a&&0!==a||this.throwParsingError("Invalid command, no name provided",t,e),-1!==o&&0!==o||this.throwParsingError("Invalid command, no end parens",t,e);let n=e.substr(a+1,e.length-(a+1)-(e.length-o));return n=function(e,t){let r=[],i="",a="",o=!1;for(let t=0;t<e.length;t++){let n=e[t];a?n===a&&(a="",o=!1):'"'===n||"'"===n?(a=n,o=!0):"("===n?o=!0:")"===n&&(o=!1),o||","!==e[t]?i+=n:(r.push(i),i="")}return i&&r.push(i),r}(n).map(e=>e.trim()),n.forEach(r=>{"'"===r[0]?"'"!==r[r.length-1]&&this.throwParsingError('Invalid command, unterminated single quote "\'"',t,e):'"'===r[0]&&'"'!==r[r.length-1]&&this.throwParsingError("Invalid command, unterminated double quote '\"'",t,e)}),{type:e.substr(0,a),args:i(n)}}parseConditional(e,t,r){let{type:i,args:a}=this.parseCommand(e,t,r);return["is","isnot","gt","lt","eq","any","all","as","once","with"].includes(i)||this.throwParsingError(`Invalid conditional, no type named "${i}"`,t,e),{type:i,args:a.map(e=>"string"==typeof e&&-1!==e.indexOf("(")?this.parseCommand(e,t,r):e)}}combineConditionals(e,t,r){return{type:r,args:[e,t]}}getConditionalFromLine(e,t,r){let i=function(e,t){let r="",i=!1;for(let t=0;t<e.length;t++){let a=e[t];if(r?a===r&&(r="",i=!1):'"'===a||"'"===a?(r=a,i=!0):"("===a?i=!0:")"===a&&(i=!1),!i&&"?"===e[t])return t}return-1}(e);if(i>-1){let a=e.indexOf(":");-1===a&&this.throwParsingError("Invalid conditional, no ending ':'",t,e);let o=e.slice(i+1,a);return{conditional:this.parseConditional(o.trim(),t,r),endIndex:a+1}}return{conditional:!0,endIndex:0}}createDialogCommand(e,t){let[r,a]=e.split(":"),o="playDialogue";"_"===r[0]&&(r=r.slice(1),o="playDialogueInterruptable"),a=a.trim();let{soundNameCh:n,soundNameIndexed:s}=t.getNextDialog(r);return this.soundsToLoad.push({soundNameCh:n,soundNameIndexed:s}),{type:o,args:i([r,a,n])}}parse(e,t){let r={},i={},a=!1,s=!1,l=!1,c=null,A=null,d=null,u=null,h=e.split("\n");if(h.forEach((e,h)=>{if(h+=1,0===(e=e.trim()).length)return;if("/"===e[0]&&"/"===e[1])return;let m=e[0];if("{"===m)a=!0;else if("}"===m)a=!1,c=null;else if("@"!==m||a){if("$"===m)l=!0,s=!1,A&&(c=A.addCommandBlock(),c.conditional=!0,c.commands.push({type:"showChoices",args:[]}));else if("#"===m)s=!0,l=!1,u=e.substr(1),d=new o(e.substr(1),this.name,h),((e,t)=>{r[e]=t})(e.substr(1),d);else if("+"===m||a){let t=e.substr(a?0:1);if(A){let{conditional:r,endIndex:i}=this.getConditionalFromLine(t,h,A);if("object"==typeof r){if("{"===t[i])return a=!0,c=A.addCommandBlock(),void(c.conditional=r);if(i===t.length)return c=A.addCommandBlock(),void(c.conditional=r)}let o=null;a?(null===c&&(c=A.addCommandBlock(),c.conditional=r),o=c):(o=c=A.addCommandBlock(),o.conditional=r);let n=t.substr(i),s=/(.*): "(.*)"/.test(n);if("?"===n[0])return void this.throwParsingError("Invalid conditional, did you forget '+' at the start?",h,e);if("+"===n[0])n=n.slice(1);else if(s){let e=this.createDialogCommand(n,A);return void o.commands.push(e)}let{type:l,args:d}=this.parseCommand(n,h,A);o.commands.push({type:l,args:d})}}else if(l){let t=e.indexOf(":");-1===t&&this.throwParsingError("Invalid choice definition, no colon '\"'",h,e);let r=e.substr(0,t),i=e.substr(t+1);c&&c.commands[0].args.push({text:r,target:i})}else if(s){let t=e.indexOf(",");-1===t&&this.throwParsingError("Invalid trigger script call, invalid number of arguments",h,e);let r=e.substr(0,t),i=e.substr(t+1),a=null;"item"===r&&(a={type:"with",args:[i.slice(0,i.indexOf(","))]},i=i.slice(i.indexOf(",")+1));let{conditional:o,endIndex:n}=this.getConditionalFromLine(i,h,A),s=o;a&&(s=this.combineConditionals(a,o,"and"));let l=i.substr(n);"this"===l&&u&&(l=u),d&&d.addScriptCall(r,s,l)}else if(">"===m)c&&c.commands.push({type:"callScript",args:[e.substr(1)]});else if(s=!1,A){if("?"===e[0])return void this.throwParsingError("Invalid conditional, did you forget '+' at the start?",h,e);let t=A.addCommandBlock(),r=this.createDialogCommand(e,A);t.commands.push(r)}}else{let r=e.substr(1,e.length-1);if("this"===r&&(r=u||""),0===r.length&&this.throwParsingError("Invalid script name",h,e),A){let e=A.isValid(t);!0!==e&&this.throwParsingError(e,h-1,"")}A=new n(r,this.name,h),i[r]=A,s=!1,l=!1}}),A){let e=A.isValid(t);!0!==e&&this.throwParsingError(e,h.length,h[h.length-1])}return{triggers:r,scripts:i}}}t.ScriptParser=s;let l=window.scripts={},c=window.triggers={};t.loadRPGScript=async(e,r)=>{let i=`res/rpgscript/${e}.rpgscript`,a=await(await fetch(i)).text();t.parseRPGScript(a,r)},t.parseRPGScript=(e,t)=>{let r=new s(e),{triggers:i,scripts:a}=r.parse(e,t);Object.assign(l,a),Object.assign(c,i)},t.parseSingleScript=(e,t)=>{let r=new s(e),{scripts:i}=r.parse(e,t);return i},t.getScript=e=>{let t=l[e];if(!t)throw Error("Cannot get script with name "+e);return t},t.getTrigger=e=>{let t=c[e];if(!t)throw Error("Cannot get trigger with name "+e);return t}})),define("model/overworld",["require","exports","model/room","model/utility","db/overworlds"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overworldHide=t.overworldShow=t.overworldCharacterCreate=t.overworldEnableTriggers=t.overworldDisableTriggers=t.createOverworldFromTemplate=void 0,t.createOverworldFromTemplate=e=>{let t=a.getRoom(e.roomName);if(!t)return console.error("Cannot initiate overworld, no room exists with name: ",e.roomName),null;let r={room:t,visible:!0,triggersEnabled:!0,characterCollisionEnabled:!0,playerIsCollidingWithInteractable:!1,loadTriggerName:e.loadTriggerName,timers:[],stepTimer:new i.Timer(50)};return r.stepTimer.start(),r},t.overworldDisableTriggers=e=>{e.triggersEnabled=!1},t.overworldEnableTriggers=e=>{e.triggersEnabled=!0},t.overworldCharacterCreate=e=>({ch:e.ch}),t.overworldShow=e=>{e.visible=!0,r.roomShow(e.room)},t.overworldHide=e=>{e.visible=!1,r.roomHide(e.room)}})),define("map/battle1",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"battle1.json"}},height:16,infinite:!1,layers:[{data:[29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29],height:16,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:16,x:0,y:0},{draworder:"topdown",id:5,name:"Objects",objects:[{gid:83,height:32,id:28,name:"MarkerAlly0",rotation:0,type:"",visible:!0,width:32,x:96,y:128},{gid:83,height:32,id:29,name:"MarkerAlly1",rotation:0,type:"",visible:!0,width:32,x:144,y:176},{gid:83,height:32,id:30,name:"MarkerAlly2",rotation:0,type:"",visible:!0,width:32,x:64,y:160},{gid:83,height:32,id:31,name:"MarkerAlly3",rotation:0,type:"",visible:!0,width:32,x:112,y:208},{gid:83,height:32,id:36,name:"MarkerEnemy2",rotation:0,type:"",visible:!0,width:32,x:160,y:64},{gid:83,height:32,id:37,name:"MarkerEnemy3",rotation:0,type:"",visible:!0,width:32,x:208,y:112},{gid:83,height:32,id:38,name:"MarkerEnemy1",rotation:0,type:"",visible:!0,width:32,x:176,y:144},{gid:83,height:32,id:39,name:"MarkerEnemy0",rotation:0,type:"",visible:!0,width:32,x:128,y:96},{gid:81,height:64,id:40,name:"",rotation:0,type:"",visible:!0,width:32,x:52,y:28},{gid:81,height:64,id:41,name:"",rotation:0,type:"",visible:!0,width:32,x:236,y:208},{gid:81,height:64,id:42,name:"",rotation:0,type:"",visible:!0,width:32,x:36,y:80}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:7,nextobjectid:43,orientation:"isometric",renderorder:"left-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:4,firstgid:1,image:"../../res/battle-terrain1.png",imageheight:128,imagewidth:128,margin:0,name:"battle-terrain1",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:8,firstgid:17,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{firstgid:81,source:"../../res/props-dynamic.tiled-sheet.tsx"}],tilewidth:32,type:"map",version:1.4,width:16}),define("map/battle-tut1",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"battle-tut1.json"}},height:16,infinite:!1,layers:[{data:[185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,145,145,145,145,145,145,145,145,145,145,145,145,145,145,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185],height:16,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:16,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:354,height:32,id:50,name:"MarkerAlly0",rotation:0,type:"",visible:!0,width:32,x:104,y:132},{gid:354,height:32,id:51,name:"MarkerAlly5",rotation:0,type:"",visible:!0,width:32,x:104,y:228},{gid:354,height:32,id:52,name:"MarkerAlly2",rotation:0,type:"",visible:!0,width:32,x:80,y:156},{gid:354,height:32,id:53,name:"MarkerAlly1",rotation:0,type:"",visible:!0,width:32,x:152,y:180},{gid:355,height:32,id:54,name:"MarkerEnemy2",rotation:0,type:"",visible:!0,width:32,x:160,y:76},{gid:355,height:32,id:55,name:"MarkerEnemy4",rotation:0,type:"",visible:!0,width:32,x:184,y:52},{gid:355,height:32,id:56,name:"MarkerEnemy1",rotation:0,type:"",visible:!0,width:32,x:184,y:148},{gid:355,height:32,id:57,name:"MarkerEnemy0",rotation:0,type:"",visible:!0,width:32,x:136,y:100},{gid:354,height:32,id:58,name:"MarkerAlly3",rotation:0,type:"",visible:!0,width:32,x:128,y:204},{gid:354,height:32,id:59,name:"MarkerAlly4",rotation:0,type:"",visible:!0,width:32,x:56,y:180},{gid:355,height:32,id:60,name:"MarkerEnemy3",rotation:0,type:"",visible:!0,width:32,x:208,y:124},{gid:355,height:32,id:61,name:"MarkerEnemy5",rotation:0,type:"",visible:!0,width:32,x:232,y:100}],offsetx:-4,offsety:4,opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:6,nextobjectid:62,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:337,image:"../../res/walls128.png",imageheight:256,imagewidth:256,margin:0,name:"walls128",spacing:0,tilecount:16,tileheight:128,tilewidth:32},{firstgid:353,source:"../../../sadelica-new-world/scratch/props-dynamic.tsx"}],tilewidth:32,type:"map",version:1.4,width:16}),define("map/test",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"test.json"}},height:64,infinite:!1,layers:[{data:[129,2,2,11,2,2,2,13,2,2,2,11,2,2,2,2,2,5,5,5,5,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,12,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,8,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,6,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,6,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,10,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,5,5,5,5,5,5,5,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129],height:64,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:64,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:193,height:32,id:1,name:"Skye",rotation:0,type:"",visible:!0,width:32,x:288,y:112}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:4,nextobjectid:3,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:2,firstgid:193,image:"../../res/control.png",imageheight:64,imagewidth:64,margin:0,name:"control",spacing:0,tilecount:4,tileheight:32,tilewidth:32},{columns:16,firstgid:197,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32}],tilewidth:32,type:"map",version:1.4,width:64}),define("map/test2",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"test2.json"}},height:40,infinite:!1,layers:[{data:[130,2,2,11,2,2,2,13,2,2,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,2,2,2,2,129,129,129,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,12,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,1,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,1,130,130,17,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,8,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,6,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,6,130,130,130,130,130,130,130,130,16,16,16,16,16,16,16,16,16,16,16,16,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,1,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,1,215,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,10,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,4,215,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,1,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,4,215,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,1,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,4,215,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,4,215,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,209,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,1,2,2,2,2,2,2,15,15,2,2,2,2,2,2,2,3,129,129,129,4,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,16,130,130,16,129,129,129,129,129,129,1,129,129,129,4,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,16,130,130,16,129,129,129,129,129,129,1,129,129,129,4,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,1,129,129,129,129,129,16,130,130,16,129,129,129,129,129,129,1,129,129,129,4,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,1,2,2,2,2,2,16,15,15,16,2,2,2,2,2,2,3,129,129,129,4,130,130,130,130,130,130,130,130,16,129,129,129,129,129,129,129,129,129,129,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,2,2,2,2,2,2,16,129,129,129,129,129,129,129,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,16,2,2,2,5,5,5,5,5,5,5,5,5,5,5,2,2,3,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,130,17,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,130,17,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,130,235,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,17,130,130,130,17,17,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,130,17,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,130,130,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,17,130,130,130,130,17,130,130,130,130,1,129,129,129,4,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,17,17,17,17,130,130,130,130,1,129,129,129,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,129,129,129,129,17,2,2,2,3,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129],height:40,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:40,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:193,height:32,id:3,name:"Skye",rotation:0,type:"",visible:!0,width:32,x:44,y:248},{gid:194,height:32,id:5,name:"MarkerWalkTest1",rotation:0,type:"",visible:!0,width:32,x:176,y:48},{gid:194,height:32,id:6,name:"MarkerWalkTest2",rotation:0,type:"",visible:!0,width:32,x:76,y:276},{gid:195,height:32,id:9,name:"#floor1-vendingPanel",rotation:0,type:"",visible:!0,width:32,x:28,y:268},{height:44,id:11,name:"#floor1-vendingPanel",rotation:0,type:"",visible:!0,width:140,x:12,y:152},{gid:193,height:32,id:18,name:"Roger",rotation:0,type:"",visible:!0,width:32,x:97.25,y:35.75},{gid:194,height:32,id:19,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:496,y:340},{height:64,id:20,name:"#floor1-openDoorA",rotation:0,type:"",visible:!0,width:32,x:428,y:280},{height:60,id:21,name:"#floor1-openDoorB",rotation:0,type:"",visible:!0,width:32,x:428,y:220},{gid:194,height:32,id:22,name:"markerDoorA",rotation:0,type:"",visible:!0,width:32,x:436,y:308},{gid:194,height:32,id:23,name:"markerDoorB",rotation:0,type:"",visible:!0,width:32,x:436,y:244},{height:164,id:26,name:"#floor1-closeDoorsAB",rotation:0,type:"",visible:!0,width:64,x:412,y:200},{gid:194,height:32,id:29,name:"MarkerSpawnAtMarker",rotation:0,type:"",visible:!0,width:32,x:440.375,y:41.125},{gid:193,height:32,id:33,name:"Rho",rotation:0,type:"",visible:!0,width:32,x:465.75,y:103.75},{gid:193,height:32,id:35,name:"Sigma",rotation:0,type:"",visible:!0,width:32,x:554.5,y:37},{height:0,id:44,name:"",rotation:0,type:"",visible:!0,width:0,x:459.625,y:232.875},{height:0,id:45,name:"",rotation:0,type:"",visible:!0,width:0,x:473.25,y:218.75},{height:0,id:46,name:"",rotation:0,type:"",visible:!0,width:0,x:476.75,y:221.75},{height:0,id:47,name:"",rotation:0,type:"",visible:!0,width:0,x:459.375,y:220.625},{height:100,id:52,name:"#rho-look-area",rotation:0,type:"",visible:!0,width:100,x:415.875,y:55.125},{gid:194,height:32,id:53,name:"MarkerWalkA",rotation:0,type:"",visible:!0,width:32,x:104,y:136},{gid:194,height:32,id:54,name:"MarkerWalkB",rotation:0,type:"",visible:!0,width:32,x:40,y:136},{gid:194,height:32,id:55,name:"MarkerWalkC",rotation:0,type:"",visible:!0,width:32,x:44,y:40},{gid:193,height:32,id:56,name:"TutRobotRoamer1",properties:[{name:"encounterName",type:"string",value:"ENCOUNTER_TUT1"},{name:"overworldAi",type:"string",value:"ROAM_WALK_RIGHT_LEFT"}],rotation:0,type:"",visible:!0,width:32,x:460,y:448},{gid:193,height:32,id:57,name:"TutRobotRoamer1",properties:[{name:"encounterName",type:"string",value:"ENCOUNTER_TUT1"},{name:"overworldAi",type:"string",value:"ROAM_WALK_RIGHTUP_LEFTDOWN"}],rotation:0,type:"",visible:!0,width:32,x:352,y:512},{gid:193,height:32,id:58,name:"TutRobotRoamer1",properties:[{name:"encounterName",type:"string",value:"ENCOUNTER_TUT1"},{name:"overworldAi",type:"string",value:"ROAM_WALK_UP_DOWN"}],rotation:0,type:"",visible:!0,width:32,x:320,y:448},{gid:193,height:32,id:59,name:"TutRobotRoamer1",properties:[{name:"encounterName",type:"string",value:"ENCOUNTER_TUT1"},{name:"overworldAi",type:"string",value:"ROAM_WALK_RIGHTDOWN_LEFTUP"}],rotation:0,type:"",visible:!0,width:32,x:444,y:540},{gid:193,height:32,id:60,name:"TutRobotRoamer1",properties:[{name:"encounterName",type:"string",value:"ENCOUNTER_TUT1"},{name:"overworldAi",type:"string",value:"ROAM_WALK_RIGHT_LEFT"}],rotation:0,type:"",visible:!0,width:32,x:440,y:376},{gid:194,height:32,id:61,name:"MarkerKioskStats",rotation:0,type:"",visible:!0,width:32,x:172,y:476},{height:56,id:62,name:"#utils-kiosk-stats-activate",rotation:0,type:"",visible:!0,width:56,x:136,y:440},{height:80,id:63,name:"#utils-kiosk-stats-deactivate",rotation:0,type:"",visible:!0,width:80,x:124,y:428}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:6,nextobjectid:64,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32}],tilewidth:32,type:"map",version:1.4,width:40}),define("map/floor1-outside",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"floor1-outside.json"}},height:32,infinite:!1,layers:[{data:[337,338,337,338,337,337,337,337,337,337,337,337,358,358,357,357,357,357,357,357,357,358,358,337,338,33,33,33,132,17,16,16,338,337,338,337,338,337,337,337,337,337,337,337,358,357,357,357,357,357,357,357,357,357,358,337,337,338,33,132,132,17,16,16,337,338,337,338,337,337,337,337,337,337,337,337,358,358,357,357,357,357,357,357,357,358,358,337,338,33,33,33,132,17,16,16,338,337,338,337,338,337,337,337,337,337,337,337,358,357,357,357,357,357,357,357,357,357,358,337,337,338,33,132,132,17,16,16,337,338,337,338,337,338,337,337,337,337,337,337,358,358,357,357,357,357,357,357,357,358,358,337,338,33,33,33,132,17,16,16,338,337,338,337,338,337,338,337,337,337,337,358,358,357,357,357,357,357,357,357,357,357,358,337,337,338,33,132,132,16,16,16,337,338,337,338,337,338,337,337,337,337,337,358,358,358,357,357,357,357,357,357,357,358,358,337,338,33,33,33,132,16,16,16,338,337,338,337,338,337,338,337,337,337,337,358,358,357,357,357,357,357,357,357,357,357,358,337,337,338,33,132,132,16,16,16,337,338,337,338,337,338,337,338,337,337,337,337,358,358,357,357,357,357,357,357,357,358,358,337,338,33,33,33,132,16,16,16,338,337,338,337,338,337,338,337,338,337,337,337,358,357,358,357,358,357,358,357,358,357,358,337,337,338,33,132,132,16,16,16,337,338,337,338,337,338,337,338,337,338,337,358,358,358,358,358,358,358,358,358,358,358,358,337,338,33,33,33,132,16,16,16,338,337,338,337,338,337,338,337,338,337,337,338,339,339,338,339,339,338,339,339,338,339,339,337,337,338,33,132,132,16,16,16,131,33,131,33,131,33,131,33,131,33,131,131,131,131,131,131,131,131,131,131,131,131,131,33,131,33,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,136,136,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,136,136,131,131,131,131,131,131,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,131,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,133,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,131,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,131,131,131,131,131,131,131,131,131,132,132,132,132,132,132,132,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,132,132,132,132,132,132,132,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131],height:32,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:194,height:32,id:19,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:240,y:240},{gid:356,height:108,id:45,name:"",rotation:0,type:"front",visible:!0,width:177,x:200,y:104},{gid:353,height:64,id:46,name:"",rotation:0,type:"",visible:!0,width:32,x:396,y:248},{gid:353,height:64,id:47,name:"",rotation:0,type:"",visible:!0,width:32,x:44,y:248},{gid:194,height:32,id:48,name:"MarkerConscience",rotation:0,type:"",visible:!0,width:32,x:360,y:248},{gid:194,height:32,id:49,name:"MarkerConscience2",rotation:0,type:"",visible:!0,width:32,x:268,y:240}],offsetx:4,offsety:4,opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:6,nextobjectid:50,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:337,image:"../../res/walls128.png",imageheight:256,imagewidth:256,margin:0,name:"walls128",spacing:0,tilecount:16,tileheight:128,tilewidth:32},{firstgid:353,source:"../../res/props-dynamic.tiled-sheet.tsx"},{columns:8,firstgid:357,image:"../../res/walls256.png",imageheight:256,imagewidth:256,margin:0,name:"walls256",spacing:0,tilecount:8,tileheight:256,tilewidth:32}],tilewidth:32,type:"map",version:1.4,width:32}),define("map/floor1-atrium",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"floor1-atrium.json"}},height:32,infinite:!1,layers:[{data:[129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,338,338,16,138,138,16,338,338,129,16,140,140,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,338,338,138,138,338,338,129,129,16,140,140,16,129,129,16,16,16,338,338,338,338,338,5,5,5,5,5,5,5,5,5,5,5,338,339,339,338,16,16,16,16,15,15,16,16,129,16,212,212,338,130,130,130,338,137,227,137,227,137,227,137,227,137,137,140,140,140,140,140,140,1,140,140,140,140,140,1,129,16,137,137,338,7,7,9,338,137,137,137,137,137,137,137,137,137,137,140,140,140,140,140,140,1,140,140,140,140,140,1,129,4,137,137,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,1,129,4,137,137,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,1,129,4,137,137,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,1,129,4,137,137,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,1,129,4,137,137,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,1,140,140,140,140,140,1,129,4,213,137,137,137,137,137,137,137,137,137,137,140,140,137,137,137,137,137,137,137,137,137,137,1,2,2,2,2,2,3,129,4,213,137,137,137,137,137,137,137,137,137,137,140,140,137,137,137,137,137,137,137,137,137,137,1,129,129,129,129,129,129,129,1,16,137,137,137,137,137,137,137,137,2,2,140,140,140,140,140,2,2,138,138,138,138,2,3,129,129,129,129,129,129,129,1,16,137,137,137,137,137,137,137,137,16,16,140,140,140,140,4,16,16,138,138,138,138,16,16,129,129,129,129,129,129,129,1,215,139,139,137,137,137,137,137,137,216,4,140,140,140,140,4,216,138,138,138,138,138,216,1,129,129,129,129,129,129,129,1,221,139,139,137,137,137,137,137,137,137,4,140,140,140,140,4,226,138,138,138,138,138,138,1,129,129,129,129,129,129,129,1,215,139,139,137,137,137,137,137,137,137,4,140,140,140,140,4,226,138,138,138,138,138,138,1,129,129,129,129,129,129,129,1,221,139,139,137,137,230,137,230,137,137,4,140,140,140,140,4,138,138,138,138,138,138,138,1,129,129,129,129,129,129,129,1,215,137,137,137,137,229,137,229,137,137,4,140,140,140,140,4,138,138,138,138,138,138,138,1,129,129,129,129,129,129,129,1,2,2,2,137,137,137,137,137,137,137,4,140,140,140,140,4,138,138,138,138,138,138,138,1,129,129,129,129,129,129,129,129,129,129,16,226,137,137,137,137,137,137,4,140,140,140,140,4,233,234,234,234,234,234,234,1,129,129,129,129,129,129,129,129,129,129,16,137,137,137,137,137,137,137,4,140,140,140,140,4,138,138,138,138,138,138,138,1,129,129,129,129,129,129,129,129,129,129,16,226,137,230,137,230,137,137,4,140,140,140,140,4,138,138,138,138,138,138,138,1,129,129,129,129,129,129,129,129,129,129,16,137,137,229,137,229,137,137,4,140,140,140,140,4,138,138,138,138,138,138,138,1,129,129,129,129,129,129,129,129,129,129,16,137,137,137,137,137,137,137,1,140,140,140,140,4,138,138,138,138,138,138,138,1,129,129,129,129,129,129,33,129,129,129,16,2,2,2,2,2,2,2,3,140,140,140,140,4,2,2,2,2,2,2,2,3,129,129,129,129,129,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,339,339,339,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,129,129,129,129,129,129,129,129,129,129,33,140,140,140,339,339,339,140,140,140,140,33,33,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,33,140,140,140,140,140,140,140,140,140,140,33,33,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,140,140,129,129,33,33,33,33,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,33,129,129,129,129,140,140,140,140,129,33,33,33,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,338,339,339,338,339,339,338,339,339,338,339,339,338,129,129,129,129,129,129,129,129,129],height:32,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:194,height:32,id:19,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:432,y:108},{gid:200,height:32,id:42,name:"MarkerDoorEntrance",rotation:0,type:"",visible:!0,width:32,x:236,y:368},{gid:198,height:32,id:43,name:"MarkerDoorBowling",rotation:0,type:"",visible:!0,width:32,x:356,y:64},{gid:193,height:32,id:45,name:"Floor1AtriumDeskEmployee",rotation:0,type:"",visible:!0,width:32,x:348,y:352},{gid:194,height:32,id:46,name:"MarkerDeskEmployeeWalk",rotation:0,type:"",visible:!0,width:32,x:340,y:256},{height:48,id:47,name:"#floor1-atrium-desk-employee",rotation:0,type:"",visible:!0,width:40,x:320,y:296},{gid:194,height:32,id:48,name:"MarkerDoorElevatorA",rotation:0,type:"",visible:!0,width:32,x:84,y:72},{gid:194,height:32,id:49,name:"MarkerElevatorInside",rotation:0,type:"",visible:!0,width:32,x:96,y:56},{gid:193,height:32,id:50,name:"Floor1AtriumElevatorEmployee",rotation:0,type:"",visible:!0,width:32,x:120,y:92},{gid:194,height:32,id:51,name:"MarkerElevatorOutside",rotation:0,type:"",visible:!0,width:32,x:96,y:96},{gid:194,height:32,id:52,name:"MarkerNPCWalkA",rotation:0,type:"",visible:!0,width:32,x:348,y:144},{gid:194,height:32,id:53,name:"MarkerNPCWalkB",rotation:0,type:"",visible:!0,width:32,x:312,y:84},{gid:194,height:32,id:54,name:"MarkerNPCWalkC",rotation:0,type:"",visible:!0,width:32,x:84,y:144},{gid:194,height:32,id:55,name:"MarkerNPCWalkD",rotation:0,type:"",visible:!0,width:32,x:76,y:92},{gid:193,height:32,id:56,name:"Floor1AtriumTicTacToeGirl",rotation:0,type:"",visible:!0,width:32,x:52,y:208},{gid:195,height:32,id:57,name:"#floor1-atrium-TicTacToeMachine",rotation:0,type:"",visible:!0,width:32,x:60,y:252},{gid:195,height:32,id:58,name:"#floor1-atrium-TicTacToeMachine",rotation:0,type:"",visible:!0,width:32,x:60,y:284},{height:16,id:59,name:"#floor1-atrium-elevator-employee",rotation:0,type:"",visible:!0,width:52,x:72,y:76},{gid:198,height:32,id:60,name:"MarkerDoorTut",rotation:0,type:"",visible:!0,width:32,x:460,y:68},{gid:193,height:32,id:61,name:"Floor1AtriumEmployeeJason",rotation:0,type:"",visible:!0,width:32,x:436,y:72},{gid:194,height:32,id:62,name:"MarkerJasonB",rotation:0,type:"",visible:!0,width:32,x:488,y:108},{gid:194,height:32,id:63,name:"MarkerJasonA",rotation:0,type:"",visible:!0,width:32,x:436,y:72},{gid:194,height:32,id:64,name:"MarkerDoorTutTile",rotation:0,type:"",visible:!0,width:32,x:456,y:40}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:6,nextobjectid:65,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:337,image:"../../res/walls128.png",imageheight:256,imagewidth:256,margin:0,name:"walls128",spacing:0,tilecount:16,tileheight:128,tilewidth:32},{firstgid:353,source:"../../res/props-dynamic.tiled-sheet.tsx"}],tilewidth:32,type:"map",version:1.4,width:32}),define("map/floor1-bowlingalley",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"floor1-bowlingalley.json"}},height:16,infinite:!1,layers:[{data:[16,2,2,2,2,2,2,2,2,2,2,2,2,2,2,16,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,16,17,17,17,17,17,17,17,17,17,17,17,130,130,130,17],height:16,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:16,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:194,height:32,id:19,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:204,y:156},{gid:200,height:32,id:43,name:"MarkerDoorA",rotation:0,type:"",visible:!0,width:32,x:216,y:228}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:6,nextobjectid:44,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32}],tilewidth:32,type:"map",version:1.4,width:16}),define("map/floor1-tut-entrance",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"floor1-tut-entrance.json"}},height:32,infinite:!1,layers:[{data:[129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,143,143,143,143,143,143,143,143,143,143,143,143,143,143,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,143,140,140,140,143,143,143,143,143,140,140,140,140,140,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,143,140,140,140,143,144,144,144,143,140,140,140,140,140,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,143,140,140,140,143,144,144,144,143,140,140,140,140,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,143,140,140,140,143,144,144,144,143,140,140,140,140,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,143,140,140,140,143,143,143,143,143,140,140,140,140,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,143,140,140,140,140,140,140,140,140,140,140,140,140,129,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,143,140,140,140,140,140,140,140,140,140,140,140,140,140,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,143,140,140,140,140,140,140,140,140,140,140,140,140,140,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,4,143,140,140,140,140,140,140,140,140,140,140,140,140,140,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,16,16,16,16,16,16,140,140,16,16,16,16,16,16,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,16,140,140,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,16,140,140,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,16,15,15,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129],height:32,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:194,height:32,id:61,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:200,y:256},{gid:194,height:32,id:65,name:"MarkerVRLanding",rotation:0,type:"",visible:!0,width:32,x:204,y:204},{height:44,id:66,name:"#floor1-tut-entrance-vr-portal",rotation:0,type:"",visible:!0,width:44,x:176,y:176},{gid:200,height:32,id:68,name:"MarkerDoor",rotation:0,type:"",visible:!0,width:32,x:200,y:288},{gid:194,height:32,id:69,name:"MarkerJason1",rotation:0,type:"",visible:!0,width:32,x:188,y:240},{gid:194,height:32,id:70,name:"MarkerJason2",rotation:0,type:"",visible:!0,width:32,x:148,y:196},{gid:194,height:32,id:71,name:"MarkerAda",rotation:0,type:"",visible:!0,width:32,x:152,y:244},{height:44,id:72,name:"#floor1-tut-entrance-door",rotation:0,type:"",visible:!0,width:32,x:192,y:320},{gid:194,height:32,id:73,name:"MarkerDoorTutTile",rotation:0,type:"",visible:!0,width:32,x:196,y:360}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:6,nextobjectid:74,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:337,image:"../../res/walls128.png",imageheight:256,imagewidth:256,margin:0,name:"walls128",spacing:0,tilecount:16,tileheight:128,tilewidth:32},{firstgid:353,source:"../../res/props-dynamic.tiled-sheet.tsx"}],tilewidth:32,type:"map",version:1.4,width:32}),define("map/floor1-tut-vr1",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"floor1-tut-vr1.json"}},height:32,infinite:!1,layers:[{data:[129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,187,187,187,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,187,187,187,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,129,185,185,185,129,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,129,186,186,186,129,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,129,186,186,186,129,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,129,186,186,186,129,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,129,129,129,129,129,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129],height:32,id:1,name:"Tiles",offsetx:0,offsety:16,opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:194,height:32,id:61,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:180,y:208},{gid:194,height:32,id:65,name:"MarkerVRLanding",rotation:0,type:"",visible:!0,width:32,x:188,y:380},{height:44,id:66,name:"#floor1-tut-vr1-portal",rotation:0,type:"",visible:!0,width:44,x:160,y:352},{height:0,id:67,name:"",rotation:0,type:"",visible:!0,width:0,x:136,y:88},{gid:194,height:32,id:68,name:"MarkerJason1",rotation:0,type:"",visible:!0,width:32,x:188,y:156},{gid:194,height:32,id:69,name:"MarkerJason0",rotation:0,type:"",visible:!0,width:32,x:188,y:196},{gid:198,height:32,id:70,name:"MarkerFromVR2",rotation:0,type:"",visible:!0,width:32,x:192,y:176},{height:32,id:71,name:"#floor1-tut-vr1-to-vr2",rotation:0,type:"",visible:!0,width:48,x:160,y:128}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:6,nextobjectid:72,orientation:"isometric",properties:[{name:"BackgroundColor",type:"string",value:"#BCB7C5"}],renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:337,image:"../../res/walls128.png",imageheight:256,imagewidth:256,margin:0,name:"walls128",spacing:0,tilecount:16,tileheight:128,tilewidth:32},{firstgid:353,source:"../../res/props-dynamic.tiled-sheet.tsx"}],tilewidth:32,type:"map",version:1.4,width:32}),define("map/floor1-tut-vr2",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"floor1-tut-vr2.json"}},height:32,infinite:!1,layers:[{data:[129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,188,188,188,188,188,188,188,188,185,185,185,185,185,185,185,185,185,185,187,187,129,129,129,185,185,185,185,185,185,185,185,185,188,188,188,188,188,188,188,188,185,185,185,185,185,185,185,185,185,185,187,187,129,129,129,185,185,185,185,185,185,185,185,185,188,188,188,188,188,188,188,188,185,185,185,185,185,185,185,185,185,185,187,187,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,188,188,188,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,188,188,188,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,188,188,188,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,188,188,188,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,188,188,188,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,188,188,188,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,187,187,187,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,187,187,187,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129],height:32,id:1,name:"Tiles",offsetx:0,offsety:16,opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,236,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,237,0,0,0,0,0,0,0,0,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,19,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],height:32,id:6,name:"Tiles2",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:194,height:32,id:73,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:148,y:136},{height:0,id:74,name:"",rotation:0,type:"",visible:!0,width:0,x:168,y:104},{gid:194,height:32,id:75,name:"MarkerJason1",rotation:0,type:"",visible:!0,width:32,x:76,y:332},{gid:194,height:32,id:76,name:"MarkerJason0",rotation:0,type:"",visible:!0,width:32,x:108,y:356},{height:32,id:77,name:"#floor1-tut-vr2-to-vr1",rotation:0,type:"",visible:!0,width:40,x:100,y:432},{gid:200,height:32,id:78,name:"MarkerFromVR1",rotation:0,type:"",visible:!0,width:32,x:128,y:428},{gid:194,height:32,id:80,name:"MarkerGate2",rotation:0,type:"",visible:!0,width:32,x:204,y:92},{gid:194,height:32,id:81,name:"MarkerJason2",rotation:0,type:"",visible:!0,width:32,x:124,y:280},{gid:194,height:32,id:82,name:"MarkerJason3",rotation:0,type:"",visible:!0,width:32,x:124,y:160},{gid:194,height:32,id:83,name:"MarkerJason4",rotation:0,type:"",visible:!0,width:32,x:76,y:92},{gid:194,height:32,id:84,name:"MarkerJason5",rotation:0,type:"",visible:!0,width:32,x:168,y:88},{gid:194,height:32,id:85,name:"MarkerJason6",rotation:0,type:"",visible:!0,width:32,x:348,y:92},{gid:194,height:32,id:86,name:"MarkerJason7",rotation:0,type:"",visible:!0,width:32,x:428,y:44},{gid:194,height:32,id:87,name:"MarkerJason8",rotation:0,type:"",visible:!0,width:32,x:456,y:88},{gid:199,height:32,id:88,name:"MarkerFromVR3",rotation:0,type:"",visible:!0,width:32,x:508,y:112},{gid:194,height:32,id:90,name:"MarkerAda0",rotation:0,type:"",visible:!0,width:32,x:116,y:388},{gid:194,height:32,id:91,name:"MarkerRobot1",rotation:0,type:"",visible:!0,width:32,x:124,y:332},{gid:194,height:32,id:92,name:"MarkerGate1",rotation:0,type:"",visible:!0,width:32,x:124,y:252},{ellipse:!0,height:0,id:94,name:"",rotation:0,type:"",visible:!0,width:0,x:148,y:284},{ellipse:!0,height:0,id:95,name:"",rotation:0,type:"",visible:!0,width:0,x:136,y:268},{ellipse:!0,height:0,id:96,name:"",rotation:0,type:"",visible:!0,width:0,x:136,y:264},{height:28,id:97,name:"#floor1-tut-vr2-facedown-jason",rotation:0,type:"",visible:!0,width:52,x:96,y:196},{height:16,id:99,name:"#floor1-tut-vr2-battle2-area",rotation:0,type:"",visible:!0,width:52,x:96,y:164},{gid:194,height:32,id:100,name:"MarkerAda1",rotation:0,type:"",visible:!0,width:32,x:120,y:124},{gid:194,height:32,id:101,name:"MarkerRobot2",rotation:0,type:"",visible:!0,width:32,x:124,y:92}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:7,nextobjectid:102,orientation:"isometric",properties:[{name:"BackgroundColor",type:"string",value:"#BCB7C5"}],renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:337,image:"../../res/walls128.png",imageheight:256,imagewidth:256,margin:0,name:"walls128",spacing:0,tilecount:16,tileheight:128,tilewidth:32},{firstgid:353,source:"../../res/props-dynamic.tiled-sheet.tsx"}],tilewidth:32,type:"map",version:1.4,width:32}),define("map/floor1-tut-vr3",[],{compressionlevel:-1,editorsettings:{export:{format:"json"}},height:32,infinite:!1,layers:[{data:[129,129,185,185,185,185,185,185,188,188,185,129,129,185,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,185,187,187,129,129,129,129,129,129,129,129,185,185,185,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,185,187,187,129,129,129,129,129,129,129,129,185,185,185,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,185,187,187,129,129,129,129,129,129,129,129,185,185,185,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,129,129,129,129,129,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,129,129,129,129,129,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,129,129,129,129,129,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,129,129,129,129,129,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,185,185,185,129,129,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,185,185,185,129,129,188,188,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,185,185,185,185,129,188,188,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,129,129,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,129,129,129,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,188,188,185,185,185,185,185,185,188,188,185,185,185,185,185,185,185,185,185,129,129,129,129,185,185,185,185,185,185,185,185,185,188,188,185,185,185,185,185,185,188,188,185,185,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,188,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,188,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,188,188,129,129,129,129,129,129,129,129,129,129,129,129,188,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,188,188,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,188,188,188,185,185,185,185,185,129,129,129,187,187,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,188,188,188,185,185,185,185,185,129,129,129,187,187,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,129,129,129,187,187,185,185,185,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,185,185,185,185],height:32,id:1,name:"Tiles",offsetx:0,offsety:16,opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,19,0,0,0,0,0,0,19,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,19,0,0,0,0,0,0,19,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,236,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],height:32,id:6,name:"Tiles2",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:194,height:32,id:97,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:120,y:424}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:7,nextobjectid:98,orientation:"isometric",properties:[{name:"BackgroundColor",type:"string",value:"#BCB7C5"}],renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:337,image:"../../res/walls128.png",imageheight:256,imagewidth:256,margin:0,name:"walls128",spacing:0,tilecount:16,tileheight:128,tilewidth:32},{firstgid:353,source:"../../res/props-dynamic.tiled-sheet.tsx"}],tilewidth:32,type:"map",version:1.4,width:32}),define("map/floor2-south",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"floor2-south.json"}},height:32,infinite:!1,layers:[{data:[129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,140,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,140,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,2,2,2,2,2,2,2,2,2,2,129,129,16,140,140,16,129,129,2,2,2,2,2,2,2,2,2,2,2,129,129,1,220,234,220,234,220,234,220,233,216,16,129,129,16,140,140,16,129,129,16,218,233,218,233,218,233,218,233,216,1,129,129,1,139,139,139,139,139,139,139,139,139,16,129,129,16,140,140,16,129,129,16,139,139,139,139,139,139,139,139,139,1,129,129,1,139,139,139,139,139,139,139,139,139,16,129,129,16,140,140,16,129,129,16,139,139,139,139,139,139,139,139,139,1,129,129,1,139,139,139,139,139,139,139,140,140,16,129,129,16,140,140,16,129,129,16,139,139,139,139,139,139,139,139,139,1,129,129,1,139,139,139,139,139,139,139,16,16,16,13,2,16,15,15,16,2,11,16,16,16,139,139,139,139,139,139,139,1,129,129,1,140,140,140,140,140,140,140,140,140,226,223,225,140,140,140,140,226,223,225,140,140,140,140,140,140,140,140,140,1,129,129,1,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,1,129,129,1,16,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,1,129,129,140,1,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,1,129,129,140,14,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,1,16,129,129,140,14,140,140,140,140,140,140,140,338,140,140,140,140,140,140,140,140,338,140,140,140,140,140,140,140,140,140,14,140,129,129,140,3,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,14,140,129,129,1,213,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,1,16,129,129,1,231,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,1,129,129,1,213,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,16,16,16,129,129,1,16,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,16,129,129,129,129,1,16,140,140,140,140,140,338,338,338,338,338,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,16,129,129,129,129,1,16,140,140,140,140,140,338,130,130,130,338,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,16,129,129,129,129,1,16,140,140,140,140,140,338,7,7,9,338,33,16,16,2,2,2,2,2,2,2,2,2,2,2,2,16,129,129,129,129,1,16,16,140,140,140,140,140,140,140,140,140,140,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,16,16,140,140,140,140,140,140,140,140,140,140,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,16,140,140,140,140,140,140,140,140,140,140,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,16,140,140,140,140,140,140,140,140,140,140,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,16,140,140,140,140,140,140,140,140,140,140,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,16,140,140,140,140,140,140,140,140,140,140,1,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,16,2,2,2,2,2,2,2,2,2,2,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129],height:32,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:194,height:32,id:19,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:92,y:160},{gid:198,height:32,id:41,name:"MarkerDoorElevatorDown",rotation:0,type:"",visible:!0,width:32,x:152,y:424},{gid:198,height:32,id:43,name:"MarkerDoorCafeteria",rotation:0,type:"",visible:!0,width:32,x:248,y:200},{gid:199,height:32,id:45,name:"MarkerDoorB",rotation:0,type:"",visible:!0,width:32,x:476,y:260}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:6,nextobjectid:46,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:337,image:"../../res/walls128.png",imageheight:256,imagewidth:256,margin:0,name:"walls128",spacing:0,tilecount:16,tileheight:128,tilewidth:32}],tilewidth:32,type:"map",version:1.4,width:32}),define("map/floor2-cafeteria",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"floor2-cafeteria.json"}},height:32,infinite:!1,layers:[{data:[129,129,129,2,2,2,2,2,2,2,130,130,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,129,129,129,129,129,129,129,129,16,130,130,130,130,130,16,130,130,16,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,16,16,16,16,130,130,130,130,130,16,130,130,16,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,16,130,130,16,130,130,227,130,130,130,227,130,130,130,227,130,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,16,130,130,16,130,226,223,225,130,130,223,130,130,226,223,225,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,16,15,15,16,130,130,224,130,130,130,224,130,130,130,224,130,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,16,16,16,16,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,129,129,129,16,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,16,16,16,16,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,136,136,136,136,130,130,227,130,130,130,227,130,130,130,227,130,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,136,136,136,136,130,226,223,228,130,130,223,130,130,226,223,225,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,136,136,136,136,130,130,224,130,130,130,130,130,130,130,224,130,130,1,129,129,129,129,129,16,16,16,16,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,129,129,129,16,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,16,16,16,16,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,136,136,136,136,130,130,227,130,130,130,227,130,130,130,227,130,130,1,129,129,129,129,129,16,130,130,17,130,130,130,130,130,136,136,136,136,130,226,223,225,130,130,223,130,130,226,223,225,130,1,129,129,129,129,129,16,16,16,16,130,130,130,130,130,136,136,136,136,130,130,224,130,130,130,224,130,130,130,224,130,130,1,129,129,129,129,129,129,129,129,1,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,129,129,129,12,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,129,129,129,10,130,130,130,130,130,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,129,129,129,1,130,130,130,130,130,136,136,136,136,130,130,130,130,130,130,130,130,130,130,130,130,130,1,129,129,129,129,129,129,129,129,1,130,130,130,130,130,2,15,15,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,129,129,129,129,129,129,129,129,1,17,17,17,17,17,16,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,16,129,129,129,129,129,129,129,129,1,130,130,130,130,130,16,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,16,129,129,129,129,129,129,129,129,1,130,130,130,130,130,16,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,16,129,129,129,129,129,129,129,129,1,130,130,130,130,130,16,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,16,129,129,129,129,129,129,129,129,1,17,17,17,17,17,16,130,130,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,129,129,129,129,129],height:32,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:194,height:32,id:19,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:192,y:260},{gid:198,height:32,id:43,name:"MarkerDoorNorth",rotation:0,type:"",visible:!0,width:32,x:184,y:128},{gid:200,height:32,id:46,name:"MarkerDoorSouth",rotation:0,type:"",visible:!0,width:32,x:184,y:396}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:6,nextobjectid:47,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32}],tilewidth:32,type:"map",version:1.4,width:32}),define("map/floor2-north",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"floor2-north.json"}},height:32,infinite:!1,layers:[{data:[1,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,15,15,16,16,16,16,16,16,1,210,130,130,130,130,130,16,130,130,130,16,130,130,130,16,130,130,130,16,130,130,130,16,130,130,16,130,130,130,130,17,1,210,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,210,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,210,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,210,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,210,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,209,130,130,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,17,17,17,17,17,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,17,130,130,130,17,130,130,130,130,130,130,130,130,130,130,130,130,17,130,130,130,130,17,1,130,130,130,130,130,130,17,130,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,17,1,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,210,210,210,210,210,210,17,1,2,15,15,2,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,1,16,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,16,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,16,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,1,16,130,130,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,16,16,130,130,16,16,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129],height:32,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:194,height:32,id:19,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:104,y:356},{gid:198,height:32,id:43,name:"MarkerDoorPrepRoom",rotation:0,type:"",visible:!0,width:32,x:408,y:48},{gid:200,height:32,id:46,name:"MarkerDoorCafeteria",rotation:0,type:"",visible:!0,width:32,x:56,y:396}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:6,nextobjectid:47,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32}],tilewidth:32,type:"map",version:1.4,width:32}),define("map/floor2-preproom",[],{compressionlevel:-1,editorsettings:{export:{format:"json",target:"floor2-preproom.json"}},height:21,infinite:!1,layers:[{data:[17,16,17,16,17,16,17,16,17,16,17,16,17,16,17,16,17,16,17,16,17,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,16,16,16,16,16,16,16,337,337,337,337,337,337,337,16,16,16,16,16,16,16,17,16,16,16,16,16,16,338,338,338,338,338,338,338,16,16,16,16,16,16,17,16,16,16,16,16,212,212,338,130,130,130,130,130,338,216,216,16,16,16,16,16,17,16,16,16,16,138,138,338,7,7,9,7,7,338,138,138,16,16,16,16,17,16,16,16,16,16,138,138,138,138,138,138,138,138,138,138,138,16,16,16,16,16,17,16,16,16,16,138,138,138,138,138,138,138,138,138,138,138,16,16,16,16,17,16,16,138,138,138,138,138,138,138,138,138,138,138,138,138,138,16,16,16,16,16,17,16,138,138,138,138,138,138,138,138,138,138,138,138,138,138,16,16,16,16,17,16,16,138,138,138,138,138,138,138,138,138,138,138,138,138,138,16,16,16,16,16,17,16,138,138,138,235,138,138,138,138,138,138,138,138,138,138,16,16,16,16,17,16,16,138,138,138,138,138,138,138,138,138,138,138,138,138,138,16,16,16,16,16,17,16,138,138,138,138,138,138,138,138,138,138,138,138,138,138,16,16,16,16,17,16,16,138,138,138,138,138,138,138,138,138,138,138,138,138,138,16,16,16,16,16,17,16,16,16,16,138,138,138,138,138,138,138,138,138,138,138,16,16,16,16,17,16,16,16,16,16,138,138,138,138,138,138,138,138,138,138,138,16,16,16,16,16,17,16,16,16,16,138,138,138,16,138,138,16,138,138,138,138,16,16,16,16,17,16,17,16,17,16,16,16,16,16,15,15,16,16,16,16,16,16,17,16,17,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],height:21,id:1,name:"Tiles",opacity:1,type:"tilelayer",visible:!0,width:21,x:0,y:0},{draworder:"topdown",id:2,name:"Objects",objects:[{gid:194,height:32,id:19,name:"MarkerPlayer",rotation:0,type:"",visible:!0,width:32,x:164,y:180},{gid:200,height:32,id:47,name:"MarkerDoorNorthRoom",rotation:0,type:"",visible:!0,width:32,x:164,y:272},{gid:194,height:32,id:48,name:"MarkerKioskStats",rotation:0,type:"",visible:!0,width:32,x:92,y:204},{height:56,id:49,name:"#utils-kiosk-stats-activate",rotation:0,type:"",visible:!0,width:56,x:56,y:168},{height:80,id:50,name:"#utils-kiosk-stats-deactivate",rotation:0,type:"",visible:!0,width:80,x:44,y:156}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:6,nextobjectid:51,orientation:"isometric",renderorder:"right-down",tiledversion:"1.4.3",tileheight:16,tilesets:[{columns:16,firstgid:1,image:"../../res/walls.png",imageheight:512,imagewidth:512,margin:0,name:"walls",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:129,image:"../../res/floors.png",imageheight:256,imagewidth:256,margin:0,name:"floors",spacing:0,tilecount:64,tileheight:32,tilewidth:32},{columns:4,firstgid:193,image:"../../res/control.png",imageheight:128,imagewidth:128,margin:0,name:"control",spacing:0,tilecount:16,tileheight:32,tilewidth:32},{columns:16,firstgid:209,image:"../../res/props.png",imageheight:512,imagewidth:512,margin:0,name:"props",spacing:0,tilecount:128,tileheight:64,tilewidth:32},{columns:8,firstgid:337,image:"../../res/walls128.png",imageheight:256,imagewidth:256,margin:0,name:"walls128",spacing:0,tilecount:16,tileheight:128,tilewidth:32}],tilewidth:32,type:"map",version:1.4,width:21}),define("db/overworlds",["require","exports","model/room","view/style","map/battle1","map/battle-tut1","map/test","map/test2","map/floor1-outside","map/floor1-atrium","map/floor1-bowlingalley","map/floor1-tut-entrance","map/floor1-tut-vr1","map/floor1-tut-vr2","map/floor1-tut-vr3","map/floor2-south","map/floor2-cafeteria","map/floor2-north","map/floor2-preproom"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u,h,m,g,p,E,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.getIfExists=t.get=t.getRoom=t.loadRooms=void 0,a=__importStar(a),o=__importStar(o),n=__importStar(n),s=__importStar(s),l=__importStar(l),c=__importStar(c),A=__importStar(A),d=__importStar(d),u=__importStar(u),h=__importStar(h),m=__importStar(m),g=__importStar(g),p=__importStar(p),E=__importStar(E),f=__importStar(f);let w=window.rooms={},C={floor1Outside:l,floor1Atrium:c,floor1Bowling:A,floor1TutEntrance:d,floor1TutVR1:u,floor1TutVR2:h,floor1TutVR3:m,floor2South:g,floor2Cafeteria:p,floor2North:E,floor2PrepRoom:f},y=async(e,t)=>{w[e]=await r.createRoom(e,t)};t.loadRooms=async()=>{await y("battle1",a),await y("battleTut1",o),await y("test",n),await y("test2",s);for(let e in C)await y(e,C[e])},t.getRoom=e=>{let t=w[e];if(!t)throw Error(`No room exists with name: "${e}"`);return r.roomCopy(t)};let b=window.overworlds={};t.get=e=>{let t=b[e];if(!t)throw Error("No overworld exists with name: "+e);return Object.assign({},t)},t.getIfExists=e=>{let t=b[e];return t?Object.assign({},t):null},t.init=async()=>{await t.loadRooms(),b.TEST={roomName:"test",backgroundColor:"black"},b.TEST2={roomName:"test2",loadTriggerName:"floor1",backgroundColor:"black"};for(let e in C)b[e]={roomName:e,loadTriggerName:e,backgroundColor:"black"};b.floor1Outside.backgroundColor=i.colors.DARKBLUE,b.floor1TutVR1.backgroundColor=i.colors.DARKBLUE,b.floor1TutVR2.backgroundColor=i.colors.DARKBLUE,b.floor1TutVR3.backgroundColor=i.colors.DARKBLUE}})),define("model/particle-system",["require","exports","utils","view/draw","view/style","model/canvas","model/generics","model/particle"],(function(e,t,r,i,a,o,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBattleTransitionParticleSystem=t.ParticleSystem=void 0;class l{constructor(){this.particles=[],this.width=0,this.height=0,this.clearColor="",this.meta={},this.onParticleUpdate=()=>{}}updateDraw(){let e=o.getCanvas("outer").getContext("2d");this.clearColor&&i.drawRect(0,0,this.width,this.height,this.clearColor,!1,e);for(let t=0;t<this.particles.length;t++){let r=this.particles[t];this.onParticleUpdate(r),s.particleUpdate(r),i.drawParticle(r,r.x,r.y,1,e)}e.restore()}}t.ParticleSystem=l,t.createBattleTransitionParticleSystem=e=>{let t=o.getCanvas("outer"),i=new l,c=t.width,A=t.height;i.width=c,i.height=A,i.clearColor=`rgba(0, 0, 0, ${.05*n.getFrameMultiplier()})`;for(let e=0;e<1500;e++){let e=s.particleCreate();e.y=-Math.random()*A/2,e.x=Math.random()*c,e.vy=20+1.5*Math.random(),e.w=e.h=15+8*Math.random(),e.color=r.randInArr([a.colors.WHITE,a.colors.GREY]),e.timer.pause(),e.shape="rect",i.particles.push(e)}return i}})),define("controller/battle-management",["require","exports","model/battle","model/battle-character","model/character","model/room","db/overworlds","model/generics","model/player","model/particle","utils","model/store","controller/ui-actions","controller/battle-actions","controller/loop","controller/scene-management","controller/events","view/ui","view/style","model/particle-system","view/draw","controller/scene-commands","model/utility","model/sound","model/overworld"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u,h,m,g,p,E,f,w,C,y,b,T,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateBattle=t.getReturnToOverworldBattleCompletionCB=t.applyDamage=t.completeCast=t.interruptCast=t.setCasting=t.resetCooldownTimer=t.applyMagicDamage=t.applyRangeDamage=t.applySwingDamage=t.applyArmorDamage=t.applyStaggerDamage=t.endAction=t.beginAction=t.invokeSkill=t.battleKeyHandler=t.callScriptDuringBattle=t.initiateBattle=t.transitionToBattle=void 0,t.transitionToBattle=async(e,o,n,l)=>{var c,h;if(T.stopCurrentMusic(500),l){let r=t.initiateBattle(e,o);return(null===(c=o.events)||void 0===c?void 0:c.onBattleStart)&&await(null===(h=o.events)||void 0===h?void 0:h.onBattleStart(r)),void u.showSection(d.AppSection.BattleUI,!0)}let m=w.createBattleTransitionParticleSystem(C.getImageDataScreenshot());s.setGlobalParticleSystem(m);let g=p.pushEmptyKeyHandler();setTimeout(()=>{y.fadeOut(100,!0),T.playMusic("music_battle1",!0)},1250),setTimeout(()=>{s.setGlobalParticleSystem(null),p.popKeyHandler(g);let l=t.initiateBattle(e,o);r.battlePauseTimers(l),y.fadeIn(250),l.allies.forEach((e,t)=>{let r=a.characterGetPos(e.ch),o=new b.Transform([r[0]-96,r[1]+96,0],r,500,b.TransformEase.LINEAR,b.transformOffsetJumpFar);a.characterSetTransform(e.ch,o),o.timer.pause(),A.timeoutPromise(500+250*t).then(()=>{var r;0===t&&T.playSoundName("battle_jump"),a.characterSetAnimationState(e.ch,a.AnimationState.BATTLE_JUMP),null===(r=e.ch.transform)||void 0===r||r.timer.unpause(),A.timeoutPromise(500).then(()=>{i.battleCharacterSetAnimationIdle(e)})})}),A.timeoutPromise(1500+250*l.allies.length).then(()=>{var e,t;u.showSection(d.AppSection.BattleUI,!0),(null===(e=o.events)||void 0===e?void 0:e.onBattleStart)?null===(t=o.events)||void 0===t||t.onBattleStart(l):r.battleUnpauseTimers(l)}),r.battleSubscribeEvent(l,r.BattleEvent.onCompletion,()=>{T.stopCurrentMusic(1e3),n&&n()})},2550)},t.initiateBattle=(e,c)=>{var A,d,u,h;let m=n.getRoom(c.roomName);m.characters=[];let g=c.enemies.map(e=>{let t=a.characterCreateFromTemplate(e.chTemplate);return o.roomAddCharacter(m,t),i.battleCharacterCreateEnemy(t,e)}),E=e.party.map(t=>(o.roomAddCharacter(m,t),i.battleCharacterCreateAlly(t,{position:l.playerGetBattlePosition(e,t)}))),f=r.battleCreate(m,E,g);return f.template=c,f.allies.forEach(t.resetCooldownTimer),f.enemies.forEach(t.resetCooldownTimer),f.allies.forEach(e=>{a.characterSetFacing(e.ch,a.Facing.RIGHT),i.battleCharacterSetAnimationIdle(e)}),s.setCurrentPlayer(e),s.setCurrentBattle(f),s.setCurrentRoom(m),r.battleSetActorPositions(f),p.pushKeyHandler(t.battleKeyHandler),r.battleSubscribeEvent(f,r.BattleEvent.onTurnStarted,e=>{r.battlePauseActionTimers(f,e===r.BattleAllegiance.ALLY?f.allies:f.enemies)}),r.battleSubscribeEvent(f,r.BattleEvent.onTurnEnded,e=>{r.battleUnpauseActionTimers(f,e===r.BattleAllegiance.ALLY?f.allies:f.enemies)}),(null===(A=c.events)||void 0===A?void 0:A.onCharacterDamaged)&&r.battleSubscribeEvent(f,r.BattleEvent.onCharacterDamaged,null===(d=c.events)||void 0===d?void 0:d.onCharacterDamaged),(null===(u=c.events)||void 0===u?void 0:u.onTurnEnded)&&r.battleSubscribeEvent(f,r.BattleEvent.onTurnEnded,null===(h=c.events)||void 0===h?void 0:h.onTurnEnded),f},t.callScriptDuringBattle=async e=>{let t=s.getCurrentBattle();if(t){t.isPaused=!0;let i=p.pushEmptyKeyHandler();u.hideSections(),r.battlePauseTimers(t),s.disableKeyUpdate(),await g.callScript(s.getCurrentScene(),e),t.isPaused=!1,s.enableKeyUpdate(),p.popKeyHandler(i),r.battleUnpauseTimers(t),u.showSection(d.AppSection.BattleUI,!0)}},t.battleKeyHandler=async e=>{let r=s.getCurrentBattle(),a=s.getIsPaused();switch(e.key){case"d":s.getTriggersVisible()?(s.hideTriggers(),s.hideMarkers()):(s.showTriggers(),s.showMarkers());break;case"x":case"X":if(!a){let e=r.allies[0],a=i.battleCharacterGetSelectedSkill(e);t.invokeSkill(e,a)}break;case"c":case"C":if(!a){let e=r.allies[1],a=i.battleCharacterGetSelectedSkill(e);t.invokeSkill(e,a)}break;case"q":case"Q":{let e=r.allies[0],t=h.createParticleAtCharacter(Object.assign({},c.EFFECT_TEMPLATE_DEAD32),e.ch);o.roomAddParticle(r.room,t);break}case"Tab":if(a){let t=E.getUiInterface().appState.battle,r=s.getCurrentBattle(),i=(t.characterIndexSelected+1)%r.allies.length;-1===i&&(i=r.allies.length-1),u.setBattleCharacterIndexSelected(i),e.preventDefault()}break;case" ":a?(T.playSoundName("woosh_reverse"),m.unpause()):(T.playSoundName("woosh"),m.pause())}},t.invokeSkill=(e,t)=>{let a=s.getCurrentBattle();((e,t)=>!r.battleGetDyingCharacters(e).length&&(t.actionState===i.BattleActionState.ACTING_READY||t.actionState!==i.BattleActionState.CASTING&&!!i.battleCharacterCanAct(e,t)))(a,e)&&(t.cb(a,e),r.battleInvokeEvent(s.getCurrentBattle(),r.BattleEvent.onCharacterAction,e))},t.beginAction=async e=>{let t=s.getCurrentBattle();null===r.battleGetActingAllegiance(t)&&r.battleInvokeEvent(t,r.BattleEvent.onTurnStarted,r.battleGetAllegiance(t,e.ch)),i.battleCharacterSetActonState(e,i.BattleActionState.ACTING),e.actionTimer.start(),e.actionTimer.pause(),r.battleInvokeEvent(t,r.BattleEvent.onCharacterActionStarted,e)},t.endAction=async e=>{let t=s.getCurrentBattle();if(i.battleCharacterIsCasting(e));else{i.battleCharacterSetActonState(e,i.BattleActionState.ACTING);let t=e.ch.transform;if(t){let r=t.createInverse();a.characterSetTransform(e.ch,r),T.playSoundName("battle_jump"),a.characterSetAnimationState(e.ch,a.AnimationState.BATTLE_JUMP),await r.timer.onCompletion(),r.markForRemoval()}i.battleCharacterSetAnimationIdle(e),i.battleCharacterSetActonState(e,i.BattleActionState.IDLE)}if(e.canActSignaled=!1,r.battleInvokeEvent(t,r.BattleEvent.onCharacterActionEnded,e),null===r.battleGetActingAllegiance(t)){let i=r.battleGetDefeatedCharacters(t);if(i.length){let o=1500;for(let e=0;e<i.length;e++){let r=i[e];T.playSoundName("despawn"),a.characterSetAnimationState(r.ch,a.AnimationState.BATTLE_DEAD),t.targetedEnemyIndex=Math.max(0,t.targetedEnemyIndex-i.length),t.targetedEnemyRangeIndex=Math.max(0,t.targetedEnemyRangeIndex-i.length),await A.timeoutPromise(100)}await A.timeoutPromise(o),r.battleInvokeEvent(t,r.BattleEvent.onTurnEnded,r.battleGetAllegiance(t,e.ch)),setTimeout(()=>{E.renderUi()},100)}else r.battleInvokeEvent(t,r.BattleEvent.onTurnEnded,r.battleGetAllegiance(t,e.ch))}},t.applyStaggerDamage=(e,t)=>{i.battleCharacterIsStaggered(e)?e.staggerTimer.start():(e.staggerGauge.fill(t),e.staggerGauge.isFull()&&(r.battleInvokeEvent(s.getCurrentBattle(),r.BattleEvent.onCharacterStaggered,e),i.battleCharacterSetActonState(e,i.BattleActionState.STAGGERED),e.staggerTimer.start(),e.staggerGauge.empty(),e.actionTimer.pause(),a.characterSetAnimationState(e.ch,a.AnimationState.BATTLE_STAGGERED)))},t.applyArmorDamage=(e,t,r,i)=>{let n=r,s=!1;if(i?(T.playSoundName("battle_armor_broken"),t.armor--,s=!0,n=0):t.armorTimer.isComplete()?(T.playSoundName("battle_armor_hit"),t.armorTimer.start(),n=0):(T.playSoundName("battle_armor_broken"),t.armor--,s=!0),s){let[r,i]=a.characterGetPosCenterPx(t.ch),n=c.particleCreateFromTemplate([r+8,i-t.ch.spriteHeight/4],c.EFFECT_TEMPLATE_ARMOR_REDUCED);o.roomAddParticle(e.room,n)}return{nextDamageAmount:n}},t.applySwingDamage=(e,r,a,o)=>{let{damage:n,staggerDamage:s}=o,l=f.colors.WHITE,c="",d=n+r.ch.stats.POW,u=Math.floor(A.getRandBetween(d-Math.ceil(d/4),d));if(i.battleCharacterIsStaggered(a))u*=2,l=f.colors.ORANGE,c="!";else if(a.armor>0){let{nextDamageAmount:r}=t.applyArmorDamage(e,a,u,o.attackType===h.SwingType.PIERCE);u=r}t.applyStaggerDamage(a,s),a.armor<=0&&t.interruptCast(a),u=Math.max(0,u),t.applyDamage(e,a,u,l,c)},t.applyRangeDamage=(e,r,a,o,n)=>{let s="",l=o+Math.floor(r.ch.stats.POW/2),c=Math.floor(A.getRandBetween(l-Math.ceil(l/4),l));if(i.battleCharacterIsStaggered(a))s="!",c*=2;else if(a.armor>0){let{nextDamageAmount:r}=t.applyArmorDamage(e,a,c,!1);c=r}t.applyStaggerDamage(a,n),c=Math.max(1,c),t.applyDamage(e,a,c,f.colors.WHITE,s)},t.applyMagicDamage=(e,r,a,o,n)=>{let s="",l=o+r.ch.stats.POW,c=Math.floor(A.getRandBetween(l-Math.ceil(l/4),l));i.battleCharacterIsStaggered(a)?(s="!",c*=2):a.armor>0&&t.applyArmorDamage(e,a,c,!1),t.applyStaggerDamage(a,n),t.interruptCast(a),c=Math.max(1,c),t.applyDamage(e,a,c,f.colors.LIGHTBLUE,s)},t.resetCooldownTimer=e=>{let t=e.ch.skills[e.ch.skillIndex];t&&e.actionTimer.start(Math.max(t.cooldown-t.cooldown*(1-1/(1+e.ch.stats.SPD/100)),1e3))},t.setCasting=(e,t)=>{i.battleCharacterSetActonState(e,i.BattleActionState.CASTING),a.characterSetAnimationState(e.ch,a.AnimationState.BATTLE_CAST),r.battleInvokeEvent(s.getCurrentBattle(),r.BattleEvent.onCharacterCasting,e);let[n,l]=a.characterGetPosCenterPx(e.ch);o.roomAddParticle(s.getCurrentRoom(),c.createStatusParticle("Casting",n,l)),e.actionTimer.pause(),e.castTimer.start(t.castTime),e.onCast=async()=>{t.onCast&&await t.onCast()},e.onCastInterrupted=async()=>{t.onInterrupt&&await t.onInterrupt()}},t.interruptCast=e=>{if(i.battleCharacterIsCasting(e)){i.battleCharacterSetActonState(e,i.BattleActionState.IDLE),r.battleInvokeEvent(s.getCurrentBattle(),r.BattleEvent.onCharacterInterrupted,e),e.onCastInterrupted();let[t,n]=a.characterGetPosCenterPx(e.ch);e.actionTimer.unpause(),o.roomAddParticle(s.getCurrentRoom(),c.createStatusParticle("Interrupted",t,n,"cyan"))}},t.completeCast=async e=>{let i=s.getCurrentBattle(),a=r.battleGetActingAllegiance(i);null!==a&&a!==r.battleGetAllegiance(i,e.ch)||(await t.beginAction(e),r.battleInvokeEvent(s.getCurrentBattle(),r.BattleEvent.onCharacterSpell,e),await e.onCast(),e.actionTimer.unpause(),e.actionTimer.start(),e.actionTimer.pause(),await t.endAction(e))},t.applyDamage=(e,t,n,l,A)=>{if(n>0){let[r,i]=a.characterGetPosCenterPx(t.ch);o.roomAddParticle(e.room,c.createDamageParticle(`${n}${null!=A?A:""}`,r,i,l)),a.characterModifyHp(t.ch,-n)}if(t.isDefeated){let[r,i]=a.characterGetPosCenterPx(t.ch);o.roomAddParticle(e.room,c.createWeightedParticle(c.EFFECT_TEMPLATE_GEM,r,i,1e3))}i.battleCharacterSetAnimationStateAfterTakingDamage(t),r.battleInvokeEvent(s.getCurrentBattle(),r.BattleEvent.onCharacterDamaged,t)},t.getReturnToOverworldBattleCompletionCB=(e,t,r,i)=>()=>{y.fadeOut(500,!0),A.timeoutPromise(500).then(()=>{var o,n;y.fadeIn(500,!0),s.setCurrentBattle(null),s.setCurrentRoom(e),u.showSection(d.AppSection.Debug,!0),S.overworldShow(s.getCurrentOverworld());let l=s.getCurrentPlayer();a.characterSetPos(l.leader,t),a.characterSetFacing(l.leader,r),(null===(o=i.events)||void 0===o?void 0:o.onAfterBattleEnded)&&(null===(n=i.events)||void 0===n||n.onAfterBattleEnded())})},t.updateBattle=e=>{for(let t=0;t<e.allies.length;t++){let r=e.allies[t];i.updateBattleCharacter(e,r),r.shouldRemove&&(e.allies.splice(t,1),t--)}for(let t=0;t<e.enemies.length;t++){let r=e.enemies[t];i.updateBattleCharacter(e,r),r.shouldRemove&&(e.enemies.splice(t,1),t--)}e.isCompleted||(async e=>{var i,o,n,s;if(r.battleIsVictory(e)){u.hideSections(),e.isCompleted=!0,p.popKeyHandler(t.battleKeyHandler),r.battlePauseActionTimers(e),(null===(o=null===(i=e.template)||void 0===i?void 0:i.events)||void 0===o?void 0:o.onBattleEnd)&&await(null===(s=null===(n=e.template)||void 0===n?void 0:n.events)||void 0===s?void 0:s.onBattleEnd(e)),T.stopCurrentMusic(),T.playSoundName("fanfare"),A.timeoutPromise(2800).then(()=>{T.playMusic("music_battle_victory",!0)}),u.showSection(d.AppSection.BattleVictory,!0),await A.timeoutPromise(250);for(let t in e.allies)a.characterSetAnimationState(e.allies[t].ch,a.AnimationState.BATTLE_FLOURISH)}else r.battleIsLoss(e)&&(u.hideSections(),e.isCompleted=!0,p.popKeyHandler(t.battleKeyHandler),r.battlePauseActionTimers(e),await A.timeoutPromise(2e3),u.showSection(d.AppSection.BattleDefeated,!0))})(e)}})),define("db/animation-metadata",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.getIfExists=t.get=void 0;let r={};t.get=e=>{let t=r[e];if(!t)throw Error("No AnimationMetadata exists with name: "+e);return Object.assign({},t)},t.getIfExists=e=>{let t=r[e];return t?Object.assign({},t):null},t.init=()=>{var e,t;r.ada_battle_attack_left_f={strikeFrame:3,sounds:[{soundName:"battle_swing1",frame:3}]},r.ada_battle_attack_p_left_f={strikeFrame:5,sounds:[{soundName:"battle_swing1",frame:5}]},r.ada_enter_vr_portal={sounds:[]};for(let i=13;i<=27;i+=2)null===(t=null===(e=null==r?void 0:r.ada_enter_vr_portal)||void 0===e?void 0:e.sounds)||void 0===t||t.push({soundName:"vr_portal_beep",frame:i});r.conscience_battle_ranged_left_f={strikeFrame:5,rangedParticleSpawnOffset:[0,0],sounds:[{soundName:"battle_shoot_arrow",frame:5}]},r.tut_robot_boss_battle_attack_left={strikeFrame:10,sounds:[{soundName:"battle_swing4",frame:10}]},r.tut_robot_boss_battle_attack_k_left={strikeFrame:6,sounds:[{soundName:"battle_swing3",frame:6}]},r.tut_robot_boss_battle_attack_p_left={strikeFrame:6,sounds:[{soundName:"battle_swing2",frame:6}]},r.tut_robot_melee_speedy_battle_attack_left={strikeFrame:2,sounds:[{soundName:"battle_swing1",frame:2}]},r.tut_robot_ranged_battle_ranged_left={strikeFrame:2,rangedParticleSpawnOffset:[8,-8],sounds:[{soundName:"battle_shoot_arrow",frame:0}]},r.tut_robot_armored_battle_attack_left={strikeFrame:2,sounds:[{soundName:"battle_swing1",frame:2}]},r.tut_robot_armored_battle_attack_k_left={strikeFrame:10,sounds:[{soundName:"battle_robot_charge_up",frame:2},{soundName:"battle_swing3",frame:8}]},r.tut_robot_melee_battle_attack_left={strikeFrame:3,sounds:[{soundName:"battle_swing1",frame:3}]},r.tile_vr_portal_active={loopFromFrame:5,sounds:[{soundName:"vr_portal_activate",frame:0}]},r.tile_vr_portal_passive={loopFromFrame:5,sounds:[{soundName:"vr_portal_deactivate",frame:0}]}}})),define("view/icons/Shield",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{fill:e.color,stroke:e.color,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("path",{d:"M0 0h512v512H0z",fill:"rgba(0, 0, 0, 0)","fill-opacity":"0"}),r.h("g",{class:"",transform:"translate(0,0)",style:""},r.h("path",{d:"M256 16c25 24 100 72 150 72v96c0 96-75 240-150 312-75-72-150-216-150-312V88c50 0 125-48 150-72z",fill:e.color,"fill-opacity":"1"})))})),define("controller/battle-actions",["require","exports","model/battle","model/battle-character","model/character","model/room","model/utility","utils","model/particle","controller/battle-management","model/generics","db/animation-metadata","view/icons/Sword","model/sound"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u,h){"use strict";var m,g;Object.defineProperty(t,"__esModule",{value:!0}),t.BattleActions=t.doSpell=t.doRange=t.doSwing=t.jumpToTarget=t.moveBackward=t.moveForward=t.getTarget=t.getTransformOffsetFunction=t.getDurationUntilStrike=t.createParticleAtCharacter=t.RangeType=t.SwingType=t.BattleActionType=void 0,u=__importDefault(u),function(e){e.SWING="swing",e.RANGED="ranged",e.CAST="cast",e.CHANNEL="channel"}(m=t.BattleActionType||(t.BattleActionType={})),function(e){e.NORMAL="normal",e.PIERCE="pierce",e.KNOCK_DOWN="knock-down",e.FINISH="finish"}(g=t.SwingType||(t.SwingType={})),(t.RangeType||(t.RangeType={})).NORMAL="normal",t.createParticleAtCharacter=(e,t)=>{let[r,i]=a.characterGetPosCenterPx(t);return l.particleCreateFromTemplate([r,i],e)},t.getDurationUntilStrike=e=>{var t;let r=d.getIfExists(e.name),i=null!==(t=null==r?void 0:r.strikeFrame)&&void 0!==t?t:e.sprites.length-1;return e.getDurationToIndex(i)},t.getTransformOffsetFunction=e=>e<45?n.transformOffsetJumpShort:e<100?n.transformOffsetJumpMedium:n.transformOffsetJumpFar,t.getTarget=(e,t)=>{let i,a=r.battleGetAllegiance(e,t.ch);return i=a===r.BattleAllegiance.ALLY?r.battleGetTargetedEnemy(e,t.ch.skills[t.ch.skillIndex].type):r.battleGetNearestAttackable(e,a),i},t.moveForward=async(e,t)=>{let i=t.ch,s=r.battleGetAllegiance(e,i),l=a.characterGetPos(i),c=[...l];s===r.BattleAllegiance.ALLY?(c[0]+=o.TILE_WIDTH/2/2,c[1]-=o.TILE_WIDTH/2/2):(c[0]-=o.TILE_WIDTH/2/2,c[1]+=o.TILE_WIDTH/2/2);let A=new n.Transform(l,c,150,n.TransformEase.LINEAR,n.transformOffsetJumpShort);return a.characterSetTransform(i,A),h.playSoundName("battle_jump"),a.characterSetAnimationState(i,a.AnimationState.BATTLE_JUMP),await A.timer.onCompletion(),A},t.moveBackward=async(e,t)=>{let i=t.ch,s=r.battleGetAllegiance(e,i),l=a.characterGetPos(i),c=[...l];s===r.BattleAllegiance.ALLY?(c[0]-=o.TILE_WIDTH/2,c[1]+=o.TILE_WIDTH/2):(c[0]+=o.TILE_WIDTH/2,c[1]-=o.TILE_WIDTH/2);let A=new n.Transform(l,c,150,n.TransformEase.LINEAR,n.transformOffsetJumpShort);return a.characterSetTransform(i,A),h.playSoundName("battle_jump"),a.characterSetAnimationState(i,a.AnimationState.BATTLE_JUMP),await A.timer.onCompletion(),A},t.jumpToTarget=async(e,i,l)=>{let c=i.ch,A=a.characterGetSize(i.ch),d=a.characterGetSize(l.ch),u=Math.floor(1+(A[0]-32)/32+(d[1]-32)/32),m=r.battleGetAllegiance(e,c),g=a.characterGetPos(c),p=a.characterGetPos(l.ch);if(m===r.BattleAllegiance.ALLY)for(let e=0;e<u;e++)p[0]-=o.TILE_WIDTH/2;else for(let e=0;e<u;e++)p[0]+=o.TILE_WIDTH/2;let E=s.calculateDistance(g,p),f=new n.Transform(g,p,250*s.normalize(E,35,125,1,1.75),n.TransformEase.LINEAR,t.getTransformOffsetFunction(E));return a.characterSetTransform(c,f),a.characterSetAnimationState(c,a.AnimationState.BATTLE_JUMP),h.playSoundName("battle_jump"),await f.timer.onCompletion(),f},t.doSwing=async(e,n,A,d,{baseDamage:u,baseStagger:h,swingType:p})=>{var E,f;let w=A.ch,C=null!==(f=null===(E=n.meta.swings)||void 0===E?void 0:E.length)&&void 0!==f?f:1,y=A.actionStateIndex;if(A.actionStateIndex=(A.actionStateIndex+1)%C,0===y&&(await c.beginAction(A),A.actionReadyTimer.start(),await t.jumpToTarget(e,A,d)),y<C){A.actionReadyTimer.start(),A.actionReadyTimer.pause(),i.battleCharacterSetActonState(A,i.BattleActionState.ACTING);let n=l.EFFECT_TEMPLATE_SWORD_LEFT;p===g.PIERCE&&(n=l.EFFECT_TEMPLATE_PIERCE_LEFT),i.battleCharacterSetAnimationStateAttack(A,m.SWING,p);let E=a.characterGetAnimation(w),f=t.getDurationUntilStrike(E);s.timeoutPromise(f).then(()=>{let[t,r]=a.characterGetPosCenterPx(d.ch),i=l.particleCreateFromTemplate([t,r],n);o.roomAddParticle(e.room,i),c.applySwingDamage(e,A,d,{damage:u,staggerDamage:h,attackType:p})}),await E.onCompletion(),y===C-1?await s.timeoutPromise(750):await s.timeoutPromise(400),r.battleInvokeEvent(e,r.BattleEvent.onCharacterActionReady,A),i.battleCharacterSetActonState(A,i.BattleActionState.ACTING_READY),i.battleCharacterSetAnimationIdle(A),A.actionReadyTimer.unpause()}0===A.actionStateIndex&&await c.endAction(A)},t.doRange=async(e,A,u,g,{baseDamage:p,baseStagger:E})=>{var f,w;let C=u.ch,y=null!==(w=null===(f=A.meta.ranges)||void 0===f?void 0:f.length)&&void 0!==w?w:1,b=u.actionStateIndex;if(u.actionStateIndex=(u.actionStateIndex+1)%y,0===b&&(await c.beginAction(u),u.actionReadyTimer.start(),await t.moveBackward(e,u)),b<y){u.actionReadyTimer.start(),u.actionReadyTimer.pause(),i.battleCharacterSetActonState(u,i.BattleActionState.ACTING),i.battleCharacterSetAnimationStateAttack(u,m.RANGED);let A=a.characterGetAnimation(C),f=t.getDurationUntilStrike(A);s.timeoutPromise(f).then(()=>{var i;let s=t.createParticleAtCharacter(Object.assign(Object.assign({},l.EFFECT_TEMPLATE_RANGED_LEFT),{flipped:r.battleGetAllegiance(e,u.ch)===r.BattleAllegiance.ALLY}),C),[c,h]=a.characterGetPosTopLeftPx(g.ch),m=d.getIfExists(A.name),[p,E]=null!==(i=null==m?void 0:m.rangedParticleSpawnOffset)&&void 0!==i?i:[0,0];s.transform=new n.Transform([s.x+p,s.y+E,0],[c,h,0],100,n.TransformEase.LINEAR),o.roomAddParticle(e.room,s)}),s.timeoutPromise(f+75).then(()=>{let r=t.createParticleAtCharacter(l.EFFECT_TEMPLATE_RANGED_HIT,g.ch);h.playSoundName("battle_arrow_hit"),o.roomAddParticle(e.room,r),c.applyRangeDamage(e,u,g,p,E)}),await A.onCompletion(),b===y-1?await s.timeoutPromise(750):await s.timeoutPromise(400),r.battleInvokeEvent(e,r.BattleEvent.onCharacterActionReady,u),i.battleCharacterSetActonState(u,i.BattleActionState.ACTING_READY),i.battleCharacterSetAnimationIdle(u),u.actionReadyTimer.unpause()}0===u.actionStateIndex&&await c.endAction(u)},t.doSpell=async(e,r,i,n,{particleText:d,particleTemplate:u,baseDamage:h,baseStagger:m})=>{await t.moveForward(e,i);let[g,p]=a.characterGetPosCenterPx(i.ch);if(o.roomAddParticle(A.getCurrentRoom(),l.createStatusParticle(d,g,p,"red")),await s.timeoutPromise(150),a.characterSetAnimationState(i.ch,a.AnimationState.BATTLE_SPELL),await s.timeoutPromise(150),n){let[t,r]=a.characterGetPosCenterPx(n.ch);o.roomAddParticle(e.room,l.particleCreateFromTemplate([t,r],u)),c.applyMagicDamage(e,i,n,h,m),await s.timeoutPromise(2e3)}},t.BattleActions={AdaTrainingSwing:{name:"Training Swing",description:"Jump to target and swing your weapon.",cooldown:1e3,type:m.SWING,meta:{swings:[g.NORMAL,g.NORMAL],icon:u.default},cb:async function(e,r){var i,a,o;let n=t.getTarget(e,r);n&&await t.doSwing(e,this,r,n,{baseDamage:1,baseStagger:5,swingType:null!==(o=null===(a=null===(i=this.meta)||void 0===i?void 0:i.swings)||void 0===a?void 0:a[r.actionStateIndex])&&void 0!==o?o:g.NORMAL})}},Swing:{name:"Swing",description:"Jump to target and swing your weapon.",cooldown:1e3,type:m.SWING,meta:{swings:[g.NORMAL,g.PIERCE,g.NORMAL],icon:u.default},cb:async(e,r)=>{var i,a,o,n;let s=t.getTarget(e,r);s&&await t.doSwing(e,t.BattleActions.Swing,r,s,{baseDamage:1,baseStagger:5,swingType:null!==(n=null===(o=null===(a=null===(i=t.BattleActions.Swing)||void 0===i?void 0:i.meta)||void 0===a?void 0:a.swings)||void 0===o?void 0:o[r.actionStateIndex])&&void 0!==n?n:g.NORMAL})}},SwingSlow:{name:"SwingSlow",description:"A slower version of the swing.",cooldown:2e3,type:m.SWING,meta:{swings:[g.NORMAL,g.NORMAL,g.NORMAL],icon:u.default},cb:async(e,r)=>t.BattleActions.Swing.cb(e,r)},SwingWithLongDescription:{name:"Swing LD",description:"This version of Swing is identical to Swing, except it kind of has a super duper long description.  This is done so that it can be TESTED.",cooldown:1e5,type:m.SWING,meta:{swings:[g.NORMAL,g.NORMAL,g.NORMAL],icon:u.default},cb:async(e,r)=>t.BattleActions.Swing.cb(e,r)},Defend:{name:"Defend",description:"Brace yourself for an attack, taking less damage and reducing stagger for a short time.",cooldown:5e3,type:m.CAST,meta:{castTime:5e3,icon:u.default},cb:async(e,o)=>{c.beginAction(o);let n=o.ch,s=await t.moveForward(e,o);a.characterSetAnimationState(n,a.AnimationState.BATTLE_ITEM);let l=a.characterGetAnimation(n);await l.onCompletion(),i.battleCharacterAddStatus(o,r.Status.DEFEND);let A=s.createInverse();a.characterSetTransform(n,A),a.characterSetAnimationState(n,a.AnimationState.BATTLE_JUMP),await A.timer.onCompletion(),A.markForRemoval(),i.battleCharacterSetAnimationIdle(o),c.setCasting(o,{castTime:5e3,onCast:async()=>{i.battleCharacterRemoveStatus(o,r.Status.DEFEND)},onInterrupt:async()=>{i.battleCharacterRemoveStatus(o,r.Status.DEFEND)}}),await c.endAction(o)}}}})),define("model/battle-character",["require","exports","model/room","model/character","utils","controller/battle-actions","controller/battle-management","model/utility","model/battle","model/sound"],(function(e,t,r,i,a,o,n,s,l,c){"use strict";var A;Object.defineProperty(t,"__esModule",{value:!0}),t.updateBattleCharacter=t.battleCharacterSetAnimationStateAttack=t.battleCharacterSetAnimationIdle=t.battleCharacterSetAnimationStateAfterTakingDamage=t.battleCharacterGetSelectedSkill=t.battleCharacterRemoveStatus=t.battleCharacterAddStatus=t.battleCharacterRemoveCanActCb=t.battleCharacterSetCanActCb=t.battleCharacterCanAct=t.battleCharacterSetActonState=t.battleCharacterIsCasting=t.battleCharacterIsKnockedDown=t.battleCharacterIsStaggered=t.battleCharacterIsActingReady=t.battleCharacterIsActing=t.battleCharacterCreateAlly=t.battleCharacterCreateEnemy=t.BattleActionState=void 0,function(e){e.IDLE="idle",e.ACTING="acting",e.ACTING_READY="acting-ready",e.CASTING="casting",e.STAGGERED="staggered",e.KNOCKED_DOWN="knocked-down"}(A=t.BattleActionState||(t.BattleActionState={}));let d=(e,t)=>{var r;let i=e.skills[e.skillIndex],a=e.stats.STAGGER;return{ch:e,armor:0,isDefeated:!1,shouldRemove:!1,actionTimer:new s.Timer(null!==(r=null==i?void 0:i.cooldown)&&void 0!==r?r:2e3),actionReadyTimer:new s.Timer(1500),staggerTimer:new s.Timer(2e3),staggerGauge:new s.Gauge(a,.002),castTimer:new s.Timer(1e3),armorTimer:new s.Timer(250),position:t,actionState:A.IDLE,actionStateIndex:0,statuses:[],canActSignaled:!1,onCanActCb:async function(){},onCast:async function(){},onCastInterrupted:async function(){},ai:void 0}};t.battleCharacterCreateEnemy=(e,t)=>{var r,i,o;-1===e.name.lastIndexOf("+")&&(e.name=e.name+"+"+a.randomId());let n=d(e,t.position);return n.ai=t.ai,n.armor=null!==(o=null!==(r=t.armor)&&void 0!==r?r:null===(i=e.template)||void 0===i?void 0:i.armor)&&void 0!==o?o:0,n},t.battleCharacterCreateAlly=(e,t)=>d(e,t.position),t.battleCharacterIsActing=e=>e.actionState===A.ACTING||e.actionState===A.ACTING_READY,t.battleCharacterIsActingReady=e=>e.actionState===A.ACTING_READY,t.battleCharacterIsStaggered=e=>e.actionState===A.STAGGERED||e.actionState===A.KNOCKED_DOWN,t.battleCharacterIsKnockedDown=e=>e.actionState===A.KNOCKED_DOWN,t.battleCharacterIsCasting=e=>e.actionState===A.CASTING,t.battleCharacterSetActonState=(e,t)=>{e.actionState=t},t.battleCharacterCanAct=(e,r)=>{if(e.isPaused)return!1;if(t.battleCharacterIsActing(r))return!1;if(t.battleCharacterIsStaggered(r))return!1;let i=l.battleGetAllegiance(e,r.ch)===l.BattleAllegiance.ALLY?e.enemies:e.allies;for(let e=0;e<i.length;e++)if(t.battleCharacterIsActing(i[e]))return!1;return r.actionTimer.isComplete()},t.battleCharacterSetCanActCb=(e,t)=>{e.onCanActCb=t},t.battleCharacterRemoveCanActCb=e=>{e.onCanActCb=async function(){}},t.battleCharacterAddStatus=(e,t)=>{e.statuses.includes(t)||e.statuses.push(t)},t.battleCharacterRemoveStatus=(e,t)=>{let r=e.statuses.indexOf(t);r>-1&&e.statuses.splice(r,1)},t.battleCharacterGetSelectedSkill=e=>e.ch.skills[e.ch.skillIndex],t.battleCharacterSetAnimationStateAfterTakingDamage=e=>{t.battleCharacterIsStaggered(e)?i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_STAGGERED,!0):(i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_DAMAGED,!0),i.characterOnAnimationCompletion(e.ch,()=>{t.battleCharacterIsStaggered(e)?i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_STAGGERED,!0):t.battleCharacterSetAnimationIdle(e)}))},t.battleCharacterSetAnimationIdle=e=>{i.characterSetAnimationState(e.ch,e.ch.weaponEquipState===i.WeaponEquipState.RANGED?i.AnimationState.BATTLE_IDLE_RANGED:i.AnimationState.BATTLE_IDLE)},t.battleCharacterSetAnimationStateAttack=(e,t,r)=>{switch(t){case o.BattleActionType.RANGED:i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_RANGED);break;case o.BattleActionType.CAST:i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_CAST);break;case o.BattleActionType.CHANNEL:console.error("No channel type implemented to set animation");break;case o.BattleActionType.SWING:switch(r){case o.SwingType.NORMAL:i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_ATTACK);break;case o.SwingType.PIERCE:if(i.characterHasAnimationState(e.ch,i.AnimationState.BATTLE_ATTACK_PIERCE)){i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_ATTACK_PIERCE);break}i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_ATTACK);case o.SwingType.KNOCK_DOWN:if(i.characterHasAnimationState(e.ch,i.AnimationState.BATTLE_ATTACK_KNOCKDOWN)){i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_ATTACK_KNOCKDOWN);break}i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_ATTACK);case o.SwingType.FINISH:if(i.characterHasAnimationState(e.ch,i.AnimationState.BATTLE_ATTACK_FINISH)){i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_ATTACK_FINISH);break}i.characterSetAnimationState(e.ch,i.AnimationState.BATTLE_ATTACK)}}},t.updateBattleCharacter=(e,a)=>{if(a.ch.hp<=0){if(i.characterGetAnimationState(a.ch)!==i.AnimationState.BATTLE_DEFEATED&&i.characterGetAnimationState(a.ch)!==i.AnimationState.BATTLE_DEAD&&i.characterSetAnimationState(a.ch,i.AnimationState.BATTLE_DEFEATED),!a.isDefeated){a.isDefeated=!0,c.playSoundName("dead"),i.characterSetAnimationState(a.ch,i.AnimationState.BATTLE_DEFEATED);let t=()=>{l.battleUnsubscribeEvent(e,l.BattleEvent.onTurnEnded,t);let i=e.enemies.indexOf(a);if(i>-1)return a.shouldRemove=!0,e.defeated.push(a),void r.roomRemoveCharacter(e.room,a.ch);i=e.allies.indexOf(a),i>-1&&(a.shouldRemove=!0,e.defeated.push(a))};l.battleSubscribeEvent(e,l.BattleEvent.onTurnEnded,t)}}else e.isCompleted||(t.battleCharacterIsStaggered(a)&&a.staggerTimer.isComplete()&&(t.battleCharacterSetActonState(a,A.IDLE),i.characterSetAnimationState(a.ch,i.AnimationState.BATTLE_IDLE),a.actionTimer.unpause(),l.battleInvokeEvent(e,l.BattleEvent.onCharacterRecovered,a)),t.battleCharacterIsCasting(a)&&a.castTimer.isComplete()&&n.completeCast(a),t.battleCharacterIsActingReady(a)&&a.actionReadyTimer.isComplete()&&(a.actionStateIndex=0,n.endAction(a)),a.staggerGauge.update(),t.battleCharacterIsActing(a)?t.battleCharacterIsActingReady(a)&&a.ai&&a.ai(e,a):t.battleCharacterCanAct(e,a)&&(a.canActSignaled||(a.canActSignaled=!0,l.battleInvokeEvent(e,l.BattleEvent.onCharacterReady,a)),a.onCanActCb(),a.ai&&a.ai(e,a)))}})),define("controller/battle-ai",["require","exports","model/battle","controller/battle-management"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BATTLE_AI_ATTACK=void 0,t.BATTLE_AI_ATTACK=(e,t)=>{let a=r.battleGetAllegiance(e,t.ch);r.battleGetNearestAttackable(e,a)&&i.invokeSkill(t,t.ch.skills[0])}})),define("model/battle",["require","exports","model/battle-character","model/character","controller/scene-commands","model/generics","controller/battle-actions"],(function(e,t,r,i,a,o,n){"use strict";var s,l,c,A;Object.defineProperty(t,"__esModule",{value:!0}),t.battleGetDyingCharacters=t.battleGetDefeatedCharacters=t.battleUnpauseActionTimers=t.battlePauseActionTimers=t.battleUnpauseTimers=t.battlePauseTimers=t.battleGetTargetedEnemy=t.battleSetEnemyRangeTargetIndex=t.battleSetEnemyTargetIndex=t.battleIsEnemyTargetableByMelee=t.battleGetActingAllegiance=t.battleInvokeEvent=t.battleUnsubscribeEvent=t.battleSubscribeEvent=t.battleGetCharactersByPosition=t.battleGetNearestAttackable=t.battleGetCharactersOfAllegiance=t.battleGetOppositeAllegiance=t.battleGetAllegiance=t.battleIsLoss=t.battleIsVictory=t.battleSetActorPositions=t.battleStatsCreate=t.battleCreate=t.Status=t.BattleAllegiance=t.BattleRow=t.BattlePosition=t.BattleEvent=void 0,(A=t.BattleEvent||(t.BattleEvent={})).onCharacterDamaged="onCharacterDamaged",A.onCharacterReady="onCharacterReady",A.onCharacterActionStarted="onCharacterActionStarted",A.onCharacterAction="onCharacterAction",A.onCharacterActionReady="onCharacterActionReady",A.onCharacterActionButtonPressed="onCharacterActionButtonPressed",A.onCharacterActionEnded="onCharacterActionEnded",A.onCharacterStaggered="onCharacterStaggered",A.onCharacterPinned="onCharacterPinned",A.onCharacterRecovered="onCharacterRecovered",A.onCharacterCasting="onCharacterCasting",A.onCharacterSpell="onCharacterSpell",A.onCharacterInterrupted="onCharacterInterrupted",A.onCharacterDefeated="onCharacterDefeated",A.onMagicShieldDamaged="onMagicShieldDamaged",A.onTurnStarted="onTurnStarted",A.onTurnEnded="onTurnEnded",A.onCompletion="onCompletion",function(e){e.FRONT="front",e.MIDDLE="middle",e.BACK="back"}(s=t.BattlePosition||(t.BattlePosition={})),(c=t.BattleRow||(t.BattleRow={})).TOP="top",c.BOTTOM="bottom",c.NONE="none",function(e){e.ALLY="ally",e.ENEMY="enemy"}(l=t.BattleAllegiance||(t.BattleAllegiance={})),(t.Status||(t.Status={})).DEFEND="defend",t.battleCreate=(e,t,r)=>({room:e,isCompleted:!1,enemies:r,defeated:[],allies:t,subscriptions:{onCharacterDamaged:[],onCharacterReady:[],onCharacterActionStarted:[],onCharacterAction:[],onCharacterActionReady:[],onCharacterActionButtonPressed:[],onCharacterActionEnded:[],onCharacterStaggered:[],onCharacterRecovered:[],onCharacterPinned:[],onCharacterSpell:[],onCharacterCasting:[],onCharacterInterrupted:[],onCharacterDefeated:[],onMagicShieldDamaged:[],onTurnStarted:[],onTurnEnded:[],onCompletion:[]},targetedEnemyIndex:0,targetedEnemyRangeIndex:0,isPaused:!1}),t.battleStatsCreate=()=>({POW:5,ACC:1,FOR:1,CON:1,RES:1,SPD:1,EVA:0,HP:10,STAGGER:10}),t.battleSetActorPositions=e=>{let t=o.getCurrentPlayer();e.allies.forEach((e,r)=>{let i=t.battlePositions.indexOf(e.ch);a.setAtMarker(e.ch.name,"MarkerAlly"+(i>-1?i:r))});let r={};e.enemies.forEach(e=>{let t=e.position,i=0;t===s.MIDDLE?i=2:t===s.BACK&&(i=4);let o="MarkerEnemy"+i;r[o]?a.setAtMarker(e.ch.name,"MarkerEnemy"+(i+1)):(r[o]=!0,a.setAtMarker(e.ch.name,o))})},t.battleIsVictory=e=>0===e.enemies.length,t.battleIsLoss=e=>0===e.allies.length,t.battleGetAllegiance=(e,t)=>{if(e.enemies.find(e=>e.ch===t))return l.ENEMY;if(e.allies.find(e=>e.ch===t))return l.ALLY;throw Error(`Cannot get battle allegiance for character '${t.name}' that does not exist in battle.`)},t.battleGetOppositeAllegiance=e=>e===l.ALLY?l.ENEMY:l.ALLY,t.battleGetCharactersOfAllegiance=(e,t)=>{switch(t){case l.ALLY:return e.allies;case l.ENEMY:return e.enemies;default:return e.allies}},t.battleGetNearestAttackable=(e,r)=>{let i,a=t.battleGetCharactersOfAllegiance(e,t.battleGetOppositeAllegiance(r));return i=a.find(e=>e.position===s.FRONT),i||(i=a.find(e=>e.position===s.MIDDLE)),i||(i=a.find(e=>e.position===s.BACK)),null!=i?i:null},t.battleGetCharactersByPosition=(e,t)=>e.filter(e=>e.position===t),t.battleSubscribeEvent=(e,t,r)=>{e.subscriptions[t].push(r)},t.battleUnsubscribeEvent=(e,t,r)=>{let i=e.subscriptions[t].indexOf(r);i>-1&&e.subscriptions[t].splice(i,1)},t.battleInvokeEvent=(e,t,r)=>{e.subscriptions[t].slice().forEach(e=>{e(r)})},t.battleGetActingAllegiance=e=>e.allies.reduce((e,t)=>e||r.battleCharacterIsActing(t),!1)?l.ALLY:e.enemies.reduce((e,t)=>e||r.battleCharacterIsActing(t),!1)?l.ENEMY:null,t.battleIsEnemyTargetableByMelee=(e,r)=>{let i=e.enemies,a=t.battleGetCharactersByPosition(i,s.FRONT);if(a.length>0&&r>=a.length)return!1;if(r<a.length)return!0;let o=t.battleGetCharactersByPosition(i,s.MIDDLE);return!(o.length>0&&r>=o.length)},t.battleSetEnemyTargetIndex=(e,r)=>t.battleGetActingAllegiance(e)!==l.ENEMY&&!!t.battleIsEnemyTargetableByMelee(e,r)&&!t.battleGetDefeatedCharacters(e).length&&(r<e.enemies.length&&(e.targetedEnemyIndex=r),!0),t.battleSetEnemyRangeTargetIndex=(e,r)=>t.battleGetActingAllegiance(e)!==l.ENEMY&&!t.battleGetDefeatedCharacters(e).length&&(r<e.enemies.length&&(e.targetedEnemyRangeIndex=r),!0),t.battleGetTargetedEnemy=(e,t)=>{var r;return null!==(r=e.enemies[t===n.BattleActionType.SWING?e.targetedEnemyIndex:e.targetedEnemyRangeIndex])&&void 0!==r?r:null},t.battlePauseTimers=(e,t)=>{(null!=t?t:e.allies.concat(e.enemies)).forEach(e=>{e.actionTimer.pauseOverride(),e.staggerTimer.pauseOverride(),e.castTimer.pauseOverride(),e.actionReadyTimer.pauseOverride(),e.ch.transform&&e.ch.transform.timer.pauseOverride()})},t.battleUnpauseTimers=(e,t)=>{(null!=t?t:e.allies.concat(e.enemies)).forEach(e=>{e.actionTimer.unpauseOverride(),e.staggerTimer.unpauseOverride(),e.castTimer.unpauseOverride(),e.actionReadyTimer.unpauseOverride(),e.ch.transform&&e.ch.transform.timer.unpauseOverride()})},t.battlePauseActionTimers=(e,t,r)=>{(null!=t?t:e.allies.concat(e.enemies)).forEach(e=>{r?e.actionTimer.pauseOverride():e.actionTimer.pause()})},t.battleUnpauseActionTimers=(e,t,r)=>{(null!=t?t:e.allies.concat(e.enemies)).forEach(e=>{r?e.actionTimer.unpauseOverride():e.actionTimer.unpause()})},t.battleGetDefeatedCharacters=e=>e.allies.concat(e.enemies).filter(e=>e.isDefeated),t.battleGetDyingCharacters=e=>e.allies.concat(e.enemies).filter(e=>e.isDefeated&&e.ch.animationState===i.AnimationState.BATTLE_DEAD)})),define("controller/pathfinding",["require","exports","model/room","utils"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPFPath=t.pfPathToRoomPath=void 0,t.pfPathToRoomPath=e=>e.path.map(e=>[e[0]*r.TILE_WIDTH_WORLD,e[1]*r.TILE_HEIGHT_WORLD]),t.createPFPath=(e,t,r)=>{let a={path:[]},o=(e=>({width:e.width,height:e.height,nodes:e.tiles.map(e=>({hCost:9999999,cost:9999999,isWall:e.isWall,x:e.x,y:e.y,connections:[],tile:e,visited:!1}))}))(r);((e,t,r)=>{if(!r.nodes[i.to1dIndex(t,r.width)])throw console.error(e,t,r),Error("Cannot setupPFGraph: End point is not in PFGraph");r.nodes.forEach(e=>{e.visited=!1,e.connections=((e,t)=>{let r=t.nodes[i.to1dIndex([e.x,e.y-1],t.width)],a=t.nodes[i.to1dIndex([e.x-1,e.y],t.width)],o=t.nodes[i.to1dIndex([e.x,e.y+1],t.width)],n=t.nodes[i.to1dIndex([e.x+1,e.y],t.width)];return[r,a,o,n].filter(e=>!(!e||e.isWall||o&&o.isWall||n&&n.isWall)).map(e=>({node:e,cost:1}))})(e,r)})})(e,t,o);let n=o.nodes[i.to1dIndex(e,o.width)];if(!n)throw console.error(e,t,o),Error("Cannot createPFPath: Start point is not in PFGraph");let s=o.nodes[i.to1dIndex(t,o.width)];if(!s)throw console.error(e,t,o),Error("Cannot createPFPath: End point is not in PFGraph");if(n===s)return a.path=[[n.x,n.y]],a;let l=[n];n.cost=0,n.hCost=0;let c=0;for(;l.length&&c<500;){let e=l.shift();if(e===s)break;if(!e)break;for(let t=0;t<e.connections.length;t++){let{node:r,cost:a}=e.connections[t],o=e.cost+a;o<r.cost&&(r.cost=o,r.hCost=o+i.calculateDistance([r.x,r.y,0],[s.x,s.y,0]),r.parent=e,l.includes(r)||l.push(r))}l=l.sort((e,t)=>e.hCost<t.hCost?-1:1),c++}if(1e3===c||0===l.length)return console.error("Cannot find path, too long or impossible"),a;let A=s;do{a.path.push([A.x,A.y]),A=A.parent}while(A&&A.parent);return a.path=a.path.reverse(),a}})),define("db/overworld-ai",["require","exports","model/character","model/overworld","model/utility","utils","model/generics","model/room","controller/pathfinding","controller/battle-management","controller/battle-actions","model/particle","model/sound"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.getIfExists=t.get=void 0;let h={};t.get=e=>{let t=h[e];if(!t)throw Error("No overworld-ai exists with name: "+e);return Object.assign({},t)},t.getIfExists=e=>{let t=h[e];return t?Object.assign({},t):null},t.init=()=>{h.DO_NOTHING={update:function(){}},h.ROAM_SEEK_PLAYER={onCreate:e=>{e.aiState.halted=!0;let t=new a.Timer(500);t.awaits.push(()=>{e.aiState.halted=!1}),r.characterAddTimer(e,t)},update:e=>{e.aiState.halted||e.walkTarget||(e=>{let t=n.getCurrentRoom(),i=r.characterGetPos(e),c=r.characterGetPos(n.getCurrentPlayer().leader),A=s.roomGetTileBelow(t,o.truncatePoint3d(i)),d=s.roomGetTileBelow(t,o.truncatePoint3d(c)),u=l.createPFPath([(null==A?void 0:A.x)||0,(null==A?void 0:A.y)||0],[(null==d?void 0:d.x)||0,(null==d?void 0:d.y)||0],n.getCurrentRoom()),h=l.pfPathToRoomPath(u)[1];if(h)r.characterSetWalkTarget(e,[h[0],h[1]],()=>{});else{e.aiState.halted=!0;let t=new a.Timer(500);t.awaits.push(()=>{e.aiState.halted=!1}),r.characterAddTimer(e,t)}})(e),!e.aiState.encountered&&r.characterCollidesWithOther(e,n.getCurrentPlayer().leader)&&(e.aiState.halted=!0,e.aiState.encountered=!0,s.roomRemoveCharacter(n.getCurrentRoom(),e),(e=>{let t=e.encounter,a=n.getCurrentRoom();if(t){u.playSoundName("battle_encountered"),i.overworldHide(n.getCurrentOverworld());let e=n.getCurrentPlayer(),o=r.characterGetPos(e.leader);c.transitionToBattle(e,t,c.getReturnToOverworldBattleCompletionCB(a,o,e.leader.facing,t),!1)}else console.error("ERROR: Roamer has no Encounter!",e)})(e))}};let e=function(e){let[t,i]=e,l=(e,a)=>{let l=n.getCurrentRoom(),[c,A]=r.characterGetPos(e),d=e.aiState.nextMarker;e.aiState.nextMarker=(d+1)%2;let u=((e,t,r)=>{let i=s.roomGetTileBelow(e,t);if(!i)return console.error(e,t,r),console.error("cannot findNextLinearWalkPosition, given startingPoint is not contained within the room."),[0,0];let[a,n]=o.facingToIncrements(r),l=0,c=t[0],A=t[1];do{if(i){let t=s.roomGetTileAt(e,i.x+a,i.y+n);if(!t||t.isWall)break;i=t,c+=16*a,A+=16*n}l++}while(l<100);return c-=8*a,A-=8*n,[c,A]})(l,[c,A],0===d?t:i);r.characterSetWalkTarget(e,u,a)};return{onCreate:e=>{e.aiState.isWaiting=!0,e.aiState.nextMarker=1;let t=new a.Timer(500);t.awaits.push(()=>{l(e,()=>{e.aiState.isWaiting=!1})}),r.characterAddTimer(e,t)},update:e=>{if(!e.aiState.isWaiting){e.aiState.isWaiting=!0;let t=new a.Timer(600);t.awaits.push(()=>{l(e,()=>{e.aiState.isWaiting=!1})}),r.characterAddTimer(e,t)}let t=n.getCurrentPlayer();if(r.characterCanSeeOther(e,t.leader)){u.playSoundName("aggro_alert");let t=A.createParticleAtCharacter(Object.assign({},d.EFFECT_TEMPLATE_AGGROED),e);s.roomAddParticle(n.getCurrentRoom(),t),r.characterClearTimers(e),r.characterStopWalking(e),r.characterSetOverworldAi(e,h.ROAM_SEEK_PLAYER)}}}};h.ROAM_WALK_RIGHT_LEFT=e([r.Facing.RIGHT,r.Facing.LEFT]),h.ROAM_WALK_UP_DOWN=e([r.Facing.UP,r.Facing.DOWN]),h.ROAM_WALK_RIGHTUP_LEFTDOWN=e([r.Facing.RIGHT_UP,r.Facing.LEFT_DOWN]),h.ROAM_WALK_RIGHTDOWN_LEFTUP=e([r.Facing.RIGHT_DOWN,r.Facing.LEFT_UP]),h.WALK_BETWEEN_MARKERS_ABC=function(){let e=["MarkerWalkA","MarkerWalkB","MarkerWalkC"],t=(t,i)=>{let a=n.getCurrentRoom(),o=t.aiState.nextMarker,s=e[o];t.aiState.nextMarker=(o+1)%e.length;let l=a.markers[s];l?r.characterSetWalkTarget(t,[l.x,l.y],i):console.error("OAI: Could not find target marker with name: "+s)};return{onCreate:e=>{e.aiState.isWaiting=!0,e.aiState.nextMarker=0;let i=new a.Timer(500);i.awaits.push(()=>{t(e,()=>{e.aiState.isWaiting=!1})}),r.characterAddTimer(e,i)},update:e=>{if(!e.aiState.isWaiting){e.aiState.isWaiting=!0;let i=new a.Timer(600);i.awaits.push(()=>{t(e,()=>{e.aiState.isWaiting=!1})}),r.characterAddTimer(e,i)}}}}()}})),define("model/character",["require","exports","model/animation","model/battle","utils","controller/battle-actions","model/generics","model/room","model/canvas","view/draw","model/player","db/overworld-ai","db/encounters"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u){"use strict";var h,m,g;Object.defineProperty(t,"__esModule",{value:!0}),t.characterUpdate=t.characterSetOverworldAi=t.characterClearTimers=t.characterCollidesWithOther=t.characterCanSeeOther=t.characterGetVisionPoint=t.characterHasAnimationState=t.characterRestoreState=t.characterStoreState=t.characterHasTimer=t.characterStopWalking=t.characterStartAi=t.characterStopAi=t.characterRemoveTimer=t.characterAddTimer=t.characterHasTag=t.characterRemoveTag=t.characterAddTag=t.characterCollidesWithRect=t.characterCollidesWithPoint=t.characterResetSpeed=t.characterSetSpeed=t.characterHasWalkTarget=t.characterSetWalkTarget=t.characterGetSize=t.characterGetPosTopLeft=t.characterGetPosCenterPx=t.characterGetPosTopLeftPx=t.characterGetPosPx=t.characterGetPosBottom=t.characterGetPos=t.characterSetTransform=t.characterGetHpPct=t.characterModifyHp=t.characterSetFacingFromAngle=t.characterSetFacing=t.characterOnAnimationCompletion=t.characterSetPos=t.characterOverrideAnimation=t.characterGetAnimationState=t.characterSetAnimationState=t.characterGetAnimation=t.characterGetAnimKey=t.characterCreateFromTemplate=t.characterCreate=t.ANIMATIONS_WITHOUT_FACING=t.AnimationState=t.Facing=t.WeaponEquipState=t.DEFAULT_SPEED=void 0,t.DEFAULT_SPEED=.5,function(e){e.NORMAL="normal",e.RANGED="ranged",e.MAGIC="magic"}(h=t.WeaponEquipState||(t.WeaponEquipState={})),function(e){e.LEFT="left",e.UP="up",e.DOWN="down",e.LEFT_UP="leftup",e.LEFT_DOWN="leftdown",e.RIGHT="left_f",e.RIGHT_UP="leftup_f",e.RIGHT_DOWN="leftdown_f",e.RIGHT2="right",e.RIGHT_UP2="rightup",e.RIGHT_DOWN2="rightdown"}(m=t.Facing||(t.Facing={})),function(e){e.OVERRIDDEN="overridden",e.IDLE="idle",e.WALK="walk",e.BATTLE_IDLE="battle_idle",e.BATTLE_IDLE_RANGED="battle_idle_ranged",e.BATTLE_JUMP="battle_jump",e.BATTLE_ATTACK="battle_attack",e.BATTLE_ATTACK_PIERCE="battle_attack_p",e.BATTLE_ATTACK_KNOCKDOWN="battle_attack_k",e.BATTLE_ATTACK_FINISH="battle_attack_f",e.BATTLE_DAMAGED="battle_damaged",e.BATTLE_STAGGERED="battle_staggered",e.BATTLE_RANGED="battle_ranged",e.BATTLE_CAST="battle_cast",e.BATTLE_SPELL="battle_spell",e.BATTLE_ITEM="battle_item",e.BATTLE_FLOURISH="battle_flourish",e.BATTLE_DEFEATED="battle_defeated",e.BATTLE_DEAD="battle_dead"}(g=t.AnimationState||(t.AnimationState={})),t.ANIMATIONS_WITHOUT_FACING=[g.BATTLE_FLOURISH],t.characterCreate=e=>{let r={name:e,nameLabel:e,spriteBase:"ada",x:0,y:0,z:0,vx:0,vy:0,spriteWidth:32,spriteHeight:32,speed:t.DEFAULT_SPEED,transform:null,hp:10,stats:i.battleStatsCreate(),skills:[o.BattleActions.SWING],skillIndex:0,facing:m.LEFT,animationState:g.IDLE,animationKey:"",animationOverride:null,storedAnimations:{},weaponEquipState:h.NORMAL,walkTarget:null,walkAngle:0,walkDistance:0,walkRetries:0,onReachWalkTarget:null,talkTrigger:"",aiState:{},aiEnabled:!0,overworldAi:d.get("DO_NOTHING"),storedState:{},timers:[],tags:[],highlighted:!1,visionRange:32,collisionSize:[16,16],template:null};return r.ro={character:r,sortY:0,visible:!0},r.animationKey=t.characterGetAnimKey(r),r},t.characterCreateFromTemplate=e=>{var r,i,a;let o=t.characterCreate(e.name);if(o.spriteBase=e.spriteBase,o.facing=e.facing||o.facing,o.animationState=e.animationState||o.animationState,o.animationKey=t.characterGetAnimKey(o),o.hp=null!==(i=null===(r=null==e?void 0:e.stats)||void 0===r?void 0:r.HP)&&void 0!==i?i:o.stats.HP,o.stats=Object.assign({},e.stats||o.stats),o.skills=e.skills||o.skills,o.talkTrigger=null!==(a=e.talkTrigger)&&void 0!==a?a:"",o.tags=e.tags||[],e.overworldAi&&(o.overworldAi=d.get(e.overworldAi)),o.overworldAi.onCreate&&o.overworldAi.onCreate(o),e.nameLabel&&(o.nameLabel=e.nameLabel),e.weaponEquipState&&(o.weaponEquipState=e.weaponEquipState),e.spriteSize&&(o.spriteWidth=e.spriteSize[0],o.spriteHeight=e.spriteSize[1]),e.canGetStuckWhileWalking&&(o.walkRetries=-1/0),e.encounterName){let t=u.getIfExists(e.encounterName);if(!t)throw console.error(e),Error(`Cannot create character from template.  No encounter exists with encounterName="${e.encounterName}"`);o.encounter=t}return e.speed&&(o.speed=e.speed),o.template=e,o},t.characterGetAnimKey=e=>{let{spriteBase:r,facing:i,animationState:a}=e;return t.ANIMATIONS_WITHOUT_FACING.includes(a)?`${r}_${a}`:`${r}_${a}_${i}`},t.characterGetAnimation=e=>{let{storedAnimations:i}=e;if(e.animationState===g.OVERRIDDEN){let t=e.animationOverride;if(t)return t;throw Error("Null overridden animation.")}let a=t.characterGetAnimKey(e),o=i[a];if(o)return o;{let e=r.createAnimation(a);return i[a]=e,e}},t.characterSetAnimationState=(e,r,i)=>{e.animationState=r;let a=t.characterGetAnimKey(e);if(a!==e.animationKey){if(e.animationPromise&&(e.animationPromise.reject(),e.animationPromise=void 0),e.animationState===g.OVERRIDDEN)return;e.animationKey=a;let r=t.characterGetAnimation(e);r.reset(),r.start()}else if(i){let r=t.characterGetAnimation(e);r.reset(),r.start()}},t.characterGetAnimationState=e=>e.animationState,t.characterOverrideAnimation=(e,r,i)=>{t.characterSetAnimationState(e,g.OVERRIDDEN),e.animationOverride=r,i&&(r.loop||r.awaits.push(i)),r.reset(),r.start()},t.characterSetPos=(e,t)=>{e.x=t[0],e.y=t[1],e.z=t[2]},t.characterOnAnimationCompletion=(e,r)=>{e.animationPromise&&(t.characterGetAnimation(e),e.animationPromise.reject());let i=t.characterGetAnimation(e);if(i.loop)return console.error("Setting characterOnAnimationCompletion for an animation set with loop=true",i.name),Promise.resolve();let a={},o=new Promise((t,r)=>{a.resolve=t,a.reject=r,(async()=>{await i.onCompletion(),e.animationPromise=void 0,t()})()}).then(()=>{r()}).catch(e=>{});return e.animationPromise=a,o},t.characterSetFacing=(e,r)=>{e.facing=r,t.characterSetAnimationState(e,e.animationState)},t.characterSetFacingFromAngle=(e,r)=>{if(r>337.5||r<22.5)return void t.characterSetFacing(e,m.UP);let i=[m.UP,m.RIGHT_UP,m.RIGHT,m.RIGHT_DOWN,m.DOWN,m.LEFT_DOWN,m.LEFT,m.LEFT_UP];for(let a=1;a<8;a++)r>=45*a-22.5&&r<=45*(a+1)-22.5&&t.characterSetFacing(e,i[a])},t.characterModifyHp=(e,t)=>{e.hp+=t,e.hp>e.stats.HP?e.hp=e.stats.HP:e.hp<0&&(e.hp=0)},t.characterGetHpPct=e=>+(e.hp/e.stats.HP).toFixed(2),t.characterSetTransform=(e,t)=>{e.transform=t},t.characterGetPos=e=>e.transform?e.transform.current():[e.x,e.y,e.z],t.characterGetPosBottom=e=>{let{x:t,y:r}=e;return[t+16,r+16-4]},t.characterGetPosPx=e=>{let[r,i,o]=t.characterGetPos(e);return a.isoToPixelCoords(r,i,o)},t.characterGetPosTopLeftPx=e=>t.characterGetPosPx(e),t.characterGetPosCenterPx=e=>{let[r,i,o]=t.characterGetPosTopLeft(e),[n,s]=a.isoToPixelCoords(r,i,o),[l,c]=t.characterGetSize(e);return[n+l/2,s+c/2]},t.characterGetPosTopLeft=e=>{let[r,i,a]=t.characterGetPos(e),[o,n]=t.characterGetSize(e);return[r-(o-32),i-(n-32)/2,a]},t.characterGetSize=e=>[e.spriteWidth,e.spriteHeight],t.characterSetWalkTarget=(e,r,i)=>{e.walkTarget=r,e.onReachWalkTarget=i;let o=t.characterGetPosBottom(e),n=p(e),s=a.getAngleTowards(o,n);e.walkAngle=s,e.walkDistance=a.calculateDistance(a.extrapolatePoint(o),a.extrapolatePoint(n)),e.walkRetries>0&&(e.walkRetries=0),t.characterCollidesWithPoint(e,[...n,1.5])&&E(e)},t.characterHasWalkTarget=e=>!!e.walkTarget;let p=e=>e.walkTarget?[e.walkTarget[0]+16,e.walkTarget[1]+16-4]:[0,0];t.characterSetSpeed=(e,t)=>{e.speed=t},t.characterResetSpeed=e=>{e.speed=t.DEFAULT_SPEED},t.characterCollidesWithPoint=(e,r)=>{let i=[...t.characterGetPosBottom(e),1];return a.circleCircleCollision(i,r)},t.characterCollidesWithRect=(e,r)=>{let i=[...t.characterGetPosBottom(e),2];return"none"!==a.circleRectCollision(i,r)},t.characterAddTag=(e,r)=>{t.characterHasTag(e,r)||e.tags.push(r)},t.characterRemoveTag=(e,t)=>{let r=e.tags.indexOf(t);r>-1&&e.tags.splice(r,1)},t.characterHasTag=(e,t)=>e.tags.includes(t),t.characterAddTimer=(e,r)=>{t.characterHasTimer(e,r)||e.timers.push(r)},t.characterRemoveTimer=(e,t)=>{let r=e.timers.indexOf(t);r>-1&&e.timers.splice(r,1)},t.characterStopAi=e=>{t.characterStoreState(e),e.aiEnabled=!1,t.characterStopWalking(e)},t.characterStartAi=e=>{e.aiEnabled=!0,t.characterRestoreState(e)};let E=e=>{var r,i;t.characterSetAnimationState(e,g.IDLE);let a=e.walkTarget;t.characterSetPos(e,[null!==(r=null==a?void 0:a[0])&&void 0!==r?r:0,null!==(i=null==a?void 0:a[1])&&void 0!==i?i:0,e.z]),e.onReachWalkTarget&&e.onReachWalkTarget(),e.walkTarget=null,e.onReachWalkTarget=null};t.characterStopWalking=e=>{e.walkTarget=null,t.characterSetAnimationState(e,g.IDLE)},t.characterHasTimer=(e,t)=>e.timers.includes(t),t.characterStoreState=e=>{e.storedState.facing=e.facing,e.storedState.walkTarget=e.walkTarget},t.characterRestoreState=e=>{e.storedState.facing&&t.characterSetFacing(e,e.storedState.facing),e.storedState.walkTarget&&(e.walkTarget=e.storedState.walkTarget)},t.characterHasAnimationState=(e,i)=>{let a=e.animationState,o=e.animationKey;e.animationState=i;let n=t.characterGetAnimKey(e);return e.animationState=a,e.animationKey=o,r.hasAnimation(n)},t.characterGetVisionPoint=e=>{let[r,i]=t.characterGetPos(e),[o,n]=a.facingToIncrements(a.pxFacingToWorldFacing(e.facing));return[r+e.visionRange*o/2,i+e.visionRange*n/2]},t.characterCanSeeOther=(e,r)=>{let[i,o]=t.characterGetPos(r),[n,s]=t.characterGetVisionPoint(e);return a.circleCircleCollision([i,o,1],[n,s,e.visionRange])},t.characterCollidesWithOther=(e,r)=>{let[i,o]=t.characterGetPos(e),[n,s]=e.collisionSize,[l,c]=t.characterGetPos(r);return"none"!==a.circleRectCollision([l,c,Math.min(r.collisionSize[0]/2,r.collisionSize[1]/2)],[i-n/2,o-s/2,n,s])},t.characterClearTimers=e=>{e.timers=[]},t.characterSetOverworldAi=(e,t)=>{e.overworldAi=t,t.onCreate&&t.onCreate(e)},t.characterUpdate=e=>{let r=n.getCurrentRoom(),i=n.getFrameMultiplier();if(e.transform&&(e.transform.update(),e.transform.shouldRemove&&(e.transform=null)),e.walkTarget){let r=t.characterGetPosBottom(e),i=p(e),o=a.getAngleTowards(r,i);e.walkAngle=o;let n=Math.sin(e.walkAngle*Math.PI/180),s=-Math.cos(e.walkAngle*Math.PI/180),l=e.walkDistance;e.walkDistance=a.calculateDistance(a.extrapolatePoint(r),a.extrapolatePoint(i)),l<=e.walkDistance&&e.walkRetries++,e.vx=n,e.vy=s,t.characterSetAnimationState(e,g.WALK),(e.walkRetries>10||t.characterCollidesWithPoint(e,[...i,1.5]))&&(E(e),e.vx=0,e.vy=0)}if(0!==e.vx||0!==e.vy){let[o,n]=a.getNormalizedVec(e.vx,e.vy),l=o*i*e.speed,c=n*i*e.speed,{x:A,y:d}=e;e.x+=l,e.y+=c;let u=a.getAngleFromVector(-l,-c)-45;if(u<0&&(u+=360),t.characterSetFacingFromAngle(e,u),w(e)){let t=s.roomGetTileBelow(r,[e.x,e.y]),i=null,a=null,o=null;t&&(i=s.roomGetTileAt(r,t.x,Math.floor((e.y+22)/s.TILE_HEIGHT_WORLD)),a=s.roomGetTileAt(r,Math.floor((e.x+22)/s.TILE_WIDTH_WORLD),t.y),o=s.roomGetTileAt(r,Math.floor((e.x+22)/s.TILE_WIDTH_WORLD),Math.floor((e.y+22)/s.TILE_HEIGHT_WORLD)));let n=f(i)||f(a)||f(o);((null==t?void 0:t.isWall)||n)&&(e.x=A,e.y=d)}else[s.roomGetTileBelow(r,[e.x-0,e.y+0])].reduce((e,t)=>e||f(t),!1)&&(e.x=A,e.y=d,e.encounter&&(t.characterStopWalking(e),t.characterStopAi(e),a.timeoutPromise(250+250*Math.random()).then(()=>{t.characterStartAi(e)})))}let[o,l]=t.characterGetPos(e),[,c]=a.isoToPixelCoords(o,l,0);e.ro&&(e.ro.sortY=c+32),e.vx=0,e.vy=0};let f=e=>(null==e?void 0:e.isWall)&&!(null==e?void 0:e.isProp),w=e=>"ada"===e.spriteBase})),define("model/room",["require","exports","model/sprite","utils","model/character","db/characters/index","view/draw","lib/rpgscript","db/tiles","model/animation","model/render-object","model/canvas"],(function(e,t,r,i,a,o,n,s,l,c,A,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.roomGetDistanceToNearestWallInFacingDirection=t.roomHide=t.roomShow=t.roomRemoveCharacter=t.roomAddCharacter=t.roomGetCharacterByName=t.roomGetTileBelow=t.roomAddParticle=t.roomGetTileAt=t.createRoom=t.awaitAllRoomProps=t.loadDynamicPropsTileset=t.roomCopy=t.tilePosToWorldPos=t.TILE_HEIGHT_WORLD=t.TILE_WIDTH_WORLD=t.TILE_HEIGHT=t.TILE_WIDTH=void 0,t.TILE_WIDTH=32,t.TILE_HEIGHT=32,t.TILE_WIDTH_WORLD=16,t.TILE_HEIGHT_WORLD=16,t.tilePosToWorldPos=(e,r)=>[e*t.TILE_WIDTH/2,r*t.TILE_HEIGHT/2];let u=e=>["props_0","props_1","props_2","props_3","props_4","props_5","props_6","props_8","props_9","props_10","props_11","props_12","props_13"].includes(e);t.roomCopy=e=>t.createRoom(e.name,e.tiledJson);let h=(e,t)=>{if(0===t)return{sprite:"invisible",tileWidth:32,tileHeight:32};let r=0;do{let i=e[r],a=e[r+1];if(!a||t>=i.firstgid&&t<a.firstgid)return{sprite:i.name+"_"+(t-i.firstgid),tileWidth:i.tilewidth,tileHeight:i.tileheight};r++}while(r<e.length);throw Error("Could not determine sprite from gid:"+t)},m=null;t.loadDynamicPropsTileset=async()=>{var e,t;let r=await fetch("res/props-dynamic.tiled-sheet.tsx").then(e=>e.text());r&&(m=null!==(t=null===(e=r.match(/source="(.*)\.[\w]+"/g))||void 0===e?void 0:e.map(e=>e.slice(e.indexOf('"')+1,e.lastIndexOf('"')-4)))&&void 0!==t?t:null)};let g=[];t.awaitAllRoomProps=async()=>{await Promise.all(g)},t.createRoom=(e,p)=>{var E;let{width:f,height:w,data:C}=null!==(E=p.layers.find(e=>"Tiles"===e.name))&&void 0!==E?E:{};if(!C)throw Error(`Cannot create room '${e}', it does not have a layer named 'Tiles'`);let y=p.layers.find(e=>"Tiles2"===e.name),{objects:b}=p.layers.find(e=>"Props"===e.name)||{},{objects:T}=p.layers.find(e=>"Objects"===e.name)||{},{firstgid:S}=p.tilesets.find(e=>{var t;return"props-dynamic"===e.name||(null!==(t=e.source)&&void 0!==t?t:"").indexOf("props-dynamic")>-1})||{firstGid:-9999999},v=f*t.TILE_WIDTH,x=w*t.TILE_HEIGHT/2,[B,I]=d.createCanvas(v,x+t.TILE_HEIGHT),_={name:e,tiledJson:p,width:f,height:w,widthPx:v,heightPx:x,props:[],tiles:[],characters:[],particles:[],markers:{},triggerActivators:[],renderObjects:[],floorTileObjects:[],floor:r.createSprite(B),defaultFloorSprite:"floors_1",visible:!0},R=t=>{let a=t.x,o=t.y,n=t.gid,s=n-S;if(n>=S&&n<S+(null==m?void 0:m.length)&&m){let l=m[s];if(!l)throw Error(`Could not load prop in room definition '${e}', the propIndex '${s}' has no associated tilesetTile. (gid=${n} startingGid=${S})`);g.push(new Promise(e=>{r.loadImageAsSprite(l,i.removeFileExtension(l)).then(()=>{let r={x:a,y:o,sprite:l,isDynamic:!0,isFront:"front"===t.type};_.props.push(r),_.renderObjects.push(A.createPropRenderObject(r)),e()})}))}},M=C.slice();y&&y.data&&y.data.forEach((e,t)=>{0!==e&&(M[t]=e)}),M.forEach((e,t)=>{var r;if(0===e)return;let{sprite:i,tileWidth:a,tileHeight:o}=h(p.tilesets,e),n=i.indexOf("wall")>-1,s=i.indexOf("props")>-1,d=y&&C[t]!==y.data[t],m={sprite:i,tileWidth:a,tileHeight:o,isWall:n||s,isProp:s&&!u(i),id:e-1,x:t%f,y:Math.floor(t/f),highlighted:!1};_.tiles.push(m);let g=A.createTileRenderObject(m);if(g.isFloor)_.renderObjects.push(g),"floors_0"===m.sprite&&(m.isProp=!0,m.isWall=!0);else{let e=_.defaultFloorSprite;if(d){let{sprite:r}=h(p.tilesets,C[t]);e=r}if(m.isWall&&!m.isProp){let r=Object.assign(Object.assign({},m),{tileWidth:32,tileHeight:32,sprite:e,id:d&&C[t]||1}),i=A.createTileRenderObject(r);r.ro=i,m.floorTileBeneath=r,_.renderObjects.push(i)}else{g.sortY+=8;let t=Object.assign(Object.assign({},m),{tileWidth:32,tileHeight:32,sprite:e,id:1,x:m.x,y:m.y}),r=A.createTileRenderObject(t);t.ro=r,m.floorTileBeneath=t,_.renderObjects.push(r)}_.renderObjects.push(g)}m.ro=g;let E=l.getReplacementTemplate(m.sprite);E&&(m.ro.sprite=E.baseSprite,m.isWall=null!==(r=E.isWall)&&void 0!==r?r:m.isWall,(null==E?void 0:E.animName)&&(m.animName=E.animName,m.ro.anim=c.createAnimation(E.animName),m.ro.anim.start()))}),b&&b.forEach(R),T&&T.forEach(r=>{let n=r.name.toLowerCase().indexOf("marker")>-1,l=0===r.name.toLowerCase().indexOf("#");n?(t=>{let r=t.x,a=t.y,[o,n]=i.isoToPixelCoords(r,a),[s,l]=i.pixelToIsoCoords(o,n-16);if(_.markers[t.name])throw Error(`Could not load marker '${t.name}' in room definition '${e}', a marker with that name already exists.)`);let c={name:t.name,x:s,y:l};_.markers[t.name]=c,_.renderObjects.push(A.createMarkerRenderObject(c))})(r):l?(t=>{let r=t.x,a=t.y,o=t.width,n=t.height,l=t.name.slice(1);if(void 0===t.gid){let e=8,t=24,i={polygon:[[t+r,e+a],[t+r+o,e+a],[t+r+o,e+a+n],[t+r,e+a+n]],name:l,x:r,y:a,width:o,height:n,isTrigger:!0};_.triggerActivators.push(i),_.renderObjects.push(A.createTriggerActivatorRenderObject(i))}else{let[o,n]=i.isoToPixelCoords(r,a),[c,d]=i.pixelToIsoCoords(o,n-16);if(!s.getTrigger(l))throw Error(`Could not load trigger '${t.name}' in room definition '${e}', a trigger with that name does not exist.)`);let u={name:l,x:c,y:d,width:16,height:16,isTrigger:!0};_.triggerActivators.push(u),_.renderObjects.push(A.createTriggerActivatorRenderObject(u))}})(r):r.name?(r=>{var n;let s=r.x,l=r.y,[c,A]=i.isoToPixelCoords(s,l),[d,u]=i.pixelToIsoCoords(c,A-16),h=o.get(r.name);if(!h)throw Error(`Could not load character '${r.name}' in room definition '${e}', no entry in the db.`);let m=null!==(n=r.properties)&&void 0!==n?n:[],g=m.find(e=>"overworldAi"===e.name);g&&(h.overworldAi=g.value);let p=m.find(e=>"encounterName"===e.name);p?h.encounterName=p.value:g&&console.error(`Error, character has an overworldAi but not an encounterName: ${r.name} `,r);let E=a.characterCreateFromTemplate(h);a.characterSetPos(E,[d,u,0]),t.roomAddCharacter(_,E)})(r):R(r)}),_.floorTileObjects=_.floorTileObjects.sort((e,t)=>e.sortY<t.sortY?-1:1);for(let e=0;e<_.floorTileObjects.length;e++){let{sprite:t,px:r,py:i}=_.floorTileObjects[e];t&&n.drawSprite(t,r+_.widthPx/2,i,1,I)}return _},t.roomGetTileAt=(e,t,r)=>t<0||t>=e.width||r<0||r>=e.height?null:e.tiles[r*e.width+t],t.roomAddParticle=(e,t)=>{e.particles.push(t)},t.roomGetTileBelow=(e,r)=>{let[i,a]=r;return t.roomGetTileAt(e,Math.floor((i+t.TILE_WIDTH_WORLD-3)/t.TILE_WIDTH*2),Math.floor((a+t.TILE_HEIGHT_WORLD-3)/t.TILE_HEIGHT*2))},t.roomGetCharacterByName=(e,t)=>{for(let r=0;r<e.characters.length;r++){let i=e.characters[r];if(i.name===t)return i}return null},t.roomAddCharacter=(e,t)=>{e.characters.push(t),t.ro&&e.renderObjects.push(t.ro)},t.roomRemoveCharacter=(e,t)=>{let r=e.characters.indexOf(t);if(r>-1&&e.characters.splice(r,1),t.ro){let r=e.renderObjects.indexOf(t.ro);r>-1&&e.renderObjects.splice(r,1)}},t.roomShow=e=>{e.visible=!0},t.roomHide=e=>{e.visible=!1};let p=(e,r,a,o)=>{let n=t.roomGetTileBelow(e,[r,a]);if(!n)return console.error(e,r,a),console.error("cannot _innerNearestInSomeDirection, given point is not contained within the room."),1/0;let[s,l]=i.facingToIncrements(i.pxFacingToWorldFacing(o)),c=0,A=0,d=0;do{if(n){let i=t.roomGetTileBelow(e,[r+A,a+d]);if(!i||i.isWall)break;n=i,A+=1*s,d+=1*l}c++}while(c<100);return i.calculateDistance([r,a,0],[r+A,a+d,0])};t.roomGetDistanceToNearestWallInFacingDirection=(e,t)=>{let[r,i]=a.characterGetPosBottom(t),o=[[r+32,i],[r-32,i],[r,i+32],[r,i-32]],n=1/0;for(let r=0;r<o.length;r++){let i=p(e,o[r][0],o[r][1],t.facing);n=Math.min(n,i)}return n}})),define("model/utility",["require","exports","model/generics","utils","model/room"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=t.transformOffsetJumpFar=t.transformOffsetJumpMedium=t.transformOffsetJumpShort=t.transformOffsetWeightedParticle=t.transformOffsetFlat=t.TransformEase=t.Gauge=t.Timer=void 0;class o{constructor(e){this.timestampStart=r.getNow(),this.timestampPause=0,this.duration=e,this.shouldRemove=!1,this.paused=!1,this.pausedOverridden=!1,this.awaits=[]}start(e){this.paused&&(this.timestampPause=r.getNow(),this.unpause()),this.timestampStart=r.getNow(),this.duration=null!=e?e:this.duration}isPaused(){return this.paused||this.pausedOverridden}pause(){this.paused||(this.paused=!0,this.timestampPause=r.getNow())}pauseOverride(){this.pausedOverridden||(this.pausedOverridden=!0,this.paused||(this.timestampPause=r.getNow()))}unpause(){this.paused&&(this.paused=!1,this.updateStart(r.getNow()-this.timestampPause))}unpauseOverride(){this.pausedOverridden&&(this.pausedOverridden=!1,this.paused||this.updateStart(r.getNow()-this.timestampPause))}updateStart(e){this.timestampStart+=e}update(){this.isComplete()&&(this.awaits.forEach(e=>e()),this.awaits=[])}isComplete(){return!this.pausedOverridden&&r.getNow()-this.timestampStart>=this.duration}onCompletion(){return new Promise(e=>{this.isComplete()||this.awaits.push(e)})}getPctComplete(){let e=r.getNow();this.isPaused()&&(e-=e-this.timestampPause);let t=e-this.timestampStart;return t>this.duration?t=this.duration:t<0&&(t=-1),t/this.duration}getDiff(){let e=r.getNow();return this.isPaused()&&(e-=e-this.timestampPause),[e-this.timestampStart,e-this.timestampPause,this.timestampStart,this.timestampPause]}markForRemoval(){this.shouldRemove=!0}}var n;t.Timer=o,t.Gauge=class{constructor(e,t){this.max=e,this.current=0,this.decayRate=t}fill(e){this.current+=e,this.current>this.max&&(this.current=this.max)}empty(){this.current=0}isFull(){return this.current>=this.max}getPct(){return this.current/this.max}update(){this.current-=this.decayRate*r.getFrameMultiplier(),this.current<0&&(this.current=0)}},function(e){e.LINEAR="linear",e.EASE_OUT="ease_out"}(n=t.TransformEase||(t.TransformEase={})),t.transformOffsetFlat=e=>[0*e,0*e,0*e],t.transformOffsetWeightedParticle=e=>{if(e<.6){let t=i.normalizeClamp(e,0,.6,0,1);return[0,-a.TILE_HEIGHT*Math.sin(t*Math.PI),0]}{let t=i.normalizeClamp(e,.6,1,0,1);return[0,-a.TILE_HEIGHT/4*Math.sin(t*Math.PI),0]}},t.transformOffsetJumpShort=e=>[0,0,a.TILE_HEIGHT*Math.sin(e*Math.PI)],t.transformOffsetJumpMedium=e=>[0,0,2*a.TILE_HEIGHT*Math.sin(e*Math.PI)],t.transformOffsetJumpFar=e=>[0,0,4*a.TILE_HEIGHT*Math.sin(e*Math.PI)];class s{constructor(e,r,i,a,n){this.startX=e[0],this.startY=e[1],this.startZ=e[2],this.endX=r[0],this.endY=r[1],this.endZ=r[2],this.timer=new o(i),this.ease=a,this.shouldRemove=!1,this.offsetFunc=n||t.transformOffsetFlat,this.timer.start()}start(){return[this.startX,this.startY,this.endZ]}end(){return[this.endX,this.endY,this.endZ]}current(){let[e,t,r]=this.offsetFunc(this.timer.getPctComplete(),this),a=this.timer.getPctComplete(),o=this.ease===n.EASE_OUT?i.normalizeEaseOutClamp:i.normalizeClamp;return[o(a,0,1,this.startX,this.endX)+e,o(a,0,1,this.startY,this.endY)+t,o(a,0,1,this.startZ,this.endZ)+r]}update(){this.timer.update()}createInverse(){return new s([this.endX,this.endY,this.endZ],[this.startX,this.startY,this.startZ],this.timer.duration,this.ease,this.offsetFunc)}markForRemoval(){this.shouldRemove=!0}}t.Transform=s})),define("utils",["require","exports","model/generics","model/canvas","model/utility","model/character"],(function(e,t,r,i,a,o){"use strict";function n(e,t,r,i){let a=e/i;return-r*a*(a-2)+t}function s(e,t,r,i,a){return i+(e-t)*(a-i)/(r-t)}function l(e,t,r,i,a){let o=s(e,t,r,i,a);return i<a?o>a?o=a:o<i&&(o=i):o<a?o=a:o>i&&(o=i),o}Object.defineProperty(t,"__esModule",{value:!0}),t.to1dIndex=t.facingToIncrements=t.pxFacingToWorldFacing=t.randInArr=t.toFixedPrecision=t.createPolygonFromRect=t.getAngleFromVector=t.degreesToRadians=t.radiansToDegrees=t.getNormalizedVec=t.getAngleTowards=t.circleRectCollision=t.circleCircleCollision=t.calculateDistance=t.removeIfPresent=t.getRandBetween=t.timeoutPromise=t.normalizeEaseOutClamp=t.normalizeEaseOut=t.normalizeClamp=t.normalize=t.randomId=t.extrapolatePoint=t.truncatePoint3d=t.removeFileExtension=t.pxToCanvasCoords4by3=t.worldToCanvasCoords4by3=t.pixelToIsoCoords=t.isoToPixelCoords=void 0,t.isoToPixelCoords=(e,t,r)=>[e-t,(e+t)/2-(null!=r?r:0)/2],t.pixelToIsoCoords=(e,t)=>[(2*t+e)/2,(2*t-e)/2],t.worldToCanvasCoords4by3=(e,r,i)=>{let[a,o]=t.isoToPixelCoords(e,r,i);return t.pxToCanvasCoords4by3(a,o)},t.pxToCanvasCoords4by3=(e,t)=>{let[a,o]=r.getCameraDrawOffset(),n=i.getDrawScale();return[(e+a)*n-(n>=4?686:0),(t+o)*n-(n>=4?512:0)]},t.removeFileExtension=e=>{let t=e.lastIndexOf(".");return t>-1&&(e=e.slice(0,t)),e},t.truncatePoint3d=e=>[e[0],e[1]],t.extrapolatePoint=e=>[e[0],e[1],0],t.randomId=()=>Math.random().toString(36).substr(2,9),t.normalize=s,t.normalizeClamp=l,t.normalizeEaseOut=function(e,t,r,i,a){return n(s(e,t,r,0,1),i,a-i,1)},t.normalizeEaseOutClamp=function(e,t,r,i,a){return n(l(e,t,r,0,1),i,a-i,1)},t.timeoutPromise=async(e,t)=>{let i=new a.Timer(e);t||r.addTimer(i),i.start(),await i.onCompletion(),t||r.removeTimer(i)},t.getRandBetween=(e,t)=>Math.floor(Math.random()*(t-e))+e,t.removeIfPresent=(e,t)=>{let r=e.indexOf(t);return r>-1&&(e.splice(r,1),!0)},t.calculateDistance=(e,t)=>{let[r,i,a]=e,[o,n,s]=t;return Math.sqrt(Math.pow(o-r,2)+Math.pow(n-i,2)+Math.pow(s-a,2))},t.circleCircleCollision=(e,r)=>{let[i,a,o]=e,[n,s,l]=r;return t.calculateDistance([i,a,0],[n,s,0])<=o+l},t.circleRectCollision=(e,t)=>{let[r,i,a]=e,o=[r-a,i-a,2*a,2*a],[n,s,l,c]=o,[A,d,u,h]=t,m=n+l/2-(A+u/2),g=s+c/2-(d+h/2),p=(l+u)/2,E=(c+h)/2,f=p*g,w=E*m,C="none";return Math.abs(m)<=p&&Math.abs(g)<=E&&(C=f>w?f>-w?"bottom":"left":f>-w?"right":"top",r<=A&&i<=d?C="top-left":r>=A+u&&i<=d?C="top-right":r<=A&&i>=d+h?C="bottom-left":r>=A+u&&i>=d+h&&(C="bottom-right")),C},t.getAngleTowards=function(e,t){let[r,i]=e,[a,o]=t,n=o-i,s=a-r,l=Math.sqrt(s*s+n*n),c=0;return c=o>=i&&a>=r?180*Math.asin(n/l)/Math.PI+90:o>=i&&a<r?180*Math.asin(n/-l)/Math.PI-90:o<i&&a>r?180*Math.asin(n/l)/Math.PI+90:180*Math.asin(-n/l)/Math.PI-90,c>=360&&(c=360-c),c<0&&(c=360+c),c},t.getNormalizedVec=(e,t)=>{let r=Math.sqrt(e*e+t*t);return[e/r,t/r]},t.radiansToDegrees=e=>e*(180/Math.PI),t.degreesToRadians=e=>e*(Math.PI/180),t.getAngleFromVector=(e,r)=>{if(0==e)return r>0?90:0==r?0:270;if(0==r)return e>=0?0:180;let i=t.radiansToDegrees(Math.atan(r/e));return e<0&&r<0||e<0?i=180+i:r<0&&(i=270+(90+i)),i},t.createPolygonFromRect=e=>{let[t,r,i,a]=e;return[[t,r],[t+i,r],[t+i,r+a],[t,r+a]]},t.toFixedPrecision=(e,t)=>parseFloat(e.toFixed(t)),t.randInArr=function(e){return e[Math.floor(Math.random()*e.length)]},t.pxFacingToWorldFacing=e=>({[o.Facing.LEFT]:o.Facing.LEFT_DOWN,[o.Facing.RIGHT]:o.Facing.RIGHT_UP,[o.Facing.UP]:o.Facing.LEFT_UP,[o.Facing.DOWN]:o.Facing.RIGHT_DOWN,[o.Facing.LEFT_DOWN]:o.Facing.DOWN,[o.Facing.RIGHT_DOWN]:o.Facing.RIGHT,[o.Facing.LEFT_UP]:o.Facing.LEFT,[o.Facing.RIGHT_UP]:o.Facing.UP}[e]),t.facingToIncrements=e=>{let t=0,r=0;switch(e){case o.Facing.LEFT:t=-1;break;case o.Facing.RIGHT:t=1;break;case o.Facing.UP:r=-1;break;case o.Facing.DOWN:r=1;break;case o.Facing.LEFT_UP:t=-1,r=-1;break;case o.Facing.RIGHT_UP:t=1,r=-1;break;case o.Facing.LEFT_DOWN:t=-1,r=1;break;case o.Facing.RIGHT_DOWN:t=1,r=1}return[t,r]},t.to1dIndex=(e,t)=>e[1]*t+e[0]%t})),define("model/generics",["require","exports","model/sound"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setPlayerWallGlowEnabled=t.getPlayerWallGlowEnabled=t.setGlobalParticleSystem=t.getGlobalParticleSystem=t.getAllTimers=t.removeTimer=t.addTimer=t.setCameraTransform=t.getCameraTransform=t.setCameraDrawOffset=t.getCameraDrawOffset=t.getVolume=t.setVolume=t.setSoundEnabled=t.getSoundEnabled=t.setRenderBackgroundColor=t.getRenderBackgroundColor=t.hideMarkers=t.showMarkers=t.getMarkersVisible=t.hideTriggers=t.showTriggers=t.getTriggersVisible=t.disableKeyUpdate=t.enableKeyUpdate=t.getKeyUpdateEnabled=t.getRenderables=t.removeRenderable=t.addRenderable=t.setIsPaused=t.getIsPaused=t.isKeyDown=t.setKeyUp=t.setKeyDown=t.setMousePos=t.getMousePos=t.setFrameMultiplier=t.getFrameMultiplier=t.setDeltaT=t.getDeltaT=t.setNow=t.getNow=t.setCurrentPlayer=t.getCurrentPlayer=t.setCurrentScene=t.getCurrentScene=t.setCurrentOverworld=t.getCurrentOverworld=t.setCurrentBattle=t.getCurrentBattle=t.setCurrentRoom=t.getCurrentRoom=void 0;let i=window.room=null;t.getCurrentRoom=()=>i,t.setCurrentRoom=e=>{i=window.room=e};let a=window.battle=null;t.getCurrentBattle=()=>a,t.setCurrentBattle=e=>{a=window.battle=e};let o=window.overworld=null;t.getCurrentOverworld=()=>o,t.setCurrentOverworld=e=>{o=window.overworld=e};let n=window.scene=null;t.getCurrentScene=()=>n,t.setCurrentScene=e=>{n=window.scene=e};let s=window.player=null;t.getCurrentPlayer=()=>s,t.setCurrentPlayer=e=>{s=window.player=e};let l=0;t.getNow=()=>l,t.setNow=e=>{l=e};let c=0;t.getDeltaT=()=>c,t.setDeltaT=e=>{c=e};let A=0;t.getFrameMultiplier=()=>A,t.setFrameMultiplier=e=>{A=e};let d=[0,0];t.getMousePos=()=>d,t.setMousePos=(e,t)=>{d=[e,t]};let u={};t.setKeyDown=e=>{u[e]=!0},t.setKeyUp=e=>{u[e]=!1},t.isKeyDown=e=>{var t;return null!==(t=u[e])&&void 0!==t&&t};let h=!1;t.getIsPaused=()=>h,t.setIsPaused=e=>{h=e};let m=window.renderables={};t.addRenderable=(e,t)=>{m[e]=t},t.removeRenderable=e=>{delete m[e]},t.getRenderables=()=>m;let g=!0;t.getKeyUpdateEnabled=()=>g,t.enableKeyUpdate=()=>{g=!0},t.disableKeyUpdate=()=>{g=!1};let p=!1;t.getTriggersVisible=()=>p,t.showTriggers=()=>p=!0,t.hideTriggers=()=>p=!1;let E=!1;t.getMarkersVisible=()=>E,t.showMarkers=()=>E=!0,t.hideMarkers=()=>E=!1;let f="black";t.getRenderBackgroundColor=()=>f,t.setRenderBackgroundColor=e=>f=e;let w=!0;t.getSoundEnabled=()=>w,t.setSoundEnabled=e=>w=e;let C={[r.SoundType.NORMAL]:.5,[r.SoundType.MUSIC]:.5};t.setVolume=(e,t)=>{t>1&&(t=1),t<0&&(t=0),C[e]=t,e===r.SoundType.MUSIC?r.setVolumeForMusic(t):r.setVolumeForActiveSounds(t)},t.getVolume=e=>C[e];let y=[0,0];t.getCameraDrawOffset=()=>y,t.setCameraDrawOffset=e=>y=e;let b=null;t.getCameraTransform=()=>b,t.setCameraTransform=e=>b=e;let T=[];t.addTimer=(...e)=>{e.forEach(e=>{-1===T.indexOf(e)&&T.push(e)})},t.removeTimer=(...e)=>{e.forEach(e=>{let t=T.indexOf(e);t>-1&&T.splice(t,1)})},t.getAllTimers=()=>T;let S=null;t.getGlobalParticleSystem=()=>S,t.setGlobalParticleSystem=e=>S=e;let v=!0;t.getPlayerWallGlowEnabled=()=>v,t.setPlayerWallGlowEnabled=e=>v=e})),define("model/animation",["require","exports","model/generics","model/sprite","db/animation-metadata","model/sound"],(function(e,t,r,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAnimation=t.hasAnimation=t.createAnimationBuilder=t.Animation=void 0;class n{constructor(e){this.loop=e||!1,this.sprites=[],this.done=!1,this.isPaused=!1,this.timestampPause=0,this.totalDurationMs=0,this.currentSpriteIndex=0,this.timestampStart=0,this.name="",this.useSubLoopAnim=!1,this.awaits=[]}reset(e){this.done=!1,this.currentSpriteIndex=0,e?(this.useSubLoopAnim=!0,this.subLoopAnim?this.subLoopAnim.reset(e):this.sprites.forEach(e=>{e.hasPlayedSound=!1})):(this.useSubLoopAnim=!1,this.subLoopAnim&&this.subLoopAnim.reset(),this.sprites.forEach(e=>{e.hasPlayedSound=!1}))}start(){this.timestampStart=r.getNow(),this.useSubLoopAnim&&this.subLoopAnim&&this.subLoopAnim.start()}pause(){this.isPaused||(this.isPaused=!0,this.timestampPause=r.getNow(),this.subLoopAnim&&this.subLoopAnim.pause())}unpause(){this.isPaused&&(this.isPaused=!1,this.timestampStart+=r.getNow()-this.timestampPause,this.currentSpriteIndex=0,this.update(),this.subLoopAnim&&this.subLoopAnim.unpause())}getDurationMs(){return this.totalDurationMs}getLongestFrameMs(){return this.sprites.reduce((e,t)=>t.duration>e?t.duration:e,0)}getLongestFrameIndex(){let e=0;return this.sprites.reduce((t,r,i)=>r.duration>e?(e=r.duration,i):t,0)}getDurationToIndex(e){return e>=this.sprites.length?this.totalDurationMs:this.sprites[e].durationUpToNow}addSprite({name:e,duration:t,offsetX:r,offsetY:i,opacity:a}){this.sprites.push({name:e||"",timestampBegin:this.totalDurationMs,timestampEnd:this.totalDurationMs+(null!=t?t:0),duration:null!=t?t:0,durationUpToNow:this.totalDurationMs,offsetX:r||0,offsetY:i||0,opacity:a,hasPlayedSound:!1}),this.totalDurationMs+=null!=t?t:0}getAnimIndex(e){if(this.useSubLoopAnim&&this.subLoopAnim)return this.subLoopAnim.getAnimIndex(e);let t=0,r=this.currentSpriteIndex,i=this.sprites.length-1;for(;r<=i;){let a=r+Math.floor((i-r)/2);t=a;let{timestampEnd:o,timestampBegin:n}=this.sprites[a],s=(n||0)+this.timestampStart,l=(o||0)+this.timestampStart;if(e<l&&e>s)return a;e>=l?r=a+1:i=a-1}return t}update(){if(this.useSubLoopAnim&&this.subLoopAnim)return void this.subLoopAnim.update();let e=r.getNow();if(this.currentSpriteIndex===this.sprites.length-1&&this.loop&&e-this.timestampStart>this.totalDurationMs){let t=this.timestampStart+this.totalDurationMs;this.reset(!0),this.start(),e-t<this.totalDurationMs&&(this.timestampStart=t)}if(this.currentSpriteIndex=this.getAnimIndex(e),this.loop||e-this.timestampStart>=this.totalDurationMs&&(this.done=!0,this.awaits.forEach(e=>e()),this.awaits=[]),this.meta){let e=this.meta.sounds;e&&e.forEach((e,t)=>{let r=this.sprites[t];this.currentSpriteIndex>=e.frame&&!r.hasPlayedSound&&(o.playSoundName(e.soundName),r.hasPlayedSound=!0)})}}onCompletion(){return new Promise(e=>{this.isDone()||this.loop||this.awaits.push(e)})}getSprite(){var e;return this.useSubLoopAnim&&this.subLoopAnim?this.subLoopAnim.getSprite():null===(e=this.sprites[this.currentSpriteIndex])||void 0===e?void 0:e.name}getSpriteSize(e){let t=r.getNow();e=null!=e?e:this.getAnimIndex(t);let{name:a}=this.sprites[e],[,,,o,n]=i.getSprite(a);return[o,n]}isDone(){return this.done}}t.Animation=n;let s=window.animations={};t.createAnimationBuilder=(e,t)=>{s[e]=t},t.hasAnimation=e=>!!s[e],t.createAnimation=e=>{var t;let r=s[e];if(r){let i=r();i.name=e,i.meta=a.getIfExists(e);let o=null===(t=null==i?void 0:i.meta)||void 0===t?void 0:t.loopFromFrame;if(void 0!==o){let e=new n(!0);for(let t=o;t<i.sprites.length;t++){let r=i.sprites[t];e.addSprite({name:r.name,duration:r.duration})}i.subLoopAnim=e}return i}throw Error(`No animation exists which is named '${e}'`)}})),define("view/draw",["require","exports","model/sprite","model/canvas","model/room","utils","model/character","model/particle","view/style","model/generics"],(function(e,t,r,i,a,o,n,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawRoom=t.drawParticle=t.drawCharacter=t.drawAnimationNF=t.drawAnimation=t.drawSprite=t.drawText=t.measureText=t.drawPolygon=t.drawCircle=t.drawRect=t.getImageDataScreenshot=t.setGlobalAlpha=t.clearScreen=t.circleToPolygonPx=t.DEFAULT_TEXT_PARAMS=void 0,t.DEFAULT_TEXT_PARAMS={font:"monospace",color:"#fff",size:14,align:"left",strokeColor:""},t.circleToPolygonPx=(e,t,r)=>{let i=[];for(let a=0;a<360;a+=10){let n=e+Math.sin(o.degreesToRadians(a))*r,s=t+Math.cos(o.degreesToRadians(a))*r;i.push(o.pxToCanvasCoords4by3(...o.isoToPixelCoords(n,s)))}return i},t.clearScreen=e=>{(e=e||i.getCtx()).clearRect(0,0,e.canvas.width,e.canvas.height)},t.setGlobalAlpha=(e,t)=>{(t=t||i.getCtx()).globalAlpha=e},t.getImageDataScreenshot=e=>(e=e||i.getCtx()).getImageData(0,0,e.canvas.width,e.canvas.height),t.drawRect=(e,t,r,a,o,n,s)=>{(s=s||i.getCtx()).lineWidth=1,s[n?"strokeStyle":"fillStyle"]=o,s[n?"strokeRect":"fillRect"](Math.floor(e),Math.floor(t),r,a)},t.drawCircle=(e,t,r,a,o,n)=>{(n=n||i.getCtx()).lineWidth=1,n[o?"strokeStyle":"fillStyle"]=a,n.beginPath(),n.arc(e,t,r,0,2*Math.PI),n[o?"stroke":"fill"]()},t.drawPolygon=(e,t,r,a)=>{r=r||1,(a=a||i.getCtx()).fillStyle=t,a.strokeStyle=t,a.beginPath();let n=e[0],[s,l]=n,[c,A]=a?[s,l]:o.isoToPixelCoords(s,l,0);a.moveTo(c,A);for(let t=1;t<e.length;t++){let r=e[t],[i,n]=r,[s,l]=a?[i,n]:o.isoToPixelCoords(i,n,0);a.lineTo(s,l)}a.closePath(),a.lineWidth=2,a.stroke()},t.measureText=(e,r,a)=>{a=a||i.getCtx();let{font:o,size:n}=Object.assign(Object.assign({},t.DEFAULT_TEXT_PARAMS),r||{});return a.textAlign="left",a.textBaseline="top",a.font=n+"px "+o,[a.measureText(e).width,null!=n?n:12]},t.drawText=(e,r,a,o,n)=>{let{font:s,size:l,color:c,align:A,strokeColor:d}=Object.assign(Object.assign({},t.DEFAULT_TEXT_PARAMS),o||{});n=n||i.getCtx(),d&&t.drawText(e,r+1,a+1,{font:s,size:l,color:d,align:A},n),n.font=`${l}px ${s}`,n.fillStyle=c||"#FFF",n.textAlign=A,n.textBaseline="middle",n.fillText(e,r,a)},t.drawSprite=(e,t,a,o,n)=>{if(o=o||1,n=n||i.getCtx(),"invisible"!==e)try{n.fillStyle="black",n.strokeStyle="black";let[i,s,l,c,A]="string"==typeof e?r.getSprite(e):e;n.drawImage(i,s,l,c,A,Math.floor(t),Math.floor(a),c*o,A*o)}catch(t){throw console.error(e),Error("Could not draw sprite: "+t)}},t.drawAnimation=(e,t,a,o,n)=>{o=o||1,n=n||i.getCtx(),e.update();let s=e.getSprite();if(!s)throw console.error(e),Error("Cannot draw animation that did not provide a sprite.");try{n.fillStyle="black",n.strokeStyle="black";let[e,i,l,c,A]="string"==typeof s?r.getSprite(s):s;n.drawImage(e,i,l,c,A,Math.floor(t),Math.floor(a),c*o,A*o)}catch(e){throw Error(`Error attempting to draw animation sprite: "${s}"`)}},t.drawAnimationNF=(e,t,a,o,n)=>{o=o||1,n=n||i.getCtx(),e.update();let s=e.getSprite();if(!s)throw console.error(e),Error("Cannot draw animation that did not provide a sprite.");try{n.fillStyle="black",n.strokeStyle="black";let[e,i,l,c,A]="string"==typeof s?r.getSprite(s):s;n.drawImage(e,i,l,c,A,t,a,c*o,A*o)}catch(e){throw Error(`Error attempting to draw animation sprite: "${s}"`)}},t.drawCharacter=(e,r,a)=>{let[s,l,c]=n.characterGetPosTopLeft(e),A=n.characterGetAnimation(e),[d,u]=o.isoToPixelCoords(s,l,c);if(a=a||i.getCtx(),d+=1,u+=0,A.isPaused){let i=A.getSprite();if(!i)throw console.error(A),Error("Cannot draw paused character that did not provide a sprite.");t.drawSprite(i,d,u,r,a),e.highlighted&&(a.globalCompositeOperation="multiply",t.drawSprite(i,d,u,r,a),a.globalCompositeOperation="source-over")}else t.drawAnimation(A,d,u,r,a),e.highlighted&&(a.globalCompositeOperation="multiply",t.drawAnimation(A,d,u,r,a),a.globalCompositeOperation="source-over")},t.drawParticle=(e,r,a,o,n)=>{let{anim:s,text:l,textParams:c,opacity:A,w:d,h:u,color:h,shape:m}=e;(n=null!=n?n:i.getCtx()).globalAlpha=null!=A?A:1,s&&t.drawAnimation(s,r,a,o?o*e.scale:e.scale,n),l&&c&&t.drawText(l,r,a,c,n),d&&u&&h&&m&&("rect"===m?t.drawRect(r-d/2,a-u/2,d,u,h,!1,n):"circle"===m&&t.drawCircle(r,a,d,h,!1,n)),n.globalAlpha=1},t.drawRoom=(e,r,A,d)=>{let{particles:u}=e,[h,m]=r;(A=A||i.getCtx()).save(),A.translate(Math.floor(h),Math.floor(m)),e.renderObjects=e.renderObjects.sort((e,t)=>e.sortY<t.sortY?-1:1);let g=i.getCtx("outer"),p=c.getCurrentPlayer().leader;for(let r=0;r<e.renderObjects.length;r++){let{name:a,sprite:n,anim:s,character:A,px:u,py:h,origPy:m,highlighted:g,visible:p,isMarker:E,isTrigger:f,polygon:w}=e.renderObjects[r];if(p)if(d)A&&t.drawCharacter(A);else if(E){if(c.getMarkersVisible()){let[e,r]=o.pxToCanvasCoords4by3(u+16,h);t.drawText(a||"",e,r,{align:"center",color:l.colors.WHITE,strokeColor:l.colors.BLACK,size:24},i.getCtx("outer")),t.drawSprite(n,u,h)}}else if(f){if(c.getTriggersVisible())if(w){let e=w[0],[r,n]=e,[s,c]=o.pxToCanvasCoords4by3(...o.isoToPixelCoords(r,n,0)),A=w.map(([e,t])=>o.isoToPixelCoords(e,t));t.drawPolygon(A,"rgba(0, 0, 0, 0.5)",1,i.getCtx()),t.drawText(a||"",s,c,{align:"center",color:l.colors.PINK,strokeColor:l.colors.BLACK,size:24},i.getCtx("outer"))}else{let[e,r]=o.pxToCanvasCoords4by3(u+16,h);t.drawSprite(n,u,h),t.drawText(a||"",e,r,{align:"center",color:l.colors.PINK,strokeColor:l.colors.BLACK,size:24},i.getCtx("outer"))}}else s?t.drawAnimation(s,u,h):n?(t.drawSprite(n,u,h),g&&t.drawSprite("indicator",u,m-3)):A&&t.drawCharacter(A)}if(c.getPlayerWallGlowEnabled()&&(A.globalAlpha=.25,A.globalCompositeOperation="luminosity",t.drawCharacter(p),A.globalAlpha=1,A.globalCompositeOperation="source-over"),!d)for(let e=0;e<u.length;e++){let r=u[e];if(r.useOuterCanvas){let[e,i]=s.particleGetPos(r),[a,n]=o.pxToCanvasCoords4by3(e,i);t.drawParticle(r,a,n,1,g)}else{let[e,i]=s.particleGetPos(r);t.drawParticle(r,e,i)}}A.restore();let[E,f]=n.characterGetPos(p);t.drawText(`POS: ${E.toFixed(0)}, ${f.toFixed(0)}`,20,164,{color:"white",size:32},g);let[w,C]=o.isoToPixelCoords(E,f),[y,b]=o.pxToCanvasCoords4by3(w,C);t.drawText(`OPos: ${y.toFixed(0)}, ${b.toFixed(0)}`,20,194,{color:"white",size:32},g);let T=a.roomGetTileBelow(e,[E,f]);t.drawText(`TPos: ${null==T?void 0:T.x.toFixed(0)}, ${null==T?void 0:T.y.toFixed(0)}`,20,224,{color:"white",size:32},g)}})),define("model/sprite",["require","exports","view/draw","model/canvas","model/room"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSprite=t.loadImageAsSpritesheet=t.loadImageAsSprite=t.loadTiles=t.SpriteModification=t.loadImage=t.createSprite=void 0;let o={};var n;window.sprites=o,t.createSprite=(e,t,r,i,a)=>[e,null!=t?t:0,null!=r?r:0,null!=i?i:e.width,null!=a?a:e.height],t.loadImage=async e=>new Promise((t,r)=>{let i=new Image;i.onload=()=>{t(i)},i.onerror=()=>{r("Failed to load image: "+e)},i.src="res/"+e}),function(e){e.NORMAL="",e.FLIPPED="_f",e.ROT90="_r1",e.ROT180="_r2",e.ROT270="_r3"}(n=t.SpriteModification||(t.SpriteModification={}));let s=(e,a,o,s,l)=>{let c=(r,i,a,o,n,s)=>e[r]=t.createSprite(i,a,o,n,s),d=(e,t,o)=>{let d=c(e,a,o*s,t*l,s,l);A(e)&&c(`${e}${n.FLIPPED}`,(e=>{let[t,r,a]=i.createCanvas(e.width,e.height);return r.translate(a,0),r.scale(-1,1),r.drawImage(e,0,0),t})((e=>{let[,,,t,a]=e,[o,n]=i.createCanvas(t,a);return r.drawSprite(e,0,0,1,n),o})(d)),0,0,s,l)},u=a.width/s,h=a.height/l;for(let e=0;e<h;e++)for(let t=0;t<u;t++){let r=`${o}_${e*u+t}`;1!==u||1!==h||r.includes("512")||(r=o),d(r,e,t)}};t.loadTiles=async()=>{let e=await t.loadImage("battle-terrain1.png");s(o,e,"terrain",a.TILE_WIDTH,a.TILE_HEIGHT)},t.loadImageAsSprite=async(e,r)=>{let i=t.getSprite(r);if(i)return i[0];{o[r]=[new Image,0,0,0,0];let i=await t.loadImage(e);return s(o,i,r,i.width,i.height),i}},t.loadImageAsSpritesheet=async(e,r,i,a)=>{let n=t.getSprite(r);if(n)return n[0];{o[r]=[new Image,0,0,0,0];let n=await t.loadImage(e);return s(o,n,r,i,a),s(o,n,r,n.width,n.height),n}};let l=t.createSprite(document.createElement("canvas"),0,0,1,1);t.getSprite=e=>0===e.indexOf("invisible")?l:o[e];let c=[/props/,/effect_/,/control/,/walls(.*)/,/walls-anims/],A=e=>{for(let t=0;t<c.length;t++)if(c[t].test(e))return!1;return!0}})),define("controller/res-loader",["require","exports","model/animation","model/sprite","model/sound"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadRes=void 0;class o{async processAssetFile(e){let t=[],o=async function(e){let[,t,r,i]=e,o=parseFloat(i);return isNaN(o)&&(o=1),a.loadSound(t,r,a.SoundType.NORMAL,o)},n=async function(e){let[,t,r,i]=e,o=parseFloat(i);return isNaN(o)&&(o=1),a.loadSound(t,r,a.SoundType.MUSIC,o)},s=async function(e){let[,t,r,a,o]=e;if("invisible"!==t)return await i.loadImageAsSpritesheet(r,t,+a,+o)},l=function(e,t){let r=e[1],i=e[2].trim();t.name=r,t.loop=i.indexOf("true")>=0},c=function(e,t){t.addSprite({name:e[1],duration:parseFloat(e[2])})},A=e.split("\n"),d=new r.Animation(!1),u=function(){r.createAnimationBuilder(d.name,function(e){let t=new r.Animation(e.loop);return e.sprites.forEach(e=>{t.addSprite({name:e.name,duration:e.duration,opacity:e.opacity,offsetX:e.offsetX,offsetY:e.offsetY})}),t}.bind(this,d)),r.createAnimationBuilder(d.name+i.SpriteModification.FLIPPED,function(e){let t=new r.Animation(e.loop);return e.sprites.forEach(e=>{t.addSprite({name:e.name+i.SpriteModification.FLIPPED,duration:e.duration,opacity:e.opacity,offsetX:e.offsetX,offsetY:e.offsetY})}),t}.bind(this,d))};for(let e of A){let i=e.split(","),[a]=i;if("AnimSprite"!==a)switch(d&&u(),a){case"Picture":t.push(()=>s(i));break;case"Animation":d=new r.Animation(!1),l(i,d);continue;case"Sound":t.push(()=>o(i));break;case"Music":t.push(()=>n(i))}else{if(!d)throw console.error("Error reading res.txt, AnimSprite without Anim",i),Error("display loading error");c(i,d)}}d&&u();for(let e=0;e<t.length;e++)await t[e]()}async loadAssets(e){await this.processAssetFile(e)}}t.loadRes=async()=>{let e=await(await fetch("res/res.txt")).text(),t=await(await fetch("res/res-foley.txt")).text(),r=new o;return Promise.all([r.loadAssets(e),r.loadAssets(t)])}})),define("db/index",["require","exports","db/enemies/index","db/encounters","db/characters/index","db/overworlds","db/tiles","db/overworld-ai","db/animation-metadata","db/particles"],(function(e,t,r,i,a,o,n,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=async()=>{c.init(),r.init(),i.init(),a.init(),n.init(),s.init(),l.init(),await o.init()}})),define("main",["require","exports","model/sprite","controller/loop","controller/res-loader","model/canvas","controller/events","view/ui","view/hooks","model/scene","db/index","lib/rpgscript","model/generics","db/overworlds","controller/overworld-management","model/player","model/character","db/characters/index","controller/save-management","model/room"],(function(e,t,r,i,a,o,n,s,l,c,A,d,u,h,m,g,p,E,f,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.main=void 0,A=__importDefault(A),t.main=async()=>{s.mountUi(),c.initScene();let e=u.getCurrentScene();await d.loadRPGScript("quest",e),await d.loadRPGScript("test2",e),await d.loadRPGScript("test",e),await d.loadRPGScript("example",e),await d.loadRPGScript("utils",e),await d.loadRPGScript("floor1-atrium",e),await d.loadRPGScript("floor1-tut",e),await d.loadRPGScript("intro",e),await a.loadRes(),await w.loadDynamicPropsTileset(),await A.default(),await w.awaitAllRoomProps(),await r.loadTiles();try{let e=f.loadSettingsFromLS();f.setCurrentSettings(e)}catch(e){}o.getCanvas(),o.setDrawScale(4),n.initEvents(),l.initHooks(),i.runMainLoop();let t=E.get("Ada"),C=g.playerCreate(t),y=p.characterCreateFromTemplate(E.get("Conscience"));C.party.push(y),C.partyStorage.push(y),C.battlePositions.push(y);let b=function(e){let t={},r=("?"===e[0]?e.substr(1):e).split("&");for(let e=0;e<r.length;e++){let i=r[e].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]||"")}return t}(window.location.search);if(b.room){let e=h.get(b.room);m.initiateOverworld(C,e)}else m.initiateOverworld(C,h.get("TEST2"));m.enableOverworldControl(),document.getElementById("controls").style.display="none",s.renderUi()}})),define("lib/picostyle",["require","exports"],(function(e,t){"use strict";function r(e,t){var r="p"+o++,i=t+r;return e.forEach((function(e){if(/^@/.test(e)){var t=e.indexOf("{")+1;e=e.slice(0,t)+i+e.slice(t)}else e=i+e;n.insertRule(e,n.cssRules.length)})),r}function i(e,t){return t+"{"+e+"}"}function a(e,t){var r=[""];for(var o in t=t||0,e){var n=e[o];o=o.replace(/[A-Z]/g,"-$&").toLowerCase(),n.sub||Array.isArray(n)?(n=Array.isArray(n)?n:[n]).forEach((function(e){return r[0]+=o+":"+e+";"})):(o=o.replace(/&/g,""),r.push(i(a(n,!/^@/.test(o)).join(""),o)))}return t||(r[0]=i(r[0],"")),r}Object.defineProperty(t,"__esModule",{value:!0}),t.keyframes=void 0;var o=0,n=document.head.appendChild(document.createElement("style")).sheet;t.default=function(e,t){function i(t){return function(r){return function(i,a){a=(i=i||{}).children||a;var n="function"==typeof r?r(i):r;return i.class=[o(n),i.class].filter(Boolean).join(" "),e(t,i,a)}}}function o(e){var t=a(e),i=t.join("");return n[i]||(n[i]=r(t,"."))}var n={};return(t=t||{}).returnObject?{style:i,css:o}:i},t.keyframes=function(e){return r([i(a(e,1).join(""),"")],"@keyframes ")}})),define("lib/preact",["require","exports"],(function(e,t){"use strict";function r(e,t){for(var r in t)e[r]=t[r];return e}function i(e){var t=e.parentNode;t&&t.removeChild(e)}function a(e,t,r){var i,a,n,s=arguments,l={};for(n in t)"key"==n?i=t[n]:"ref"==n?a=t[n]:l[n]=t[n];if(arguments.length>3)for(r=[r],n=3;n<arguments.length;n++)r.push(s[n]);if(null!=r&&(l.children=r),"function"==typeof e&&null!=e.defaultProps)for(n in e.defaultProps)void 0===l[n]&&(l[n]=e.defaultProps[n]);return o(e,l,i,a,null)}function o(e,t,r,i,a){var o={type:e,props:t,key:r,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==a?++x.__v:a};return null!=x.vnode&&x.vnode(o),o}function n(e){return e.children}function s(e,t){this.props=e,this.context=t}function l(e,t){if(null==t)return e.__?l(e.__,e.__.__k.indexOf(e)+1):null;for(var r;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e)return r.__e;return"function"==typeof e.type?l(e):null}function c(e){var t,r;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e){e.__e=e.__c.base=r.__e;break}return c(e)}}function A(e){(!e.__d&&(e.__d=!0)&&I.push(e)&&!d.__r++||R!==x.debounceRendering)&&((R=x.debounceRendering)||_)(d)}function d(){for(var e;d.__r=I.length;)e=I.sort((function(e,t){return e.__v.__b-t.__v.__b})),I=[],e.some((function(e){var t,i,a,o,n,s,A;e.__d&&(s=(n=(t=e).__v).__e,(A=t.__P)&&(i=[],(a=r({},n)).__v=n.__v+1,o=w(A,n,a,t.__n,void 0!==A.ownerSVGElement,null!=n.__h?[s]:null,i,null==s?l(n):s,n.__h),C(i,n),o!=s&&c(n)))}))}function u(e,t,r,a,s,c,A,d,u,m){var g,p,E,f,C,y,S,v=a&&a.__k||O,x=v.length;for(u==D&&(u=null!=A?A[0]:x?l(a,0):null),r.__k=[],g=0;g<t.length;g++)if(null!=(f=r.__k[g]=null==(f=t[g])||"boolean"==typeof f?null:"string"==typeof f||"number"==typeof f?o(null,f,null,null,f):Array.isArray(f)?o(n,{children:f},null,null,null):null!=f.__e||null!=f.__c?o(f.type,f.props,f.key,null,f.__v):f)){if(f.__=r,f.__b=r.__b+1,null===(E=v[g])||E&&f.key==E.key&&f.type===E.type)v[g]=void 0;else for(p=0;p<x;p++){if((E=v[p])&&f.key==E.key&&f.type===E.type){v[p]=void 0;break}E=null}C=w(e,f,E=E||D,s,c,A,d,u,m),(p=f.ref)&&E.ref!=p&&(S||(S=[]),E.ref&&S.push(E.ref,null,f),S.push(p,f.__c||C,f)),null!=C?(null==y&&(y=C),u=h(e,f,E,v,A,C,u),m||"option"!=r.type?"function"==typeof r.type&&(r.__d=u):e.value=""):u&&E.__e==u&&u.parentNode!=e&&(u=l(E))}if(r.__e=y,null!=A&&"function"!=typeof r.type)for(g=A.length;g--;)null!=A[g]&&i(A[g]);for(g=x;g--;)null!=v[g]&&T(v[g],v[g]);if(S)for(g=0;g<S.length;g++)b(S[g],S[++g],S[++g])}function h(e,t,r,i,a,o,n){var s,l,c;if(void 0!==t.__d)s=t.__d,t.__d=void 0;else if(a==r||o!=n||null==o.parentNode)e:if(null==n||n.parentNode!==e)e.appendChild(o),s=null;else{for(l=n,c=0;(l=l.nextSibling)&&c<i.length;c+=2)if(l==o)break e;e.insertBefore(o,n),s=n}return void 0!==s?s:o.nextSibling}function m(e,t,r){"-"===t[0]?e.setProperty(t,r):e[t]=null==r?"":"number"!=typeof r||P.test(t)?r:r+"px"}function g(e,t,r,i,a){var o,n,s;if(a&&"className"==t&&(t="class"),"style"===t)if("string"==typeof r)e.style.cssText=r;else{if("string"==typeof i&&(e.style.cssText=i=""),i)for(t in i)r&&t in r||m(e.style,t,"");if(r)for(t in r)i&&r[t]===i[t]||m(e.style,t,r[t])}else"o"===t[0]&&"n"===t[1]?(o=t!==(t=t.replace(/Capture$/,"")),(n=t.toLowerCase())in e&&(t=n),t=t.slice(2),e.l||(e.l={}),e.l[t+o]=r,s=o?E:p,r?i||e.addEventListener(t,s,o):e.removeEventListener(t,s,o)):"list"!==t&&"tagName"!==t&&"form"!==t&&"type"!==t&&"size"!==t&&"download"!==t&&"href"!==t&&!a&&t in e?e[t]=null==r?"":r:"function"!=typeof r&&"dangerouslySetInnerHTML"!==t&&(t!==(t=t.replace(/xlink:?/,""))?null==r||!1===r?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):null==r||!1===r&&!/^ar/.test(t)?e.removeAttribute(t):e.setAttribute(t,r))}function p(e){this.l[e.type+!1](x.event?x.event(e):e)}function E(e){this.l[e.type+!0](x.event?x.event(e):e)}function f(e,t,r){var i,a;for(i=0;i<e.__k.length;i++)(a=e.__k[i])&&(a.__=e,a.__e&&("function"==typeof a.type&&a.__k.length>1&&f(a,t,r),t=h(r,a,a,e.__k,null,a.__e,t),"function"==typeof e.type&&(e.__d=t)))}function w(e,t,i,a,o,l,c,A,d){var h,m,g,p,E,w,C,b,T,v,B,I=t.type;if(void 0!==t.constructor)return null;null!=i.__h&&(d=i.__h,A=t.__e=i.__e,t.__h=null,l=[A]),(h=x.__b)&&h(t);try{e:if("function"==typeof I){if(b=t.props,T=(h=I.contextType)&&a[h.__c],v=h?T?T.props.value:h.__:a,i.__c?C=(m=t.__c=i.__c).__=m.__E:("prototype"in I&&I.prototype.render?t.__c=m=new I(b,v):(t.__c=m=new s(b,v),m.constructor=I,m.render=S),T&&T.sub(m),m.props=b,m.state||(m.state={}),m.context=v,m.__n=a,g=m.__d=!0,m.__h=[]),null==m.__s&&(m.__s=m.state),null!=I.getDerivedStateFromProps&&(m.__s==m.state&&(m.__s=r({},m.__s)),r(m.__s,I.getDerivedStateFromProps(b,m.__s))),p=m.props,E=m.state,g)null==I.getDerivedStateFromProps&&null!=m.componentWillMount&&m.componentWillMount(),null!=m.componentDidMount&&m.__h.push(m.componentDidMount);else{if(null==I.getDerivedStateFromProps&&b!==p&&null!=m.componentWillReceiveProps&&m.componentWillReceiveProps(b,v),!m.__e&&null!=m.shouldComponentUpdate&&!1===m.shouldComponentUpdate(b,m.__s,v)||t.__v===i.__v){m.props=b,m.state=m.__s,t.__v!==i.__v&&(m.__d=!1),m.__v=t,t.__e=i.__e,t.__k=i.__k,m.__h.length&&c.push(m),f(t,A,e);break e}null!=m.componentWillUpdate&&m.componentWillUpdate(b,m.__s,v),null!=m.componentDidUpdate&&m.__h.push((function(){m.componentDidUpdate(p,E,w)}))}m.context=v,m.props=b,m.state=m.__s,(h=x.__r)&&h(t),m.__d=!1,m.__v=t,m.__P=e,h=m.render(m.props,m.state,m.context),m.state=m.__s,null!=m.getChildContext&&(a=r(r({},a),m.getChildContext())),g||null==m.getSnapshotBeforeUpdate||(w=m.getSnapshotBeforeUpdate(p,E)),u(e,Array.isArray(B=null!=h&&h.type==n&&null==h.key?h.props.children:h)?B:[B],t,i,a,o,l,c,A,d),m.base=t.__e,t.__h=null,m.__h.length&&c.push(m),C&&(m.__E=m.__=null),m.__e=!1}else null==l&&t.__v===i.__v?(t.__k=i.__k,t.__e=i.__e):t.__e=y(i.__e,t,i,a,o,l,c,d);(h=x.diffed)&&h(t)}catch(e){t.__v=null,(d||null!=l)&&(t.__e=A,t.__h=!!d,l[l.indexOf(A)]=null),x.__e(e,t,i)}return t.__e}function C(e,t){x.__c&&x.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){x.__e(e,t.__v)}}))}function y(e,t,r,i,a,o,n,s){var l,c,A,d,h,m=r.props,p=t.props;if(a="svg"===t.type||a,null!=o)for(l=0;l<o.length;l++)if(null!=(c=o[l])&&((null===t.type?3===c.nodeType:c.localName===t.type)||e==c)){e=c,o[l]=null;break}if(null==e){if(null===t.type)return document.createTextNode(p);e=a?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type,p.is&&{is:p.is}),o=null,s=!1}if(null===t.type)m===p||s&&e.data===p||(e.data=p);else{if(null!=o&&(o=O.slice.call(e.childNodes)),A=(m=r.props||D).dangerouslySetInnerHTML,d=p.dangerouslySetInnerHTML,!s){if(null!=o)for(m={},h=0;h<e.attributes.length;h++)m[e.attributes[h].name]=e.attributes[h].value;(d||A)&&(d&&(A&&d.__html==A.__html||d.__html===e.innerHTML)||(e.innerHTML=d&&d.__html||""))}(function(e,t,r,i,a){var o;for(o in r)"children"===o||"key"===o||o in t||g(e,o,null,r[o],i);for(o in t)a&&"function"!=typeof t[o]||"children"===o||"key"===o||"value"===o||"checked"===o||r[o]===t[o]||g(e,o,t[o],r[o],i)})(e,p,m,a,s),d?t.__k=[]:u(e,Array.isArray(l=t.props.children)?l:[l],t,r,i,"foreignObject"!==t.type&&a,o,n,D,s),s||("value"in p&&void 0!==(l=p.value)&&(l!==e.value||"progress"===t.type&&!l)&&g(e,"value",l,m.value,!1),"checked"in p&&void 0!==(l=p.checked)&&l!==e.checked&&g(e,"checked",l,m.checked,!1))}return e}function b(e,t,r){try{"function"==typeof e?e(t):e.current=t}catch(e){x.__e(e,r)}}function T(e,t,r){var a,o,n;if(x.unmount&&x.unmount(e),(a=e.ref)&&(a.current&&a.current!==e.__e||b(a,null,t)),r||"function"==typeof e.type||(r=null!=(o=e.__e)),e.__e=e.__d=void 0,null!=(a=e.__c)){if(a.componentWillUnmount)try{a.componentWillUnmount()}catch(e){x.__e(e,t)}a.base=a.__P=null}if(a=e.__k)for(n=0;n<a.length;n++)a[n]&&T(a[n],t,r);null!=o&&i(o)}function S(e,t,r){return this.constructor(e,r)}function v(e,t,r){var i,o,s;x.__&&x.__(e,t),o=(i=r===M)?null:r&&r.__k||t.__k,e=a(n,null,[e]),s=[],w(t,(i?t:r||t).__k=e,o||D,D,void 0!==t.ownerSVGElement,r&&!i?[r]:o?null:t.childNodes.length?O.slice.call(t.childNodes):null,s,r||D,i),C(s,e)}Object.defineProperty(t,"__esModule",{value:!0}),t.options=t.__u=t.toChildArray=t.createContext=t.cloneElement=t.Component=t.isValidElement=t.createRef=t.Fragment=t.h=t.createElement=t.hydrate=t.render=void 0;var x,B,I,_,R,M,k,D={},O=[],P=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;t.options=x,t.isValidElement=B,t.createElement=a,t.h=a,t.createRef=function(){return{current:null}},t.Fragment=n,t.Component=s,t.toChildArray=function e(t,r){return r=r||[],null==t||"boolean"==typeof t||(Array.isArray(t)?t.some((function(t){e(t,r)})):r.push(t)),r},t.__u=T,t.render=v,t.hydrate=function(e,t){v(e,t,M)},t.cloneElement=function(e,t,i){var a,n,s,l=arguments,c=r({},e.props);for(s in t)"key"==s?a=t[s]:"ref"==s?n=t[s]:c[s]=t[s];if(arguments.length>3)for(i=[i],s=3;s<arguments.length;s++)i.push(l[s]);return null!=i&&(c.children=i),o(e.type,c,a||e.key,n||e.ref,null)},t.createContext=function(e,t){var r={__c:t="__cC"+k++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e,r,i){return this.getChildContext||(r=[],(i={})[t]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&r.some(A)},this.sub=function(e){r.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){r.splice(r.indexOf(e),1),t&&t.call(e)}}),e.children}};return r.Provider.__=r.Consumer.contextType=r},t.options=x={__e:function(e,t){for(var r,i,a,o=t.__h;t=t.__;)if((r=t.__c)&&!r.__)try{if((i=r.constructor)&&null!=i.getDerivedStateFromError&&(r.setState(i.getDerivedStateFromError(e)),a=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e),a=r.__d),a)return t.__h=o,r.__E=r}catch(t){e=t}throw e},__v:0},t.isValidElement=B=function(e){return null!=e&&void 0===e.constructor},s.prototype.setState=function(e,t){var i;i=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=r({},this.state),"function"==typeof e&&(e=e(r({},i),this.props)),e&&r(i,e),null!=e&&this.__v&&(t&&this.__h.push(t),A(this))},s.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),A(this))},s.prototype.render=n,I=[],_="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,d.__r=0,M=D,k=0})),define("view/components/BattleActionMenu",["require","exports","preact","view/elements/VerticalMenu","view/style"],(function(e,t,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=__importDefault(i);let o=a.style("div",()=>({})),n=a.style("div",()=>({display:"flex",justifyContent:"space-between",alignItems:"center"})),s=a.style("div",()=>({width:"24px",height:"24px"}));t.default=e=>r.h(o,null,r.h(i.default,{title:"ACTION",open:!0,onClose:e.onClose,width:"8rem",items:e.bCh.ch.skills.map((e,t)=>({label:r.h(n,null,r.h("span",null,e.name),r.h(s,null)),value:t})),onItemClick:t=>{e.bCh.ch.skillIndex=t,e.onClose()}}))})),define("view/components/BattleCharacterStatus",["require","exports","preact","model/battle-character","view/style","view/elements/AnimDiv","view/elements/ProgressBar","model/character","model/animation"],(function(e,t,r,i,a,o,n,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);let c=a.colors.GREEN,A=a.colors.BLUE,d=a.style("div",e=>({display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",width:"64px",boxShadow:e.highlighted?"0px 0px 67px 21px rgba(255, 255, 255,0.75)":"unset"})),u=a.style("div",{background:"black",border:"2px solid "+a.colors.GREY,position:"relative"}),h=a.style("div",{position:"absolute",top:"0",left:"1px"}),m=a.style("div",e=>({border:e.omitBorder?"":"2px solid "+a.colors.WHITE,width:"100%",borderBottomLeftRadius:e.bottom?"4px":0,borderBottomRightRadius:e.bottom?"4px":0,borderTopLeftRadius:e.top?"4px":0,borderTopRightRadius:e.top?"4px":0}));t.default=e=>{let t=t=>`${e.bCh.ch.name}_${t}`,g=e.bCh.ch.skills[e.bCh.ch.skillIndex],p="battlePortraits_"+e.bCh.ch.spriteBase;return l.hasAnimation(p)||(p="bartolo_portrait"),r.h(d,null,r.h(m,{top:!0},r.h(n.ProgressBarWithRender,{renderFunc:()=>e.bCh.actionTimer.getPctComplete(),renderKey:t("action"),backgroundColor:a.colors.BLACK,color:A,height:20,label:null==g?void 0:g.name})),r.h(u,null,r.h(o.default,{style:{width:"64px"},animName:p}),r.h(h,null,e.bCh.ch.name)),r.h(m,{top:!0,omitBorder:!0},r.h(n.ProgressBarWithRender,{renderFunc:()=>i.battleCharacterIsStaggered(e.bCh)?1:e.bCh.staggerGauge.getPct(),renderKey:t("stagger"),backgroundColor:a.colors.BLACK,color:i.battleCharacterIsStaggered(e.bCh)?a.colors.WHITE:a.colors.ORANGE,height:4,label:""})),r.h(m,{bottom:!0},r.h(n.ProgressBarWithRender,{renderFunc:()=>s.characterGetHpPct(e.bCh.ch),renderKey:t("hp"),backgroundColor:a.colors.BLACK,color:c,height:20,label:"HP: "+e.bCh.ch.hp})))}})),define("view/components/BattleUISection",["require","exports","preact","preact/hooks","view/style","view/components/BattleCharacterStatus","view/components/BattleActionMenu","view/elements/Button","controller/loop","model/generics"],(function(e,t,r,i,a,o,n,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),s=__importStar(s);let A=a.style("div",{position:"absolute",bottom:"0px",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",width:"100%"}),d=a.style("div",{display:"flex",justifyContent:"center",alignItems:"center",width:"100%"}),u=a.style("div",{position:"absolute",bottom:"150px",width:"100%",display:"flex",justifyContent:"center"}),h=a.style("div",{margin:"16px"});t.default=()=>{let[e,t]=i.useState(!1),a=c.getCurrentBattle();return r.h(r.Fragment,null,e?null:r.h(u,null,r.h(s.default,{type:s.ButtonType.PRIMARY,onClick:()=>{t(!e),l.pause()}},"PAUSE")),r.h(A,null,r.h(d,null,a.allies.map(e=>r.h(h,{key:e.ch.name},r.h(o.default,{battle:a,bCh:e}))),a.enemies.map(e=>r.h(h,{key:e.ch.name},r.h(o.default,{battle:a,bCh:e})))),e?r.h(n.default,{onClose:()=>{l.unpause(),t(!1)},open:e,bCh:a.allies[0]}):null))}})),define("view/elements/PillButton",["require","exports","view/style"],(function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonType=void 0,function(e){e[e.NEUTRAL=0]="NEUTRAL",e[e.PRIMARY=1]="PRIMARY",e[e.SECONDARY=2]="SECONDARY",e[e.ENEMY=3]="ENEMY"}(i=t.ButtonType||(t.ButtonType={}));let a={[i.NEUTRAL]:{top:r.colors.GREY,bottom:r.colors.DARKGREY_ALT},[i.PRIMARY]:{top:r.colors.BLUE,bottom:r.colors.DARKBLUE},[i.SECONDARY]:{top:r.colors.GREEN,bottom:r.colors.DARKGREEN},[i.ENEMY]:{top:r.colors.RED,bottom:r.colors.DARKRED}},o=r.keyframes({"0%":{filter:"brightness(100%)"},"50%":{filter:"brightness(80%)"},"100%":{filter:"brightness(100%)"}}),n=r.style("div",(e={type:i.NEUTRAL})=>({fontSize:"16px",textAlign:"center",padding:"2px 8px",cursor:e.disabled?"unset":"pointer",background:a[e.type].bottom,textDecoration:e.selected?"underline":"unset",transition:"border-radius 250sm",border:"2px solid "+(e.selected?r.colors.WHITE:e.disabled?r.colors.GREY:a[e.type].top),borderBottom:"0px solid transparent",filter:e.disabled?"brightness(80%)":"unset",animation:e.selected?o+" 1500ms linear infinite":"unset","&:hover":{filter:e.disabled?"unset":"brightness(120%)"},"&:active":{filter:e.disabled?"unset":"brightness(80%)",transform:"translateY(2px)"}}));t.default=n})),define("view/icons/RangedMulti",["require","exports","preact"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>r.h("svg",{fill:e.color,stroke:e.color,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},r.h("path",{d:"M0 0h512v512H0z",fill:"#000","fill-opacity":"1"}),r.h("g",{class:"",transform:"translate(0,0) rotateZ(-90deg)",style:""},r.h("path",{d:"M136.564 31.01l239.67 149.595c-12.418 21.234-20.756 28.302-45.027 46.936l156.3-26.33-85.603-125.474c4.936 24.85 8.85 38.5.75 60.49L136.568 31.01h-.004zM21.524 42.75l83.13 325.893c-21.017 5.232-30.98 3.262-58.875-3.96l124.046 113.45 13.426-166.844c-10.836 23.322-15.94 37.197-34.342 46.82L21.523 42.75zm64.353.215l252.2 353.16c-23.285 16.947-36.38 19.583-73.83 24.9l200.66 71.74L407.7 286.944c-2.477 33.743-2.313 53.14-20.37 74.09L85.877 42.965z",fill:e.color,"fill-opacity":"1"})))}))})();